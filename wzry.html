 <!DOCTYPE html>
 <html lang="zh-CN">

 	<head>
 		<meta charset="UTF-8">
 		<meta name="viewport"
 			content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
 		<meta name="apple-mobile-web-app-capable" content="yes">
 		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
 		<meta name="format-detection" content="telephone=no">
 		<title>SMART原则任务管理 | 自定义多巴胺闯关</title>
 		<script src="https://cdn.tailwindcss.com"></script>
 		<link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
 		<script>
 			tailwind.config = {
 				theme: {
 					extend: {
 						colors: {
							neonPink: '#FF2A6D',
							neonBlue: '#05D9E8',
							neonYellow: '#F7F99C',
							neonGreen: '#4EEC7B',
							darkBg: '#121826',
							gold: '#FFD700'
						},
 						animation: {
 							'pulse-fast': 'pulse 0.8s cubic-bezier(0.4, 0, 0.6, 1) infinite',
 							'bounce-slow': 'bounce 2s infinite',
 							'float': 'float 3s ease-in-out infinite',
 							'explode': 'explode 0.5s ease-out forwards',
 							'slide-up': 'slide-up 0.6s ease-out forwards',
 							'spin-slow': 'spin 3s linear infinite',
 							'glow-pulse': 'glowPulse 2s ease-in-out infinite',
 							'number-pop': 'numberPop 0.8s ease-out forwards',
 							'fade-in': 'fadeIn 0.5s ease-out forwards'
 						},
 						keyframes: {
 							float: {
 								'0%, 100%': {
 									transform: 'translateY(0)'
 								},
 								'50%': {
 									transform: 'translateY(-15px)'
 								}
 							},
 							explode: {
 								'0%': {
 									transform: 'scale(0)',
 									opacity: 1
 								},
 								'70%': {
 									transform: 'scale(1.2)',
 									opacity: 1
 								},
 								'100%': {
 									transform: 'scale(1)',
 									opacity: 1
 								}
 							},
 							'slide-up': {
 								'0%': {
 									transform: 'translateY(50px)',
 									opacity: 0
 								},
 								'100%': {
 									transform: 'translateY(0)',
 									opacity: 1
 								}
 							},
 							glowPulse: {
 								'0%, 100%': {
 									boxShadow: '0 0 10px currentColor, 0 0 30px currentColor'
 								},
 								'50%': {
 									boxShadow: '0 0 20px currentColor, 0 0 60px currentColor, 0 0 80px currentColor'
 								}
 							},
 							numberPop: {
 								'0%': {
 									transform: 'scale(0.8)',
 									opacity: 0
 								},
 								'50%': {
 									transform: 'scale(1.2)',
 									opacity: 1
 								},
 								'100%': {
 									transform: 'scale(1)',
 									opacity: 1
 								}
 							},
 							fadeIn: {
 								'0%': {
 									opacity: 0
 								},
 								'100%': {
 									opacity: 1
 								}
 							}
 						}
 					}
 				}
 			}
 		</script>
 		<style>
 			/* 动态任务类型标签样式 */

 			.type-tag-dynamic {
 				padding: 0.25rem 0.75rem;
 				border-radius: 9999px;
 				font-size: 0.75rem;
 				font-weight: bold;
 			}

 			#smartTaskModal form {
 				padding-bottom: 2rem !important;
 			}

 			#smartTaskModal input,
 			#smartTaskModal select {
 				font-size: 1rem !important;
 				padding: 0.75rem !important;
 			}

 			#smartTaskModal .animate-explode,
 			#customTaskModal .animate-explode,
 			#taskSwitchModal,
 			#editCardModal,
 			#rewardModal .animate-explode {
 				max-height: 90vh !important;
 				overflow-y: auto !important;
 				padding: 1rem !important;
 				width: 95vw !important;
 				max-width: 95vw !important;
 			}

 			#taskSwitchModal .card-select-item {
 				min-height: 80px !important;
 				display: flex !important;
 				align-items: center !important;
 				justify-content: center !important;
 			}

 			#taskSwitchModal {
 				padding: 1rem !important;
 			}
 		</style>
 		<style type="text/tailwindcss">
 			.wechat-notification { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background-color: white; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.3); width: 90%; max-width: 400px; z-index: 9999; overflow: hidden; animation:
        slideUp 0.3s ease-out forwards; } .wechat-notification-header { background-color: #07C160; color: white; padding: 8px 15px; font-size: 14px; font-weight: bold; display: flex; justify-content: space-between; align-items: center; } .wechat-notification-close
        { width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; cursor: pointer; } .wechat-notification-body { padding: 15px; color: #333; } .wechat-notification-title { font-size: 16px; font-weight: bold; margin-bottom:
        8px; color: #1A1A1A; } .wechat-notification-content { font-size: 14px; color: #666; line-height: 1.4; margin-bottom: 12px; } .wechat-notification-btn { display: flex; justify-content: flex-end; gap: 10px; } .wechat-notification-btn button { padding:
        6px 15px; border-radius: 6px; font-size: 14px; cursor: pointer; border: 1px solid #ddd; } .wechat-notification-btn .btn-confirm { background-color: #07C160; color: white; border-color: #07C160; } @keyframes slideUp { from { transform: translate(-50%,
        100%); opacity: 0; } to { transform: translate(-50%, 0); opacity: 1; } }
        
        @keyframes particle-float {
            0% {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) scale(0);
                opacity: 0;
            }
        }
        
        @keyframes pulse-fast {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }
        
        @keyframes glowPulse {
            0%, 100% {
                box-shadow: 0 0 10px currentColor, 0 0 30px currentColor;
            }
            50% {
                box-shadow: 0 0 20px currentColor, 0 0 45px currentColor;
            }
        }
        
        @keyframes explode {
            0% {
                transform: scale(0);
                opacity: 0;
            }
            70% {
                transform: scale(1.2);
                opacity: 1;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        @keyframes bounce-slow {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
            100% {
                transform: translateY(0);
            }
        }
        
        @keyframes spin-slow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes number-pop {
            0% {
                transform: scale(0.8);
                opacity: 0;
            }
            50% {
                transform: scale(1.2);
                opacity: 1;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        @keyframes slide-up {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        @keyframes float {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-20px);
            }
        }
        
        /* 角标提醒样式（仿微信小红点） */
        .wechat-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 18px;
            height: 18px;
            background-color: #FF3B30;
            color: white;
            border-radius: 50%;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        @media (max-width: 480px) {
            .modal-mobile {
                width: 98vw !important;
                max-width: 98vw !important;
                padding: 0.5rem !important;
            }
            .modal-mobile form {
                gap: 1rem !important;
            }
            .modal-mobile input, .modal-mobile select, .modal-mobile textarea {
                font-size: 0.9rem !important;
                padding: 0.5rem !important;
            }
            .modal-mobile button {
                padding: 0.5rem !important;
                font-size: 1rem !important;
            }
        }
        
        .text-shadow-neon {
            text-shadow: 0 0 5px currentColor, 0 0 20px currentColor, 0 0 40px currentColor;
        }
        
        .bg-glow {
            box-shadow: 0 0 10px currentColor, 0 0 30px currentColor;
        }
        
        .bg-glow-hover {
            transition: all 0.3s ease;
        }
        
        .bg-glow-hover:hover {
            box-shadow: 0 0 15px currentColor, 0 0 45px currentColor, 0 0 75px currentColor;
        }
        
        .clip-path-star {
            clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
        }
        
        .particle {
            position: absolute;
            border-radius: 50%;
            pointer-events: none;
            opacity: 0.8;
        }
        
        .firework {
            position: absolute;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            pointer-events: none;
        }
        
        .task-card {
            transition: all 0.3s ease;
        }
        
        .task-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px -5px rgba(5, 217, 232, 0.2);
        }
        
        .record-btn-highlight {
            animation: glowPulse 1.5s ease-in-out infinite;
        }
        
        .smart-label {
            color: #F7F99C;
            margin-bottom: 0.5rem;
            font-size: 1.125rem;
            display: flex;
            align-items: center;
        }
        
        .smart-label::after {
            content: '';
            margin-left: 0.5rem;
            width: 0.5rem;
            height: 0.5rem;
            border-radius: 50%;
            background-color: #FF2A6D;
        }
        
        .smart-hint {
            font-size: 0.75rem;
            color: #9CA3AF;
            margin-top: 0.25rem;
            font-style: italic;
        }
        
        .filter-active {
            background-color: #FF2A6D !important;
            color: white !important;
        }
        
        .transition-modal {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .scale-in {
            transform: scale(1);
            opacity: 1;
            pointer-events: auto;
        }
        
        .scale-out {
            transform: scale(0.95);
            opacity: 0;
            pointer-events: none;
            visibility: hidden;
        }
        
        .chart-container {
            position: relative;
            width: 100%;
            height: 300px;
            margin: 1rem 0;
        }
        
        .timeline-item {
            position: relative;
            padding-left: 2rem;
            padding-bottom: 1.5rem;
            border-left: 2px solid #05D9E8;
        }
        
        .timeline-dot {
            position: absolute;
            left: -8px;
            top: 0;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background-color: #FF2A6D;
        }
        
        .timeline-time {
            color: #F7F99C;
            font-size: 0.875rem;
            margin-bottom: 0.25rem;
        }
        
        .card-setting-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: rgba(17, 24, 39, 0.8);
            border: 2px solid #05D9E8;
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }
        
        .card-setting-item:hover {
            border-color: #FF2A6D;
            transform: translateX(5px);
        }
        
        .card-delete-btn {
            color: #FF4444;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .card-delete-btn:hover {
            color: #FF6666;
            transform: scale(1.1);
        }
        
        .card-type-tag {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: bold;
        }
        
        .type-tag {
            background-color: rgba(5, 217, 232, 0.2);
            color: #05D9E8;
        }
        
        .type-tag-study {
            background-color: rgba(5, 217, 232, 0.2);
            color: #05D9E8;
        }
        
        .type-tag-rest {
            background-color: rgba(78, 236, 123, 0.2);
            color: #4EEC7B;
        }
        
        .type-tag-work {
            background-color: rgba(255, 42, 109, 0.2);
            color: #FF2A6D;
        }
        
        .type-tag-life {
            background-color: rgba(247, 249, 156, 0.2);
            color: #F7F99C;
        }
        
        .type-tag-dynamic {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: bold;
        }
        
        /* 移动端字体大小优化 */
        @media (max-width: 640px) {
            /* 基础字体优化 */
            body {
                font-size: 14px;
                line-height: 1.5;
            }
            
            /* 标题字体优化 */
            h1 {
                font-size: 1.5rem;
                line-height: 1.3;
            }
            
            h2 {
                font-size: 1.25rem;
                line-height: 1.3;
            }
            
            h3 {
                font-size: 1.1rem;
                line-height: 1.3;
            }
            
            /* 段落和文本优化 */
            p {
                font-size: 0.9rem;
                line-height: 1.6;
            }
            
            span, label, div {
                font-size: 0.9rem;
            }
            
            /* 按钮文本优化 */
            button {
                font-size: 0.9rem;
                line-height: 1.4;
            }
            
            /* 输入框文本优化 */
            input, select, textarea {
                font-size: 1rem;
                line-height: 1.4;
            }
            
            /* 特定元素字体优化 */
            #timer {
                font-size: 3.5rem !important;
                line-height: 1;
            }
            
            #gameTaskTitle {
                font-size: 1.25rem !important;
                line-height: 1.3;
            }
            
            /* 转盘相关字体优化 */
            .wheel-button {
                font-size: 0.85rem;
            }
            
            .wheel-subtitle {
                font-size: 12px;
            }
            
            .wheel-reward-display {
                font-size: 14px;
            }
            
            /* 奖励模块字体优化 */
            #rewardModuleScreen h2 {
                font-size: 1.5rem !important;
            }
            
            #rewardModuleScreen button {
                font-size: 0.85rem;
            }
            
            /* 任务记录页面字体优化 */
            #recordScreen h2 {
                font-size: 1.5rem !important;
            }
            
            #recordScreen button {
                font-size: 0.85rem;
            }
            
            #recordScreen select {
                font-size: 0.9rem;
            }
            
            #recordScreen input[type="date"] {
                font-size: 0.9rem;
            }
            
            /* 周期任务页面字体优化 */
            #periodicTaskScreen h2 {
                font-size: 1.5rem !important;
            }
            
            /* 子任务列表字体优化 */
            #subtaskList button {
                font-size: 0.85rem;
            }
            
            #subtaskList input[type="text"] {
                font-size: 0.9rem;
            }
            
            /* 弹窗字体优化 */
            .modal h2, .modal h3 {
                font-size: 1.25rem;
            }
            
            .modal p, .modal span, .modal label {
                font-size: 0.9rem;
            }
            
            /* 背包弹窗字体优化 */
            #backpackModal h2 {
                font-size: 1.5rem;
            }
            
            #backpackModal .text-4xl {
                font-size: 2rem;
            }
            
            #backpackModal .text-xl {
                font-size: 1rem;
            }
            
            #backpackModal .text-sm {
                font-size: 0.85rem;
            }
            
            /* 微信通知字体优化 */
            .wechat-notification {
                font-size: 0.9rem;
            }
            
            /* 统计卡片字体优化 */
            .grid-cols-1.md\:grid-cols-4 h3 {
                font-size: 1rem;
            }
            
            .grid-cols-1.md\:grid-cols-4 p {
                font-size: 0.85rem;
            }
            
            /* 图表字体优化 */
            .chart-container {
                font-size: 0.85rem;
            }
            
            /* 历史记录筛选器字体优化 */
            #filterContainer button {
                font-size: 0.9rem;
            }
            
            #filterContainer select {
                font-size: 0.9rem;
            }
            
            #filterContainer input[type="date"] {
                font-size: 0.9rem;
            }
            
            /* 文本对比度优化 */
            .text-white {
                color: #ffffff;
            }
            
            .text-gray-400 {
                color: #9ca3af;
            }
            
            /* 文本阴影优化 */
            .text-shadow-neon {
                text-shadow: 0 0 10px currentColor, 0 0 20px currentColor;
            }
            
            /* 字体粗细优化 */
            .font-bold {
                font-weight: 700;
            }
            
            .font-medium {
                font-weight: 500;
            }
        }
        
        /* 平板字体大小优化 */
        @media (min-width: 641px) and (max-width: 1024px) {
            body {
                font-size: 15px;
                line-height: 1.5;
            }
            
            h1 {
                font-size: 1.75rem;
            }
            
            h2 {
                font-size: 1.5rem;
            }
            
            h3 {
                font-size: 1.25rem;
            }
            
            p {
                font-size: 0.95rem;
            }
            
            #timer {
                font-size: 4rem !important;
            }
            
            #gameTaskTitle {
                font-size: 1.5rem !important;
            }
            
            .wheel-button {
                font-size: 0.9rem;
            }
            
            .wheel-subtitle {
                font-size: 13px;
            }
            
            .wheel-reward-display {
                font-size: 15px;
            }
        }
        
        /* 超小屏幕字体优化 (小于 375px) */
        @media (max-width: 374px) {
            body {
                font-size: 13px;
                line-height: 1.4;
            }
            
            h1 {
                font-size: 1.25rem;
            }
            
            h2 {
                font-size: 1.1rem;
            }
            
            h3 {
                font-size: 1rem;
            }
            
            p {
                font-size: 0.85rem;
            }
            
            #timer {
                font-size: 3rem !important;
            }
            
            #gameTaskTitle {
                font-size: 1.1rem !important;
            }
            
            .wheel-button {
                font-size: 0.8rem;
            }
            
            .wheel-subtitle {
                font-size: 11px;
            }
            
            .wheel-reward-display {
                font-size: 13px;
            }
            
            button {
                font-size: 0.8rem;
            }
            
            input, select, textarea {
                font-size: 0.85rem;
            }
        }
        
        /* 横屏字体优化 */
        @media (max-height: 500px) and (orientation: landscape) {
            body {
                font-size: 13px;
                line-height: 1.3;
            }
            
            h1 {
                font-size: 1.1rem;
            }
            
            h2 {
                font-size: 1rem;
            }
            
            h3 {
                font-size: 0.95rem;
            }
            
            p {
                font-size: 0.85rem;
            }
            
            #timer {
                font-size: 2.5rem !important;
            }
            
            #gameTaskTitle {
                font-size: 1rem !important;
            }
            
            .wheel-button {
                font-size: 0.75rem;
            }
            
            .wheel-subtitle {
                font-size: 10px;
            }
            
            .wheel-reward-display {
                font-size: 12px;
            }
        }
        
        /* 移动端按钮大小和间距优化 */
        @media (max-width: 640px) {
            body {
                padding: 0.5rem;
                font-size: 14px;
            }
            
            /* 通用按钮优化 */
            button {
                min-height: 48px;
                padding: 0.75rem 1.5rem;
                font-size: 0.9rem;
                border-radius: 0.5rem;
                transition: all 0.2s ease;
            }
            
            /* 按钮组间距优化 */
            .flex.gap-2 {
                gap: 0.5rem;
            }
            
            .flex.gap-4 {
                gap: 0.75rem;
            }
            
            .flex.gap-6 {
                gap: 1rem;
            }
            
            /* 开始界面按钮优化 */
            #startScreen button {
                width: 100%;
                max-width: 300px;
                padding: 0.875rem 1rem;
                font-size: 1rem;
                min-height: 52px;
                margin-bottom: 0.5rem;
            }
            
            /* 开始界面按钮组优化 */
            #startScreen .flex.flex-col {
                gap: 0.75rem;
                width: 100%;
                max-width: 400px;
                padding: 0 1rem;
            }
            
            #startScreen .flex.flex-col button {
                width: 100%;
                padding: 0.875rem 1rem;
                font-size: 0.95rem;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                min-height: 52px;
            }
            
            /* 游戏界面按钮优化 */
            #gameScreen button {
                padding: 0.75rem 1.5rem;
                font-size: 0.9rem;
                min-height: 48px;
                margin: 0.25rem;
            }
            
            #gameScreen .flex.gap-6 {
                gap: 0.5rem;
                flex-wrap: wrap;
                justify-content: center;
            }
            
            /* 奖励模块按钮优化 */
            #rewardModuleScreen button {
                padding: 0.5rem 0.75rem;
                font-size: 0.85rem;
                min-height: 44px;
                margin: 0.25rem;
            }
            
            #rewardModuleScreen .flex.gap-4 {
                gap: 0.5rem;
                flex-wrap: wrap;
                justify-content: center;
            }
            
            /* 转盘按钮优化 */
            .wheel-button {
                padding: 0.5rem 1rem;
                font-size: 0.85rem;
                min-height: 44px;
                bottom: -50px;
                border-radius: 9999px;
                box-shadow: 0 4px 15px rgba(236, 72, 153, 0.4);
            }
            
            /* 任务记录页面按钮优化 */
            #recordScreen button {
                padding: 0.5rem 0.75rem;
                font-size: 0.85rem;
                min-height: 44px;
                margin: 0.25rem;
            }
            
            #recordScreen .flex.gap-4 {
                gap: 0.5rem;
                flex-wrap: wrap;
                justify-content: center;
            }
            
            /* 周期任务页面按钮优化 */
            #periodicTaskScreen button {
                padding: 0.5rem 0.75rem;
                font-size: 0.85rem;
                min-height: 44px;
                margin: 0.25rem;
            }
            
            #periodicTaskScreen .flex.gap-4 {
                gap: 0.5rem;
                flex-wrap: wrap;
                justify-content: center;
            }
            
            /* 子任务列表按钮优化 */
            #subtaskList button {
                padding: 0.5rem 0.75rem;
                font-size: 0.85rem;
                min-height: 44px;
                margin: 0.25rem;
            }
            
            #subtaskList .flex.gap-2 {
                gap: 0.5rem;
                flex-wrap: wrap;
                justify-content: center;
            }
            
            /* 弹窗按钮优化 */
            .modal button {
                padding: 0.75rem 1.5rem;
                font-size: 0.9rem;
                min-height: 48px;
                margin: 0.5rem;
                width: auto;
                min-width: 120px;
            }
            
            .modal .flex {
                justify-content: center;
                flex-wrap: wrap;
            }
            
            /* 背包弹窗按钮优化 */
            #backpackModal button {
                padding: 0.5rem 0.75rem;
                font-size: 0.85rem;
                min-height: 44px;
            }
            
            #backpackModal .exchange-btn {
                padding: 0.5rem 0.75rem;
                font-size: 0.85rem;
                min-height: 40px;
            }
            
            /* 历史记录筛选器按钮优化 */
            #filterContainer button {
                flex: 1;
                min-width: 80px;
                padding: 0.5rem 0.75rem;
                font-size: 0.9rem;
                min-height: 44px;
                margin: 0.25rem;
            }
            
            #filterContainer .flex {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            /* 按钮悬停效果优化 */
            button:hover {
                transform: scale(1.05);
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            }
            
            /* 按钮点击效果优化 */
            button:active {
                transform: scale(0.95);
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            }
            
            /* 按钮禁用状态优化 */
            button:disabled {
                opacity: 0.5;
                cursor: not-allowed;
                transform: none;
            }
            
            /* 图标按钮优化 */
            button i {
                font-size: 1rem;
            }
            
            /* 按钮内边距优化 */
            button i + span,
            button span + i {
                margin-left: 0.5rem;
            }
            
            /* 成就展示区优化 */
            #startScreen .flex.gap-6 {
                gap: 1rem;
                flex-wrap: wrap;
                justify-content: center;
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                max-width: 300px;
                margin: 0 auto;
            }
            
            #startScreen .flex.gap-6 > div {
                min-width: auto;
                width: 100%;
            }
            
            #startScreen .w-16 {
                width: 3rem;
                height: 3rem;
            }
            
            /* 成就墙优化 */
            #achievementWall {
                gap: 0.5rem;
            }
            
            #achievementWall .w-12 {
                width: 2.5rem;
                height: 2.5rem;
            }
            
       
            
            /* 游戏界面优化 */
            #gameScreen {
                padding: 1rem;
            }
            
            #timer {
                font-size: 3.5rem !important;
            }
            
            #gameTaskTitle {
                font-size: 1.25rem !important;
            }
            
            /* 按钮组优化 */
            #gameScreen .flex.gap-6 {
                gap: 0.5rem;
                flex-wrap: wrap;
            }
            
            #gameScreen button {
                padding: 0.75rem 1.5rem;
                font-size: 0.9rem;
                min-height: 48px;
            }
            
            /* 弹窗优化 */
            .modal {
                width: 95vw;
                max-height: 90vh;
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
                padding: 1rem;
            }
            
            /* 弹窗按钮优化 */
            .modal button {
                padding: 0.75rem 1.5rem;
                font-size: 0.9rem;
                min-height: 48px;
                margin: 0.5rem;
                width: auto;
                min-width: 120px;
            }
            
            .modal .flex {
                justify-content: center;
                flex-wrap: wrap;
            }
            
            /* 弹窗内容优化 */
            .modal h2, .modal h3 {
                font-size: 1.25rem;
                line-height: 1.3;
            }
            
            .modal p, .modal span, .modal label {
                font-size: 0.9rem;
                line-height: 1.6;
            }
            
            /* 弹窗输入框优化 */
            .modal input, .modal select, .modal textarea {
                padding: 0.75rem;
                font-size: 1rem;
                min-height: 44px;
                width: 100%;
            }
            
            /* 弹窗网格布局优化 */
            .modal .grid {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }
            
            .modal .grid-cols-2 {
                grid-template-columns: 1fr;
            }
            
            .modal .grid-cols-3 {
                grid-template-columns: 1fr;
            }
            
            .modal .grid-cols-4 {
                grid-template-columns: 1fr 1fr;
            }
            
            /* 网格布局优化 */
            .grid-cols-2 {
                grid-template-columns: 1fr;
            }
            
            .grid-cols-3 {
                grid-template-columns: 1fr;
            }
            
            .grid-cols-4 {
                grid-template-columns: 1fr 1fr;
            }
            
            /* 文字大小优化 */
            h1, h2, h3 {
                font-size: 1.25rem;
            }
            
            p, span, label {
                font-size: 0.9rem;
            }
            
            /* 输入框优化 */
            input, select, textarea {
                font-size: 1rem;
                padding: 0.75rem;
                min-height: 44px;
            }
            
            /* 奖励模块优化 */
            #rewardModuleScreen {
                padding: 0.5rem;
            }
            
            #rewardModuleScreen h2 {
                font-size: 1.5rem !important;
            }
            
            #rewardModuleScreen .flex.gap-4 {
                gap: 0.5rem;
                flex-wrap: wrap;
            }
            
            #rewardModuleScreen button {
                padding: 0.5rem 0.75rem;
                font-size: 0.85rem;
                min-height: 44px;
            }
            
            /* 转盘容器优化 */
            .wheel-container {
                padding: 15px;
            }
            
            .w-48 {
                width: 8rem !important;
                height: 8rem !important;
            }
            
            /* 转盘按钮优化 */
            .wheel-button {
                padding: 0.5rem 1rem;
                font-size: 0.85rem;
                min-height: 44px;
                bottom: -50px;
            }
            
            .wheel-subtitle {
                bottom: -70px;
                font-size: 12px;
            }
            
            /* 转盘奖励显示优化 */
            .wheel-reward-display {
                margin-top: 50px;
                padding: 15px 20px;
                font-size: 14px;
                min-height: 60px;
            }
            
            /* 任务记录页面优化 */
            #recordScreen {
                padding: 0.5rem;
            }
            
            #recordScreen h2 {
                font-size: 1.5rem !important;
            }
            
            #recordScreen .flex.gap-4 {
                gap: 0.5rem;
                flex-wrap: wrap;
            }
            
            #recordScreen button {
                padding: 0.5rem 0.75rem;
                font-size: 0.85rem;
                min-height: 44px;
            }
            
            #recordScreen select {
                padding: 0.5rem;
                font-size: 0.9rem;
                min-height: 44px;
            }
            
            #recordScreen input[type="date"] {
                padding: 0.5rem;
                font-size: 0.9rem;
                min-height: 44px;
            }
            
            /* 周期任务页面优化 */
            #periodicTaskScreen {
                padding: 0.5rem;
            }
            
            #periodicTaskScreen h2 {
                font-size: 1.5rem !important;
            }
            
            #periodicTaskScreen .flex.gap-4 {
                gap: 0.5rem;
                flex-wrap: wrap;
            }
            
            /* 子任务列表优化 */
            #subtaskList {
                padding: 0.5rem;
            }
            
            #subtaskList .flex.gap-2 {
                gap: 0.5rem;
                flex-wrap: wrap;
            }
            
            #subtaskList button {
                padding: 0.5rem 0.75rem;
                font-size: 0.85rem;
                min-height: 44px;
            }
            
            #subtaskList input[type="text"] {
                padding: 0.5rem;
                font-size: 0.9rem;
                min-height: 44px;
            }
            
            /* 触摸优化 */
            button, input, select, textarea {
                min-height: 44px;
            }
            
            /* 防止双击缩放 */
            * {
                touch-action: manipulation;
            }
            
            /* 触摸反馈优化 */
            button:active {
                transform: scale(0.95);
                transition: transform 0.1s ease;
            }
            
            /* 滑动优化 */
            .overflow-y-auto {
                -webkit-overflow-scrolling: touch;
            }
            
            /* 背包弹窗优化 */
            #backpackModal {
                padding: 1rem;
            }
            
            #backpackModal .grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            #backpackModal button {
                padding: 0.5rem 0.75rem;
                font-size: 0.85rem;
                min-height: 44px;
            }
            
            #backpackModal .exchange-btn {
                padding: 0.5rem 0.75rem;
                font-size: 0.85rem;
                min-height: 40px;
            }
            
            #backpackModal h2 {
                font-size: 1.5rem;
            }
            
            #backpackModal .text-4xl {
                font-size: 2rem;
            }
            
            #backpackModal .text-xl {
                font-size: 1rem;
            }
            
            #backpackModal .text-sm {
                font-size: 0.85rem;
            }
            
            /* 奖励弹窗优化 */
            #backpackRewardModal, #pointsModal {
                padding: 1rem;
                max-width: 90vw;
            }
            
            #backpackRewardModal h2, #pointsModal h2 {
                font-size: 1.5rem;
            }
            
            #backpackRewardModal p, #pointsModal p {
                font-size: 1rem;
            }
            
            #backpackRewardModal button, #pointsModal button {
                padding: 0.75rem 1.5rem;
                font-size: 1rem;
                min-height: 48px;
            }
            
            /* 微信通知优化 */
            .wechat-notification {
                width: 95%;
                max-width: 95%;
                left: 50%;
                transform: translateX(-50%);
                font-size: 0.9rem;
                padding: 1rem;
            }
            
            /* 背景音乐选择弹窗优化 */
            #bgMusicSelectModal {
                padding: 1rem;
                max-width: 95vw;
            }
            
            #bgMusicSelectModal h2 {
                font-size: 1.25rem;
            }
            
            #bgMusicSelectModal .bg-music-option {
                padding: 0.75rem;
                font-size: 0.9rem;
                min-height: 48px;
            }
            
            /* 版本信息弹窗优化 */
            #versionInfoModal {
                padding: 1rem;
                max-width: 95vw;
                max-height: 90vh;
                overflow-y: auto;
            }
            
            #versionInfoModal h2 {
                font-size: 1.25rem;
            }
            
            #versionInfoModal p, #versionInfoModal li {
                font-size: 0.9rem;
            }
            
            /* 奖励记录优化 */
            #rewardHistory {
                max-height: 150px;
            }
            
            /* 图表容器优化 */
            .chart-container {
                height: 200px;
            }
            
            /* 历史记录筛选器优化 */
            #filterContainer {
                flex-direction: column;
                gap: 0.75rem;
            }
            
            #filterContainer > div {
                width: 100%;
            }
            
            #filterContainer .flex {
                flex-wrap: wrap;
            }
            
            #filterContainer button {
                flex: 1;
                min-width: 80px;
                padding: 0.5rem 0.75rem;
                font-size: 0.9rem;
                min-height: 44px;
            }
            
            #filterContainer select {
                width: 100%;
                padding: 0.5rem;
                font-size: 0.9rem;
                min-height: 44px;
            }
            
            #filterContainer input[type="date"] {
                flex: 1;
                min-width: 120px;
                padding: 0.5rem;
                font-size: 0.9rem;
                min-height: 44px;
            }
            
            /* 统计卡片优化 */
            .grid-cols-1.md\:grid-cols-4 {
                grid-template-columns: 1fr 1fr;
                gap: 0.75rem;
            }
            
            /* 微信通知优化 */
            .wechat-notification {
                width: 95%;
                max-width: 95%;
                left: 50%;
                transform: translateX(-50%);
            }
            
            /* 转盘区域网格优化 */
            #rewardModuleScreen .grid-cols-1.md\:grid-cols-3 {
                grid-template-columns: 1fr;
                gap: 2rem;
            }
            
            /* 转盘容器额外优化 */
            .wheel-container {
                margin: 0 auto;
            }
        }
        
        /* 平板和小屏幕优化 */
        @media (min-width: 641px) and (max-width: 1024px) {
            body {
                padding: 1rem;
            }
            
            /* 转盘容器优化 */
            .wheel-container {
                padding: 20px;
            }
            
            .w-48 {
                width: 10rem !important;
                height: 10rem !important;
            }
            
            /* 转盘按钮优化 */
            .wheel-button {
                padding: 0.75rem 1.5rem;
                font-size: 0.9rem;
                bottom: -40px;
            }
            
            .wheel-subtitle {
                bottom: -60px;
                font-size: 13px;
            }
            
            /* 转盘奖励显示优化 */
            .wheel-reward-display {
                margin-top: 40px;
                padding: 15px 20px;
                font-size: 15px;
                min-height: 50px;
            }
            
            /* 转盘区域网格优化 */
            #rewardModuleScreen .grid-cols-1.md\:grid-cols-3 {
                grid-template-columns: 1fr 1fr;
                gap: 2rem;
            }
            
            /* 背包弹窗优化 */
            #backpackModal .grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            /* 平板弹窗优化 */
            .modal {
                padding: 1.5rem;
                max-width: 85vw;
            }
            
            .modal h2, .modal h3 {
                font-size: 1.5rem;
            }
            
            .modal p, .modal span, .modal label {
                font-size: 1rem;
            }
            
            .modal button {
                padding: 0.875rem 1.75rem;
                font-size: 0.95rem;
                min-height: 52px;
            }
            
            .modal input, .modal select, .modal textarea {
                padding: 0.875rem;
                font-size: 1rem;
                min-height: 48px;
            }
            
            #backpackModal .grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            #backpackModal h2 {
                font-size: 1.75rem;
            }
            
            #backpackRewardModal, #pointsModal {
                max-width: 80vw;
            }
            
            #backpackRewardModal h2, #pointsModal h2 {
                font-size: 1.75rem;
            }
            
            #bgMusicSelectModal {
                max-width: 85vw;
            }
            
            #versionInfoModal {
                max-width: 85vw;
            }
            
            /* 统计卡片优化 */
            .grid-cols-1.md\:grid-cols-4 {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }
            
            /* 图表容器优化 */
            .chart-container {
                height: 250px;
            }
            
            /* 历史记录筛选器优化 */
            #filterContainer {
                flex-direction: row;
                gap: 1rem;
            }
            
            #filterContainer > div {
                width: auto;
            }
            
            #filterContainer button {
                min-width: 100px;
            }
            
            /* 平板按钮优化 */
            button {
                min-height: 52px;
                padding: 0.875rem 1.75rem;
                font-size: 0.95rem;
            }
            
            #startScreen button {
                min-height: 56px;
                padding: 1rem 1.25rem;
                font-size: 1.05rem;
            }
            
            #gameScreen button {
                min-height: 52px;
                padding: 0.875rem 1.75rem;
                font-size: 0.95rem;
            }
            
            .wheel-button {
                padding: 0.75rem 1.5rem;
                font-size: 0.9rem;
                min-height: 48px;
            }
        }
        
        /* 超小屏幕优化 (小于 375px) */
        @media (max-width: 374px) {
            body {
                padding: 0.25rem;
                font-size: 13px;
            }
            
            #timer {
                font-size: 3rem !important;
            }
            
            #gameTaskTitle {
                font-size: 1.1rem !important;
            }
            
            /* 转盘容器优化 */
            .wheel-container {
                padding: 10px;
            }
            
            .w-48 {
                width: 7rem !important;
                height: 7rem !important;
            }
            
            /* 转盘按钮优化 */
            .wheel-button {
                padding: 0.4rem 0.8rem;
                font-size: 0.8rem;
                min-height: 40px;
                bottom: -45px;
            }
            
            .wheel-subtitle {
                bottom: -65px;
                font-size: 11px;
            }
            
            /* 转盘奖励显示优化 */
            .wheel-reward-display {
                margin-top: 45px;
                padding: 12px 15px;
                font-size: 13px;
                min-height: 50px;
            }
            
            /* 背包弹窗优化 */
            #backpackModal .grid {
                grid-template-columns: 1fr;
            }
            
            /* 超小屏幕弹窗优化 */
            .modal {
                padding: 0.75rem;
                max-width: 98vw;
            }
            
            .modal h2, .modal h3 {
                font-size: 1.1rem;
            }
            
            .modal p, .modal span, .modal label {
                font-size: 0.85rem;
            }
            
            .modal button {
                padding: 0.5rem 0.75rem;
                font-size: 0.85rem;
                min-height: 44px;
                min-width: 100px;
            }
            
            .modal input, .modal select, .modal textarea {
                padding: 0.5rem;
                font-size: 0.9rem;
                min-height: 40px;
            }
            
            #backpackModal h2 {
                font-size: 1.25rem;
            }
            
            #backpackModal .text-4xl {
                font-size: 1.5rem;
            }
            
            #backpackModal .text-xl {
                font-size: 0.9rem;
            }
            
            #backpackModal .text-sm {
                font-size: 0.8rem;
            }
            
            #backpackRewardModal, #pointsModal {
                max-width: 95vw;
            }
            
            #backpackRewardModal h2, #pointsModal h2 {
                font-size: 1.25rem;
            }
            
            #backpackRewardModal p, #pointsModal p {
                font-size: 0.9rem;
            }
            
            #backpackRewardModal button, #pointsModal button {
                padding: 0.5rem 0.75rem;
                font-size: 0.9rem;
                min-height: 44px;
            }
            
            .wechat-notification {
                font-size: 0.85rem;
                padding: 0.75rem;
            }
            
            #bgMusicSelectModal {
                max-width: 98vw;
            }
            
            #bgMusicSelectModal h2 {
                font-size: 1.1rem;
            }
            
            #bgMusicSelectModal .bg-music-option {
                padding: 0.5rem;
                font-size: 0.85rem;
                min-height: 44px;
            }
            
            #versionInfoModal {
                max-width: 98vw;
            }
            
            #versionInfoModal h2 {
                font-size: 1.1rem;
            }
            
            #versionInfoModal p, #versionInfoModal li {
                font-size: 0.85rem;
            }
            
            /* 统计卡片优化 */
            .grid-cols-1.md\:grid-cols-4 {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }
            
            /* 按钮优化 */
            button {
                padding: 0.5rem 0.75rem;
                font-size: 0.8rem;
                min-height: 40px;
            }
            
            #startScreen button {
                min-height: 48px;
                padding: 0.75rem 0.875rem;
                font-size: 0.9rem;
            }
            
            #gameScreen button {
                min-height: 44px;
                padding: 0.5rem 0.75rem;
                font-size: 0.8rem;
            }
            
            .wheel-button {
                padding: 0.4rem 0.8rem;
                font-size: 0.8rem;
                min-height: 40px;
            }
            
            .flex.gap-2 {
                gap: 0.375rem;
            }
            
            .flex.gap-4 {
                gap: 0.5rem;
            }
            
            .flex.gap-6 {
                gap: 0.75rem;
            }
            
            /* 输入框优化 */
            input, select, textarea {
                padding: 0.5rem;
                font-size: 0.85rem;
                min-height: 40px;
            }
        }
        
        /* 横屏优化 */
        @media (max-height: 500px) and (orientation: landscape) {
            body {
                padding: 0.25rem;
            }
            
            #timer {
                font-size: 2.5rem !important;
            }
            
            #gameTaskTitle {
                font-size: 1rem !important;
            }
            
            /* 转盘容器优化 */
            .wheel-container {
                padding: 10px;
            }
            
            .w-48 {
                width: 6rem !important;
                height: 6rem !important;
            }
            
            /* 转盘按钮优化 */
            .wheel-button {
                padding: 0.3rem 0.6rem;
                font-size: 0.75rem;
                min-height: 36px;
                bottom: -35px;
            }
            
            .wheel-subtitle {
                bottom: -55px;
                font-size: 10px;
            }
            
            /* 转盘奖励显示优化 */
            .wheel-reward-display {
                margin-top: 35px;
                padding: 10px 15px;
                font-size: 12px;
                min-height: 40px;
            }
            
            /* 弹窗优化 */
            .modal {
                max-height: 95vh;
                padding: 0.5rem;
            }
            
            /* 横屏弹窗优化 */
            .modal h2, .modal h3 {
                font-size: 1rem;
            }
            
            .modal p, .modal span, .modal label {
                font-size: 0.85rem;
            }
            
            .modal button {
                padding: 0.4rem 0.6rem;
                font-size: 0.75rem;
                min-height: 40px;
                min-width: 90px;
            }
            
            .modal input, .modal select, .modal textarea {
                padding: 0.4rem;
                font-size: 0.85rem;
                min-height: 36px;
            }
            
            #backpackModal h2 {
                font-size: 1.1rem;
            }
            
            #backpackModal .text-4xl {
                font-size: 1.25rem;
            }
            
            #backpackModal .text-xl {
                font-size: 0.85rem;
            }
            
            #backpackModal .text-sm {
                font-size: 0.75rem;
            }
            
            #backpackRewardModal, #pointsModal {
                max-width: 95vw;
            }
            
            #backpackRewardModal h2, #pointsModal h2 {
                font-size: 1.1rem;
            }
            
            #backpackRewardModal p, #pointsModal p {
                font-size: 0.85rem;
            }
            
            #backpackRewardModal button, #pointsModal button {
                padding: 0.4rem 0.6rem;
                font-size: 0.75rem;
                min-height: 40px;
            }
            
            .wechat-notification {
                font-size: 0.8rem;
                padding: 0.5rem;
            }
            
            #bgMusicSelectModal {
                max-width: 95vw;
            }
            
            #bgMusicSelectModal h2 {
                font-size: 1rem;
            }
            
            #bgMusicSelectModal .bg-music-option {
                padding: 0.4rem;
                font-size: 0.75rem;
                min-height: 40px;
            }
            
            #versionInfoModal {
                max-width: 95vw;
            }
            
            #versionInfoModal h2 {
                font-size: 1rem;
            }
            
            #versionInfoModal p, #versionInfoModal li {
                font-size: 0.8rem;
            }
            
            /* 图表容器优化 */
            .chart-container {
                height: 150px;
            }
            
            /* 横屏按钮优化 */
            button {
                min-height: 40px;
                padding: 0.4rem 0.6rem;
                font-size: 0.75rem;
            }
            
            #startScreen button {
                min-height: 44px;
                padding: 0.5rem 0.75rem;
                font-size: 0.85rem;
            }
            
            #gameScreen button {
                min-height: 40px;
                padding: 0.4rem 0.6rem;
                font-size: 0.75rem;
            }
            
            .wheel-button {
                padding: 0.3rem 0.6rem;
                font-size: 0.75rem;
                min-height: 36px;
            }
            
            .flex.gap-2 {
                gap: 0.25rem;
            }
            
            .flex.gap-4 {
                gap: 0.375rem;
            }
            
            .flex.gap-6 {
                gap: 0.5rem;
            }
        }
        
        /* 奢华抽奖转盘样式 */
        .wheel-container {
            position: relative;
            display: inline-block;
            padding: 40px;
            background: radial-gradient(ellipse at center, #1a237e 0%, #0d47a1 50%, #01579b 100%);
            border-radius: 50%;
            box-shadow: 
                0 10px 40px rgba(0, 0, 0, 0.4),
                inset 0 2px 10px rgba(255, 255, 255, 0.1);
        }
        
        .wheel {
            position: relative;
            border-radius: 50%;
            overflow: hidden;
            transition: transform 4s cubic-bezier(0.25, 0.1, 0.25, 1);
            box-shadow: 
                0 0 0 6px linear-gradient(135deg, #ffd700 0%, #ffed4a 50%, #ffd700 100%),
                0 0 0 8px #b8860b,
                0 0 0 10px linear-gradient(135deg, #ffd700 0%, #ffed4a 50%, #ffd700 100%),
                0 0 0 12px #b8860b,
                0 0 40px rgba(255, 215, 0, 0.6);
        }
        
        .wheel::before {
            content: '';
            position: absolute;
            inset: -14px;
            border-radius: 50%;
            background: conic-gradient(
                from 0deg,
                #ffd700, #ffed4a, #ffd700, #ffed4a,
                #ffd700, #ffed4a, #ffd700, #ffed4a,
                #ffd700, #ffed4a, #ffd700, #ffed4a,
                #ffd700
            );
            animation: goldShimmer 2s linear infinite;
            z-index: -1;
            filter: blur(1px);
        }
        
        @keyframes goldShimmer {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .wheel::after {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.25) 0%, transparent 60%);
            pointer-events: none;
            z-index: 5;
        }
        
        .wheel-segment {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            border-radius: 50%;
            overflow: hidden;
        }
        
        .wheel-segment::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: inherit;
            clip-path: polygon(50% 50%, 100% 0%, 100% 100%);
        }
        
        .wheel-segment span {
            font-size: 13px;
            font-weight: 900;
            text-align: center;
            line-height: 1.4;
            padding: 5px 15px;
            text-shadow: 
                3px 3px 6px rgba(0, 0, 0, 0.9),
                0 0 15px rgba(255, 255, 255, 0.6);
            letter-spacing: 0.5px;
            white-space: nowrap;
            z-index: 2;
            position: relative;
            transform: translateY(-15px);
        }
        
        .wheel-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border-radius: 50%;
            z-index: 10;
            background: linear-gradient(135deg, #ffd700 0%, #ffed4a 50%, #ffd700 100%);
            box-shadow: 
                0 0 25px rgba(255, 215, 0, 0.7),
                inset 0 2px 4px rgba(255, 255, 255, 0.6),
                0 4px 8px rgba(0, 0, 0, 0.4);
            border: 4px solid #b8860b;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .wheel-center:hover {
            transform: translate(-50%, -50%) scale(1.05);
            box-shadow: 
                0 0 35px rgba(255, 215, 0, 0.9),
                inset 0 2px 4px rgba(255, 255, 255, 0.7),
                0 4px 8px rgba(0, 0, 0, 0.5);
        }
        
        .wheel-pointer {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            z-index: 15;
            cursor: pointer;
        }
        
        .wheel-pointer::before {
            content: '';
            position: absolute;
            top: -55px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 14px solid transparent;
            border-right: 14px solid transparent;
            border-bottom: 45px solid #ffd700;
            filter: drop-shadow(0 5px 10px rgba(0, 0, 0, 0.5));
        }
        
        .wheel-pointer::after {
            content: '';
            position: absolute;
            top: -55px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-bottom: 35px solid #ffed4a;
            z-index: 1;
        }
        
        .wheel-button {
            position: absolute;
            bottom: -60px;
            left: 50%;
            transform: translateX(-50%);
            padding: 18px 60px;
            border-radius: 40px;
            font-weight: 900;
            font-size: 24px;
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
            text-transform: uppercase;
            letter-spacing: 3px;
            background: linear-gradient(135deg, #ff6b35 0%, #ffd700 50%, #ff6b35 100%);
            color: #fff;
            text-shadow: 
                3px 3px 0 #b8860b,
                -2px -2px 0 #b8860b,
                2px -2px 0 #b8860b,
                -2px 2px 0 #b8860b,
                2px 2px 0 #b8860b,
                0 0 30px rgba(255, 215, 0, 1),
                0 0 60px rgba(255, 215, 0, 0.5);
            box-shadow: 
                0 8px 25px rgba(255, 107, 53, 0.5),
                0 0 40px rgba(255, 215, 0, 0.5),
                inset 0 3px 6px rgba(255, 255, 255, 0.4);
            animation: buttonGlow 2s ease-in-out infinite;
        }
        
        @keyframes buttonGlow {
            0%, 100% {
                text-shadow: 
                    3px 3px 0 #b8860b,
                    -2px -2px 0 #b8860b,
                    2px -2px 0 #b8860b,
                    -2px 2px 0 #b8860b,
                    2px 2px 0 #b8860b,
                    0 0 30px rgba(255, 215, 0, 1),
                    0 0 60px rgba(255, 215, 0, 0.5);
                box-shadow: 
                    0 8px 25px rgba(255, 107, 53, 0.5),
                    0 0 40px rgba(255, 215, 0, 0.5),
                    inset 0 3px 6px rgba(255, 255, 255, 0.4);
            }
            50% {
                text-shadow: 
                    3px 3px 0 #b8860b,
                    -2px -2px 0 #b8860b,
                    2px -2px 0 #b8860b,
                    -2px 2px 0 #b8860b,
                    2px 2px 0 #b8860b,
                    0 0 50px rgba(255, 215, 0, 1),
                    0 0 100px rgba(255, 215, 0, 0.7);
                box-shadow: 
                    0 8px 25px rgba(255, 107, 53, 0.5),
                    0 0 60px rgba(255, 215, 0, 0.7),
                    inset 0 3px 6px rgba(255, 255, 255, 0.4);
        }
        
        .wheel-button:hover {
            transform: translateX(-50%) translateY(-5px);
            box-shadow: 
                0 12px 35px rgba(255, 107, 53, 0.6),
                0 0 60px rgba(255, 215, 0, 0.7),
                inset 0 3px 6px rgba(255, 255, 255, 0.5);
        }
        
        .wheel-button:active {
            transform: translateX(-50%) translateY(-2px);
        }
        
        .wheel-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            animation: none;
        }
        
        .wheel-button::before {
            content: '✨';
            position: absolute;
            top: -8px;
            left: 12px;
            font-size: 18px;
            animation: starTwinkle 1.5s ease-in-out infinite;
        }
        
        .wheel-button::after {
            content: '✨';
            position: absolute;
            top: -8px;
            right: 12px;
            font-size: 18px;
            animation: starTwinkle 1.5s ease-in-out infinite 0.75s;
        }
        
        @keyframes starTwinkle {
            0%, 100% { opacity: 0.5; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.3); }
        }
        
        .wheel-subtitle {
            position: absolute;
            bottom: -110px;
            left: 50%;
            transform: translateX(-50%);
            color: #ffffff;
            font-size: 16px;
            font-weight: 600;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            white-space: nowrap;
        }
        
        .wheel-reward-display {
            margin-top: 70px;
            padding: 22px 35px;
            border-radius: 15px;
            min-height: 85px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #ffd700 0%, #ffed4a 100%);
            border: 4px solid #b8860b;
            box-shadow: 
                0 8px 25px rgba(255, 215, 0, 0.5),
                inset 0 3px 6px rgba(255, 255, 255, 0.6);
            font-weight: 900;
            font-size: 20px;
            color: #8b4513;
            text-shadow: 2px 2px 0 rgba(255, 255, 255, 0.6);
        }
        
        .wheel-reward-display.show {
            animation: rewardPopup 0.5s ease-out;
        }
        
        @keyframes rewardPopup {
            0% {
                transform: scale(0.8);
                opacity: 0;
            }
            50% {
                transform: scale(1.1);
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }
            
            /* 奖励记录优化 */
            #rewardHistory {
                max-height: 200px;
            }
            
            /* 图表容器优化 */
            .chart-container {
                height: 200px;
            }
            
            /* 历史记录筛选器优化 */
            #filterContainer {
                flex-direction: column;
                gap: 0.75rem;
            }
            
            #filterContainer > div {
                width: 100%;
            }
            
            #filterContainer .flex {
                flex-wrap: wrap;
            }
            
            #filterContainer button {
                flex: 1;
                min-width: 80px;
                padding: 0.5rem 0.75rem;
                font-size: 0.9rem;
            }
            
            #filterContainer select {
                width: 100%;
                padding: 0.5rem;
                font-size: 0.9rem;
            }
            
            #filterContainer input[type="date"] {
                flex: 1;
                min-width: 120px;
                padding: 0.5rem;
                font-size: 0.9rem;
            }
            
            /* 统计卡片优化 */
            .grid-cols-1.md\:grid-cols-4 {
                grid-template-columns: 1fr 1fr;
                gap: 0.75rem;
            }
        }
        
        @media (max-width: 480px) {
            /* 小屏幕进一步优化 */
            #startScreen h1 {
                font-size: 2rem !important;
            }
            
            #timer {
                font-size: 3rem !important;
            }
            
            .grid-cols-4 {
                grid-template-columns: 1fr;
            }
            
            /* 按钮文字优化 */
            button {
                font-size: 0.9rem;
            }
            
            /* 弹窗宽度优化 */
            .modal {
                width: 98vw;
                padding: 1rem;
            }
            
            /* 转盘进一步优化 */
            .wheel-container {
                padding: 15px;
            }
            
            .w-48 {
                width: 8rem !important;
                height: 8rem !important;
            }
            
            .wheel-button {
                padding: 0.5rem 1rem;
                font-size: 0.85rem;
            }
            
            .wheel-reward-display {
                margin-top: 50px;
                padding: 15px 20px;
                font-size: 16px;
                min-height: 60px;
            }
            
            .wheel-subtitle {
                bottom: -80px;
                font-size: 14px;
            }
            
            /* 奖励记录优化 */
            #rewardHistory {
                max-height: 150px;
            }
            
            /* 图表容器优化 */
            .chart-container {
                height: 150px;
            }
            
            /* 历史记录筛选器进一步优化 */
            #filterContainer {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            #filterContainer .flex {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            #filterContainer button {
                width: 100%;
                padding: 0.75rem;
                font-size: 0.85rem;
            }
            
            #filterContainer select {
                width: 100%;
                padding: 0.75rem;
                font-size: 0.85rem;
            }
            
            #filterContainer input[type="date"] {
                width: 100%;
                padding: 0.75rem;
                font-size: 0.85rem;
            }
            
            /* 统计卡片进一步优化 */
            .grid-cols-1.md\:grid-cols-4 {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }
            
            /* 子任务列表进一步优化 */
            #subtaskList .flex.gap-2 {
                flex-direction: column;
            }
            
            #subtaskList button {
                width: 100%;
                padding: 0.75rem;
                font-size: 0.85rem;
            }
            
            #subtaskList input[type="text"] {
                width: 100%;
                padding: 0.75rem;
                font-size: 0.85rem;
            }
            
            /* 模态框进一步优化 */
            .modal-mobile {
                width: 98vw !important;
                max-width: 98vw !important;
                padding: 0.5rem !important;
            }
            
            .modal-mobile form {
                gap: 1rem !important;
            }
            
            .modal-mobile input, .modal-mobile select, .modal-mobile textarea {
                font-size: 0.9rem !important;
                padding: 0.5rem !important;
            }
            
            .modal-mobile button {
                padding: 0.5rem !important;
                font-size: 1rem !important;
            }
            
            /* 触摸反馈优化 */
            button:active {
                transform: scale(0.95);
            }
            
            /* 滑动优化 */
            .overflow-y-auto {
                -webkit-overflow-scrolling: touch;
            }
        }
        
        /* 通用移动端优化 */
        @media (max-width: 768px) {
            /* 防止文本选择 */
            .no-select {
                -webkit-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none;
                user-select: none;
            }
            
            /* 触摸反馈 */
            .touch-feedback {
                -webkit-tap-highlight-color: rgba(255, 255, 255, 0.3);
            }
            
            /* 滚动优化 */
            .scroll-container {
                -webkit-overflow-scrolling: touch;
                overscroll-behavior: contain;
            }
            
            /* 字体优化 */
            body {
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
            }
            
            /* 输入框优化 */
            input, textarea, select {
                -webkit-appearance: none;
                appearance: none;
                border-radius: 0;
            }
            
            /* 按钮优化 */
            button {
                -webkit-tap-highlight-color: transparent;
                outline: none;
            }
            
            /* 模态框优化 */
            .modal {
                -webkit-overflow-scrolling: touch;
            }
            
            /* 转盘触摸优化 */
            .wheel-container {
                -webkit-tap-highlight-color: transparent;
            }
        }
        
        /* 背景音乐选择弹窗样式 */
        .bg-music-option {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .bg-music-option:hover {
            transform: translateY(-3px);
        }
        
        .bg-music-option:active {
            transform: translateY(-1px);
        }
    </style>
 	</head>

 	<body
 		class="bg-darkBg text-white min-h-screen flex flex-col items-center justify-between p-4 overflow-x-hidden no-select touch-feedback scroll-container">
 		<!-- 粒子特效容器 -->
 		<div id="particleContainer" class="fixed inset-0 z-0 pointer-events-none"></div>
 		<!-- 烟花特效容器 -->
 		<div id="fireworkContainer" class="fixed inset-0 z-10 pointer-events-none"></div>

 		<!-- 背景音乐（王源的骄傲） -->
 		<audio id="bgMusic" loop preload="auto">
 			<!-- 提供MP3源，兼容主流浏览器 -->
 			<source src="img/wy.mp3" type="audio/mpeg">
 			<!-- 浏览器不支持audio标签时的提示 -->
 			您的浏览器不支持音频播放，请升级浏览器！
 		</audio>

 		<!-- 纯音乐1 -->
 		<audio id="bgMusic1" loop preload="auto">
 			<source src="https://music.163.com/song/media/outer/url?id=1406609386.mp3" type="audio/mpeg">
 		</audio>

 		<!-- 纯音乐2 -->
 		<audio id="bgMusic2" loop preload="auto">
 			<source
 				src="https://webfs.kugou.com/202601111122/dd20c7df75fce50c68e6457a8ebbf73a/v3/de6a202a0ddba1591ebf4ab1df3f5254/yp/p_0_960183/ap1014_us1012145785_mii0w1iw8z2ai2iphcu80ooo2ki81120_pi406_mx32774416_s3976297900.mp3"
 				type="audio/mpeg">
 		</audio>

 		<!-- 纯音乐3 -->
 		<audio id="bgMusic3" loop preload="auto">
 			<source src="./img/ap1014_us1012145785_mii0w1iw8z2ai2iphcu80ooo2ki81120_pi406_mx291935709_s3485033891.mp3"
 				type="audio/mpeg">
 		</audio>

 		<!-- 纯音乐4 -->
 		<audio id="bgMusic4" loop preload="auto">
 			<source src="./img/ap1014_us0_mii0w1iw8z2ai2iphcu80ooo2ki81120_pi406_mx59809325_s873791898.mp3"
 				type="audio/mpeg">
 		</audio>

 		<!-- 纯音乐5 -->
 		<audio id="bgMusic5" loop preload="auto">
 			<source src="./img/ap1014_us0_mi6e603fe658d23fe951de834ece69bbe6_pi406_mx49165170_s136100511.mp3"
 				type="audio/mpeg">
 		</audio>

 		<!-- 单击音效 -->
 		<audio id="clickSound">
 			<source src="img/dj.mp3" type="audio/mpeg">
 		</audio>

 		<!-- 背景音乐控制按钮 -->
 		<button id="bgMusicToggle"
 			class="fixed top-4 right-4 z-[60] bg-neonPink/80 text-white w-12 h-12 rounded-full flex items-center justify-center transition-all duration-300 hover:scale-110 shadow-lg">
 			<i class="fa fa-music" id="bgMusicIcon"></i>
 		</button>

 		<!-- 背景音乐选择弹窗 -->
 		<div id="bgMusicSelectModal"
 			class="fixed inset-0 bg-darkBg/95 backdrop-blur-md z-50 flex items-center justify-center hidden">
 			<div
 				class="bg-darkBg border-2 border-neonPink rounded-2xl p-6 w-full max-w-md max-h-[90vh] overflow-y-auto animate-explode">
 				<h2 class="text-2xl font-bold text-neonPink text-shadow-neon mb-6 text-center">
 					<i class="fa fa-music mr-2"></i>选择背景音乐
 				</h2>
 				<div class="space-y-3">
 					<button
 						class="bg-music-option bg-darkBg/50 border-2 border-neonBlue/30 rounded-lg p-4 w-full text-left transition-all duration-300 hover:border-neonBlue hover:bg-neonBlue/20"
 						data-music="wy">
 						<div class="flex items-center gap-3">
 							<i class="fa fa-music text-neonBlue text-xl"></i>
 							<div>
 								<h3 class="text-white font-bold text-lg">王源的骄傲</h3>
 								<p class="text-gray-400 text-sm">默认背景音乐</p>
 							</div>
 						</div>
 					</button>
 					<button
 						class="bg-music-option bg-darkBg/50 border-2 border-neonGreen/30 rounded-lg p-4 w-full text-left transition-all duration-300 hover:border-neonGreen hover:bg-neonGreen/20"
 						data-music="pure1">
 						<div class="flex items-center gap-3">
 							<i class="fa fa-music text-neonGreen text-xl"></i>
 							<div>
 								<h3 class="text-white font-bold text-lg">纯音乐1</h3>
 								<p class="text-gray-400 text-sm">轻柔钢琴曲</p>
 							</div>
 						</div>
 					</button>
 					<button
 						class="bg-music-option bg-darkBg/50 border-2 border-neonYellow/30 rounded-lg p-4 w-full text-left transition-all duration-300 hover:border-neonYellow hover:bg-neonYellow/20"
 						data-music="pure2">
 						<div class="flex items-center gap-3">
 							<i class="fa fa-music text-neonYellow text-xl"></i>
 							<div>
 								<h3 class="text-white font-bold text-lg">纯音乐2</h3>
 								<p class="text-gray-400 text-sm">轻柔吉他曲</p>
 							</div>
 						</div>
 					</button>
 					<button
 						class="bg-music-option bg-darkBg/50 border-2 border-neonPink/30 rounded-lg p-4 w-full text-left transition-all duration-300 hover:border-neonPink hover:bg-neonPink/20"
 						data-music="pure3">
 						<div class="flex items-center gap-3">
 							<i class="fa fa-music text-neonPink text-xl"></i>
 							<div>
 								<h3 class="text-white font-bold text-lg">纯音乐3</h3>
 								<p class="text-gray-400 text-sm">轻柔小提琴曲</p>
 							</div>
 						</div>
 					</button>
 					<button
 						class="bg-music-option bg-darkBg/50 border-2 border-neonBlue/30 rounded-lg p-4 w-full text-left transition-all duration-300 hover:border-neonBlue hover:bg-neonBlue/20"
 						data-music="pure4">
 						<div class="flex items-center gap-3">
 							<i class="fa fa-music text-neonBlue text-xl"></i>
 							<div>
 								<h3 class="text-white font-bold text-lg">纯音乐4</h3>
 								<p class="text-gray-400 text-sm">轻柔长笛曲</p>
 							</div>
 						</div>
 					</button>
 					<button
 						class="bg-music-option bg-darkBg/50 border-2 border-neonGreen/30 rounded-lg p-4 w-full text-left transition-all duration-300 hover:border-neonGreen hover:bg-neonGreen/20"
 						data-music="pure5">
 						<div class="flex items-center gap-3">
 							<i class="fa fa-music text-neonGreen text-xl"></i>
 							<div>
 								<h3 class="text-white font-bold text-lg">纯音乐5</h3>
 								<p class="text-gray-400 text-sm">轻柔大提琴曲</p>
 							</div>
 						</div>
 					</button>
 					<button
 						class="bg-music-option bg-darkBg/50 border-2 border-neonPink/30 rounded-lg p-4 w-full text-left transition-all duration-300 hover:border-neonPink hover:bg-neonPink/20"
 						data-music="import">
 						<div class="flex items-center gap-3">
 							<i class="fa fa-upload text-neonPink text-xl"></i>
 							<div>
 								<h3 class="text-white font-bold text-lg">导入本地音乐</h3>
 								<p class="text-gray-400 text-sm">上传你的音乐文件</p>
 							</div>
 						</div>
 					</button>
 					<input type="file" id="localMusicInput" accept="audio/*" class="hidden">
 				</div>

 				<!-- 本地音乐列表 -->
 				<div class="mt-6 border-t-2 border-gray-700 pt-4">
 					<h3 class="text-neonPink font-bold text-lg mb-3">
 						<i class="fa fa-list mr-2"></i>我的本地音乐
 					</h3>
 					<div id="localMusicListContainer" class="max-h-60 overflow-y-auto">
 						<p class="text-gray-400 text-center py-4">还没有导入本地音乐</p>
 					</div>
 				</div>

 				<button id="closeBgMusicSelectModal"
 					class="w-full bg-gray-700 px-6 py-3 rounded-full text-xl font-bold mt-6 transition-all duration-300 hover:scale-105">
 					<i class="fa fa-times mr-2"></i>关闭
 				</button>
 			</div>
 		</div>

 		<!-- 开始界面 -->
 		<div id="startScreen"
 			class="screen flex flex-col items-center justify-start min-h-screen w-full z-30 overflow-y-auto py-8 px-4 bg-gradient-to-b from-darkBg via-darkBg/95 to-darkBg/90">
 			<div
 				class="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWV3Qm94PSIwIDAgMTAwIDEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCI+PGNpcmNsZSBjeD0iNTAiIGN5PSI1MCIgcj0iNDAiIHN0cm9rZT0icmdiYSgyNSwgMjU1LCAyNTUsIDAuMSkiIGZpbGw9Im5vbmUiLz48L3N2Zz4=')] opacity-5">
 			</div>

 			<div class="relative z-10 w-full max-w-lg mx-auto">
 				<h1
 					class="text-[clamp(2.5rem,8vw,5rem)] font-bold text-transparent bg-clip-text bg-gradient-to-r from-neonPink via-neonYellow to-neonBlue text-shadow-neon mb-4 animate-bounce-slow text-center">
 					加油，你是最棒的
 				</h1>
 				<p
 					class="text-neonBlue text-[clamp(1rem,3vw,1.5rem)] mb-8 max-w-md text-center animate-slide-up mx-auto">
 					学习永无止境，慢就是快，将大任务都变成小任务，大任务才可以完成
 				</p>

 				<!-- 功能按钮组 -->
 			<!-- 功能按钮组（重新布局：奖励转盘在最左边，任务记录在最右边） -->
<div class="flex justify-between items-center mb-8 animate-slide-up w-full"
    style="animation-delay: 0.2s">
    
    <!-- 最左边：奖励转盘图标按钮 -->
    <button id="rewardModuleBtn"
        class="bg-gradient-to-br from-yellow-500/30 to-yellow-700/30 border-2 border-yellow-400/50 rounded-2xl p-4 flex flex-col items-center justify-center hover:border-yellow-300 transition-all duration-300 hover:scale-105">
        <i class="fa fa-gift text-yellow-300 text-2xl mb-1"></i>
        <span class="text-yellow-200 text-xs font-bold">奖励</span>
    </button>

    <!-- 中间：功能按钮区域 -->
    <div class="flex flex-col sm:flex-row gap-4">
        <!-- SMART任务按钮 -->
        <button id="smartTaskBtn"
            class="bg-gradient-to-r from-neonPink to-pink-600 text-white px-6 py-3 rounded-full text-sm font-bold transition-all duration-300 hover:scale-105 hover:shadow-xl hover:shadow-neonPink/50 bg-glow-hover shadow-lg shadow-neonPink/30">
            <i class="fa fa-check-square-o mr-1"></i>SMART任务
        </button>

        <!-- 普通任务按钮 -->
        <button id="customTaskBtn"
            class="bg-gradient-to-r from-neonBlue to-blue-600 text-darkBg px-6 py-3 rounded-full text-sm font-bold transition-all duration-300 hover:scale-105 hover:shadow-xl hover:shadow-neonBlue/50 bg-glow-hover shadow-lg shadow-neonBlue/30">
            <i class="fa fa-pencil mr-1"></i>普通任务
        </button>

        <!-- 开始闯关按钮 -->
        <button id="startDefaultBtn"
            class="bg-gradient-to-r from-neonGreen to-green-600 text-darkBg px-6 py-3 rounded-full text-sm font-bold transition-all duration-300 hover:scale-105 hover:shadow-xl hover:shadow-neonGreen/50 bg-glow-hover shadow-lg shadow-neonGreen/30">
            <i class="fa fa-play mr-1"></i>查看当前任务
        </button>
    </div>

    <!-- 最右边：查看任务记录图标按钮 -->
    <button id="taskRecordBtn"
        class="bg-gradient-to-br from-purple-500/30 to-purple-700/30 border-2 border-purple-400/50 rounded-2xl p-4 flex flex-col items-center justify-center hover:border-purple-300 transition-all duration-300 hover:scale-105 relative">
        <i class="fa fa-history text-purple-300 text-2xl mb-1"></i>
        <span class="text-purple-200 text-xs font-bold">记录</span>
        <span id="recordBadge"
            class="absolute top-1 right-1 w-3 h-3 bg-neonPink rounded-full hidden"></span>
        <span class="absolute -bottom-6 left-1/2 transform -translate-x-1/2 text-xs text-neonYellow animate-pulse-fast hidden"
            id="recordTip">
            完成任务后可查看记录
        </span>
    </button>
</div>
 			</div>

			<!-- 新增：底部区域（紧贴底部，仅图标显示） -->
			<div class="fixed bottom-4 left-4 right-4 z-20">
				<div class="grid grid-cols-3 gap-4">
					<!-- 荣誉图标按钮 -->
					<button id="viewHonorBtn"
						class="bg-gradient-to-br from-purple-600/30 to-purple-800/30 border-2 border-purple-400/50 rounded-2xl p-6 flex flex-col items-center justify-center hover:border-purple-300 transition-all duration-300 hover:scale-105 relative">
						<i class="fa fa-trophy text-purple-300 text-3xl mb-2"></i>
						<span class="text-purple-200 text-xs font-bold">荣誉</span>
						<!-- 长按提示 -->
						<span class="absolute -bottom-8 left-1/2 transform -translate-x-1/2 text-xs text-purple-300 opacity-0 hover:opacity-100 transition-opacity">
							长按设置
						</span>
						<!-- 荣誉状态指示器 -->
						<div id="honorStatusDot" class="absolute top-2 right-2 w-2 h-2 bg-purple-400 rounded-full opacity-50"></div>
					</button>

					<!-- 任务设置图标按钮 -->
				<button id="taskSettingsBtn"
					class="bg-gradient-to-br from-blue-600/30 to-blue-800/30 border-2 border-blue-400/50 rounded-2xl p-6 flex flex-col items-center justify-center hover:border-blue-300 transition-all duration-300 hover:scale-105">
					<i class="fa fa-cogs text-blue-300 text-3xl mb-2"></i>
					<span class="text-blue-200 text-xs font-bold">设置</span>
				</button>

				<!-- 背包图标按钮 -->
				<button id="backpackBtn"
					class="bg-gradient-to-br from-gray-600/30 to-gray-800/30 border-2 border-gray-400/50 rounded-2xl p-6 flex flex-col items-center justify-center hover:border-gray-300 transition-all duration-300 hover:scale-105">
					<i class="fa fa-briefcase text-gray-300 text-3xl mb-2"></i>
					<span class="text-gray-200 text-xs font-bold">背包</span>
				</button>
				</div>
			</div>

			<!-- 新增：荣誉设置弹窗 -->
			<div id="honorSettingsModal"
				class="fixed inset-0 bg-darkBg/95 backdrop-blur-md z-50 flex items-center justify-center hidden">
				<div class="bg-darkBg border-2 border-purple-400 rounded-2xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto animate-explode">
					<div class="flex justify-between items-center mb-6">
						<h2 class="text-2xl font-bold text-purple-300 text-shadow-neon">
							<i class="fa fa-trophy mr-2"></i>自定义荣誉称号
						</h2>
						<button id="closeHonorSettingsBtn" class="text-gray-400 hover:text-white text-2xl">
							<i class="fa fa-times"></i>
						</button>
					</div>
					
					<!-- 荣誉设置表单 -->
					<div class="space-y-4">
						<!-- 创建多个自定义荣誉称号 -->
						<div class="bg-purple-900/20 border border-purple-400/30 rounded-lg p-4 mb-4">
							<h3 class="text-lg font-bold text-purple-300 mb-3">
								<i class="fa fa-plus-circle mr-2"></i>快速创建多个荣誉称号
							</h3>
							<div class="grid grid-cols-1 md:grid-cols-2 gap-3">
								<div>
									<label class="block text-purple-300 text-sm mb-2">称号1</label>
									<input type="text" id="honorTitle1"
										class="w-full bg-darkBg/80 border-2 border-purple-400 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-purple-300"
										placeholder="如：学习达人">
								</div>
								<div>
									<label class="block text-purple-300 text-sm mb-2">王者值1</label>
									<input type="number" id="honorPoints1"
										class="w-full bg-darkBg/80 border-2 border-purple-400 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-purple-300"
										placeholder="如：50">
								</div>
								<div>
									<label class="block text-purple-300 text-sm mb-2">称号2</label>
									<input type="text" id="honorTitle2"
										class="w-full bg-darkBg/80 border-2 border-purple-400 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-purple-300"
										placeholder="如：知识探索者">
								</div>
								<div>
									<label class="block text-purple-300 text-sm mb-2">王者值2</label>
									<input type="number" id="honorPoints2"
										class="w-full bg-darkBg/80 border-2 border-purple-400 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-purple-300"
										placeholder="如：100">
								</div>
								<div>
									<label class="block text-purple-300 text-sm mb-2">称号3</label>
									<input type="text" id="honorTitle3"
										class="w-full bg-darkBg/80 border-2 border-purple-400 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-purple-300"
										placeholder="如：勤奋之星">
								</div>
								<div>
									<label class="block text-purple-300 text-sm mb-2">王者值3</label>
									<input type="number" id="honorPoints3"
										class="w-full bg-darkBg/80 border-2 border-purple-400 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-purple-300"
										placeholder="如：150">
								</div>
								<div>
									<label class="block text-purple-300 text-sm mb-2">称号4</label>
									<input type="text" id="honorTitle4"
										class="w-full bg-darkBg/80 border-2 border-purple-400 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-purple-300"
										placeholder="如：进步先锋">
								</div>
								<div>
									<label class="block text-purple-300 text-sm mb-2">王者值4</label>
									<input type="number" id="honorPoints4"
										class="w-full bg-darkBg/80 border-2 border-purple-400 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-purple-300"
										placeholder="如：200">
								</div>
							</div>
							<button onclick="createMultipleHonors()"
								class="w-full bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg font-bold transition-colors">
								<i class="fa fa-plus mr-2"></i>批量创建这4个称号
							</button>
						</div>
					</div>
					
					<!-- 单个自定义荣誉称号 -->
					<div class="space-y-4">
						<div>
							<label class="block text-purple-300 text-sm mb-2">荣誉称号</label>
							<input type="text" id="honorTitleInput"
								class="w-full bg-darkBg/80 border-2 border-purple-400 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-purple-300"
								placeholder="请输入荣誉称号">
						</div>

						<div>
							<label class="block text-purple-300 text-sm mb-2">王者值要求</label>
							<input type="number" id="honorPointsRequirementInput"
								class="w-full bg-darkBg/80 border-2 border-purple-400 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-purple-300"
								placeholder="需要多少王者值">
						</div>

						<div>
							<label class="block text-purple-300 text-sm mb-2">荣誉等级</label>
							<select id="honorLevelInput"
								class="w-full bg-darkBg/80 border-2 border-purple-400 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-purple-300">
								<option value="low">初级</option>
								<option value="medium">中级</option>
								<option value="high">高级</option>
							</select>
						</div>

						<div>
							<label class="block text-purple-300 text-sm mb-2">描述</label>
							<textarea id="honorDescriptionInput" rows="3"
								class="w-full bg-darkBg/80 border-2 border-purple-400 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-purple-300 resize-none"
								placeholder="描述这个荣誉的意义"></textarea>
						</div>

						<div class="flex gap-3">
							<button id="saveHonorBtn"
								class="flex-1 bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors">
								<i class="fa fa-save mr-2"></i>保存荣誉称号
							</button>
							<button id="resetHonorBtn"
								class="flex-1 bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg transition-colors">
								<i class="fa fa-undo mr-2"></i>重置表单
							</button>
						</div>
					</div>
				</div>
				
				<!-- 荣誉历史记录 -->
				<div class="border-t border-gray-600 pt-6 mb-6">
					<h3 class="text-lg font-bold text-purple-300 mb-4">
						<i class="fa fa-history mr-2"></i>已获得的荣誉称号
					</h3>
					<div id="honorHistoryList" class="space-y-3 max-h-60 overflow-y-auto">
						<p class="text-gray-400 text-center py-4">暂无已获得的荣誉称号</p>
					</div>
				</div>
				
				<!-- 操作按钮 -->
				<div class="flex gap-4 mt-6">
					<button id="confirmHonorBtn"
						class="flex-1 bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-full text-lg font-bold transition-colors">
						<i class="fa fa-check mr-2"></i>确定
					</button>
				</div>
			</div>

			<!-- 新增：荣誉弹窗 -->
			<div id="honorModal"
				class="fixed inset-0 bg-darkBg/95 backdrop-blur-md z-50 flex items-center justify-center hidden">
				<div class="bg-darkBg border-4 border-purple-400 rounded-3xl p-8 w-full max-w-2xl max-h-[80vh] overflow-y-auto animate-explode">
					<div class="flex justify-between items-center mb-6">
						<h2 id="honorModalTitle" class="text-3xl font-bold text-purple-300 text-shadow-neon">我的荣誉</h2>
						<div class="flex gap-2">
							<button id="currentHonorTab" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg text-sm transition-colors">
								当前荣誉
							</button>
							<button id="honorHistoryTab" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg text-sm transition-colors">
								荣誉历史
							</button>
						</div>
						<button id="closeHonorModalBtn" class="text-gray-400 hover:text-white text-2xl">
							<i class="fa fa-times"></i>
						</button>
					</div>
					
					<!-- 当前荣誉内容 -->
					<div id="currentHonorContent" class="text-center">
						<div id="currentHonorList" class="space-y-4">
							<!-- 当前荣誉将在这里动态生成 -->
						</div>
						<div id="noCurrentHonor" class="text-center text-gray-400 py-8">
							<i class="fa fa-trophy text-4xl mb-4"></i>
							<p>暂无荣誉称号</p>
							<p class="text-sm mt-2">完成任务获得奖励值，解锁更多荣誉！</p>
						</div>
					</div>
					
					<!-- 荣誉历史内容 -->
					<div id="honorHistoryContent" class="hidden">
						<div class="space-y-4" id="honorHistoryList">
							<!-- 荣誉历史将在这里动态生成 -->
						</div>
						<div id="noHonorHistory" class="text-center text-gray-400 py-8 hidden">
							<i class="fa fa-trophy text-4xl mb-4"></i>
							<p>暂无荣誉历史</p>
							<p class="text-sm mt-2">完成任务获得奖励值，解锁更多荣誉！</p>
						</div>
					</div>
					
					<!-- 操作按钮 -->
					<div class="flex gap-4 mt-6">
						<button id="confirmHonorBtn"
							class="flex-1 bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-full text-lg font-bold transition-colors">
							<i class="fa fa-check mr-2"></i>确定
						</button>
					</div>
				</div>
			</div>

			

 			<!-- 版本介绍弹窗 -->
 			<div id="versionInfoModal"
 				class="fixed inset-0 bg-darkBg/95 backdrop-blur-md z-50 flex items-center justify-center hidden">
 				<div
 					class="bg-darkBg border-2 border-purple-500 rounded-2xl p-6 w-full max-w-lg max-h-[90vh] overflow-y-auto animate-explode">
 					<div class="flex justify-between items-center mb-6">
 						<h2 class="text-2xl font-bold text-purple-400 text-shadow-neon">
 							<i class="fa fa-info-circle mr-2"></i>版本介绍
 						</h2>
 						<button id="closeVersionInfoBtn" class="text-gray-400 hover:text-white transition-colors">
 							<i class="fa fa-times text-2xl"></i>
 						</button>
 					</div>

 					<div class="space-y-5">
 						<!-- 当前版本信息 -->
 						<div class="bg-purple-900/30 border border-purple-500/50 rounded-lg p-4">
 							<h3 class="text-purple-300 font-bold text-lg mb-3">
 								<i class="fa fa-rocket mr-2"></i>当前版本：1.0.03
 							</h3>
 							<div class="space-y-2 text-sm">
 								<p class="text-gray-300"><span class="text-purple-400">版本号：</span><span
 										id="currentVersion">1.0.03</span></p>
 								<p class="text-gray-300"><span class="text-purple-400">发布日期：</span><span
 										id="releaseDate">20260130</span></p>
 								<p class="text-gray-300"><span class="text-purple-400">开发者：</span><span
 										id="developerName">多多</span></p>
 							</div>
 						</div>

 						<!-- 功能介绍 -->
 						<div class="space-y-3">
 							<h3 class="text-neonYellow font-bold text-lg">
 								<i class="fa fa-star mr-2"></i>功能介绍
 							</h3>
 							<div id="featuresList" class="space-y-2">
 								<div class="bg-darkBg/50 border border-neonBlue/30 rounded-lg p-3">
 									<h4 class="text-neonBlue font-bold mb-1">
 										<i class="fa fa-check-square-o mr-2"></i>功能名称1
 									</h4>
 									<p class="text-gray-400 text-sm">可以记录每天干了什么事情</p>
 								</div>
 								<div class="bg-darkBg/50 border border-neonGreen/30 rounded-lg p-3">
 									<h4 class="text-neonGreen font-bold mb-1">
 										<i class="fa fa-check-square-o mr-2"></i>功能名称2
 									</h4>
 									<p class="text-gray-400 text-sm">可以激发多巴胺</p>
 								</div>
 								<div class="bg-darkBg/50 border border-neonPink/30 rounded-lg p-3">
 									<h4 class="text-neonPink font-bold mb-1">
 										<i class="fa fa-check-square-o mr-2"></i>功能名称3
 									</h4>
 									<p class="text-gray-400 text-sm">请在此处填写功能3的详细介绍</p>
 								</div>
 							</div>
 						</div>

 						<!-- 版本历史 -->
 						<div class="space-y-3">
 							<h3 class="text-neonYellow font-bold text-lg">
 								<i class="fa fa-history mr-2"></i>版本历史
 							</h3>
 							<div id="versionHistory" class="space-y-3">
								<div class="bg-darkBg/50 border border-neonBlue/30 rounded-lg p-3">
									<h4 class="text-neonBlue font-bold mb-2">
										<i class="fa fa-code-branch mr-2"></i>v1.0.03
									</h4>
									<p class="text-gray-400 text-sm mb-2">发布日期：20260130 </p>
									<ul class="text-gray-400 text-sm space-y-1 ml-4">
										<li></li>
										<li>• 优化1：暂停和完成加入了二次点击（避免误点）</li>
									</ul>
								</div>
								
								<div class="bg-darkBg/50 border border-neonBlue/30 rounded-lg p-3">
									<h4 class="text-neonBlue font-bold mb-2">
										<i class="fa fa-code-branch mr-2"></i>v1.0.02
									</h4>
									<p class="text-gray-400 text-sm mb-2">发布日期：20260128 </p>
									<ul class="text-gray-400 text-sm space-y-1 ml-4">
										<li></li>
										<li>• 优化1：历史记录感受可以修改并添加了！！！</li>
									</ul>
								</div>
								
 								<div class="bg-darkBg/50 border border-neonBlue/30 rounded-lg p-3">
 									<h4 class="text-neonBlue font-bold mb-2">
 										<i class="fa fa-code-branch mr-2"></i>v1.06.04
 									</h4>
 									<p class="text-gray-400 text-sm mb-2">发布日期：20260112 </p>
 									<ul class="text-gray-400 text-sm space-y-1 ml-4">
 										<li></li>
 										<li>• 优化1：历史记录饼状图可以关联smart的和普通任务的</li>
 										<li>• 优化2：按钮点不动</li>
 										<li>• 优化3：正计时</li>
 									</ul>
 								</div>
 								<div class="bg-darkBg/50 border border-neonBlue/30 rounded-lg p-3">
 									<h4 class="text-neonBlue font-bold mb-2">
 										<i class="fa fa-code-branch mr-2"></i>v1.06.05
 									</h4>
 									<p class="text-gray-400 text-sm mb-2">发布日期2026.01.15<：p>
 											<ul class="text-gray-400 text-sm space-y-1 ml-4">
 												<li>• 优化1：历史记录的总时长可以根据日期筛选改变</li>
 												<li>• 优化2：今日任务可以由自己打钩</li>
 												<li>• 优化3：请在此处填写优化内容</li>
 											</ul>
 								</div>



 								<div class="bg-darkBg/50 border border-neonBlue/30 rounded-lg p-3">
 									<h4 class="text-neonBlue font-bold mb-2">
 										<i class="fa fa-code-branch mr-2"></i>v1.06.06
 									</h4>
 									<p class="text-gray-400 text-sm mb-2">发布日期：2026.01.17</p>
 									<ul class="text-gray-400 text-sm space-y-1 ml-4">
 										<li>• 优化1：子任务管理
 											子任务按地图的样子一层一层展示
 											点击 “查看今天任务”，弹出弹窗，文字显示 “恭喜你骑士，你准备好今天的挑战了吗？”，下面放 “是”“否” 两个按钮
 											点 “是”，给用户加 1 积分
 											点 “否”，弹出新弹窗，文字显示
 											“你确定要放弃？你还要多久呢，如果刷视频，你会刷多久你都不知道的，你现在就是最好的状态，状态不是等来的，是自己做出来的。”，下面放 “放弃”“继续”
 											两个按钮
 											点 “继续”，回到上一个 “是”“否” 的弹窗；点 “放弃”，回到首页
 											查看今日任务时，能看到设置好的子任务，并且可以打钩标记完成
 											点击查看子任务，弹出弹窗，子任务排成一条弯线，弹窗背景要做得好看</li>
 										<li>• 优化2：现有两个转盘：普通转盘转一次扣 30 积分，超级转盘转一次扣 60 积分；新增一个 “最终转盘”，转一次扣 300
 											积分，功能和普通、超级转盘完全一样
 											把转盘的样式（CSS）全部改好看
 											把转盘里的奖励名字整理好，不要乱七八糟的
 											给抽奖加动画效果，让动画更好看
 											抽奖的时候要配上音效
 											加一个任务排序的功能</li>
 										<li>• 优化3：请在此处填写优化内容</li>
 									</ul>
 								</div>














 								<div class="bg-darkBg/50 border border-neonGreen/30 rounded-lg p-3">
 									<h4 class="text-neonGreen font-bold mb-2">
 										<i class="fa fa-code-branch mr-2"></i>v1.0
 									</h4>
 									<p class="text-gray-400 text-sm mb-2">发布日期：请填写日期</p>
 									<ul class="text-gray-400 text-sm space-y-1 ml-4">
 										<li>• 初始版本发布</li>
 										<li>• 基础功能实现</li>
 									</ul>
 								</div>
 							</div>
 						</div>

 						<!-- 使用建议 -->
 						<div class="bg-purple-900/30 border border-purple-500/50 rounded-lg p-4">
 							<h3 class="text-purple-300 font-bold mb-3">
 								<i class="fa fa-heart mr-2"></i>使用建议
 							</h3>
 							<ul id="tipsList" class="text-gray-300 text-sm space-y-2">
 								<li>• 建议1：请在此处填写使用建议</li>
 								<li>• 建议2：请在此处填写使用建议</li>
 								<li>• 建议3：请在此处填写使用建议</li>
 								<li>• 建议4：请在此处填写使用建议</li>
 							</ul>
 						</div>

 						<!-- 联系方式 -->
 						<div class="bg-purple-900/30 border border-purple-500/50 rounded-lg p-4">
 							<h3 class="text-purple-300 font-bold mb-3">
 								<i class="fa fa-envelope mr-2"></i>联系方式
 							</h3>
 							<div class="space-y-2 text-sm">
 								<p class="text-gray-300"><span class="text-purple-400">邮箱：</span><span
 										id="contactEmail">请填写联系邮箱</span></p>
 								<p class="text-gray-300"><span class="text-purple-400">官网：</span><span
 										id="websiteUrl">请填写官网地址</span></p>
 								<p class="text-gray-300"><span class="text-purple-400">GitHub：</span><span
 										id="githubUrl">请填写GitHub地址</span></p>
 							</div>
 						</div>
 					</div>
 				</div>
 			</div>

 			<!-- 成就展示区 -->
 			<div class="mt-4 flex gap-6 animate-float opacity-90 animate-slide-up" style="animation-delay: 0.6s">
 				<div class="flex flex-col items-center">
 					<div
 						class="w-16 h-16 clip-path-star bg-neonYellow text-darkBg flex items-center justify-center text-2xl font-bold mb-2 animate-spin-slow">
 						<i class="fa fa-trophy"></i>
 					</div>
 					<p class="text-neonYellow text-shadow-neon" id="totalComplete">0</p>
 					<p class="text-sm text-gray-300">已完成任务</p>
 				</div>
 				<div class="flex flex-col items-center">
 					<div
 						class="w-16 h-16 rounded-full bg-neonPink flex items-center justify-center text-2xl font-bold mb-2 animate-pulse-fast">
 						<i class="fa fa-fire"></i>
 					</div>
 					<p class="text-neonPink text-shadow-neon" id="streakDays">0</p>
 					<p class="text-sm text-gray-300">连续打卡</p>
 				</div>
 			
 			
 			</div>

 			<!-- 版本介绍按钮 -->
 			<div class="mt-6 animate-slide-up" style="animation-delay: 0.7s">
 				<button id="versionInfoBtn"
 					class="w-full max-w-md bg-gradient-to-r from-purple-600 to-purple-800 text-white px-8 py-3 rounded-full text-lg font-bold transition-all duration-300 hover:scale-105 hover:shadow-xl hover:shadow-purple-500/50 bg-glow-hover shadow-lg shadow-purple-500/30">
 					<i class="fa fa-info-circle mr-2"></i>版本介绍
 				</button>
 			</div>

 			<div class="mt-8 animate-slide-up" style="animation-delay: 0.8s">
 				<h3 class="text-neonYellow text-xl font-bold mb-4 text-center">
 					<i class="fa fa-trophy mr-2"></i>成就墙
 				</h3>
 				<div id="achievementWall" class="flex gap-4 justify-center flex-wrap">
 					<!-- 成就徽章动态生成 -->
 				</div>
 			</div>










 		</div>
 		</div>

 		<!-- 新增：SMART任务弹窗 -->
 		<div id="smartTaskModal"
 			class="fixed inset-0 bg-darkBg/95 backdrop-blur-md z-50 flex items-center justify-center hidden">
 			<div
 				class="bg-darkBg border-2 border-neonPink rounded-2xl p-4 w-full max-w-[90vw] max-h-[80vh] overflow-y-auto animate-explode">
 				<h2 class="text-2xl font-bold text-neonPink text-shadow-neon mb-6 text-center">
 					<i class="fa fa-check-square-o mr-2"></i>创建SMART原则任务
 				</h2>
 				<form id="smartTaskForm" class="space-y-6">
 					<!-- S (Specific) 具体目标 -->
 					<div class="space-y-2">
 						<label class="block text-neonPink mb-1 text-sm md:text-base">
 							<span>S - 具体目标</span>
 						</label>
 						<div class="flex gap-2">
 							<input type="text" id="smartSpecific"
 								class="flex-1 bg-darkBg/80 border-2 border-neonPink rounded-lg px-4 py-3 text-xl focus:outline-none focus:border-neonYellow text-white"
 								placeholder="例如：完成Python基础语法3个章节的学习" required>
 							<button type="button" id="quickFillFromPeriodicBtn"
 								class="bg-neonBlue text-white px-4 py-3 rounded-lg font-bold hover:bg-neonBlue/80 transition-colors"
 								title="从周期任务快速填充">
 								<i class="fa fa-calendar"></i>
 							</button>
 						</div>
 						<p class="smart-hint">提示：避免模糊表述（如“学Python”），明确具体内容</p>
 					</div>

 					<!-- M (Measurable) 子任务管理 -->
 					<div class="space-y-2">
 						<label class="block text-neonPink mb-1 text-sm md:text-base">
 							<span>M - 子任务管理</span>
 						</label>
 						<div id="subtaskContainer" class="space-y-2">
 							<!-- 子任务将动态添加到这里 -->
 						</div>
 						<div class="flex gap-2">
 							<input type="text" id="newSubtaskInput"
 								class="flex-1 bg-darkBg/80 border-2 border-neonPink rounded-lg px-4 py-2 text-lg focus:outline-none focus:border-neonYellow text-white"
 								placeholder="输入子任务内容">
 							<button type="button" id="addSubtaskBtn"
 								class="bg-neonBlue text-white px-4 py-2 rounded-lg font-bold hover:bg-neonBlue/80 transition-colors">
 								<i class="fa fa-plus"></i> 添加
 							</button>
 						</div>
 						<p class="smart-hint">提示：添加具体子任务，完成后可打对号标记</p>
 					</div>

 					<!-- A (Achievable) 可实现难度 -->
 					<div class="space-y-2">
 						<label class="block text-neonPink mb-1 text-sm md:text-base">
 							<span>A - 可实现难度</span>
 						</label>
 						<select id="smartAchievable"
 							class="w-full bg-darkBg/80 border-2 border-neonPink rounded-lg px-4 py-3 text-xl focus:outline-none focus:border-neonYellow text-white"
 							required>
 							<option value="easy">简单（10-20分钟，无门槛）</option>
 							<option value="medium" selected>中等（30-60分钟，有基础）</option>
 							<option value="hard">较难（90-120分钟，需专注）</option>
 						</select>
 						<p class="smart-hint">提示：难度需匹配当前能力，避免无法完成或过于简单</p>
 					</div>

 					<!-- R (Relevant) 相关关联 -->
 					<div class="space-y-2">
 						<label class="block text-neonPink mb-1 text-sm md:text-base">
 							<span>R - 相关关联</span>
 						</label>
 						<!-- 新增：历史关联快捷选择 -->
 						<div class="flex gap-2 mb-2">
 							<select id="historyRelevantSelect"
 								class="w-full bg-darkBg/80 border-2 border-neonBlue rounded-lg px-4 py-2 text-base focus:outline-none focus:border-neonPink text-white">
 								<option value="">选择历史关联（快捷填充）</option>
 							</select>
 							<button type="button" id="clearRelevantBtn"
 								class="bg-gray-700 px-2 py-2 rounded-lg text-base">
 								<i class="fa fa-times"></i>
 							</button>
 						</div>
 						<input type="text" id="smartRelevant"
 							class="w-full bg-darkBg/80 border-2 border-neonPink rounded-lg px-4 py-3 text-xl focus:outline-none focus:border-neonYellow text-white"
 							placeholder="例如：为后续开发数据分析项目打基础" required>
 						<p class="smart-hint">提示：说明任务与长期目标/当前计划的关联</p>
 					</div>

 					<!-- T (Time-bound) 时间期限 -->
 					<div class="grid grid-cols-1 md:grid-cols-2 gap-4 space-y-2 md:space-y-0">
 						<div class="space-y-2">
 							<label class="block text-neonPink mb-1 text-sm md:text-base">
 								<span>T - 完成日期</span>
 							</label>
 							<input type="date" id="smartDate"
 								class="w-full bg-darkBg/80 border-2 border-neonPink rounded-lg px-4 py-3 text-xl focus:outline-none focus:border-neonYellow text-white"
 								required>
 						</div>
 						<div class="space-y-2">
 							<label class="block text-neonPink mb-1 text-sm md:text-base">
 								<span>预计时长（分钟）</span>
 							</label>
 							<input type="number" id="smartTime" min="5" max="180"
 								class="w-full bg-darkBg/80 border-2 border-neonPink rounded-lg px-4 py-3 text-xl focus:outline-none focus:border-neonYellow text-white"
 								value="30" required>
 						</div>
 					</div>

 					<!-- 任务奖励设置 -->
 					<div class="space-y-2">
 						<label class="block text-neonYellow mb-2 text-lg">完成奖励（可选）</label>
 						<input type="text" id="smartReward"
 							class="w-full bg-darkBg/80 border-2 border-neonBlue rounded-lg px-4 py-3 text-xl focus:outline-none focus:border-neonPink text-white"
 							placeholder="例如：看1集喜欢的动漫、吃1块巧克力">
 					</div>

 					<!-- 按钮组 -->
 					<div class="flex gap-4 mt-6">
 						<button type="button" id="closeSmartModalBtn"
 							class="flex-1 bg-gray-700 px-6 py-3 rounded-full text-xl font-bold transition-all duration-300 hover:scale-105">
 							<i class="fa fa-times mr-2"></i>取消
 						</button>
 						<button type="submit"
 							class="flex-1 bg-neonPink text-white px-6 py-3 rounded-full text-xl font-bold transition-all duration-300 hover:scale-105 bg-glow-hover">
 							<i class="fa fa-check mr-2"></i>创建SMART任务
 						</button>
 					</div>
 				</form>
 			</div>
 		</div>

 		<!-- 原有：自定义任务弹窗 -->
 		<div id="customTaskModal"
 			class="fixed inset-0 bg-darkBg/95 backdrop-blur-md z-50 flex items-center justify-center hidden">
 			<div class="bg-darkBg border-2 border-neonBlue rounded-2xl p-8 w-full max-w-md animate-explode">
 				<h2 class="text-2xl font-bold text-neonBlue text-shadow-neon mb-6 text-center">
 					创建普通任务
 				</h2>
 				<form id="customTaskForm" class="space-y-4">
 					<div>
 						<label class="block text-neonYellow mb-2 text-lg">任务名称</label>
 						<input type="text" id="taskName"
 							class="w-full bg-darkBg/80 border-2 border-neonBlue rounded-lg px-4 py-3 text-xl focus:outline-none focus:border-neonPink text-white"
 							placeholder="例如：30分钟健身、读10页书" required>
 					</div>
 					<div>
 						<label class="block text-neonYellow mb-2 text-lg">任务描述</label>
 						<textarea id="taskDesc" rows="2"
 							class="w-full bg-darkBg/80 border-2 border-neonBlue rounded-lg px-4 py-3 text-xl focus:outline-none focus:border-neonPink text-white"
 							placeholder="详细说明任务要求" required></textarea>
 					</div>
 					<div class="grid grid-cols-2 gap-4">
 						<div>
 							<label class="block text-neonYellow mb-2 text-lg">预计时长（分钟）</label>
 							<input type="number" id="taskTime" min="1" max="120" value="10"
 								class="w-full bg-darkBg/80 border-2 border-neonBlue rounded-lg px-4 py-3 text-xl focus:outline-none focus:border-neonPink text-white"
 								required>
 						</div>
 						<div>
 							<label class="block text-neonYellow mb-2 text-lg">难度</label>
 							<select id="taskDifficulty"
 								class="w-full bg-darkBg/80 border-2 border-neonBlue rounded-lg px-4 py-3 text-xl focus:outline-none focus:border-neonPink text-white">
 								<option value="easy">简单</option>
 								<option value="medium" selected>中等</option>
 								<option value="hard">困难</option>
 							</select>
 						</div>
 					</div>
 					<div>
 						<label class="block text-neonYellow mb-2 text-lg">SMART关联（可选）</label>
 						<div class="flex gap-2 mb-2">
 							<select id="customTaskHistoryRelevantSelect"
 								class="w-full bg-darkBg/80 border-2 border-neonBlue rounded-lg px-4 py-2 text-base focus:outline-none focus:border-neonPink text-white">
 								<option value="">选择历史关联（快捷填充）</option>
 							</select>
 							<button type="button" id="clearCustomTaskRelevantBtn"
 								class="bg-gray-700 px-2 py-2 rounded-lg text-base">
 								<i class="fa fa-times"></i>
 							</button>
 						</div>
 						<input type="text" id="taskSmartAssociation"
 							class="w-full bg-darkBg/80 border-2 border-neonBlue rounded-lg px-4 py-3 text-xl focus:outline-none focus:border-neonPink text-white"
 							placeholder="例如：学习、健身、工作等">
 					</div>
 					<div class="flex gap-4 mt-6">
 						<button type="button" id="closeModalBtn"
 							class="flex-1 bg-gray-700 px-6 py-3 rounded-full text-xl font-bold transition-all duration-300 hover:scale-105">
 							<i class="fa fa-times mr-2"></i>取消
 						</button>
 						<button type="submit"
 							class="flex-1 bg-neonGreen text-darkBg px-6 py-3 rounded-full text-xl font-bold transition-all duration-300 hover:scale-105 bg-glow-hover">
 							<i class="fa fa-check mr-2"></i>创建任务
 						</button>
 					</div>
 				</form>
 			</div>
 		</div>

 		<!-- 原有：闯关界面（新增SMART任务标识） -->
 		<div id="gameScreen" class="screen flex flex-col items-center justify-center h-screen w-full z-30 hidden">
 			<div class="w-full max-w-lg mx-auto">
 				<!-- 新增：SMART任务标签 -->
 				<div id="smartTaskTag" class="text-center mb-4 hidden">
 					<span
 						class="inline-block bg-neonPink text-white px-3 py-1 rounded-full text-sm font-bold animate-pulse-fast">
 						SMART任务
 					</span>
 				</div>

 				<!-- 任务标题区 -->
 				<div class="text-center mb-8 animate-slide-up">
 					<h2 id="gameTaskTitle"
 						class="text-[clamp(1.8rem,5vw,3rem)] font-bold text-neonPink text-shadow-neon mb-4">
 						第一关：专注阅读5分钟
 					</h2>
 					<!-- 新增：SMART任务详情展示 -->
 					<div id="smartTaskDetails" class="text-neonBlue text-base mb-4 hidden space-y-2">
 						<p><i class="fa fa-check-circle mr-2 text-neonGreen"></i><span
 								class="text-neonYellow">具体目标：</span><span id="detailSpecific">-</span></p>
 						<div id="subtaskList" class="mt-2">
 							<!-- 批量操作和搜索筛选 -->
 							<div class="flex flex-wrap gap-3 mb-4">
 								<!-- 搜索框 -->
 								<div class="flex-1 min-w-[200px]">
 									<input type="text" id="subtaskSearchInput" placeholder="搜索子任务..."
 										class="w-full bg-darkBg/80 border-2 border-neonBlue rounded-lg px-4 py-2 text-white focus:outline-none focus:border-neonYellow">
 								</div>
 								<!-- 筛选按钮 -->
 								<div class="flex gap-2">
 									<button id="filterAllSubtasks"
 										class="bg-neonBlue text-white px-4 py-2 rounded-lg font-medium hover:bg-neonBlue/80 transition-all">
 										全部
 									</button>
 									<button id="filterIncompleteSubtasks"
 										class="bg-neonGreen text-white px-4 py-2 rounded-lg font-medium hover:bg-neonGreen/80 transition-all">
 										未完成
 									</button>
 									<button id="filterCompletedSubtasks"
 										class="bg-neonPink text-white px-4 py-2 rounded-lg font-medium hover:bg-neonPink/80 transition-all">
 										已完成
 									</button>
 								</div>
 								<!-- 批量操作 -->
 								<div class="flex gap-2">
 									<button id="completeAllSubtasks"
 										class="bg-neonGreen text-white px-4 py-2 rounded-lg font-medium hover:bg-neonGreen/80 transition-all">
 										<i class="fa fa-check mr-2"></i>全部完成
 									</button>
 									<button id="resetAllSubtasks"
 										class="bg-neonPink text-white px-4 py-2 rounded-lg font-medium hover:bg-neonPink/80 transition-all">
 										<i class="fa fa-undo mr-2"></i>重置
 									</button>
 								</div>
 							</div>
 							<p class="text-neonYellow mb-2"><i class="fa fa-tasks mr-2 text-neonGreen"></i>子任务列表：</p>
 							<div id="subtaskContainerGame" class="space-y-2 ml-4">
 								<!-- 子任务将动态添加到这里 -->
 							</div>
 						</div>
 						<p><i class="fa fa-check-circle mr-2 text-neonGreen"></i><span
 								class="text-neonYellow">相关关联：</span><span id="detailRelevant">-</span></p>
 						<p><i class="fa fa-check-circle mr-2 text-neonGreen"></i><span
 								class="text-neonYellow">完成期限：</span><span id="detailDeadline">-</span></p>
 					</div>
 					<p id="gameTaskDesc" class="text-neonBlue text-xl mb-2">无干扰读完1个章节片段</p>
 					<p class="text-neonYellow text-lg">预计时长：<span id="gameTaskTime">5</span> 分钟</p>
 				</div>

 				<!-- 进度条 -->
 				<div class="w-full h-4 bg-darkBg/50 rounded-full border-2 border-neonBlue mb-10 overflow-hidden animate-slide-up"
 					style="animation-delay: 0.2s">
 					<div id="progressBar" class="h-full bg-neonBlue bg-glow w-0 transition-all duration-300"></div>
 				</div>

 				<!-- 计时器 -->
 				<div class="text-center mb-10 animate-slide-up" style="animation-delay: 0.4s">
 					<div id="timer"
 						class="text-[clamp(3rem,10vw,5rem)] font-bold text-neonYellow text-shadow-neon mb-6">
 						05:00
 					</div>
 					<div class="flex gap-6 justify-center">
 						<button id="startTimerBtn"
 							class="bg-neonGreen text-darkBg px-8 py-3 rounded-full text-xl font-bold transition-all duration-300 hover:scale-110 bg-glow-hover">
 							<i class="fa fa-play mr-2"></i>开始计时
 						</button>
 						<button id="pauseTimerBtn"
 							class="bg-neonPink text-white px-8 py-3 rounded-full text-xl font-bold transition-all duration-300 hover:scale-110 bg-glow-hover opacity-50 cursor-not-allowed">
 							<i class="fa fa-pause mr-2"></i>暂停
 						</button>
 					</div>
 				</div>

 				<!-- 完成按钮 -->
 				<button id="completeTaskBtn"
 					class="w-full bg-neonBlue text-darkBg px-8 py-4 rounded-full text-2xl font-bold transition-all duration-300 hover:scale-105 bg-glow-hover mb-8 animate-slide-up"
 					style="animation-delay: 0.6s; opacity: 0.5; cursor: not-allowed">
 					<i class="fa fa-flag-checkered mr-2"></i>完成任务，领取奖励
 				</button>

 				<!-- 换任务按钮 -->
 				<button id="switchTaskBtn"
 					class="w-full bg-neonPink text-white px-8 py-4 rounded-full text-2xl font-bold transition-all duration-300 hover:scale-105 bg-glow-hover mb-8 animate-slide-up"
 					style="animation-delay: 0.7s">
 					<i class="fa fa-exchange mr-2"></i>换任务啦
 				</button>

 				<!-- 返回按钮 -->
 				<button id="backToStartBtn"
 					class="bg-gray-700 px-6 py-3 rounded-full text-xl font-bold transition-all duration-300 hover:scale-105 animate-slide-up"
 					style="animation-delay: 0.8s">
 					<i class="fa fa-arrow-left mr-2"></i>返回首页
 				</button>
 			</div>
 		</div>

 		<!-- 原有：奖励弹窗（新增SMART任务提示） -->
 		<div id="rewardModal"
 			class="fixed inset-0 bg-darkBg/95 backdrop-blur-md z-50 flex items-center justify-center hidden">
 			<div class="bg-darkBg border-2 border-neonYellow rounded-2xl p-8 w-full max-w-md animate-explode">
 				<div class="text-center">
 					<!-- 新增：SMART任务完成标识 -->
 					<div id="smartRewardBadge"
 						class="w-16 h-16 rounded-full bg-neonPink text-white flex items-center justify-center text-3xl font-bold mx-auto mb-4 hidden animate-spin-slow">
 						<i class="fa fa-trophy"></i>
 					</div>

 					<div
 						class="w-24 h-24 clip-path-star bg-neonYellow text-darkBg flex items-center justify-center text-4xl font-bold mx-auto mb-6 animate-spin-slow">
 						<i class="fa fa-trophy"></i>
 					</div>
 					<h2 class="text-3xl font-bold text-neonPink text-shadow-neon mb-4">任务完成！</h2>
 					<!-- 新增：SMART任务完成提示 -->
 					<p id="smartRewardTip" class="text-neonPink text-lg mb-4 hidden animate-pulse-fast">
 						✨ 恭喜完成SMART任务，离目标又近一步！
 					</p>
 					<p class="text-neonBlue text-xl mb-6" id="rewardMsg">你成功完成了专注阅读任务</p>

 					<!-- 奖励统计 -->
 					<div class="grid grid-cols-3 gap-4 mb-8">
 						<div class="flex flex-col items-center">
 							<p class="text-neonYellow text-3xl font-bold animate-number-pop" id="rewardPoints">50</p>
 							<p class="text-sm text-gray-300">奖励值+50</p>
 						</div>
 						<div class="flex flex-col items-center">
 							<p class="text-neonGreen text-3xl font-bold animate-number-pop" id="rewardStreak">1</p>
 							<p class="text-sm text-gray-300">连续+1</p>
 						</div>
 						<div class="flex flex-col items-center">
 							<p class="text-neonBlue text-3xl font-bold animate-number-pop" id="rewardTotal">1</p>
 							<p class="text-sm text-gray-300">总完成+1</p>
 						</div>
 					</div>

 					<!-- 任务感受输入 -->
 					<div class="mb-6">
 						<label class="block text-neonYellow mb-2 text-base">
 							<i class="fa fa-comment mr-2"></i>刚做完这个，感觉咋样？
 						</label>
 						<textarea id="taskFeeling" rows="2"
 							class="w-full bg-darkBg/80 border-2 border-neonBlue rounded-lg px-4 py-3 text-lg focus:outline-none focus:border-neonPink text-white"
 							placeholder="比如：循环嵌套还是绕 / 比昨天顺一点"></textarea>
 					</div>

 					<button id="closeRewardBtn"
 						class="bg-neonGreen text-darkBg px-8 py-3 rounded-full text-xl font-bold transition-all duration-300 hover:scale-105 bg-glow-hover">
 						<i class="fa fa-smile-o mr-2"></i>继续闯关
 					</button>
 					<button id="gotoRecordBtn"
 						class="bg-neonYellow text-darkBg px-8 py-3 rounded-full text-xl font-bold transition-all duration-300 hover:scale-105 bg-glow-hover mt-4">
 						<i class="fa fa-history mr-2"></i>查看我的记录
 					</button>
 				</div>
 			</div>
 		</div>

		<!-- 感受编辑弹窗 -->
		<div id="feelingEditModal"
			class="fixed inset-0 bg-darkBg/95 backdrop-blur-md z-50 flex items-center justify-center hidden">
			<div class="bg-darkBg border-2 border-neonGreen rounded-2xl p-6 w-full max-w-md animate-explode">
				<h2 class="text-2xl font-bold text-neonGreen text-shadow-neon mb-6 text-center">
					<i class="fa fa-edit mr-2"></i>编辑任务感受
				</h2>
				
				<!-- 任务信息显示 -->
				<div class="bg-darkBg/50 border border-neonBlue/30 rounded-lg p-4 mb-4">
					<p class="text-neonYellow font-bold mb-1" id="feelingEditTaskName">任务名称</p>
					<p class="text-gray-400 text-sm" id="feelingEditTaskDate">完成时间</p>
				</div>
				
				<!-- 感受输入 -->
				<div class="mb-6">
					<label class="block text-neonYellow mb-2 text-base">
						<i class="fa fa-comment mr-2"></i>任务感受
					</label>
					<textarea id="feelingEditText" rows="4"
						class="w-full bg-darkBg/80 border-2 border-neonBlue rounded-lg px-4 py-3 text-lg focus:outline-none focus:border-neonGreen text-white"
						placeholder="比如：循环嵌套还是绕 / 比昨天顺一点 / 感觉很轻松"></textarea>
				</div>
				
				<!-- 按钮组 -->
				<div class="flex gap-3">
					<button id="cancelFeelingEditBtn"
						class="flex-1 bg-gray-700 text-white px-6 py-3 rounded-full text-lg font-bold transition-all duration-300 hover:scale-105">
						<i class="fa fa-times mr-2"></i>取消
					</button>
					<button id="saveFeelingEditBtn"
						class="flex-1 bg-neonGreen text-darkBg px-6 py-3 rounded-full text-lg font-bold transition-all duration-300 hover:scale-105 bg-glow-hover">
						<i class="fa fa-check mr-2"></i>修改完毕
					</button>
				</div>
			</div>
		</div>

		<!-- 新增：任务切换弹窗 -->
 		<div id="taskSwitchModal"
 			class="fixed inset-0 bg-darkBg/95 backdrop-blur-md z-50 flex items-center justify-center transition-modal scale-out hidden">
 			<div class="bg-darkBg border-2 border-neonBlue rounded-2xl p-6 w-full max-w-md">
 				<h2 class="text-2xl font-bold text-neonBlue text-shadow-neon mb-4 text-center">
 					<i class="fa fa-exchange mr-2"></i>切换任务
 				</h2>
 				<!-- 上一个任务总结 -->
 				<div id="lastTaskSummary" class="bg-darkBg/50 border border-neonGreen rounded-lg p-4 mb-6">
 					<p class="text-neonGreen font-medium mb-1">上一个任务</p>
 					<p id="lastTaskName" class="text-white text-lg mb-1">学Python基础语法</p>
 					<p id="lastTaskDuration" class="text-neonYellow text-sm">本次耗时：25分钟</p>
 				</div>

 				<!-- 任务卡片选择区域 -->
 				<div id="taskCardSelectArea" class="mb-6">
 					<label class="block text-neonYellow mb-2 text-base">
 						<i class="fa fa-th-large mr-2"></i>选择常用任务卡片（可选）
 					</label>
 					<!-- 卡片选择容器（动态生成） -->
 					<div id="taskCardSelectContainer" class="grid grid-cols-2 sm:grid-cols-3 gap-4">
 						<!-- 示例卡片（实际从本地存储读取） -->
 						<div class="card-select-item bg-darkBg/80 border-2 border-neonBlue rounded-lg p-3 cursor-pointer transition-all duration-300 hover:border-neonPink hover:scale-105"
 							data-card-id="card1">
 							<div class="text-center">
 								<div
 									class="w-10 h-10 rounded-full bg-neonBlue/20 flex items-center justify-center text-neonBlue text-base mx-auto mb-2">
 									<i class="fa fa-code"></i>
 								</div>
 								<p class="text-white text-sm font-medium truncate">学Python基础语法</p>
 								<p class="text-neonYellow text-xs mt-1">30分钟</p>
 							</div>
 						</div>
 					</div>
 					<p class="text-gray-400 text-xs mt-2">
 						<i class="fa fa-cog mr-1"></i>
 						<a href="javascript:;" id="goToCardSettingBtn"
 							class="text-neonBlue hover:underline">去设置更多任务卡片</a>
 					</p>
 				</div>

 				<!-- 任务感受输入 -->
 				<div class="mb-6">
 					<label class="block text-neonYellow mb-2 text-base">
 						<i class="fa fa-comment mr-2"></i>刚做完这个，感觉咋样？
 					</label>
 					<textarea id="taskFeeling" rows="2"
 						class="w-full bg-darkBg/80 border-2 border-neonBlue rounded-lg px-4 py-3 text-lg focus:outline-none focus:border-neonPink text-white"
 						placeholder="比如：循环嵌套还是绕 / 比昨天顺一点"></textarea>
 				</div>

 				<!-- 下一个任务输入 -->
 				<div class="mb-6">
 					<label class="block text-neonYellow mb-2 text-base">
 						<i class="fa fa-plus-circle mr-2"></i>下一个要做什么？
 					</label>
 					<input type="text" id="nextTaskName"
 						class="w-full bg-darkBg/80 border-2 border-neonBlue rounded-lg px-4 py-3 text-lg focus:outline-none focus:border-neonPink text-white"
 						placeholder="比如：背10个英语单词" required>
 					<div class="grid grid-cols-2 gap-4 mt-4">
 						<div>
 							<label class="block text-neonYellow mb-2 text-sm">预计时长（分钟）</label>
 							<input type="number" id="nextTaskTime" min="1" max="180" value="15"
 								class="w-full bg-darkBg/80 border-2 border-neonBlue rounded-lg px-4 py-2 text-lg focus:outline-none focus:border-neonPink text-white">
 						</div>
 						<div>
 							<label class="block text-neonYellow mb-2 text-sm">任务类型</label>

 							<!-- 自定义任务类型输入框 -->
 							<div class="relative">
 								<input type="text" id="nextTaskType"
 									class="w-full bg-darkBg/80 border-2 border-neonBlue rounded-lg px-4 py-2 text-lg focus:outline-none focus:border-neonPink text-white"
 									placeholder="输入任务类型（如：健身、阅读、编程）" value="学习" required>
 								<!-- 下拉建议列表 -->
 								<div id="taskTypeSuggestions"
 									class="absolute top-full left-0 right-0 bg-darkBg border-2 border-neonBlue rounded-lg mt-1 max-h-40 overflow-y-auto hidden z-10">
 									<div id="taskTypeSuggestionList" class="p-2">
 										<!-- 动态生成建议项 -->
 									</div>
 								</div>
 							</div>
 							<!-- 显示已保存的类型标签 -->
 							<div id="savedTaskTypes" class="flex flex-wrap gap-2 mt-2">
 								<!-- 动态生成已保存的类型标签 -->
 							</div>
 						</div>
 					</div>

 					<!-- SMART任务联动：关联已有计划 -->
 					<div class="mt-4">
 						<label class="flex items-center text-neonPink mb-2 text-sm">
 							<input type="checkbox" id="linkSmartTask" class="mr-2">
 							<span>关联已有SMART任务</span>
 						</label>
 						<select id="smartTaskLinkSelect"
 							class="w-full bg-darkBg/80 border-2 border-neonPink rounded-lg px-4 py-2 text-lg focus:outline-none focus:border-neonYellow text-white hidden">
 							<option value="">选择要关联的SMART任务</option>
 						</select>
 					</div>
 				</div>

 				<!-- 按钮组 -->
 				<div class="flex gap-4">
 					<button id="cancelSwitchBtn"
 						class="flex-1 bg-gray-700 px-4 py-3 rounded-full text-lg font-bold transition-all duration-300 hover:scale-105">
 						<i class="fa fa-times mr-2"></i>取消
 					</button>
 					<button id="confirmSwitchBtn"
 						class="flex-1 bg-neonGreen text-darkBg px-4 py-3 rounded-full text-lg font-bold transition-all duration-300 hover:scale-105 bg-glow-hover">
 						<i class="fa fa-check mr-2"></i>开始下一个
 					</button>
 				</div>
 			</div>
 		</div>

 		<!-- 原有：任务记录页面（替换为可视化成长日记） -->
 		<div id="recordScreen" class="screen flex flex-col min-h-screen w-full z-30 hidden p-6">
 			<!-- 顶部导航 -->
 			<div class="flex flex-wrap justify-between items-center mb-8 gap-4">
 				<h2 class="text-[clamp(1.8rem,5vw,3rem)] font-bold text-neonPink text-shadow-neon">
 					<i class="fa fa-line-chart mr-3"></i>成长日记
 				</h2>
 				<div class="flex gap-4 items-center">
 					<!-- 筛选切换按钮不再需要，移除 -->

 					<!-- 导出按钮移到这里，确保在手机上始终可见 -->
 					<button id="exportRecordBtn"
 						class="bg-neonYellow text-darkBg px-4 py-2 rounded-lg text-lg font-bold transition-all duration-300 hover:scale-105 bg-glow-hover">
 						<i class="fa fa-download mr-2"></i>导出
 					</button>

 					<button id="backFromRecordBtn"
 						class="bg-gray-700 px-4 py-2 rounded-lg text-lg font-bold transition-all duration-300 hover:scale-105">
 						<i class="fa fa-arrow-left mr-2"></i>返回
 					</button>
 				</div>

 				<div id="filterContainer" class="w-full flex flex-wrap gap-4">
 					<!-- 原有筛选内容（视图切换、类型筛选、关联筛选、日期筛选） -->
 					<div class="flex gap-2">
 						<button id="chartViewBtn"
 							class="bg-neonBlue text-darkBg px-4 py-2 rounded-lg text-lg font-bold transition-all duration-300 hover:scale-105 bg-glow-hover filter-active">
 							<i class="fa fa-pie-chart mr-2"></i>图表
 						</button>
 						<button id="timelineViewBtn"
 							class="bg-gray-700 px-4 py-2 rounded-lg text-lg font-bold transition-all duration-300 hover:scale-105">
 							<i class="fa fa-history mr-2"></i>时间轴
 						</button>
 					</div>

 					<select id="filterSelect"
 						class="bg-darkBg border-2 border-neonBlue rounded-lg px-4 py-2 text-lg focus:outline-none focus:border-neonPink text-white">
 						<option value="all">全部任务</option>
 						<option value="smart">仅SMART任务</option>
 						<option value="today">今日任务</option>
 						<option value="week">本周任务</option>
 						<option value="month">本月任务</option>
 					</select>

 					<select id="sortSelect"
 						class="bg-darkBg border-2 border-neonBlue rounded-lg px-4 py-2 text-lg focus:outline-none focus:border-neonPink text-white">
 						<option value="dateDesc">最新完成</option>
 						<option value="dateAsc">最早完成</option>
 						<option value="timeDesc">时长从长到短</option>
 						<option value="timeAsc">时长从短到长</option>
 						<option value="pointsDesc">奖励值从高到低</option>
 						<option value="pointsAsc">奖励值从低到高</option>
 					</select>

 					<select id="relevantFilterSelect"
 						class="bg-darkBg border-2 border-neonBlue rounded-lg px-4 py-2 text-lg focus:outline-none focus:border-neonPink text-white">
 						<option value="">全部关联</option>
 					</select>

 					<div class="flex gap-2">
 						<input type="date" id="startDateFilter"
 							class="bg-darkBg border-2 border-neonBlue rounded-lg px-4 py-2 text-lg focus:outline-none focus:border-neonPink text-white">
 						<input type="date" id="endDateFilter"
 							class="bg-darkBg border-2 border-neonBlue rounded-lg px-4 py-2 text-lg focus:outline-none focus:border-neonPink text-white">
 						<button id="dateFilterBtn"
 							class="bg-neonGreen text-darkBg px-4 py-2 rounded-lg text-lg font-bold transition-all duration-300 hover:scale-105">
 							<i class="fa fa-filter mr-1"></i>筛选
 						</button>
 					</div>
 				</div>
 			</div>

 			<!-- 记录统计概览 -->
 			<div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8 animate-slide-up">
 				<div class="bg-darkBg border-2 border-neonBlue rounded-2xl p-6 text-center">
 					<p class="text-neonBlue text-lg mb-2">总完成任务</p>
 					<p class="text-4xl font-bold text-white" id="recordTotal">0</p>
 				</div>
 				<div class="bg-darkBg border-2 border-neonPink rounded-2xl p-6 text-center">
 					<p class="text-neonPink text-lg mb-2">SMART任务</p>
 					<p class="text-4xl font-bold text-white" id="recordSmartTotal">0</p>
 				</div>
 				<div class="bg-darkBg border-2 border-neonYellow rounded-2xl p-6 text-center">
 					<p class="text-neonYellow text-lg mb-2">累计专注时长</p>
 					<p class="text-4xl font-bold text-white" id="recordTotalHours">0小时</p>
 				</div>
 				<div class="bg-darkBg border-2 border-neonPink rounded-2xl p-6 text-center">
 					<p class="text-neonPink text-lg mb-2">最长连续打卡</p>
 					<p class="text-4xl font-bold text-white" id="recordMaxStreak">0天</p>
 				</div>
 			</div>

 			<!-- 可视化内容区 -->
 			<div class="flex-1 animate-slide-up" style="animation-delay: 0.2s">
 				<!-- 图表视图（默认显示） -->
 				<div id="chartView" class="">
 					<h3 class="text-neonBlue text-xl font-bold mb-4">
 						<i class="fa fa-pie-chart mr-2"></i>SMART关联时间分配分析
 					</h3>
 					<!-- 饼图容器 -->
 					<div class="chart-container">
 						<canvas id="taskTypeChart"></canvas>
 					</div>
 					<!-- 计划vs实际对比 -->
 					<div class="mt-8">
 						<h3 class="text-neonBlue text-xl font-bold mb-4">
 							<i class="fa fa-bar-chart mr-2"></i>SMART任务计划vs实际
 						</h3>
 						<div class="chart-container">
 							<canvas id="planVsActualChart"></canvas>
 						</div>
 					</div>

 					<!-- 任务记录列表 -->
 					<div id="recordList" class="mt-8 space-y-4"></div>
 				</div>

 				<!-- 时间轴视图（默认隐藏） -->
 				<div id="timelineView" class="hidden">
 					<h3 class="text-neonBlue text-xl font-bold mb-4">
 						<i class="fa fa-history mr-2"></i>任务时间轴
 					</h3>
 					<!-- 时间轴容器 -->
 					<div id="taskTimeline" class="space-y-4">
 						<!-- 时间轴内容动态生成 -->
 						<div class="timeline-item">
 							<div class="timeline-dot"></div>
 							<div class="timeline-time">今天 09:00-09:25</div>
 							<h4 class="text-white font-bold text-lg">学Python基础语法</h4>
 							<p class="text-neonGreen text-sm">类型：学习 | 耗时：25分钟</p>
 							<p class="text-gray-400 text-sm mt-1">感受：循环嵌套还是绕，但比昨天顺一点</p>
 							<p class="text-neonPink text-xs mt-1">关联SMART任务：Python基础学习计划</p>
 						</div>
 					</div>
 				</div>

 				<!-- 空记录提示 -->
 				<div id="emptyRecord" class="text-center py-20 hidden">
 					<div
 						class="w-24 h-24 rounded-full bg-darkBg/50 flex items-center justify-center text-4xl text-neonBlue/30 mx-auto mb-6">
 						<i class="fa fa-folder-open"></i>
 					</div>
 					<p class="text-2xl text-gray-400 mb-4">暂无任务记录</p>
 					<p class="text-lg text-gray-500 mb-8">完成第一个任务，开启你的成长日记！</p>
 					<button id="emptyRecordStartBtn"
 						class="bg-neonGreen text-darkBg px-6 py-3 rounded-full text-xl font-bold transition-all duration-300 hover:scale-105 bg-glow-hover">
 						<i class="fa fa-play mr-2"></i>立即开始第一个任务
 					</button>
 				</div>
 			</div>
 		</div>

 		<!-- 新增：任务卡片设置界面 -->
 		<div id="cardSettingScreen" class="screen flex flex-col min-h-screen w-full z-30 hidden p-6">
 			<!-- 顶部导航 -->
 			<div class="flex flex-wrap justify-between items-center mb-8 gap-4">
 				<h2 class="text-[clamp(1.8rem,5vw,3rem)] font-bold text-neonBlue text-shadow-neon">
 					<i class="fa fa-th-large mr-3"></i>任务卡片设置
 				</h2>
 				<div class="flex flex-wrap gap-4">
 					<!-- 添加新卡片按钮 -->
 					<button id="addNewCardBtn"
 						class="bg-neonGreen text-darkBg px-4 py-2 rounded-lg text-lg font-bold transition-all duration-300 hover:scale-105 bg-glow-hover">
 						<i class="fa fa-plus mr-2"></i>添加新卡片
 					</button>
 					<!-- 返回按钮 -->
 					<button id="backFromCardSettingBtn"
 						class="bg-gray-700 px-4 py-2 rounded-lg text-lg font-bold transition-all duration-300 hover:scale-105">
 						<i class="fa fa-arrow-left mr-2"></i>返回首页
 					</button>
 				</div>
 			</div>

 			<!-- 功能说明 -->
 			<div class="bg-darkBg/50 border border-neonYellow rounded-lg p-4 mb-8">
 				<p class="text-neonYellow font-medium mb-2">
 					<i class="fa fa-info-circle mr-2"></i>功能说明
 				</p>
 				<p class="text-white text-sm">设置常用任务卡片后，在“切换任务”时可直接选择卡片，无需重复输入任务名称和时长，提升操作效率</p>
 			</div>

 			<!-- 卡片列表 -->
 			<div class="flex-1 mb-8">
 				<h3 class="text-neonPink text-xl font-bold mb-4">
 					<i class="fa fa-list mr-2"></i>已添加的任务卡片
 				</h3>
 				<!-- 卡片列表容器（动态生成） -->
 				<div id="taskCardList" class="space-y-4">
 					<!-- 示例卡片（默认显示，实际从本地存储读取） -->
 					<div class="card-setting-item" data-card-id="card1">
 						<div class="flex items-center gap-4">
 							<div
 								class="w-12 h-12 rounded-full bg-neonBlue/20 flex items-center justify-center text-neonBlue text-xl">
 								<i class="fa fa-code"></i>
 							</div>
 							<div>
 								<h4 class="text-white font-bold text-lg">学Python基础语法</h4>
 								<div class="flex items-center gap-3 mt-1">
 									<span class="card-type-tag type-tag-study">学习</span>
 									<span class="text-gray-400 text-sm">预计时长：30分钟</span>
 								</div>
 							</div>
 						</div>
 						<button class="card-delete-btn" data-card-id="card1">
 							<i class="fa fa-trash text-xl"></i>
 						</button>
 					</div>
 				</div>

 				<!-- 空卡片提示 -->
 				<div id="emptyCardTip" class="text-center py-20 hidden">
 					<div
 						class="w-24 h-24 rounded-full bg-darkBg/50 flex items-center justify-center text-4xl text-neonBlue/30 mx-auto mb-6">
 						<i class="fa fa-th-large"></i>
 					</div>
 					<p class="text-2xl text-gray-400 mb-4">暂无任务卡片</p>
 					<p class="text-lg text-gray-500 mb-8">点击“添加新卡片”，创建你的常用任务卡片吧！</p>
 					<button id="emptyCardAddBtn"
 						class="bg-neonGreen text-darkBg px-6 py-3 rounded-full text-xl font-bold transition-all duration-300 hover:scale-105 bg-glow-hover">
 						<i class="fa fa-plus mr-2"></i>立即添加
 					</button>
 				</div>
 			</div>
 		</div>

 		<!-- 新增/编辑卡片弹窗 -->
 		<div id="editCardModal"
 			class="fixed inset-0 bg-darkBg/95 backdrop-blur-md z-50 flex items-center justify-center transition-modal scale-out hidden">
 			<div class="bg-darkBg border-2 border-neonBlue rounded-2xl p-6 w-full max-w-md">
 				<h2 id="editCardModalTitle" class="text-2xl font-bold text-neonBlue text-shadow-neon mb-4 text-center">
 					<i class="fa fa-plus-circle mr-2"></i>添加新任务卡片
 				</h2>
 				<!-- 隐藏的卡片ID（编辑时使用） -->
 				<input type="hidden" id="editCardId" value="">
 				<!-- 卡片表单 -->
 				<form id="editCardForm" class="space-y-6">
 					<div>
 						<label class="block text-neonYellow mb-2 text-base">
 							<i class="fa fa-font mr-2"></i>任务名称
 						</label>
 						<input type="text" id="editCardName"
 							class="w-full bg-darkBg/80 border-2 border-neonBlue rounded-lg px-4 py-3 text-lg focus:outline-none focus:border-neonPink text-white"
 							placeholder="比如：学Python基础语法" required>
 					</div>
 					<div class="grid grid-cols-2 gap-4">
 						<div>
 							<label class="block text-neonYellow mb-2 text-sm">预计时长（分钟）</label>
 							<input type="number" id="editCardTime" min="1" max="180" value="30"
 								class="w-full bg-darkBg/80 border-2 border-neonBlue rounded-lg px-4 py-2 text-lg focus:outline-none focus:border-neonPink text-white"
 								required>
 						</div>
 						<div>
 							<label class="block text-neonYellow mb-2 text-sm">任务类型</label>

 							<!-- 自定义任务类型输入框 -->
 							<div class="relative">
 								<input type="text" id="editCardType"
 									class="w-full bg-darkBg/80 border-2 border-neonBlue rounded-lg px-4 py-2 text-lg focus:outline-none focus:border-neonPink text-white"
 									placeholder="输入任务类型（如：健身、阅读、编程）" value="学习" required>
 								<!-- 下拉建议列表 -->
 								<div id="editCardTypeSuggestions"
 									class="absolute top-full left-0 right-0 bg-darkBg border-2 border-neonBlue rounded-lg mt-1 max-h-40 overflow-y-auto hidden z-10">
 									<div id="editCardTypeSuggestionList" class="p-2">
 										<!-- 动态生成建议项 -->
 									</div>
 								</div>
 							</div>
 							<!-- 显示已保存的类型标签 -->
 							<div id="editCardSavedTypes" class="flex flex-wrap gap-2 mt-2">
 								<!-- 动态生成已保存的类型标签 -->
 							</div>
 						</div>
 					</div>
 					<div>
 						<label class="block text-neonYellow mb-2 text-sm">
 							<i class="fa fa-link mr-2"></i>关联SMART任务（可选）
 						</label>
 						<select id="editCardSmartLink"
 							class="w-full bg-darkBg/80 border-2 border-neonBlue rounded-lg px-4 py-2 text-lg focus:outline-none focus:border-neonPink text-white">
 							<option value="">不关联SMART任务</option>
 						</select>
 					</div>
 					<!-- 按钮组 -->
 					<div class="flex gap-4">
 						<button type="button" id="cancelEditCardBtn"
 							class="flex-1 bg-gray-700 px-4 py-3 rounded-full text-lg font-bold transition-all duration-300 hover:scale-105">
 							<i class="fa fa-times mr-2"></i>取消
 						</button>
 						<button type="submit" id="confirmEditCardBtn"
 							class="flex-1 bg-neonGreen text-darkBg px-4 py-3 rounded-full text-lg font-bold transition-all duration-300 hover:scale-105 bg-glow-hover">
 							<i class="fa fa-check mr-2"></i>确认添加
 						</button>
 					</div>
 				</form>
 			</div>
 		</div>

 		<!-- 新增：周期任务管理页面 -->
 		<div id="periodicTaskScreen" class="screen flex flex-col min-h-screen w-full z-30 hidden p-6">
 			<!-- 顶部导航 -->
 			<div class="flex flex-wrap justify-between items-center mb-8 gap-4">
 				<h2 class="text-[clamp(1.8rem,5vw,3rem)] font-bold text-neonBlue text-shadow-neon">
 					<i class="fa fa-calendar mr-3"></i>周期任务管理
 				</h2>
 				<div class="flex flex-wrap gap-4">
 					<!-- 查看今天任务按钮 -->
 					<button id="viewTodayTasksBtn"
 						class="bg-neonPink text-white px-4 py-2 rounded-lg text-lg font-bold transition-all duration-300 hover:scale-105 bg-glow-hover">
 						<i class="fa fa-calendar-day mr-2"></i>查看今天任务
 					</button>
 					<!-- 添加新周期任务按钮 -->
 					<button id="addPeriodicTaskBtn"
 						class="bg-neonGreen text-darkBg px-4 py-2 rounded-lg text-lg font-bold transition-all duration-300 hover:scale-105 bg-glow-hover">
 						<i class="fa fa-plus mr-2"></i>添加周期任务
 					</button>
 					<!-- 返回按钮 -->
 					<button id="backFromPeriodicTaskBtn"
 						class="bg-gray-700 px-4 py-2 rounded-lg text-lg font-bold transition-all duration-300 hover:scale-105">
 						<i class="fa fa-arrow-left mr-2"></i>返回首页
 					</button>
 				</div>
 			</div>

 			<!-- 功能说明 -->
 			<div class="bg-darkBg/50 border border-neonYellow rounded-lg p-4 mb-8">
 				<p class="text-neonYellow font-medium mb-2">
 					<i class="fa fa-info-circle mr-2"></i>功能说明
 				</p>
 				<p class="text-white text-sm">设置每日/每周/每月/每年的周期任务，在创建SMART任务时可以快速填充，提升任务设置效率</p>
 			</div>

 			<!-- 周期类型切换 -->
 			<div class="flex gap-2 mb-6 flex-wrap">
 				<button
 					class="periodic-tab-btn active bg-neonBlue text-darkBg px-4 py-2 rounded-lg font-bold transition-all duration-300"
 					data-period="daily">
 					<i class="fa fa-sun mr-2"></i>每日任务
 				</button>
 				<button
 					class="periodic-tab-btn bg-gray-700 text-white px-4 py-2 rounded-lg font-bold transition-all duration-300"
 					data-period="weekly">
 					<i class="fa fa-calendar-week-o mr-2"></i>每周任务
 				</button>
 				<button
 					class="periodic-tab-btn bg-gray-700 text-white px-4 py-2 rounded-lg font-bold transition-all duration-300"
 					data-period="specific">
 					<i class="fa fa-calendar mr-2"></i>具体日期
 				</button>
 			</div>

 			<!-- 周期任务列表 -->
 			<div class="flex-1 mb-8">
 				<h3 class="text-neonPink text-xl font-bold mb-4">
 					<i class="fa fa-list mr-2"></i>已添加的周期任务
 				</h3>
 				<!-- 任务列表容器（动态生成） -->
 				<div id="periodicTaskList" class="space-y-4">
 					<!-- 示例任务（默认显示，实际从本地存储读取） -->
 					<div class="periodic-task-item" data-task-id="task1">
 						<div class="flex items-center gap-4">
 							<div
 								class="w-12 h-12 rounded-full bg-neonGreen/20 flex items-center justify-center text-neonGreen text-xl">
 								<i class="fa fa-book"></i>
 							</div>
 							<div class="flex-1">
 								<h4 class="text-white font-bold text-lg">阅读30分钟</h4>
 								<div class="flex items-center gap-3 mt-1">
 									<span
 										class="periodic-type-tag bg-neonBlue/20 text-neonBlue px-2 py-1 rounded text-sm">每日</span>
 									<span class="text-gray-400 text-sm">预计时长：30分钟</span>
 								</div>
 							</div>
 							<div class="flex gap-2">
 								<button class="periodic-edit-btn" data-task-id="task1">
 									<i class="fa fa-edit text-neonYellow text-xl"></i>
 								</button>
 								<button class="periodic-delete-btn" data-task-id="task1">
 									<i class="fa fa-trash text-neonPink text-xl"></i>
 								</button>
 							</div>
 						</div>
 					</div>
 				</div>

 				<!-- 空任务提示 -->
 				<div id="emptyPeriodicTaskTip" class="text-center py-20 hidden">
 					<div
 						class="w-24 h-24 rounded-full bg-darkBg/50 flex items-center justify-center text-4xl text-neonBlue/30 mx-auto mb-6">
 						<i class="fa fa-calendar"></i>
 					</div>
 					<p class="text-2xl text-gray-400 mb-4">暂无周期任务</p>
 					<p class="text-lg text-gray-500 mb-8">点击"添加周期任务"，创建你的周期任务吧！</p>
 					<button id="emptyPeriodicTaskAddBtn"
 						class="bg-neonGreen text-darkBg px-6 py-3 rounded-full text-xl font-bold transition-all duration-300 hover:scale-105 bg-glow-hover">
 						<i class="fa fa-plus mr-2"></i>立即添加
 					</button>
 				</div>
 			</div>
 		</div>

 		<!-- 查看今天任务弹窗 -->
 		<div id="todayTasksModal"
 			class="fixed inset-0 bg-darkBg/95 backdrop-blur-md z-50 flex items-center justify-center hidden">
 			<div
 				class="bg-darkBg border-2 border-neonPink rounded-2xl p-6 w-full max-w-md max-h-[80vh] overflow-y-auto animate-explode">
 				<h2 class="text-2xl font-bold text-neonPink text-shadow-neon mb-4 text-center">
 					<i class="fa fa-calendar-day mr-2"></i>今天的任务
 				</h2>
 				<p id="todayDate" class="text-gray-400 text-sm mb-4 text-center"></p>

 				<!-- 今天任务列表 -->
 				<div id="todayTasksList" class="space-y-3 max-h-60 overflow-y-auto">
 					<!-- 动态生成 -->
 				</div>

 				<!-- 空提示 -->
 				<div id="emptyTodayTasksTip" class="text-center py-8 hidden">
 					<div
 						class="w-16 h-16 rounded-full bg-darkBg/50 flex items-center justify-center text-3xl text-neonPink/30 mx-auto mb-4">
 						<i class="fa fa-calendar-day"></i>
 					</div>
 					<p class="text-gray-400">今天没有安排任务</p>
 				</div>

 				<!-- 关闭按钮 -->
 				<button id="closeTodayTasksBtn"
 					class="w-full bg-neonPink text-white px-6 py-3 rounded-full text-xl font-bold mt-6 transition-all duration-300 hover:scale-105 bg-glow-hover">
 					<i class="fa fa-times mr-2"></i>关闭
 				</button>
 			</div>
 		</div>

 		<!-- 今日任务确认弹窗 -->
 		<div id="todayTaskConfirmationModal"
 			class="fixed inset-0 bg-darkBg/95 backdrop-blur-md z-50 flex items-center justify-center hidden">
 			<div class="bg-darkBg border-2 border-neonYellow rounded-2xl p-8 w-full max-w-md animate-explode">
 				<div class="text-center">
 					<div
 						class="w-24 h-24 rounded-full bg-neonYellow/20 flex items-center justify-center text-5xl text-neonYellow mx-auto mb-6 animate-bounce-slow">
 						<i class="fa fa-trophy"></i>
 					</div>
 					<h2 class="text-3xl font-bold text-neonYellow text-shadow-neon mb-4">
 						恭喜你骑士
 					</h2>
 					<p class="text-white text-xl mb-8">
 						你准备好今天的挑战了吗？
 					</p>
 					<div class="flex gap-4">
 						<button id="todayTaskYesBtn"
 							class="flex-1 bg-neonGreen text-darkBg px-6 py-4 rounded-full text-xl font-bold transition-all duration-300 hover:scale-105 bg-glow-hover">
 							<i class="fa fa-check mr-2"></i>是
 						</button>
 						<button id="todayTaskNoBtn"
 							class="flex-1 bg-gray-700 text-white px-6 py-4 rounded-full text-xl font-bold transition-all duration-300 hover:scale-105">
 							<i class="fa fa-times mr-2"></i>否
 						</button>
 					</div>
 				</div>
 			</div>
 		</div>

 		<!-- 子任务查看弹窗 -->
 		<div id="subtaskViewModal"
 			class="fixed inset-0 bg-darkBg/95 backdrop-blur-md z-50 flex items-center justify-center hidden">
 			<div
 				class="bg-gradient-to-br from-darkBg via-purple-900/30 to-darkBg border-2 border-neonBlue rounded-2xl p-8 w-full max-w-lg animate-explode relative overflow-hidden">
 				<!-- 粒子特效容器 -->
 				<div id="subtaskParticles" class="absolute inset-0 pointer-events-none overflow-hidden"></div>

 				<!-- 背景装饰 -->
 				<div class="absolute inset-0 pointer-events-none overflow-hidden">
 					<div
 						class="absolute top-0 left-0 w-32 h-32 bg-neonBlue/10 rounded-full blur-3xl -translate-x-1/2 -translate-y-1/2 animate-float">
 					</div>
 					<div class="absolute top-0 right-0 w-24 h-24 bg-neonPink/10 rounded-full blur-2xl translate-x-1/2 translate-y-1/4 animate-float"
 						style="animation-delay: 0.2s"></div>
 					<div class="absolute bottom-0 left-1/4 w-20 h-20 bg-neonYellow/10 rounded-full blur-xl translate-x-1/4 translate-y-1/2 animate-float"
 						style="animation-delay: 0.4s"></div>
 					<div class="absolute bottom-0 right-1/4 w-16 h-16 bg-neonGreen/10 rounded-full blur-lg translate-x-1/2 translate-y-1/3 animate-float"
 						style="animation-delay: 0.6s"></div>

 					<!-- 流星效果 -->
 					<div class="absolute top-1/4 left-1/4 w-2 h-2 bg-neonBlue/30 rounded-full animate-pulse-fast">
 					</div>
 					<div class="absolute top-1/3 right-1/3 w-1.5 h-1.5 bg-neonPink/30 rounded-full animate-pulse-fast"
 						style="animation-delay: 0.3s"></div>
 					<div class="absolute top-1/2 left-1/2 w-1.5 h-1.5 bg-neonYellow/30 rounded-full animate-pulse-fast"
 						style="animation-delay: 0.5s"></div>
 					<div class="absolute top-2/3 left-1/3 w-1 h-1 bg-neonGreen/30 rounded-full animate-pulse-fast"
 						style="animation-delay: 0.7s"></div>
 					<div class="absolute top-1/2 right-1/2 w-1 h-1 bg-neonBlue/30 rounded-full animate-pulse-fast"
 						style="animation-delay: 0.9s"></div>
 					<div class="absolute top-1/3 right-1/3 w-1 h-1 bg-neonPink/30 rounded-full animate-pulse-fast"
 						style="animation-delay: 1.1s"></div>
 				</div>

 				<div class="relative z-10">
 					<div class="text-center mb-6">
 						<div class="inline-flex items-center gap-3 mb-4">
 							<div
 								class="w-16 h-16 rounded-full bg-neonBlue/20 flex items-center justify-center text-3xl text-neonBlue mx-auto animate-bounce-slow">
 								<i class="fa fa-tasks"></i>
 							</div>
 							<div class="text-left">
 								<h2 class="text-2xl font-bold text-white text-shadow-neon mb-2">
 									子任务详情
 								</h2>
 								<p id="subtaskProgressText" class="text-neonYellow text-sm">完成进度：0/0</p>
 							</div>
 						</div>
 					</div>

 					<!-- 进度条 -->
 					<div class="mb-6">
 						<div class="w-full h-3 bg-darkBg/50 rounded-full overflow-hidden relative">
 							<div id="subtaskProgressBar"
 								class="h-full bg-gradient-to-r from-neonPink via-neonBlue to-neonGreen transition-all duration-500"
 								style="width: 0%">
 								<div class="absolute inset-0 flex items-center justify-center">
 									<div
 										class="w-full h-full bg-gradient-to-r from-transparent via-white/10 to-transparent animate-pulse-fast">
 									</div>
 								</div>
 							</div>
 						</div>
 					</div>

 					<div id="subtaskViewList" class="space-y-4 max-h-60 overflow-y-auto pr-2">
 						<!-- 子任务将动态添加到这里 -->
 					</div>

 					<!-- 完成奖励区域 -->
 					<div id="subtaskRewardSection" class="mt-6 pt-6 border-t border-neonYellow/30 hidden">
 						<div class="text-center">
 							<div
 								class="w-20 h-20 rounded-full bg-neonYellow/20 flex items-center justify-center text-4xl text-neonYellow mx-auto mb-4 animate-bounce-slow">
 								<i class="fa fa-gift"></i>
 							</div>
 							<h3 class="text-2xl font-bold text-neonYellow text-shadow-neon mb-3">
 								恭喜！全部完成！
 							</h3>
 							<p class="text-white text-lg mb-4">
 								你已完成所有子任务
 							</p>
 							<div class="bg-neonYellow/20 border-2 border-neonYellow rounded-lg p-4 mb-4">
 								<p class="text-neonYellow font-bold text-lg mb-2">
 									<i class="fa fa-star mr-2"></i>奖励内容
 								</p>
 								<div class="flex items-center gap-3">
 									<div class="flex-1 text-center">
 										<p class="text-white text-3xl font-bold">+10 积分</p>
 										<p class="text-gray-400 text-sm">基础奖励</p>
 									</div>
 									<div class="flex-1 text-center">
 										<p class="text-white text-3xl font-bold" id="bonusReward">+5 积分</p>
 										<p class="text-gray-400 text-sm">额外奖励</p>
 									</div>
 								</div>
 							</div>
 							<button id="claimSubtaskRewardBtn"
 								class="w-full bg-neonGreen text-darkBg px-6 py-4 rounded-full text-xl font-bold transition-all duration-300 hover:scale-105 bg-glow-hover animate-bounce-slow">
 								<i class="fa fa-check-circle mr-2"></i>领取奖励
 							</button>
 							<button id="closeRewardSectionBtn"
 								class="w-full bg-gray-700 text-white px-6 py-4 rounded-full text-xl font-bold transition-all duration-300 hover:scale-105 hover:bg-gray-600 hidden">
 								<i class="fa fa-times mr-2"></i>关闭
 							</button>
 						</div>
 					</div>

 					<!-- 关闭按钮 -->
 					<button id="closeSubtaskViewBtn"
 						class="w-full bg-gray-700 text-white px-6 py-3 rounded-full text-xl font-bold mt-6 transition-all duration-300 hover:scale-105 hover:bg-gray-600">
 						<i class="fa fa-times mr-2"></i>关闭
 					</button>
 				</div>
 			</div>
 		</div>

 		<!-- 放弃确认弹窗 -->
 		<div id="giveUpConfirmationModal"
 			class="fixed inset-0 bg-darkBg/95 backdrop-blur-md z-50 flex items-center justify-center hidden">
 			<div class="bg-darkBg border-2 border-neonPink rounded-2xl p-8 w-full max-w-md animate-explode">
 				<div class="text-center">
 					<div
 						class="w-24 h-24 rounded-full bg-neonPink/20 flex items-center justify-center text-5xl text-neonPink mx-auto mb-6 animate-pulse-fast">
 						<i class="fa fa-exclamation-triangle"></i>
 					</div>
 					<h2 class="text-2xl font-bold text-neonPink text-shadow-neon mb-4">
 						你确定要放弃？
 					</h2>
 					<p class="text-gray-300 text-lg mb-6 leading-relaxed">
 						你还要多久呢，如果刷视频，你会刷多久你都不知道的，你现在就是最好的状态，状态不是等来的，是自己做出来的。
 					</p>
 					<div class="flex gap-4">
 						<button id="giveUpConfirmBtn"
 							class="flex-1 bg-neonPink text-white px-6 py-4 rounded-full text-xl font-bold transition-all duration-300 hover:scale-105 bg-glow-hover">
 							<i class="fa fa-times mr-2"></i>放弃
 						</button>
 						<button id="giveUpContinueBtn"
 							class="flex-1 bg-neonGreen text-darkBg px-6 py-4 rounded-full text-xl font-bold transition-all duration-300 hover:scale-105 bg-glow-hover">
 							<i class="fa fa-arrow-left mr-2"></i>继续
 						</button>
 					</div>
 				</div>
 			</div>
		</div>

		<!-- 暂停确认弹窗 -->
		<div id="pauseConfirmationModal"
			class="fixed inset-0 bg-darkBg/95 backdrop-blur-md z-50 flex items-center justify-center hidden">
			<div class="bg-darkBg border-2 border-neonYellow rounded-2xl p-8 w-full max-w-md animate-explode">
				<div class="text-center">
					<div
						class="w-24 h-24 rounded-full bg-neonYellow/20 flex items-center justify-center text-5xl text-neonYellow mx-auto mb-6 animate-pulse-fast">
						<i class="fa fa-pause"></i>
					</div>
					<h2 class="text-2xl font-bold text-neonYellow text-shadow-neon mb-4">
						确定要暂停吗？
					</h2>
					<p class="text-gray-300 text-lg mb-6 leading-relaxed">
						暂停后可以随时继续，但要保持专注哦！
					</p>
					<div class="flex gap-4">
						<button id="pauseConfirmBtn"
							class="flex-1 bg-neonYellow text-darkBg px-6 py-4 rounded-full text-xl font-bold transition-all duration-300 hover:scale-105 bg-glow-hover">
							<i class="fa fa-check mr-2"></i>确认
						</button>
						<button id="pauseCancelBtn"
							class="flex-1 bg-gray-600 text-white px-6 py-4 rounded-full text-xl font-bold transition-all duration-300 hover:scale-105 bg-glow-hover">
							<i class="fa fa-times mr-2"></i>取消
						</button>
					</div>
				</div>
			</div>
		</div>

		<!-- 完成确认弹窗 -->
		<div id="completeConfirmationModal"
			class="fixed inset-0 bg-darkBg/95 backdrop-blur-md z-50 flex items-center justify-center hidden">
			<div class="bg-darkBg border-2 border-neonGreen rounded-2xl p-8 w-full max-w-md animate-explode">
				<div class="text-center">
					<div
						class="w-24 h-24 rounded-full bg-neonGreen/20 flex items-center justify-center text-5xl text-neonGreen mx-auto mb-6 animate-pulse-fast">
						<i class="fa fa-flag-checkered"></i>
					</div>
					<h2 class="text-2xl font-bold text-neonGreen text-shadow-neon mb-4">
						确定要完成任务吗？
					</h2>
					<p class="text-gray-300 text-lg mb-6 leading-relaxed">
						恭喜你完成这次专注！完成后将获得奖励值。
					</p>
					<div class="flex gap-4">
						<button id="completeConfirmBtn"
							class="flex-1 bg-neonGreen text-darkBg px-6 py-4 rounded-full text-xl font-bold transition-all duration-300 hover:scale-105 bg-glow-hover">
							<i class="fa fa-check mr-2"></i>确认
						</button>
						<button id="completeCancelBtn"
							class="flex-1 bg-gray-600 text-white px-6 py-4 rounded-full text-xl font-bold transition-all duration-300 hover:scale-105 bg-glow-hover">
							<i class="fa fa-times mr-2"></i>取消
						</button>
					</div>
				</div>
			</div>
		</div>

		<!-- 新增/编辑周期任务弹窗 -->
 		<div id="editPeriodicTaskModal"
 			class="fixed inset-0 bg-darkBg/95 backdrop-blur-md z-50 flex items-center justify-center transition-modal scale-out hidden">
 			<div
 				class="bg-darkBg border-2 border-neonBlue rounded-2xl p-4 w-full max-w-[90vw] max-h-[80vh] overflow-y-auto animate-explode">
 				<h2 id="editPeriodicTaskModalTitle"
 					class="text-2xl font-bold text-neonBlue text-shadow-neon mb-6 text-center">
 					<i class="fa fa-plus-circle mr-2"></i>添加周期任务
 				</h2>
 				<!-- 隐藏的任务ID（编辑时使用） -->
 				<input type="hidden" id="editPeriodicTaskId" value="">
 				<!-- 任务表单 -->
 				<form id="editPeriodicTaskForm" class="space-y-6">
 					<!-- S (Specific) 具体目标 -->
 					<div class="space-y-2">
 						<label class="block text-neonBlue mb-1 text-sm md:text-base">
 							<span>S - 具体目标</span>
 						</label>
 						<input type="text" id="editPeriodicTaskName"
 							class="w-full bg-darkBg/80 border-2 border-neonBlue rounded-lg px-4 py-3 text-xl focus:outline-none focus:border-neonYellow text-white"
 							placeholder="例如：完成Python基础语法3个章节的学习" required>
 						<p class="text-gray-400 text-sm">提示：避免模糊表述（如"学Python"），明确具体内容</p>
 					</div>

 					<!-- M (Measurable) 子任务管理 -->
 					<div class="space-y-2">
 						<label class="block text-neonBlue mb-1 text-sm md:text-base">
 							<span>M - 子任务管理</span>
 						</label>
 						<div id="periodicSubtaskContainer" class="space-y-2">
 							<!-- 子任务将动态添加到这里 -->
 						</div>
 						<div class="flex gap-2">
 							<input type="text" id="newPeriodicSubtaskInput"
 								class="flex-1 bg-darkBg/80 border-2 border-neonBlue rounded-lg px-4 py-2 text-lg focus:outline-none focus:border-neonYellow text-white"
 								placeholder="输入子任务内容">
 							<button type="button" id="addPeriodicSubtaskBtn"
 								class="bg-neonYellow text-darkBg px-4 py-2 rounded-lg font-bold hover:bg-neonYellow/80 transition-colors">
 								<i class="fa fa-plus"></i> 添加
 							</button>
 						</div>
 						<p class="text-gray-400 text-sm">提示：添加具体子任务，完成后可打对号标记</p>
 					</div>

 					<!-- A (Achievable) 可实现难度 -->
 					<div class="space-y-2">
 						<label class="block text-neonBlue mb-1 text-sm md:text-base">
 							<span>A - 可实现难度</span>
 						</label>
 						<select id="editPeriodicTaskDifficulty"
 							class="w-full bg-darkBg/80 border-2 border-neonBlue rounded-lg px-4 py-3 text-xl focus:outline-none focus:border-neonYellow text-white"
 							required>
 							<option value="easy">简单（10-20分钟，无门槛）</option>
 							<option value="medium" selected>中等（30-60分钟，有基础）</option>
 							<option value="hard">较难（90-120分钟，需专注）</option>
 						</select>
 						<p class="text-gray-400 text-sm">提示：难度需匹配当前能力，避免无法完成或过于简单</p>
 					</div>

 					<!-- R (Relevant) 相关关联 -->
 					<div class="space-y-2">
 						<label class="block text-neonBlue mb-1 text-sm md:text-base">
 							<span>R - 相关关联</span>
 						</label>
 						<input type="text" id="editPeriodicTaskRelevant"
 							class="w-full bg-darkBg/80 border-2 border-neonBlue rounded-lg px-4 py-3 text-xl focus:outline-none focus:border-neonYellow text-white"
 							placeholder="例如：为后续开发数据分析项目打基础" required>
 						<p class="text-gray-400 text-sm">提示：说明任务与长期目标/当前计划的关联</p>
 					</div>

 					<!-- T (Time-bound) 时间期限 -->
 					<div class="grid grid-cols-1 md:grid-cols-2 gap-4 space-y-2 md:space-y-0">
 						<div class="space-y-2">
 							<label class="block text-neonBlue mb-1 text-sm md:text-base">
 								<span>T - 周期类型</span>
 							</label>
 							<select id="editPeriodicTaskType"
 								class="w-full bg-darkBg/80 border-2 border-neonBlue rounded-lg px-4 py-3 text-xl focus:outline-none focus:border-neonYellow text-white"
 								required>
 								<option value="daily">每日任务</option>
 								<option value="weekly">每周任务</option>
 								<option value="specific">具体日期</option>
 							</select>
 						</div>
 						<div class="space-y-2">
 							<label class="block text-neonBlue mb-1 text-sm md:text-base">
 								<span>预计时长（分钟）</span>
 							</label>
 							<input type="number" id="editPeriodicTaskDuration"
 								class="w-full bg-darkBg/80 border-2 border-neonBlue rounded-lg px-4 py-3 text-xl focus:outline-none focus:border-neonYellow text-white"
 								value="30" min="5" max="180" required>
 						</div>
 					</div>

 					<!-- 具体日期设置 -->
 					<div class="space-y-2" id="specificDateContainer">
 						<label class="block text-neonBlue mb-1 text-sm md:text-base">
 							<span>具体日期设置</span>
 						</label>
 						<div id="dailyDateSetting" class="date-setting hidden">
 							<p class="text-gray-400 text-sm">每日任务无需设置具体日期</p>
 						</div>
 						<div id="weeklyDateSetting" class="date-setting hidden">
 							<div class="grid grid-cols-7 gap-2">
 								<label class="flex items-center gap-2 cursor-pointer">
 									<input type="checkbox" class="weekly-date-checkbox" value="1"> <span
 										class="text-sm">周一</span>
 								</label>
 								<label class="flex items-center gap-2 cursor-pointer">
 									<input type="checkbox" class="weekly-date-checkbox" value="2"> <span
 										class="text-sm">周二</span>
 								</label>
 								<label class="flex items-center gap-2 cursor-pointer">
 									<input type="checkbox" class="weekly-date-checkbox" value="3"> <span
 										class="text-sm">周三</span>
 								</label>
 								<label class="flex items-center gap-2 cursor-pointer">
 									<input type="checkbox" class="weekly-date-checkbox" value="4"> <span
 										class="text-sm">周四</span>
 								</label>
 								<label class="flex items-center gap-2 cursor-pointer">
 									<input type="checkbox" class="weekly-date-checkbox" value="5"> <span
 										class="text-sm">周五</span>
 								</label>
 								<label class="flex items-center gap-2 cursor-pointer">
 									<input type="checkbox" class="weekly-date-checkbox" value="6"> <span
 										class="text-sm">周六</span>
 								</label>
 								<label class="flex items-center gap-2 cursor-pointer">
 									<input type="checkbox" class="weekly-date-checkbox" value="0"> <span
 										class="text-sm">周日</span>
 								</label>
 							</div>
 						</div>
 						<div id="specificDateSetting" class="date-setting hidden">
 							<div class="grid grid-cols-2 gap-4">
 								<div>
 									<label class="block text-sm text-gray-400 mb-1">选择日期</label>
 									<input type="date" id="specificDateInput"
 										class="w-full bg-darkBg/80 border-2 border-neonBlue rounded-lg px-4 py-3 text-lg focus:outline-none focus:border-neonYellow text-white">
 								</div>
 								<div>
 									<label class="block text-sm text-gray-400 mb-1">选择时间（可选）</label>
 									<input type="time" id="specificTimeInput"
 										class="w-full bg-darkBg/80 border-2 border-neonBlue rounded-lg px-4 py-3 text-lg focus:outline-none focus:border-neonYellow text-white">
 								</div>
 							</div>
 							<p class="text-gray-400 text-sm mt-2">选择具体的日历日期来执行任务</p>
 						</div>
 					</div>

 					<!-- 任务奖励设置 -->
 					<div class="space-y-2">
 						<label class="block text-neonYellow mb-2 text-lg">完成奖励（可选）</label>
 						<input type="text" id="editPeriodicTaskReward"
 							class="w-full bg-darkBg/80 border-2 border-neonBlue rounded-lg px-4 py-3 text-xl focus:outline-none focus:border-neonYellow text-white"
 							placeholder="例如：看1集喜欢的动漫、吃1块巧克力">
 					</div>

 					<!-- 按钮组 -->
 					<div class="flex gap-4 mt-6">
 						<button type="button" id="cancelEditPeriodicTaskBtn"
 							class="flex-1 bg-gray-700 px-6 py-3 rounded-full text-xl font-bold transition-all duration-300 hover:scale-105">
 							<i class="fa fa-times mr-2"></i>取消
 						</button>
 						<button type="submit" id="confirmEditPeriodicTaskBtn"
 							class="flex-1 bg-neonBlue text-white px-6 py-3 rounded-full text-xl font-bold transition-all duration-300 hover:scale-105 bg-glow-hover">
 							<i class="fa fa-check mr-2"></i>确认添加
 						</button>
 					</div>
 				</form>
 			</div>
 		</div>

 		<!-- 新增：周期任务选择弹窗（用于SMART任务快速填充） -->
 		<div id="periodicTaskSelectModal"
 			class="fixed inset-0 bg-darkBg/95 backdrop-blur-md z-50 flex items-center justify-center hidden">
 			<div
 				class="bg-darkBg border-2 border-neonBlue rounded-2xl p-6 w-full max-w-md max-h-[80vh] overflow-y-auto">
 				<h2 class="text-2xl font-bold text-neonBlue text-shadow-neon mb-4 text-center">
 					<i class="fa fa-calendar mr-2"></i>选择周期任务
 				</h2>
 				<p class="text-gray-400 text-sm mb-4 text-center">选择一个周期任务，快速填充到SMART任务中</p>

 				<!-- 周期类型筛选 -->
 				<div class="flex gap-2 mb-4 flex-wrap">
 					<button
 						class="periodic-select-tab-btn active bg-neonBlue text-darkBg px-3 py-1 rounded-lg font-bold transition-all duration-300 text-sm"
 						data-period="all">全部</button>
 					<button
 						class="periodic-select-tab-btn bg-gray-700 text-white px-3 py-1 rounded-lg font-bold transition-all duration-300 text-sm"
 						data-period="daily">每日</button>
 					<button
 						class="periodic-select-tab-btn bg-gray-700 text-white px-3 py-1 rounded-lg font-bold transition-all duration-300 text-sm"
 						data-period="weekly">每周</button>
 					<button
 						class="periodic-select-tab-btn bg-gray-700 text-white px-3 py-1 rounded-lg font-bold transition-all duration-300 text-sm"
 						data-period="specific">具体日期</button>
 				</div>

 				<!-- 周期任务列表 -->
 				<div id="periodicTaskSelectList" class="space-y-3 max-h-60 overflow-y-auto">
 					<!-- 动态生成 -->
 				</div>

 				<!-- 空提示 -->
 				<div id="emptyPeriodicSelectTip" class="text-center py-8 hidden">
 					<p class="text-gray-400">暂无周期任务，请先在周期任务管理中添加</p>
 				</div>

 				<div class="flex gap-4 mt-6">
 					<button type="button" id="closePeriodicSelectModalBtn"
 						class="flex-1 bg-gray-700 px-4 py-3 rounded-full text-lg font-bold transition-all duration-300 hover:scale-105">
 						<i class="fa fa-times mr-2"></i>取消
 					</button>
 				</div>
 			</div>
 		</div>

 		<!-- 新增：奖励模块页面 -->
 		<div id="rewardModuleScreen" class="screen flex flex-col min-h-screen w-full z-30 hidden p-6">
 			<!-- 顶部导航 -->
 			<div class="flex flex-wrap justify-between items-center mb-8 gap-4">
 				<h2 class="text-[clamp(1.8rem,5vw,3rem)] font-bold text-neonYellow text-shadow-neon">
 					<i class="fa fa-gift mr-3"></i>奖励转盘
 				</h2>
 				<div class="flex flex-wrap gap-4">
 					<!-- 音效开关按钮 -->
 					<button id="toggleSoundBtn"
 						class="bg-neonBlue px-4 py-2 rounded-lg text-lg font-bold transition-all duration-300 hover:scale-105">
 						<i class="fa fa-volume-up mr-2"></i>音效
 					</button>
 					<!-- 返回按钮 -->
 					<button id="backFromRewardModuleBtn"
 						class="bg-gray-700 px-4 py-2 rounded-lg text-lg font-bold transition-all duration-300 hover:scale-105">
 						<i class="fa fa-arrow-left mr-2"></i>返回首页
 					</button>
 				</div>
 			</div>

 			<!-- 功能说明 -->
 			<div class="bg-darkBg/50 border border-neonYellow rounded-lg p-4 mb-8">
 				<p class="text-neonYellow font-medium mb-2">
 					<i class="fa fa-info-circle mr-2"></i>功能说明
 				</p>
 				<p class="text-white text-sm">完成任务可获得奖励值，使用奖励值转动转盘获取随机奖励！</p>
 			</div>

 			<!-- 奖励值和王者值显示 -->
			<div class="bg-darkBg border-2 border-neonYellow rounded-2xl p-6 mb-8 text-center">
				<div class="grid grid-cols-2 gap-6">
					<!-- 王者值显示 -->
					<div class="flex flex-col items-center">
						<h3 class="text-xl font-bold text-gold mb-2">王者值</h3>
						<div class="text-4xl font-bold text-gold animate-number-pop" id="currentHonorPoints">0</div>
						<div class="flex items-center gap-2 mt-2">
							<button id="decreaseHonorBtn" 
								class="bg-red-500 hover:bg-red-600 text-white w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold transition-all duration-300 hover:scale-110">
								<i class="fa fa-minus"></i>
							</button>
							<button id="increaseHonorBtn" 
								class="bg-green-500 hover:bg-green-600 text-white w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold transition-all duration-300 hover:scale-110">
								<i class="fa fa-plus"></i>
							</button>
						</div>
						<p class="text-gray-400 text-xs mt-1">今日已增加 <span id="todayIncreaseCount">0</span>/3</p>
						<p class="text-gold text-xs mt-1">通过王者值获得荣誉称号</p>
					</div>
					
					<!-- 奖励值显示 -->
					<div class="flex flex-col items-center">
						<h3 class="text-xl font-bold text-neonYellow mb-2">奖励值</h3>
						<div class="text-4xl font-bold text-white animate-number-pop" id="currentRewardPoints">0</div>
						<p class="text-gray-400 text-sm mt-2">完成任务可获得更多奖励值</p>
					</div>
				</div>
			</div>

 			<!-- 奖励管理区域 -->
 			<div class="bg-darkBg border-2 border-neonBlue rounded-2xl p-6 mb-8">
 				<h3 class="text-xl font-bold text-neonBlue mb-4">
 					<i class="fa fa-cog mr-2"></i>奖励管理
 				</h3>
 				<div class="flex flex-wrap gap-4 mb-4">
 					<button id="addNormalRewardBtn"
 						class="bg-neonGreen text-darkBg px-4 py-2 rounded-lg text-sm font-bold transition-all duration-300 hover:scale-105">
 						<i class="fa fa-plus mr-2"></i>添加普通奖励
 					</button>
 					<button id="addSuperRewardBtn"
 						class="bg-neonPink text-white px-4 py-2 rounded-lg text-sm font-bold transition-all duration-300 hover:scale-105">
 						<i class="fa fa-plus mr-2"></i>添加超级奖励
 					</button>
 					<button id="addUltimateRewardBtn"
 						class="bg-neonYellow text-darkBg px-4 py-2 rounded-lg text-sm font-bold transition-all duration-300 hover:scale-105">
 						<i class="fa fa-plus mr-2"></i>添加最终奖励
 					</button>
 				</div>

 				<!-- 普通奖励列表 -->
 				<div class="mb-6">
 					<h4 class="text-lg font-bold text-neonGreen mb-2">普通奖励</h4>
 					<div id="normalRewardsList"
 						class="grid grid-cols-2 md:grid-cols-4 gap-3 max-h-40 overflow-y-auto p-2 bg-darkBg/50 rounded-lg">
 						<!-- 奖励列表将动态生成 -->
 					</div>
 				</div>

 				<!-- 超级奖励列表 -->
 				<div class="mb-6">
 					<h4 class="text-lg font-bold text-neonPink mb-2">超级奖励</h4>
 					<div id="superRewardsList"
 						class="grid grid-cols-2 md:grid-cols-4 gap-3 max-h-40 overflow-y-auto p-2 bg-darkBg/50 rounded-lg">
 						<!-- 奖励列表将动态生成 -->
 					</div>
 				</div>

 				<!-- 最终奖励列表 -->
 				<div>
 					<h4 class="text-lg font-bold text-neonYellow mb-2">最终奖励</h4>
 					<div id="ultimateRewardsList"
 						class="grid grid-cols-2 md:grid-cols-4 gap-3 max-h-40 overflow-y-auto p-2 bg-darkBg/50 rounded-lg">
 						<!-- 奖励列表将动态生成 -->
 					</div>
 				</div>
 			</div>

 			<!-- 编辑奖励弹窗 -->
 			<div id="editRewardModal"
 				class="fixed inset-0 bg-darkBg/95 backdrop-blur-md z-50 flex items-center justify-center hidden transition-modal scale-out">
 				<div
 					class="bg-darkBg border-2 border-neonBlue rounded-2xl p-6 w-full max-w-md max-h-[80vh] overflow-y-auto animate-explode">
 					<h2 id="editRewardModalTitle"
 						class="text-2xl font-bold text-neonBlue text-shadow-neon mb-6 text-center">
 						<i class="fa fa-edit mr-2"></i>编辑奖励
 					</h2>
 					<!-- 隐藏的奖励ID和转盘类型 -->
 					<input type="hidden" id="editRewardId" value="">
 					<input type="hidden" id="editRewardWheelType" value="">
 					<!-- 奖励表单 -->
 					<form id="editRewardForm" class="space-y-6">
 						<div class="space-y-2">
 							<label class="block text-neonBlue mb-1 text-sm md:text-base">
 								奖励名称
 							</label>
 							<input type="text" id="editRewardName"
 								class="w-full bg-darkBg/80 border-2 border-neonBlue rounded-lg px-4 py-3 text-xl focus:outline-none focus:border-neonYellow text-white"
 								placeholder="输入奖励名称" required>
 						</div>

 						<div class="space-y-2">
 							<label class="block text-neonBlue mb-1 text-sm md:text-base">
 								图标类名
 							</label>
 							<input type="text" id="editRewardIcon"
 								class="w-full bg-darkBg/80 border-2 border-neonBlue rounded-lg px-4 py-3 text-xl focus:outline-none focus:border-neonYellow text-white"
 								placeholder="例如：fa-gift" required>
 						</div>

 						<div class="space-y-2">
 							<label class="block text-neonBlue mb-1 text-sm md:text-base">
 								颜色
 							</label>
 							<select id="editRewardColor"
 								class="w-full bg-darkBg/80 border-2 border-neonBlue rounded-lg px-4 py-3 text-xl focus:outline-none focus:border-neonYellow text-white"
 								required>
 								<option value="neonPink">霓虹粉</option>
 								<option value="neonBlue">霓虹蓝</option>
 								<option value="neonGreen">霓虹绿</option>
 								<option value="neonYellow">霓虹黄</option>
 							</select>
 						</div>

 						<div class="space-y-2">
 							<label class="block text-neonBlue mb-1 text-sm md:text-base">
 								概率（数字越大，概率越高）
 							</label>
 							<input type="number" id="editRewardProbability"
 								class="w-full bg-darkBg/80 border-2 border-neonBlue rounded-lg px-4 py-3 text-xl focus:outline-none focus:border-neonYellow text-white"
 								placeholder="输入概率值" min="1" value="1" required>
 						</div>

 						<!-- 按钮组 -->
 						<div class="flex gap-4 mt-6">
 							<button type="button" id="cancelEditRewardBtn"
 								class="flex-1 bg-gray-700 px-6 py-3 rounded-full text-xl font-bold transition-all duration-300 hover:scale-105">
 								<i class="fa fa-times mr-2"></i>取消
 							</button>
 							<button type="submit"
 								class="flex-1 bg-neonBlue text-white px-6 py-3 rounded-full text-xl font-bold transition-all duration-300 hover:scale-105 bg-glow-hover">
 								<i class="fa fa-check mr-2"></i>确认保存
 							</button>
 						</div>
 					</form>
 				</div>
 			</div>

 			<!-- 转盘区域 -->
 			<div class="flex-1 mb-8">
 				<div class="grid grid-cols-1 md:grid-cols-3 gap-8">
 					<!-- 普通奖励转盘 -->
 					<div class="bg-darkBg border-2 border-neonGreen rounded-2xl p-6 text-center">
 						<h3 class="text-xl font-bold text-neonGreen mb-4">
 							<i class="fa fa-diamond mr-2"></i>幸运转盘
 						</h3>
 						<p class="text-gray-400 text-sm mb-4">免费抽奖</p>
 						<div class="relative mb-6 wheel-container">
 							<!-- 转盘 -->
 							<div class="w-48 h-48 mx-auto relative">
 								<div id="normalWheel"
 									class="wheel w-full h-full rounded-full bg-gradient-to-br relative overflow-hidden">
 									<!-- 转盘扇形区域 - 使用conic-gradient创建完美扇形 -->
 									<div class="absolute inset-0" style="
                                    background: conic-gradient(
                                        from 0deg,
                                        #ff1744 0deg 45deg,
                                        #1a237e 45deg 90deg,
                                        #ff1744 90deg 135deg,
                                        #1a237e 135deg 180deg,
                                        #ffd700 180deg 225deg,
                                        #ff1744 225deg 270deg,
                                        #1a237e 270deg 315deg,
                                        #ffd700 315deg 360deg
                                    );
                                    border-radius: 50%;
                                ">
 										<!-- 扇形分隔线 -->
 										<div class="absolute inset-0" style="
                                        background: conic-gradient(
                                            from 0deg,
                                            transparent 0deg 45deg,
                                            rgba(255, 215, 0, 0.5) 45deg 45.5deg,
                                            transparent 45.5deg 90deg,
                                            rgba(255, 215, 0, 0.5) 90deg 90.5deg,
                                            transparent 90.5deg 135deg,
                                            rgba(255, 215, 0, 0.5) 135deg 135.5deg,
                                            transparent 135.5deg 180deg,
                                            rgba(255, 215, 0, 0.5) 180deg 180.5deg,
                                            transparent 180.5deg 225deg,
                                            rgba(255, 215, 0, 0.5) 225deg 225.5deg,
                                            transparent 225.5deg 270deg,
                                            rgba(255, 215, 0, 0.5) 270deg 270.5deg,
                                            transparent 270.5deg 315deg,
                                            rgba(255, 215, 0, 0.5) 315deg 315.5deg,
                                            transparent 315.5deg 360deg
                                        );
                                    "></div>
 										<!-- 扇形文字 - 使用绝对定位，文字保持水平 -->
 										<div id="normalWheelTexts" style="position: absolute; inset: 0;"></div>
 									</div>
 									<!-- 中心圆 -->
 									<div class="wheel-center w-12 h-12 flex items-center justify-center">
 										<i class="fa fa-star text-white text-xl"></i>
 									</div>
 									<!-- 指针 -->
 									<div class="wheel-pointer"></div>
 								</div>
 								<!-- 转盘按钮 -->
 								<button id="spinNormalWheelBtn" class="wheel-button">
 									点击抽奖
 								</button>
 								<div class="wheel-subtitle">点击转动获取奖励</div>
 							</div>
 						</div>
 						<!-- 奖励显示 -->
 						<div id="normalWheelReward" class="wheel-reward-display">
 							<p class="text-center">点击转动获取奖励</p>
 						</div>
 					</div>

 					<!-- 超级奖励转盘 -->
 					<div class="bg-darkBg border-2 border-neonPink rounded-2xl p-6 text-center">
 						<h3 class="text-xl font-bold text-neonPink mb-4">
 							<i class="fa fa-star mr-2"></i>超级转盘
 						</h3>
 						<p class="text-gray-400 text-sm mb-4">免费抽奖</p>
 						<div class="relative mb-6 wheel-container">
 							<!-- 转盘 -->
 							<div class="w-48 h-48 mx-auto relative">
 								<div id="superWheel"
 									class="wheel w-full h-full rounded-full bg-gradient-to-br relative overflow-hidden">
 									<!-- 转盘扇形区域 - 使用conic-gradient创建完美扇形 -->
 									<div class="absolute inset-0" style="
                                    background: conic-gradient(
                                        from 0deg,
                                        #ff1744 0deg 45deg,
                                        #1a237e 45deg 90deg,
                                        #ff1744 90deg 135deg,
                                        #1a237e 135deg 180deg,
                                        #ffd700 180deg 225deg,
                                        #ff1744 225deg 270deg,
                                        #1a237e 270deg 315deg,
                                        #ffd700 315deg 360deg
                                    );
                                    border-radius: 50%;
                                ">
 										<!-- 扇形分隔线 -->
 										<div class="absolute inset-0" style="
                                        background: conic-gradient(
                                            from 0deg,
                                            transparent 0deg 45deg,
                                            rgba(255, 215, 0, 0.5) 45deg 45.5deg,
                                            transparent 45.5deg 90deg,
                                            rgba(255, 215, 0, 0.5) 90deg 90.5deg,
                                            transparent 90.5deg 135deg,
                                            rgba(255, 215, 0, 0.5) 135deg 135.5deg,
                                            transparent 135.5deg 180deg,
                                            rgba(255, 215, 0, 0.5) 180deg 180.5deg,
                                            transparent 180.5deg 225deg,
                                            rgba(255, 215, 0, 0.5) 225deg 225.5deg,
                                            transparent 225.5deg 270deg,
                                            rgba(255, 215, 0, 0.5) 270deg 270.5deg,
                                            transparent 270.5deg 315deg,
                                            rgba(255, 215, 0, 0.5) 315deg 315.5deg,
                                            transparent 315.5deg 360deg
                                        );
                                    "></div>
 										<!-- 扇形文字 - 使用绝对定位，文字保持水平 -->
 										<div id="superWheelTexts" style="position: absolute; inset: 0;"></div>
 									</div>
 									<!-- 中心圆 -->
 									<div class="wheel-center w-12 h-12 flex items-center justify-center">
 										<i class="fa fa-crown text-white text-xl"></i>
 									</div>
 									<!-- 指针 -->
 									<div class="wheel-pointer"></div>
 								</div>
 								<!-- 转盘按钮 -->
 								<button id="spinSuperWheelBtn" class="wheel-button">
 									点击抽奖
 								</button>
 								<div class="wheel-subtitle">点击转动获取奖励</div>
 							</div>
 						</div>
 						<!-- 奖励显示 -->
 						<div id="superWheelReward" class="wheel-reward-display">
 							<p class="text-center">点击转动获取奖励</p>
 						</div>
 					</div>

 					<!-- 最终转盘 -->
 					<div class="bg-darkBg border-2 border-neonYellow rounded-2xl p-6 text-center">
 						<h3 class="text-xl font-bold text-neonYellow mb-4">
 							<i class="fa fa-trophy mr-2"></i>终极转盘
 						</h3>
 						<p class="text-gray-400 text-sm mb-4">免费抽奖</p>
 						<div class="relative mb-6 wheel-container">
 							<!-- 转盘 -->
 							<div class="w-48 h-48 mx-auto relative">
 								<div id="ultimateWheel"
 									class="wheel w-full h-full rounded-full bg-gradient-to-br relative overflow-hidden">
 									<!-- 转盘扇形区域 - 使用conic-gradient创建完美扇形 -->
 									<div class="absolute inset-0" style="
                                    background: conic-gradient(
                                        from 0deg,
                                        #ff1744 0deg 45deg,
                                        #1a237e 45deg 90deg,
                                        #ff1744 90deg 135deg,
                                        #1a237e 135deg 180deg,
                                        #ffd700 180deg 225deg,
                                        #ff1744 225deg 270deg,
                                        #1a237e 270deg 315deg,
                                        #ffd700 315deg 360deg
                                    );
                                    border-radius: 50%;
                                ">
 										<!-- 扇形分隔线 -->
 										<div class="absolute inset-0" style="
                                        background: conic-gradient(
                                            from 0deg,
                                            transparent 0deg 45deg,
                                            rgba(255, 215, 0, 0.5) 45deg 45.5deg,
                                            transparent 45.5deg 90deg,
                                            rgba(255, 215, 0, 0.5) 90deg 90.5deg,
                                            transparent 90.5deg 135deg,
                                            rgba(255, 215, 0, 0.5) 135deg 135.5deg,
                                            transparent 135.5deg 180deg,
                                            rgba(255, 215, 0, 0.5) 180deg 180.5deg,
                                            transparent 180.5deg 225deg,
                                            rgba(255, 215, 0, 0.5) 225deg 225.5deg,
                                            transparent 225.5deg 270deg,
                                            rgba(255, 215, 0, 0.5) 270deg 270.5deg,
                                            transparent 270.5deg 315deg,
                                            rgba(255, 215, 0, 0.5) 315deg 315.5deg,
                                            transparent 315.5deg 360deg
                                        );
                                    "></div>
 										<!-- 扇形文字 - 使用绝对定位，文字保持水平 -->
 										<div id="ultimateWheelTexts" style="position: absolute; inset: 0;"></div>
 									</div>
 									<!-- 中心圆 -->
 									<div class="wheel-center w-12 h-12 flex items-center justify-center">
 										<i class="fa fa-gem text-white text-xl"></i>
 									</div>
 									<!-- 指针 -->
 									<div class="wheel-pointer"></div>
 								</div>
 								<!-- 转盘按钮 -->
 								<button id="spinUltimateWheelBtn" class="wheel-button">
 									点击抽奖
 								</button>
 								<div class="wheel-subtitle">点击转动获取奖励</div>
 							</div>
 						</div>
 						<!-- 奖励显示 -->
 						<div id="ultimateWheelReward" class="wheel-reward-display">
 							<p class="text-center">点击转动获取奖励</p>
 						</div>
 					</div>
 				</div>
 			</div>

 			<!-- 奖励记录 -->
 			<div class="bg-darkBg border-2 border-neonBlue rounded-2xl p-6">
 				<h3 class="text-xl font-bold text-neonBlue mb-4">
 					<i class="fa fa-history mr-2"></i>奖励记录
 				</h3>
 				<!-- 抽奖统计信息 -->
 				<div id="rewardStatistics" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
 					<div class="bg-darkBg/50 border border-neonPink rounded-lg p-4">
 						<p class="text-gray-400 text-sm mb-1">总抽奖次数</p>
 						<p id="totalSpins" class="text-neonPink text-2xl font-bold">0</p>
 					</div>
 					<div class="bg-darkBg/50 border border-neonGreen rounded-lg p-4">
 						<p class="text-gray-400 text-sm mb-1">中奖次数</p>
 						<p id="winCount" class="text-neonGreen text-2xl font-bold">0</p>
 					</div>
 					<div class="bg-darkBg/50 border border-neonYellow rounded-lg p-4">
 						<p class="text-gray-400 text-sm mb-1">中奖率</p>
 						<p id="winRate" class="text-neonYellow text-2xl font-bold">0%</p>
 					</div>
 					<div class="bg-darkBg/50 border border-neonBlue rounded-lg p-4">
 						<p class="text-gray-400 text-sm mb-1">最近中奖</p>
 						<p id="recentWin" class="text-neonBlue text-2xl font-bold">无</p>
 					</div>
 				</div>
 				<div id="rewardHistory" class="space-y-2 max-h-60 overflow-y-auto">
 					<!-- 奖励记录将动态生成 -->
 					<div class="text-gray-400 text-center py-8">
 						<p>暂无奖励记录</p>
 					</div>
 				</div>
 			</div>
 		</div>

 		<!-- 引入Chart.js用于可视化 -->
 		<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>

 		<script>
 			// 全局状态管理
 			// ===== 新增成就系统 =====
 			// 定义成就列表
 			const achievements = [{
 				id: 'first_task',
 				name: '初次尝试',
 				desc: '完成第一个任务',
 				icon: 'fa-star',
 				unlocked: false
 			}, {
 				id: '7_days_streak',
 				name: '一周坚持',
 				desc: '连续打卡7天',
 				icon: 'fa-calendar-check-o',
 				unlocked: false
 			}, {
 				id: '10_smart_tasks',
 				name: 'SMART达人',
 				desc: '完成10个SMART任务',
 				icon: 'fa-trophy',
 				unlocked: false
 			}, {
 				id: '1000_points',
 				name: '奖励值达人',
 				desc: '累计获得1000奖励值',
 				icon: 'fa-fire',
 				unlocked: false
 			}, {
 				id: '5_hours',
 				name: '专注大师',
 				desc: '累计专注5小时',
 				icon: 'fa-clock-o',
 				unlocked: false
 			}];

 			// 检查成就解锁状态
 			function checkAchievements() {
 				// 检查"初次尝试"
 				if (appState.totalComplete >= 1) {
 					unlockAchievement('first_task');
 				}
 				// 检查"一周坚持"
 				if (appState.streakDays >= 7) {
 					unlockAchievement('7_days_streak');
 				}
 				// 检查"SMART达人"
 				if (appState.smartTaskCount >= 10) {
 					unlockAchievement('10_smart_tasks');
 				}
 				// 检查"奖励值达人"
 				if (appState.rewardPoints >= 1000) {
 					unlockAchievement('1000_points');
 				}
 				// 检查"专注大师"
 				if (appState.totalTime >= 300) { // 5小时 = 300分钟
 					unlockAchievement('5_hours');
 				}

 				// 渲染成就墙
 				renderAchievements();
 			}

 			// 解锁成就
 			function unlockAchievement(achievementId) {
 				const achievement = achievements.find(a => a.id === achievementId);
 				if (achievement && !achievement.unlocked) {
 					achievement.unlocked = true;
 					// 奖励积分
					appState.rewardPoints += 0;
					localStorage.setItem('dopamineRewardPoints', appState.rewardPoints); // 替换为原生方法
					// 显示解锁提示
					showToast(`🎉 解锁成就：${achievement.name}！谢谢你打开`, 'success');
 				}
 			}

 			// 渲染成就墙
 			function renderAchievements() {
 				const container = document.getElementById('achievementWall');
 				if (!container) return;

 				let html = '';
 				achievements.forEach(achievement => {
 					html += `
        <div class="w-20 h-24 flex flex-col items-center justify-center rounded-full p-2 ${
            achievement.unlocked ? 'bg-neonPink/20 border-2 border-neonPink' : 'bg-gray-700/20 border-2 border-gray-600'
        } transition-all duration-300 hover:scale-105">
            <i class="fa ${achievement.icon} text-2xl ${achievement.unlocked ? 'text-neonPink' : 'text-gray-500'} mb-2"></i>
            <p class="text-xs text-center ${achievement.unlocked ? 'text-white' : 'text-gray-500'}">${achievement.name}</p>
        </div>
        `;
 				});

 				container.innerHTML = html;
 			}
 			// ===== 成就系统结束 =====

 			// ===== 抽奖音效系统 =====

 			// 音频上下文
 			let audioContext = null;
 			let soundEnabled = true;

 			// 初始化音频上下文
 			function initAudioContext() {
 				if (!audioContext) {
 					audioContext = new(window.AudioContext || window.webkitAudioContext)();
 				}
 				return audioContext;
 			}

 			// 播放旋转音效（滴答声）
 			function playSpinSound() {
 				if (!soundEnabled) return;

 				try {
 					const ctx = initAudioContext();
 					const oscillator = ctx.createOscillator();
 					const gainNode = ctx.createGain();

 					oscillator.connect(gainNode);
 					gainNode.connect(ctx.destination);

 					oscillator.frequency.value = 800;
 					oscillator.type = 'sine';

 					gainNode.gain.setValueAtTime(0.1, ctx.currentTime);
 					gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.1);

 					oscillator.start(ctx.currentTime);
 					oscillator.stop(ctx.currentTime + 0.1);
 				} catch (e) {
 					console.log('播放音效失败:', e);
 				}
 			}

 			// 播放中奖音效
 			function playWinSound() {
 				if (!soundEnabled) return;

 				try {
 					const ctx = initAudioContext();

 					// 第一声
 					const osc1 = ctx.createOscillator();
 					const gain1 = ctx.createGain();
 					osc1.connect(gain1);
 					gain1.connect(ctx.destination);
 					osc1.frequency.value = 523.25; // C5
 					osc1.type = 'sine';
 					gain1.gain.setValueAtTime(0.2, ctx.currentTime);
 					gain1.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);
 					osc1.start(ctx.currentTime);
 					osc1.stop(ctx.currentTime + 0.3);

 					// 第二声
 					const osc2 = ctx.createOscillator();
 					const gain2 = ctx.createGain();
 					osc2.connect(gain2);
 					gain2.connect(ctx.destination);
 					osc2.frequency.value = 659.25; // E5
 					osc2.type = 'sine';
 					gain2.gain.setValueAtTime(0.2, ctx.currentTime + 0.15);
 					gain2.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.45);
 					osc2.start(ctx.currentTime + 0.15);
 					osc2.stop(ctx.currentTime + 0.45);

 					// 第三声
 					const osc3 = ctx.createOscillator();
 					const gain3 = ctx.createGain();
 					osc3.connect(gain3);
 					gain3.connect(ctx.destination);
 					osc3.frequency.value = 783.99; // G5
 					osc3.type = 'sine';
 					gain3.gain.setValueAtTime(0.2, ctx.currentTime + 0.3);
 					gain3.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.6);
 					osc3.start(ctx.currentTime + 0.3);
 					osc3.stop(ctx.currentTime + 0.6);
 				} catch (e) {
 					console.log('播放音效失败:', e);
 				}
 			}

 			// 播放失败音效
 			function playLoseSound() {
 				if (!soundEnabled) return;

 				try {
 					const ctx = initAudioContext();
 					const oscillator = ctx.createOscillator();
 					const gainNode = ctx.createGain();

 					oscillator.connect(gainNode);
 					gainNode.connect(ctx.destination);

 					oscillator.frequency.value = 200;
 					oscillator.type = 'sawtooth';

 					gainNode.gain.setValueAtTime(0.1, ctx.currentTime);
 					gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);

 					oscillator.start(ctx.currentTime);
 					oscillator.stop(ctx.currentTime + 0.3);
 				} catch (e) {
 					console.log('播放音效失败:', e);
 				}
 			}

 			// 播放开始音效
 			function playStartSound() {
 				if (!soundEnabled) return;

 				try {
 					const ctx = initAudioContext();
 					const oscillator = ctx.createOscillator();
 					const gainNode = ctx.createGain();

 					oscillator.connect(gainNode);
 					gainNode.connect(ctx.destination);

 					oscillator.frequency.value = 440;
 					oscillator.type = 'triangle';

 					gainNode.gain.setValueAtTime(0.15, ctx.currentTime);
 					gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.2);

 					oscillator.start(ctx.currentTime);
 					oscillator.stop(ctx.currentTime + 0.2);
 				} catch (e) {
 					console.log('播放音效失败:', e);
 				}
 			}

 			// 切换音效开关
 			function toggleSound() {
 				soundEnabled = !soundEnabled;
 				localStorage.setItem('dopamineSoundEnabled', soundEnabled);

 				// 更新按钮UI
 				const btn = document.getElementById('toggleSoundBtn');
 				if (btn) {
 					const icon = btn.querySelector('i');
 					if (soundEnabled) {
 						icon.className = 'fa fa-volume-up mr-2';
 						btn.classList.remove('bg-gray-700');
 						btn.classList.add('bg-neonBlue');
 					} else {
 						icon.className = 'fa fa-volume-off mr-2';
 						btn.classList.remove('bg-neonBlue');
 						btn.classList.add('bg-gray-700');
 					}
 				}

 				showToast(soundEnabled ? '音效已开启' : '音效已关闭');
 			}

 			// 从本地存储加载音效设置
 			function loadSoundSettings() {
 				const saved = localStorage.getItem('dopamineSoundEnabled');
 				if (saved !== null) {
 					soundEnabled = saved === 'true';
 				}

 				// 更新按钮UI
 				const btn = document.getElementById('toggleSoundBtn');
 				if (btn) {
 					const icon = btn.querySelector('i');
 					if (soundEnabled) {
 						icon.className = 'fa fa-volume-up mr-2';
 						btn.classList.remove('bg-gray-700');
 						btn.classList.add('bg-neonBlue');
 					} else {
 						icon.className = 'fa fa-volume-off mr-2';
 						btn.classList.remove('bg-neonBlue');
 						btn.classList.add('bg-gray-700');
 					}
 				}
 			}

 			// ===== 抽奖音效系统结束 =====


 			const appState = {
 				currentTask: null,
 				isSmartTask: false,
 				timerInterval: null,
 				reminderInterval: null,
 				elapsedTime: 0,
 				totalComplete: Number(localStorage.getItem('dopamineTotalComplete')) || 0,
 				streakDays: Number(localStorage.getItem('dopamineStreak')) || 0,
 				totalPoints: Number(localStorage.getItem('dopamineRewardPoints')) || 0,
 				rewardPoints: Number(localStorage.getItem('dopamineRewardPoints')) || 0,
 				smartTaskCount: Number(localStorage.getItem('dopamineSmartCount')) || 0,
 				lastCompleteDate: localStorage.getItem('dopamineLastDate') || '',
 				maxStreak: Number(localStorage.getItem('dopamineMaxStreak')) || 0,
 				totalTime: Number(localStorage.getItem('dopamineTotalTime')) || 0,
 				taskRecords: JSON.parse(localStorage.getItem('dopamineTaskRecords')) || [],
 				taskCards: [],
 				currentTaskCreateTime: null,
 				currentTaskStartTime: null,
 				periodicTasks: JSON.parse(localStorage.getItem('dopaminePeriodicTasks')) || [],
 				currentPeriodFilter: 'daily',
 				rewardHistory: JSON.parse(localStorage.getItem('dopamineRewardHistory')) || [],
 				normalWheelRewards: [{
 						id: 1,
 						name: '额外休息时间',
 						icon: 'fa-coffee',
 						color: 'neonGreen'
 					},
 					{
 						id: 2,
 						name: '健康零食',
 						icon: 'fa-apple',
 						color: 'neonYellow'
 					},
 					{
 						id: 3,
 						name: '娱乐时间',
 						icon: 'fa-gamepad',
 						color: 'neonBlue'
 					},
 					{
 						id: 4,
 						name: '购物券',
 						icon: 'fa-ticket',
 						color: 'neonPink'
 					}
 				],
 				superWheelRewards: [{
 						id: 1,
 						name: '电影票',
 						icon: 'fa-film',
 						color: 'neonGreen'
 					},
 					{
 						id: 2,
 						name: '美食券',
 						icon: 'fa-utensils',
 						color: 'neonYellow'
 					},
 					{
 						id: 3,
 						name: '游戏皮肤',
 						icon: 'fa-paint-brush',
 						color: 'neonBlue'
 					},
 					{
 						id: 4,
 						name: '购物券',
 						icon: 'fa-shopping-bag',
 						color: 'neonPink'
 					},
 					{
 						id: 5,
 						name: '特殊称号',
 						icon: 'fa-crown',
 						color: 'neonYellow'
 					},
 					{
 						id: 6,
 						name: '神秘大奖',
 						icon: 'fa-gift',
 						color: 'neonPink'
 					}
 				],
 				ultimateWheelRewards: [{
 						id: 1,
 						name: '豪华晚餐券',
 						icon: 'fa-utensils',
 						color: 'neonPink'
 					},
 					{
 						id: 2,
 						name: 'VIP特权卡',
 						icon: 'fa-crown',
 						color: 'neonYellow'
 					},
 					{
 						id: 3,
 						name: '游戏皮肤包',
 						icon: 'fa-paint-brush',
 						color: 'neonBlue'
 					},
 					{
 						id: 4,
 						name: '电影票x2',
 						icon: 'fa-film',
 						color: 'neonGreen'
 					},
 					{
 						id: 5,
 						name: '购物大礼包',
 						icon: 'fa-shopping-bag',
 						color: 'neonPink'
 					},
 					{
 						id: 6,
 						name: '特殊称号',
 						icon: 'fa-medal',
 						color: 'neonYellow'
 					},
 					{
 						id: 7,
 						name: '神秘大奖',
 						icon: 'fa-gift',
 						color: 'neonBlue'
 					},
 					{
 						id: 8,
 						name: '超级大奖',
 						icon: 'fa-trophy',
 						color: 'neonGreen'
 					}
 				]
 			};

 			function showToast(message, type = 'success') {
 				// 先移除已存在的toast，避免重复
 				const existingToast = document.querySelector('.fixed.top-4.right-4.z-50');
 				if (existingToast) existingToast.remove();

 				// 创建Toast元素
 				const toast = document.createElement('div');
 				toast.className = `fixed top-4 right-4 z-50 px-6 py-3 rounded-lg shadow-lg transition-all duration-300 transform translate-x-full ${
        type === 'success' ? 'bg-neonGreen text-darkBg' : 'bg-neonPink text-white'
    }`;
 				toast.textContent = message;

 				// 添加到页面
 				document.body.appendChild(toast);

 				// 显示动画
 				setTimeout(() => {
 					toast.classList.remove('translate-x-full');
 				}, 10);

 				// 自动消失
 				setTimeout(() => {
 					toast.classList.add('translate-x-full');
 					setTimeout(() => toast.remove(), 300);
 				}, 3000);
 			}

 			// 默认关卡配置
 			const defaultTasks = [{
 				name: "第一关：专注阅读5分钟",
 				desc: "无干扰读完1个章节片段",
 				time: 5,
 				difficulty: "medium",
 				points: 50,
 				isSmart: false
 			}, {
 				name: "第二关：10分钟拉伸运动",
 				desc: "完成5个基础拉伸动作，每个保持20秒",
 				time: 10,
 				difficulty: "medium",
 				points: 80,
 				isSmart: false
 			}];

 			// 初始化统计数据
			function initStats() {
				document.getElementById('totalComplete').textContent = appState.totalComplete;
				document.getElementById('streakDays').textContent = appState.streakDays;
				document.getElementById('recordSmartTotal').textContent = appState.smartTaskCount;

 				// 兼容性处理：为没有completedDates的周期任务添加该字段
 				appState.periodicTasks.forEach(task => {
 					if (!task.completedDates) {
 						task.completedDates = [];
 					}
 				});
 				savePeriodicTasks();

 				updateRecordStats();
 				updateRecordBadge();

 				// 设置默认日期为今天
 				const today = new Date().toISOString().split('T')[0];
 				document.getElementById('smartDate').value = today;
 				document.getElementById('startDateFilter').value = today;
 				document.getElementById('endDateFilter').value = today;
 			}

 			// 更新记录提示
 			function updateRecordBadge() {
 				const badge = document.getElementById('recordBadge');
 				const tip = document.getElementById('recordTip');

 				if (appState.taskRecords.length > 0) {
 					badge.classList.remove('hidden');
 					tip.classList.add('hidden');
 				} else {
 					badge.classList.add('hidden');
 					tip.classList.remove('hidden');
 				}

 				if (appState.taskRecords.length > 0) {
 					document.getElementById('emptyRecord').classList.add('hidden');
 				} else {
 					document.getElementById('emptyRecord').classList.remove('hidden');
 				}
 				renderTaskRecords((document.getElementById('filterSelect') || {}).value || 'all');
 				updateRelevantFilterOptions();
 				updateHistoryRelevantOptions();
 			}

 			// 创建粒子特效
 			function createParticles(x = window.innerWidth / 2, y = window.innerHeight / 2, color = '#FF2A6D') {
 				const container = document.getElementById('particleContainer');
 				const particleCount = 100;

 				for (let i = 0; i < particleCount; i++) {
 					const particle = document.createElement('div');
 					particle.classList.add('particle');

 					const size = Math.random() * 8 + 2;
 					const angle = Math.random() * Math.PI * 2;
 					const speed = Math.random() * 6 + 2;
 					const lifetime = Math.random() * 1500 + 1000;

 					particle.style.width = `${size}px`;
 					particle.style.height = `${size}px`;
 					particle.style.backgroundColor = color;
 					particle.style.left = `${x}px`;
 					particle.style.top = `${y}px`;

 					container.appendChild(particle);

 					let startTime = Date.now();

 					function updateParticle() {
 						const elapsed = Date.now() - startTime;
 						if (elapsed > lifetime) {
 							particle.remove();
 							return;
 						}

 						const progress = elapsed / lifetime;
 						const currentSpeed = speed * (1 - progress);
 						const opacity = 1 - progress;

 						const newX = x + Math.cos(angle) * currentSpeed * progress * 50;
 						const newY = y + Math.sin(angle) * currentSpeed * progress * 50;

 						particle.style.left = `${newX}px`;
 						particle.style.top = `${newY}px`;
 						particle.style.opacity = opacity;

 						requestAnimationFrame(updateParticle);
 					}

 					requestAnimationFrame(updateParticle);
 				}
 			}

 			// 创建烟花特效
 			function createFireworks() {
 				const container = document.getElementById('fireworkContainer');
 				const colors = ['#FF2A6D', '#05D9E8', '#F7F99C', '#4EEC7B'];

 				for (let i = 0; i < 8; i++) {
 					const x = Math.random() * window.innerWidth;
 					const y = Math.random() * window.innerHeight;
 					const color = colors[Math.floor(Math.random() * colors.length)];

 					const firework = document.createElement('div');
 					firework.classList.add('firework');
 					firework.style.backgroundColor = color;
 					firework.style.left = `${x}px`;
 					firework.style.top = `${y}px`;

 					container.appendChild(firework);

 					setTimeout(() => {
 						createParticles(x, y, color);
 						firework.remove();
 					}, Math.random() * 1000);
 				}
 			}

 			// 计算连续打卡天数
 			function calculateStreak() {
 				const today = new Date().toLocaleDateString();
 				const yesterday = new Date(Date.now() - 86400000).toLocaleDateString();

 				if (appState.lastCompleteDate === today) {
 					return appState.streakDays;
 				} else if (appState.lastCompleteDate === yesterday) {
 					appState.streakDays = parseInt(appState.streakDays) + 1;
 				} else if (appState.lastCompleteDate === '') {
 					appState.streakDays = 1;
 				} else {
 					appState.streakDays = 1;
 				}

 				if (parseInt(appState.streakDays) > parseInt(appState.maxStreak)) {
 					appState.maxStreak = appState.streakDays;
 					localStorage.setItem('dopamineMaxStreak', appState.maxStreak);
 				}

 				appState.lastCompleteDate = today;
 				localStorage.setItem('dopamineStreak', appState.streakDays);
 				localStorage.setItem('dopamineLastDate', today);

 				return appState.streakDays;
 			}

 			// 保存任务记录
 			function saveTaskRecord(task) {
 				const now = new Date();

 				let actualTime = 0;
 				if (task.startTimeStamp) {
 					const timeDiff = (now.getTime() - task.startTimeStamp) / 1000;
 					actualTime = Math.round((timeDiff / 60) * 10) / 10;
 				} else {
 					actualTime = task.time;
 				}

 				// 如果是SMART任务，从游戏界面获取子任务的最新完成状态
 				let updatedSubtasks = task.subtasks || [];
 				if (task.isSmart) {
 					const subtaskCheckboxes = document.querySelectorAll('.subtask-checkbox-game');
 					if (subtaskCheckboxes.length > 0) {
 						updatedSubtasks = task.subtasks.map((subtask, index) => {
 							const checkbox = document.querySelector(`.subtask-checkbox-game[data-index="${index}"]`);
 							return {
 								...subtask,
 								completed: checkbox ? checkbox.checked : subtask.completed
 							};
 						});
 					}
 				}

 				const record = {
 					id: Date.now(),
 					name: task.name,
 					desc: task.desc || `${task.specific || ''}`,
 					presetTime: task.time,
 					actualTime: actualTime,
 					difficulty: task.difficulty || 'medium',
 					points: task.points,
 					isSmart: task.isSmart || false,
 					smartAssociation: task.smartAssociation || '',
 					smartDetails: task.isSmart ? {
 						specific: task.specific,
 						subtasks: updatedSubtasks,
 						achievable: task.achievable,
 						relevant: task.relevant,
 						deadline: task.deadline
 					} : null,
 					reward: task.reward || '完成任务的成就感',
 					createTime: task.createTime || now.toLocaleString(),
 					startTime: task.startTime || '未记录',
 					completeTime: now.toLocaleString(),
 					completeDate: now.toLocaleDateString(),
 					completeTimeStamp: now.getTime(),
 					type: task.type || 'study',
 					feeling: task.feeling || '',
 					linkedSmartTaskId: task.linkedSmartTaskId || null
 				};

 				appState.taskRecords.push(record);
 				localStorage.setItem('dopamineTaskRecords', JSON.stringify(appState.taskRecords));

 				appState.totalTime = parseInt(appState.totalTime) + actualTime;
 				localStorage.setItem('dopamineTotalTime', appState.totalTime);

 				if (task.isSmart) {
 					appState.smartTaskCount = parseInt(appState.smartTaskCount) + 1;
 					localStorage.setItem('dopamineSmartCount', appState.smartTaskCount);
 				}
 				if (task.isSmart && task.smartDetails && task.smartDetails.deadline) {
 					console.log("任务有智能截止日期：", task.smartDetails.deadline);
 				}

 				updateRecordBadge();
 				updateRecordStats();
 				renderTaskRecords();
 			}

 			// 更新记录统计数据
 			function updateRecordStats(records = null) {
 				let recordsToUse = records;

 				if (!recordsToUse) {
 					recordsToUse = appState.taskRecords;
 				}

 				const totalTasks = recordsToUse.length;
 				const smartTasks = recordsToUse.filter(record => record.isSmart).length;
 				const totalTime = recordsToUse.reduce((sum, record) => sum + record.actualTime, 0);

 				document.getElementById('recordTotal').textContent = totalTasks;
 				document.getElementById('recordSmartTotal').textContent = smartTasks;
 				document.getElementById('recordMaxStreak').textContent = appState.maxStreak;

 				const totalHours = (totalTime / 60).toFixed(1);
 				document.getElementById('recordTotalHours').textContent = `${totalHours}小时`;
 			}

 			// 提取所有关联关键词
 			function getRelevantKeywords() {
 				const keywords = new Set();
 				appState.taskRecords.forEach(record => {
 					if (record.isSmart && record.smartDetails && record.smartDetails.relevant) {
 						const words = record.smartDetails.relevant.split(/[,，\s]+/).filter(word => word.trim());
 						words.forEach(word => keywords.add(word.trim()));
 					}
 				});
 				return Array.from(keywords).sort();
 			}

 			// 更新关联筛选下拉框
 			function updateRelevantFilterOptions() {
 				const select = document.getElementById('relevantFilterSelect');
 				if (!select) return;

 				const keywords = getRelevantKeywords();
 				select.innerHTML = '<option value="">全部关联</option>';

 				keywords.forEach(keyword => {
 					const option = document.createElement('option');
 					option.value = keyword;
 					option.textContent = keyword;
 					select.appendChild(option);
 				});
 			}

 			// 更新历史关联快捷选择框
 			function updateHistoryRelevantOptions() {
 				const select = document.getElementById('historyRelevantSelect');
 				if (!select) return;

 				const keywords = getRelevantKeywords();
 				select.innerHTML = '<option value="">选择历史关联（快捷填充）</option>';

 				keywords.forEach(keyword => {
 					const option = document.createElement('option');
 					option.value = keyword;
 					option.textContent = keyword;
 					select.appendChild(option);
 				});
 			}

 			// 更新普通任务历史关联快捷选择框
 			function updateCustomTaskHistoryRelevantOptions() {
 				const select = document.getElementById('customTaskHistoryRelevantSelect');
 				if (!select) return;

 				const keywords = getRelevantKeywords();
 				select.innerHTML = '<option value="">选择历史关联（快捷填充）</option>';

 				keywords.forEach(keyword => {
 					const option = document.createElement('option');
 					option.value = keyword;
 					option.textContent = keyword;
 					select.appendChild(option);
 				});
 			}

 			// 渲染任务记录列表
 			function renderTaskRecords(filter = 'all', relevantFilter = '', startDate = '', endDate = '') {
 				const recordList = document.getElementById('recordList');
 				const emptyRecord = document.getElementById('emptyRecord');

 				if (!recordList || !emptyRecord) return;

 				let filteredRecords = [...appState.taskRecords];

 				// 类型/时间筛选
 				if (filter === 'smart') {
 					filteredRecords = appState.taskRecords.filter(record => record.isSmart);
 				} else if (filter === 'today') {
 					const today = new Date().toLocaleDateString();
 					filteredRecords = appState.taskRecords.filter(record => record.completeDate === today);
 				} else if (filter === 'week') {
 					const weekAgo = new Date();
 					weekAgo.setDate(weekAgo.getDate() - 7);
 					filteredRecords = appState.taskRecords.filter(record => record.completeTimeStamp >= weekAgo.getTime());
 				} else if (filter === 'month') {
 					const monthAgo = new Date();
 					monthAgo.setMonth(monthAgo.getMonth() - 1);
 					filteredRecords = appState.taskRecords.filter(record => record.completeTimeStamp >= monthAgo.getTime());
 				}

 				// 日期范围筛选
 				if (startDate && endDate) {
 					const start = new Date(startDate).setHours(0, 0, 0, 0);
 					const end = new Date(endDate).setHours(23, 59, 59, 999);
 					filteredRecords = filteredRecords.filter(record => {
 						return record.completeTimeStamp >= start && record.completeTimeStamp <= end;
 					});
 				}

 				// 关联筛选
 				if (relevantFilter) {
 					const filterText = relevantFilter.trim().toLowerCase();
 					filteredRecords = filteredRecords.filter(record => {
 						if (!record.isSmart || !record.smartDetails || !record.smartDetails.relevant) return false;
 						return record.smartDetails.relevant.trim().toLowerCase().includes(filterText);
 					});
 				}

 				// 排序
 				const sortSelect = document.getElementById('sortSelect');
 				const sortValue = sortSelect ? sortSelect.value : 'dateDesc';

 				switch (sortValue) {
 					case 'dateDesc':
 						filteredRecords.sort((a, b) => b.completeTimeStamp - a.completeTimeStamp);
 						break;
 					case 'dateAsc':
 						filteredRecords.sort((a, b) => a.completeTimeStamp - b.completeTimeStamp);
 						break;
 					case 'timeDesc':
 						filteredRecords.sort((a, b) => b.actualTime - a.actualTime);
 						break;
 					case 'timeAsc':
 						filteredRecords.sort((a, b) => a.actualTime - b.actualTime);
 						break;
 					case 'pointsDesc':
 						filteredRecords.sort((a, b) => (b.points || 0) - (a.points || 0));
 						break;
 					case 'pointsAsc':
 						filteredRecords.sort((a, b) => (a.points || 0) - (b.points || 0));
 						break;
 				}

 				if (filteredRecords.length === 0) {
 					emptyRecord.classList.remove('hidden');
 					recordList.innerHTML = '';
 				} else {
 					emptyRecord.classList.add('hidden');
 				}

 				let html = '';
 				filteredRecords.forEach((record, index) => {
 					let difficultyColor = 'neonBlue';
 					if (record.difficulty === 'easy') difficultyColor = 'neonGreen';
 					if (record.difficulty === 'hard') difficultyColor = 'neonPink';

 					const smartTag = record.isSmart ?
 						`<span class="inline-block bg-neonPink text-white px-2 py-0.5 rounded-full text-xs font-bold ml-2">SMART</span>` :
 						'';

 					// 动态类型标签样式
 					let typeClass = 'type-tag';
 					// 兼容原有类型
 					if (record.type === 'study') typeClass = 'type-tag-study';
 					if (record.type === 'rest') typeClass = 'type-tag-rest';
 					if (record.type === 'work') typeClass = 'type-tag-work';
 					if (record.type === 'life') typeClass = 'type-tag-life';

 					html += `
             <div class="bg-darkBg/50 border-2 border-${difficultyColor} rounded-xl p-4 transition-all duration-300 hover:scale-105">

                    <div class="flex justify-between items-start mb-2">
                        <h4 class="text-white font-bold text-lg">${index + 1}. ${record.name} ${smartTag}</h4>
                        <span class="text-neonYellow text-sm">${record.completeDate}</span>
                    </div>
                    <p class="text-gray-300 text-sm mb-3">${record.desc}</p>
                    <div class="flex flex-wrap gap-3 mb-3">
<span class="type-tag" style="background-color: rgba(5, 217, 232, 0.2); color: #05D9E8;">${record.type || '学习'}</span>                        <span class="text-neonBlue text-sm">计划：${record.presetTime}分钟</span>
                        <span class="text-neonGreen text-sm">实际：${record.actualTime}分钟</span>
                        <span class="text-neonPink text-sm">积分+${record.points}</span>
                    </div>
                    ${record.feeling ? `<p class="text-gray-400 text-sm italic mb-2">感受：${record.feeling}</p>` : ''}
                    <button onclick="openFeelingEditModal(${record.id})" 
                        class="w-full bg-neonGreen/20 border-2 border-neonGreen text-neonGreen px-4 py-2 rounded-lg text-sm font-bold transition-all duration-300 hover:bg-neonGreen/30 hover:scale-105 mb-2">
                        <i class="fa fa-edit mr-2"></i>${record.feeling ? '修改感受' : '添加感受'}
                    </button>
                    ${record.isSmart ? `
                    <div class="bg-darkBg/80 rounded-lg p-3 mt-3 text-sm">
                        <p class="text-neonYellow mb-1">SMART详情：</p>
                        <p class="text-gray-300">具体：${record.smartDetails.specific}</p>
                        ${record.smartDetails.subtasks && record.smartDetails.subtasks.length > 0 ? `
                        <div class="mt-2">
                            <p class="text-neonBlue mb-1">子任务完成情况：</p>
                            <ul class="space-y-1 ml-4">
                                ${record.smartDetails.subtasks.map(subtask => `
                                    <li class="flex items-center gap-2 ${subtask.completed ? 'text-neonGreen' : 'text-gray-400'}">
                                        <i class="fa ${subtask.completed ? 'fa-check-circle' : 'fa-circle-o'}"></i>
                                        <span style="${subtask.completed ? 'text-decoration: line-through; opacity: 0.7;' : ''}">${subtask.text}</span>
                                    </li>
                                `).join('')}
                            </ul>
                        </div>
                        ` : ''}
                        <p class="text-gray-300">关联：${record.smartDetails.relevant}</p>
                    </div>
                    ` : ''}
                </div>
                `;
 				});

 				recordList.innerHTML = html;
 				renderTaskTimeline(filteredRecords);
 				renderCharts(filteredRecords);
 				updateRecordStats(filteredRecords); // 根据筛选结果更新统计数据
 			}

 			// 渲染任务时间轴
 			function renderTaskTimeline(records) {
 				const timelineContainer = document.getElementById('taskTimeline');
 				if (!timelineContainer) return;

 				if (records.length === 0) {
 					timelineContainer.innerHTML = `
                <div class="text-center py-10">
                    <p class="text-gray-400 text-lg">暂无符合条件的任务记录</p>
                </div>
                `;
 					return;
 				}

 				// 按日期分组
 				const groupedByDate = {};
 				records.forEach(record => {
 					if (!record.completeDate) return;
 					if (!groupedByDate[record.completeDate]) {
 						groupedByDate[record.completeDate] = [];
 					}
 					groupedByDate[record.completeDate].push(record);
 				});

 				let html = '';
 				Object.keys(groupedByDate).reverse().forEach(date => {
 					html += `<div class="mb-8">
                    <h4 class="text-neonYellow text-lg font-bold mb-4">${date}</h4>
                    <div class="space-y-6">`;

 					groupedByDate[date].forEach(record => {
 						const time = record.completeTime ? record.completeTime.split(' ')[1]?.substring(0, 5) ||
 							'' : '';
 						// 正确代码（替换原错误代码）
 						const typeColorMap = {
 							'学习': {
 								bg: 'rgba(5, 217, 232, 0.2)',
 								color: '#05D9E8'
 							},
 							'休息': {
 								bg: 'rgba(78, 236, 123, 0.2)',
 								color: '#4EEC7B'
 							},
 							'工作': {
 								bg: 'rgba(255, 42, 109, 0.2)',
 								color: '#FF2A6D'
 							},
 							'生活杂事': {
 								bg: 'rgba(247, 249, 156, 0.2)',
 								color: '#F7F99C'
 							}
 						};
 						// 自定义类型使用默认样式
 						const typeStyle = typeColorMap[record.type] || {
 							bg: 'rgba(5, 217, 232, 0.2)',
 							color: '#05D9E8'
 						};

 						// 注入到HTML字符串
 						html += `
<p class="text-neonGreen text-sm">
  <span class="type-tag-dynamic" style="background-color: ${typeStyle.bg}; color: ${typeStyle.color};">${record.type || '学习'}</span> 
  | 积分+${record.points}
</p>                        
`;

 						html += `
                    <div class="timeline-item">
                        <div class="timeline-dot"></div>
                        <div class="timeline-time">${time} (${record.actualTime}分钟)</div>
                        <h4 class="text-white font-bold text-lg">${record.name} ${record.isSmart ? '<span class="inline-block bg-neonPink/20 text-neonPink px-2 py-0.5 rounded-full text-xs ml-2">SMART</span>' : ''}</h4>
                        
<p class="text-neonGreen text-sm"><span class="type-tag" style="background-color: rgba(5, 217, 232, 0.2); color: #05D9E8;">${record.type || '学习'}</span> | 积分+${record.points}</p >                        
                        ${record.feeling ? `<p class="text-gray-400 text-sm mt-1">感受：${record.feeling}</p>` : ''}
                        ${record.isSmart ? `
                        <div class="mt-1">
                            <p class="text-neonPink text-xs">关联：${record.smartDetails.relevant || '-'}</p>
                            ${record.smartDetails.subtasks && record.smartDetails.subtasks.length > 0 ? `
                            <div class="mt-1 ml-2">
                                <p class="text-neonBlue text-xs mb-1">子任务：</p>
                                ${record.smartDetails.subtasks.map(subtask => `
                                    <p class="text-xs ${subtask.completed ? 'text-neonGreen' : 'text-gray-400'}">
                                        <i class="fa ${subtask.completed ? 'fa-check-circle' : 'fa-circle-o'}"></i>
                                        <span style="${subtask.completed ? 'text-decoration: line-through; opacity: 0.7;' : ''}">${subtask.text}</span>
                                    </p>
                                `).join('')}
                            </div>
                            ` : ''}
                        </div>
                        ` : ''}
                    </div>
                    `;
 					});

 					html += `</div></div>`;
 				});

 				timelineContainer.innerHTML = html;
 			}

 			// 渲染图表
 			function renderCharts(records) {
 				// 等待DOM完全渲染
 				setTimeout(() => {
 					// 任务类型饼图
 					let taskTypeCtx = document.getElementById('taskTypeChart');
 					if (!taskTypeCtx) {
 						// 如果canvas元素不存在，重新创建它
 						const taskTypeContainer = document.querySelector('.chart-container');
 						if (taskTypeContainer) {
 							taskTypeContainer.innerHTML = '<canvas id="taskTypeChart"></canvas>';
 							taskTypeCtx = document.getElementById('taskTypeChart');
 						}
 					}

 					if (taskTypeCtx && typeof Chart !== 'undefined') {
 						// 销毁已有图表
 						if (window.taskTypeChart && typeof window.taskTypeChart.destroy === 'function') {
 							window.taskTypeChart.destroy();
 						}

 						// 统计SMART关联时长
 						const typeStats = {};
 						records.forEach(record => {
 							let association = '未分类';

 							if (record.isSmart && record.smartDetails && record.smartDetails.relevant) {
 								association = record.smartDetails.relevant;
 							} else if (!record.isSmart && record.smartAssociation) {
 								association = record.smartAssociation;
 							}

 							if (!typeStats[association]) {
 								typeStats[association] = 0;
 							}
 							typeStats[association] += record.actualTime;
 						});

 						// 过滤掉时长为0的类型
 						Object.keys(typeStats).forEach(type => {
 							if (typeStats[type] === 0) {
 								delete typeStats[type];
 							}
 						});

 						// 准备动态的标签和数据
 						const typeLabels = Object.keys(typeStats);
 						const typeData = Object.values(typeStats);

 						// 如果没有数据，不渲染图表
 						if (typeLabels.length === 0) {
 							if (!document.getElementById('taskTypeChartNoData')) {
 								taskTypeCtx.parentElement.innerHTML = `
                        <div class="text-center text-gray-400 py-10" id="taskTypeChartNoData">
                            <p>暂无任务类型数据</p>
                        </div>
                    `;
 							}
 						} else {
 							// 如果之前显示了无数据提示，现在恢复canvas元素
 							if (!document.getElementById('taskTypeChart')) {
 								taskTypeCtx.parentElement.innerHTML = `
                        <canvas id="taskTypeChart"></canvas>
                    `;
 								// 重新获取canvas元素
 								taskTypeCtx = document.getElementById('taskTypeChart');
 								if (!taskTypeCtx) return;
 							}

 							// 生成动态颜色（循环使用预设颜色）
 							const baseColors = ['#05D9E8', '#4EEC7B', '#FF2A6D', '#F7F99C', '#9D4EDD', '#FF9E00',
 								'#FF6B6B', '#4ECDC4'
 							];
 							const typeColors = typeLabels.map((_, index) => baseColors[index % baseColors.length]);

 							window.taskTypeChart = new Chart(taskTypeCtx, {
 								type: 'doughnut',
 								data: {
 									labels: typeLabels,
 									datasets: [{
 										label: '时间分配（分钟）',
 										data: typeData,
 										backgroundColor: typeColors,
 										borderWidth: 0
 									}]
 								},
 								options: {
 									responsive: true,
 									maintainAspectRatio: false,
 									plugins: {
 										legend: {
 											position: 'right',
 											labels: {
 												color: 'white',
 												font: {
 													size: 14
 												}
 											}
 										},
 										tooltip: {
 											backgroundColor: 'rgba(18, 24, 38, 0.9)',
 											titleColor: '#F7F99C',
 											bodyColor: 'white',
 											borderColor: '#05D9E8',
 											borderWidth: 1,
 											padding: 10,
 											displayColors: true,
 											callbacks: {
 												title: function(context) {
 													const index = context[0].dataIndex;
 													return typeLabels[index] || '';
 												},
 												label: function(context) {
 													let label = context.dataset.label || '';
 													if (label) label += ': ';
 													label += context.raw + '分钟';
 													return label;
 												}
 											}
 										}
 									}
 								}
 							});
 						}
 					}

 					// 计划vs实际对比图
 					let planVsActualCtx = document.getElementById('planVsActualChart');
 					if (!planVsActualCtx) {
 						// 如果canvas元素不存在，重新创建它
 						const planVsActualContainer = document.querySelectorAll('.chart-container')[1];
 						if (planVsActualContainer) {
 							planVsActualContainer.innerHTML = '<canvas id="planVsActualChart"></canvas>';
 							planVsActualCtx = document.getElementById('planVsActualChart');
 						}
 					}

 					if (planVsActualCtx && typeof Chart !== 'undefined') {
 						// 销毁已有图表
 						if (window.planVsActualChart && typeof window.planVsActualChart.destroy === 'function') {
 							window.planVsActualChart.destroy();
 						}

 						// 只取最近20条记录，增加显示数量
 						const recentRecords = records.slice(-20);

 						// 如果没有数据，不渲染图表
 						if (recentRecords.length === 0) {
 							if (!document.getElementById('planVsActualChartNoData')) {
 								planVsActualCtx.parentElement.innerHTML = `
                        <div class="text-center text-gray-400 py-10" id="planVsActualChartNoData">
                            <p>暂无任务时长对比数据</p>
                        </div>
                    `;
 							}
 						} else {
 							// 如果之前显示了无数据提示，现在恢复canvas元素
 							if (!document.getElementById('planVsActualChart')) {
 								planVsActualCtx.parentElement.innerHTML = `
                        <canvas id="planVsActualChart"></canvas>
                    `;
 								// 重新获取canvas元素
 								planVsActualCtx = document.getElementById('planVsActualChart');
 								if (!planVsActualCtx) return;
 							}

 							const labels = recentRecords.map(r => r.name.length > 6 ? r.name.substring(0, 6) + '..' : r
 								.name);
 							const planTimes = recentRecords.map(r => r.presetTime);
 							const actualTimes = recentRecords.map(r => r.actualTime);

 							window.planVsActualChart = new Chart(planVsActualCtx, {
 								type: 'bar',
 								data: {
 									labels: labels,
 									datasets: [{
 										label: '计划时长（分钟）',
 										data: planTimes,
 										backgroundColor: '#FF2A6D',
 										borderWidth: 0
 									}, {
 										label: '实际时长（分钟）',
 										data: actualTimes,
 										backgroundColor: '#05D9E8',
 										borderWidth: 0
 									}]
 								},
 								options: {
 									responsive: true,
 									maintainAspectRatio: false,
 									scales: {
 										y: {
 											beginAtZero: true,
 											grid: {
 												color: 'rgba(255, 255, 255, 0.1)'
 											},
 											ticks: {
 												color: 'white',
 												font: {
 													size: 10
 												}
 											}
 										},
 										x: {
 											grid: {
 												display: false
 											},
 											ticks: {
 												color: 'white',
 												font: {
 													size: 10
 												},
 												maxRotation: 45,
 												minRotation: 0
 											}
 										}
 									},
 									plugins: {
 										legend: {
 											labels: {
 												color: 'white',
 												font: {
 													size: 12
 												}
 											}
 										},
 										tooltip: {
 											backgroundColor: 'rgba(18, 24, 38, 0.9)',
 											titleColor: '#F7F99C',
 											bodyColor: 'white',
 											borderColor: '#05D9E8',
 											borderWidth: 1,
 											padding: 10,
 											displayColors: true,
 											callbacks: {
 												title: function(context) {
 													const index = context[0].dataIndex;
 													return recentRecords[index]?.name || '';
 												},
 												label: function(context) {
 													let label = context.dataset.label || '';
 													if (label) label += ': ';
 													label += context.raw + '分钟';
 													return label;
 												}
 											}
 										}
 									}
 								}
 							});
 						}
 					}
 				}, 100);
 			}
 			// ===== 自定义任务类型管理 =====
 			// 从本地存储获取任务类型
 			function getTaskTypes() {
 				const savedTypes = JSON.parse(localStorage.getItem('dopamineTaskTypes')) || [
 					'学习', '休息', '工作', '生活杂事' // 默认类型
 				];
 				return savedTypes;
 			}

 			// 保存任务类型到本地存储
 			function saveTaskType(type) {
 				if (!type || type.trim() === '') return;

 				const types = getTaskTypes();
 				const trimmedType = type.trim();

 				// 避免重复
 				if (!types.includes(trimmedType)) {
 					types.push(trimmedType);
 					localStorage.setItem('dopamineTaskTypes', JSON.stringify(types));
 				}

 				return trimmedType;
 			}

 			// 删除任务类型
 			function deleteTaskType(type) {
 				let types = getTaskTypes();
 				types = types.filter(t => t !== type);
 				localStorage.setItem('dopamineTaskTypes', JSON.stringify(types));

 				// 更新所有UI
 				renderTaskTypeSuggestions();
 				renderSavedTaskTypeTags();
 			}

 			// 渲染任务类型建议列表
 			function renderTaskTypeSuggestions() {
 				const types = getTaskTypes();
 				const suggestionList = document.getElementById('taskTypeSuggestionList');
 				const editCardSuggestionList = document.getElementById('editCardTypeSuggestionList');

 				// 渲染切换任务弹窗的建议
 				if (suggestionList) {
 					let html = '';
 					types.forEach(type => {
 						html +=
 							`<div class="px-2 py-1 hover:bg-neonBlue/20 rounded cursor-pointer task-type-suggestion" data-type="${type}">${type}</div>`;
 					});
 					suggestionList.innerHTML = html;

 					// 绑定点击事件
 					document.querySelectorAll('.task-type-suggestion').forEach(item => {
 						item.addEventListener('click', function() {
 							const type = this.getAttribute('data-type');
 							document.getElementById('nextTaskType').value = type;
 							document.getElementById('taskTypeSuggestions').classList.add('hidden');
 						});
 					});
 				}

 				// 渲染编辑卡片弹窗的建议
 				if (editCardSuggestionList) {
 					let html = '';
 					types.forEach(type => {
 						html +=
 							`<div class="px-2 py-1 hover:bg-neonBlue/20 rounded cursor-pointer edit-card-type-suggestion" data-type="${type}">${type}</div>`;
 					});
 					editCardSuggestionList.innerHTML = html;

 					// 绑定点击事件
 					document.querySelectorAll('.edit-card-type-suggestion').forEach(item => {
 						item.addEventListener('click', function() {
 							const type = this.getAttribute('data-type');
 							document.getElementById('editCardType').value = type;
 							document.getElementById('editCardTypeSuggestions').classList.add('hidden');
 						});
 					});
 				}
 			}

 			// 渲染已保存的任务类型标签
 			function renderSavedTaskTypeTags() {
 				const types = getTaskTypes();
 				const savedTags = document.getElementById('savedTaskTypes');
 				const editCardSavedTags = document.getElementById('editCardSavedTypes');

 				// 渲染切换任务弹窗的标签
 				if (savedTags) {
 					let html = '';
 					types.forEach(type => {
 						html += `
            <span class="bg-neonBlue/20 text-neonBlue px-2 py-1 rounded-full text-sm flex items-center">
                ${type}
                <button class="ml-1 text-xs text-gray-400 hover:text-neonPink delete-task-type" data-type="${type}">×</button>
            </span>
            `;
 					});
 					savedTags.innerHTML = html;
 				}

 				// 渲染编辑卡片弹窗的标签
 				if (editCardSavedTags) {
 					let html = '';
 					types.forEach(type => {
 						html += `
            <span class="bg-neonBlue/20 text-neonBlue px-2 py-1 rounded-full text-sm flex items-center">
                ${type}
                <button class="ml-1 text-xs text-gray-400 hover:text-neonPink delete-edit-card-type" data-type="${type}">×</button>
            </span>
            `;
 					});
 					editCardSavedTags.innerHTML = html;
 				}

 				// 绑定删除事件
 				document.querySelectorAll('.delete-task-type').forEach(btn => {
 					btn.addEventListener('click', function() {
 						const type = this.getAttribute('data-type');
 						deleteTaskType(type);
 					});
 				});

 				document.querySelectorAll('.delete-edit-card-type').forEach(btn => {
 					btn.addEventListener('click', function() {
 						const type = this.getAttribute('data-type');
 						deleteTaskType(type);
 					});
 				});
 			}

 			// 初始化任务类型输入框事件
 			function initTaskTypeInputEvents() {
 				// 切换任务弹窗的输入框
 				const nextTaskTypeInput = document.getElementById('nextTaskType');
 				if (nextTaskTypeInput) {
 					// 聚焦时显示建议
 					nextTaskTypeInput.addEventListener('focus', function() {
 						document.getElementById('taskTypeSuggestions').classList.remove('hidden');
 						renderTaskTypeSuggestions();
 					});

 					// 失焦时隐藏建议
 					nextTaskTypeInput.addEventListener('blur', function() {
 						setTimeout(() => {
 							document.getElementById('taskTypeSuggestions').classList.add('hidden');
 						}, 200);
 					});

 					// 回车保存类型
 					nextTaskTypeInput.addEventListener('keydown', function(e) {
 						if (e.key === 'Enter') {
 							saveTaskType(this.value);
 							renderTaskTypeSuggestions();
 							renderSavedTaskTypeTags();
 							e.preventDefault();
 						}
 					});
 				}

 				// 编辑卡片弹窗的输入框
 				const editCardTypeInput = document.getElementById('editCardType');
 				if (editCardTypeInput) {
 					// 聚焦时显示建议
 					editCardTypeInput.addEventListener('focus', function() {
 						document.getElementById('editCardTypeSuggestions').classList.remove('hidden');
 						renderTaskTypeSuggestions();
 					});

 					// 失焦时隐藏建议
 					editCardTypeInput.addEventListener('blur', function() {
 						setTimeout(() => {
 							document.getElementById('editCardTypeSuggestions').classList.add('hidden');
 						}, 200);
 					});

 					// 回车保存类型
 					editCardTypeInput.addEventListener('keydown', function(e) {
 						if (e.key === 'Enter') {
 							saveTaskType(this.value);
 							renderTaskTypeSuggestions();
 							renderSavedTaskTypeTags();
 							e.preventDefault();
 						}
 					});
 				}
 			}
 			// 初始化任务卡片
 			function initTaskCards() {
 				// 从本地存储加载卡片
 				const savedCards = JSON.parse(localStorage.getItem('dopamineTaskCards')) || [];
 				appState.taskCards = savedCards;

 				renderTaskCards();
 				renderCardSelectOptions();
 			}

 			// 渲染任务卡片列表
 			function renderTaskCards() {
 				const cardList = document.getElementById('taskCardList');
 				const emptyTip = document.getElementById('emptyCardTip');

 				if (!cardList || !emptyTip) return;

 				if (appState.taskCards.length === 0) {
 					cardList.innerHTML = '';
 					emptyTip.classList.remove('hidden');
 					return;
 				}

 				emptyTip.classList.add('hidden');

 				let html = '';
 				appState.taskCards.forEach(card => {
 					let typeClass = 'type-tag';
 					if (card.type === 'study') typeClass = 'type-tag-study';
 					if (card.type === 'rest') typeClass = 'type-tag-rest';
 					if (card.type === 'work') typeClass = 'type-tag-work';
 					if (card.type === 'life') typeClass = 'type-tag-life';

 					let iconClass = 'fa-code';
 					if (card.type === 'rest') iconClass = 'fa-heart';
 					if (card.type === 'work') iconClass = 'fa-briefcase';
 					if (card.type === 'life') iconClass = 'fa-home';

 					let colorClass = 'neonBlue';
 					if (card.type === 'rest') colorClass = 'neonGreen';
 					if (card.type === 'work') colorClass = 'neonPink';
 					if (card.type === 'life') colorClass = 'neonYellow';

 					html += `
                <div class="card-setting-item" data-card-id="${card.id}">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 rounded-full bg-${colorClass}/20 flex items-center justify-center text-${colorClass} text-xl">
                            <i class="fa ${iconClass}"></i>
                        </div>
                        <div>
                            <h4 class="text-white font-bold text-lg">${card.name}</h4>
                            <div class="flex items-center gap-3 mt-1">
                                <span class="card-type-tag type-tag" style="background-color: rgba(5, 217, 232, 0.2); color: #05D9E8;">${card.type || '学习'}</span>
                                <span class="text-gray-400 text-sm">预计时长：${card.time}分钟</span>
                            </div>
                        </div>
                    </div>
                    <button class="card-delete-btn" data-card-id="${card.id}">
                        <i class="fa fa-trash text-xl"></i>
                    </button>
                </div>
                `;
 				});

 				cardList.innerHTML = html;

 				// 绑定删除事件
 				document.querySelectorAll('.card-delete-btn').forEach(btn => {
 					btn.addEventListener('click', function() {
 						const cardId = this.getAttribute('data-card-id');
 						deleteTaskCard(cardId);
 					});
 				});
 			}

 			// ===== 周期任务管理功能 =====

 			// 渲染周期任务列表
 			// 渲染具体日期信息
 			function renderSpecificDates(taskType, specificDates) {
 				if (!specificDates) return '';

 				let dateText = '';
 				const weekDays = ['周日', '周一', '周二', '周三', '周四', '周五', '周六'];

 				if (taskType === 'weekly' && Array.isArray(specificDates)) {
 					const sortedDates = specificDates.sort((a, b) => a - b);
 					const dateLabels = sortedDates.map(day => weekDays[day]).join('、');
 					dateText =
 						`<p class="text-neonGreen text-sm mt-1"><i class="fa fa-calendar-check-o mr-1"></i>执行日期：${dateLabels}</p>`;
 				} else if (taskType === 'specific' && typeof specificDates === 'object') {
 					const dateObj = new Date(specificDates.date);
 					const formattedDate = dateObj.toLocaleDateString('zh-CN', {
 						year: 'numeric',
 						month: 'long',
 						day: 'numeric'
 					});
 					let timeText = '';
 					if (specificDates.time) {
 						timeText = ` ${specificDates.time}`;
 					}
 					dateText =
 						`<p class="text-neonPink text-sm mt-1"><i class="fa fa-calendar mr-1"></i>执行日期：${formattedDate}${timeText}</p>`;
 				}

 				return dateText;
 			}

 			function renderPeriodicTasks() {
 				const taskList = document.getElementById('periodicTaskList');
 				const emptyTip = document.getElementById('emptyPeriodicTaskTip');

 				if (!taskList || !emptyTip) return;

 				// 根据当前筛选类型过滤任务
 				const filteredTasks = appState.currentPeriodFilter === 'all' ?
 					appState.periodicTasks :
 					appState.periodicTasks.filter(task => task.type === appState.currentPeriodFilter);

 				if (filteredTasks.length === 0) {
 					taskList.innerHTML = '';
 					emptyTip.classList.remove('hidden');
 					return;
 				}

 				emptyTip.classList.add('hidden');

 				const typeLabels = {
 					daily: '每日',
 					weekly: '每周',
 					specific: '具体日期'
 				};

 				const typeColors = {
 					daily: 'neonBlue',
 					weekly: 'neonGreen',
 					specific: 'neonPink'
 				};

 				const typeIcons = {
 					daily: 'fa-sun',
 					weekly: 'fa-calendar-week-o',
 					specific: 'fa-calendar'
 				};

 				let html = '';
 				filteredTasks.forEach(task => {
 					const colorClass = typeColors[task.type] || 'neonBlue';
 					const iconClass = typeIcons[task.type] || 'fa-calendar';
 					const typeLabel = typeLabels[task.type] || task.type;

 					html += `
                <div class="periodic-task-item" data-task-id="${task.id}">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 rounded-full bg-${colorClass}/20 flex items-center justify-center text-${colorClass} text-xl">
                            <i class="fa ${iconClass}"></i>
                        </div>
                        <div class="flex-1">
                            <h4 class="text-white font-bold text-lg">${task.name}</h4>
                            <div class="flex items-center gap-3 mt-1">
                                <span class="periodic-type-tag bg-${colorClass}/20 text-${colorClass} px-2 py-1 rounded text-sm">${typeLabel}</span>
                                <span class="text-gray-400 text-sm">预计时长：${task.duration}分钟</span>
                            </div>
                            ${task.specificDates ? renderSpecificDates(task.type, task.specificDates) : ''}
                            ${task.description ? `<p class="text-gray-500 text-sm mt-1">${task.description}</p>` : ''}
                        </div>
                        <div class="flex gap-2">
                            <button class="periodic-edit-btn" data-task-id="${task.id}">
                                <i class="fa fa-edit text-neonYellow text-xl"></i>
                            </button>
                            <button class="periodic-delete-btn" data-task-id="${task.id}">
                                <i class="fa fa-trash text-neonPink text-xl"></i>
                            </button>
                        </div>
                    </div>
                </div>
                `;
 				});

 				taskList.innerHTML = html;

 				// 绑定编辑事件
 				document.querySelectorAll('.periodic-edit-btn').forEach(btn => {
 					btn.addEventListener('click', function() {
 						const taskId = this.getAttribute('data-task-id');
 						editPeriodicTask(taskId);
 					});
 				});

 				// 绑定删除事件
 				document.querySelectorAll('.periodic-delete-btn').forEach(btn => {
 					btn.addEventListener('click', function() {
 						const taskId = this.getAttribute('data-task-id');
 						if (confirm('确定要删除这个周期任务吗？')) {
 							deletePeriodicTask(taskId);
 						}
 					});
 				});
 			}

 			// 保存周期任务到本地存储
 			function savePeriodicTasks() {
 				localStorage.setItem('dopaminePeriodicTasks', JSON.stringify(appState.periodicTasks));
 			}

 			// 添加周期任务
 			function addPeriodicTask(task) {
 				const newTask = {
 					id: 'periodic_' + Date.now(),
 					name: task.name,
 					type: task.type,
 					duration: task.duration,
 					difficulty: task.difficulty || 'medium',
 					relevant: task.relevant || '',
 					subtasks: task.subtasks || [],
 					reward: task.reward || '',
 					specificDates: task.specificDates || null,
 					completedDates: [],
 					createdAt: new Date().toISOString()
 				};
 				appState.periodicTasks.push(newTask);
 				savePeriodicTasks();
 				renderPeriodicTasks();
 				showToast('周期任务添加成功！');
 			}

 			// 编辑周期任务
 			function editPeriodicTask(taskId) {
 				const task = appState.periodicTasks.find(t => t.id === taskId);
 				if (!task) return;

 				document.getElementById('editPeriodicTaskId').value = task.id;
 				document.getElementById('editPeriodicTaskName').value = task.name;
 				document.getElementById('editPeriodicTaskType').value = task.type;
 				document.getElementById('editPeriodicTaskDuration').value = task.duration;
 				document.getElementById('editPeriodicTaskDifficulty').value = task.difficulty || 'medium';
 				document.getElementById('editPeriodicTaskRelevant').value = task.relevant || '';
 				document.getElementById('editPeriodicTaskReward').value = task.reward || '';

 				// 渲染子任务
 				renderPeriodicSubtasks(task.subtasks || []);

 				// 初始化日期选择器
 				initializeDateSelectors();

 				// 更新日期设置显示
 				updateDateSetting(task.type);

 				// 加载已保存的具体日期设置
 				if (task.specificDates) {
 					if (task.type === 'weekly' && Array.isArray(task.specificDates)) {
 						// 恢复每周日期选择
 						document.querySelectorAll('.weekly-date-checkbox').forEach(cb => {
 							cb.checked = task.specificDates.includes(parseInt(cb.value));
 						});
 					} else if (task.type === 'specific' && typeof task.specificDates === 'object') {
 						// 恢复具体日期选择
 						document.getElementById('specificDateInput').value = task.specificDates.date || '';
 						document.getElementById('specificTimeInput').value = task.specificDates.time || '';
 					}
 				}

 				document.getElementById('editPeriodicTaskModalTitle').innerHTML = '<i class="fa fa-edit mr-2"></i>编辑周期任务';
 				document.getElementById('confirmEditPeriodicTaskBtn').textContent = '确认修改';

 				const modal = document.getElementById('editPeriodicTaskModal');
 				modal.classList.remove('hidden', 'scale-out');
 				modal.classList.add('scale-in');
 			}

 			// 更新周期任务
 			function updatePeriodicTask(taskId, updatedTask) {
 				const index = appState.periodicTasks.findIndex(t => t.id === taskId);
 				if (index !== -1) {
 					appState.periodicTasks[index] = {
 						...appState.periodicTasks[index],
 						...updatedTask,
 						completedDates: appState.periodicTasks[index].completedDates || []
 					};
 					savePeriodicTasks();
 					renderPeriodicTasks();
 					showToast('周期任务更新成功！');
 				}
 			}

 			// 删除周期任务
 			function deletePeriodicTask(taskId) {
 				appState.periodicTasks = appState.periodicTasks.filter(t => t.id !== taskId);
 				savePeriodicTasks();
 				renderPeriodicTasks();
 				showToast('周期任务删除成功！');
 			}

 			// 显示周期任务选择弹窗（用于SMART任务快速填充）
 			function showPeriodicTaskSelectModal() {
 				document.getElementById('periodicTaskSelectModal').classList.remove('hidden');
 				renderPeriodicTaskSelectList('all');
 			}

 			// 渲染周期任务选择列表
 			function renderPeriodicTaskSelectList(filterType) {
 				const container = document.getElementById('periodicTaskSelectList');
 				const emptyTip = document.getElementById('emptyPeriodicSelectTip');

 				if (!container || !emptyTip) return;

 				const filteredTasks = filterType === 'all' ?
 					appState.periodicTasks :
 					appState.periodicTasks.filter(task => task.type === filterType);

 				if (filteredTasks.length === 0) {
 					container.innerHTML = '';
 					emptyTip.classList.remove('hidden');
 					return;
 				}

 				emptyTip.classList.add('hidden');

 				const typeLabels = {
 					daily: '每日',
 					weekly: '每周',
 					monthly: '每月',
 					yearly: '每年'
 				};

 				let html = '';
 				filteredTasks.forEach(task => {
 					const typeLabel = typeLabels[task.type] || task.type;

 					html += `
                <div class="periodic-task-select-item bg-darkBg/50 border border-neonBlue rounded-lg p-3 cursor-pointer hover:bg-neonBlue/10 transition-colors" data-task-id="${task.id}">
                    <div class="flex items-center gap-3">
                        <div class="flex-1">
                            <h4 class="text-white font-bold">${task.name}</h4>
                            <div class="flex items-center gap-2 mt-1">
                                <span class="text-neonBlue text-sm">${typeLabel}</span>
                                <span class="text-gray-400 text-sm">${task.duration}分钟</span>
                            </div>
                        </div>
                        <i class="fa fa-chevron-right text-neonBlue"></i>
                    </div>
                </div>
                `;
 				});

 				container.innerHTML = html;

 				// 绑定点击事件
 				document.querySelectorAll('.periodic-task-select-item').forEach(item => {
 					item.addEventListener('click', function() {
 						const taskId = this.getAttribute('data-task-id');
 						fillSmartTaskFromPeriodic(taskId);
 					});
 				});
 			}

 			// 从周期任务填充到SMART任务
 			function fillSmartTaskFromPeriodic(taskId) {
 				const task = appState.periodicTasks.find(t => t.id === taskId);
 				if (!task) return;

 				// 填充到SMART任务表单
 				document.getElementById('smartSpecific').value = task.name;
 				document.getElementById('smartTime').value = task.duration;
 				document.getElementById('smartAchievable').value = task.difficulty || 'medium';
 				document.getElementById('smartRelevant').value = task.relevant || '';
 				document.getElementById('smartReward').value = task.reward || '';

 				// 渲染子任务
 				renderSubtasks(task.subtasks || []);

 				// 关闭选择弹窗
 				document.getElementById('periodicTaskSelectModal').classList.add('hidden');

 				showToast('已从周期任务快速填充！');
 			}

 			// 渲染周期任务子任务
 			function renderPeriodicSubtasks(subtasks) {
 				const container = document.getElementById('periodicSubtaskContainer');
 				if (!container) return;

 				container.innerHTML = '';

 				subtasks.forEach((subtask, index) => {
 					const subtaskDiv = document.createElement('div');
 					subtaskDiv.className =
 						'periodic-subtask-item flex items-center gap-2 bg-darkBg/60 border border-neonBlue/30 rounded-lg p-2';

 					const checkbox = document.createElement('input');
 					checkbox.type = 'checkbox';
 					checkbox.className =
 						'periodic-subtask-checkbox w-5 h-5 bg-darkBg border-2 border-neonBlue rounded focus:ring-neonYellow cursor-pointer';
 					checkbox.checked = subtask.completed || false;

 					const textSpan = document.createElement('span');
 					textSpan.className = 'periodic-subtask-text flex-1 text-white text-sm';
 					textSpan.textContent = subtask.text || `子任务 ${index + 1}`;

 					const deleteBtn = document.createElement('button');
 					deleteBtn.type = 'button';
 					deleteBtn.className =
 						'periodic-subtask-delete-btn text-neonPink hover:text-neonPink/80 transition-colors';
 					deleteBtn.innerHTML = '<i class="fa fa-trash"></i>';

 					subtaskDiv.appendChild(checkbox);
 					subtaskDiv.appendChild(textSpan);
 					subtaskDiv.appendChild(deleteBtn);

 					container.appendChild(subtaskDiv);

 					// 添加删除事件
 					deleteBtn.addEventListener('click', () => {
 						subtasks.splice(index, 1);
 						renderPeriodicSubtasks(subtasks);
 					});
 				});
 			}

 			// ===== 奖励模块功能 =====

 			// 更新奖励值显示
 			function updateRewardPointsDisplay() {
				const pointsElement = document.getElementById('currentRewardPoints');
				if (pointsElement) {
					pointsElement.textContent = appState.rewardPoints.toFixed(1);
				}

				// 同时更新荣誉系统的显示
				if (window.honorSystem) {
					window.honorSystem.updateDisplay();
				}
			}

 			// 保存奖励值到本地存储
 			function saveRewardPoints() {
 				localStorage.setItem('dopamineRewardPoints', appState.rewardPoints);
 			}

 			// 保存奖励历史到本地存储
 			function saveRewardHistory() {
 				localStorage.setItem('dopamineRewardHistory', JSON.stringify(appState.rewardHistory));
 			}

 			// 渲染奖励历史记录
 			function renderRewardHistory() {
 				const container = document.getElementById('rewardHistory');
 				if (!container) return;

 				if (appState.rewardHistory.length === 0) {
 					container.innerHTML = `
            <div class="text-gray-400 text-center py-8">
                <p>暂无奖励记录</p>
            </div>
            `;
 					return;
 				}

 				let html = '';
 				appState.rewardHistory.forEach((reward, index) => {
 					const date = new Date(reward.timestamp).toLocaleString();
 					let rewardItem;
 					let wheelTypeName;

 					if (reward.wheelType === 'normal') {
 						rewardItem = appState.normalWheelRewards.find(r => r.id === reward.rewardId);
 						wheelTypeName = '普通转盘';
 					} else if (reward.wheelType === 'super') {
 						rewardItem = appState.superWheelRewards.find(r => r.id === reward.rewardId);
 						wheelTypeName = '超级转盘';
 					} else if (reward.wheelType === 'ultimate') {
 						rewardItem = appState.ultimateWheelRewards.find(r => r.id === reward.rewardId);
 						wheelTypeName = '最终转盘';
 					}

 					if (rewardItem) {
 						html += `
                <div class="flex items-center justify-between bg-darkBg/50 border border-${rewardItem.color}/30 rounded-lg p-3">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-full bg-${rewardItem.color}/20 flex items-center justify-center">
                            <i class="fa ${rewardItem.icon} text-${rewardItem.color}"></i>
                        </div>
                        <div>
                            <p class="text-white font-medium">${rewardItem.name}</p>
                            <p class="text-gray-400 text-sm">${date}</p>
                        </div>
                    </div>
                    <div class="text-${rewardItem.color} font-bold">
                        ${wheelTypeName}
                    </div>
                </div>
                `;
 					}
 				});

 				container.innerHTML = html;
 			}

 			// 更新抽奖统计
 			function updateRewardStatistics() {
 				const totalSpins = appState.rewardHistory.length;
 				const winCount = appState.rewardHistory.filter(h => {
 					const rewardItem = getRewardItem(h);
 					return rewardItem && !rewardItem.name.includes('谢谢参与');
 				}).length;
 				const winRate = totalSpins > 0 ? ((winCount / totalSpins) * 100).toFixed(1) : 0;

 				// 更新统计显示
 				document.getElementById('totalSpins').textContent = totalSpins;
 				document.getElementById('winCount').textContent = winCount;
 				document.getElementById('winRate').textContent = winRate + '%';

 				// 更新最近中奖
 				const recentWinElement = document.getElementById('recentWin');
 				const recentWins = appState.rewardHistory.filter(h => {
 					const rewardItem = getRewardItem(h);
 					return rewardItem && !rewardItem.name.includes('谢谢参与');
 				}).slice(0, 3);

 				if (recentWins.length > 0) {
 					const lastWin = recentWins[0];
 					const rewardItem = getRewardItem(lastWin);
 					recentWinElement.textContent = rewardItem ? rewardItem.name : '无';
 				} else {
 					recentWinElement.textContent = '无';
 				}
 			}

 			// 获取奖励项
 			function getRewardItem(historyItem) {
 				if (historyItem.wheelType === 'normal') {
 					return appState.normalWheelRewards.find(r => r.id === historyItem.rewardId);
 				} else if (historyItem.wheelType === 'super') {
 					return appState.superWheelRewards.find(r => r.id === historyItem.rewardId);
 				} else if (historyItem.wheelType === 'ultimate') {
 					return appState.ultimateWheelRewards.find(r => r.id === historyItem.rewardId);
 				}
 				return null;
 			}

 			// 根据概率选择奖励
 			function selectRewardByProbability(rewards) {
 				// 计算总概率
 				const totalProbability = rewards.reduce((sum, reward) => sum + (reward.probability || 1), 0);
 				let random = Math.random() * totalProbability;

 				// 根据概率选择奖励
 				for (let i = 0; i < rewards.length; i++) {
 					const reward = rewards[i];
 					random -= (reward.probability || 1);
 					if (random <= 0) {
 						return {
 							reward,
 							index: i
 						};
 					}
 				}

 				// 默认返回第一个奖励
 				return {
 					reward: rewards[0],
 					index: 0
 				};
 			}

 			// 转动普通转盘
 			// 转动普通奖励转盘
 			function spinNormalWheel() {
 				if (appState.rewardPoints < 30) {
 					showToast('积分不足！需要至少30积分', 'error');
 					return;
 				}

 				// 扣除积分
 				appState.rewardPoints -= 30;
 				saveRewardPoints();
 				updateRewardPointsDisplay();

 				// 根据概率选择奖励
 				const {
 					reward,
 					index
 				} = selectRewardByProbability(appState.normalWheelRewards);

 				// 添加到奖励历史
 				appState.rewardHistory.unshift({
 					rewardId: reward.id,
 					wheelType: 'normal',
 					timestamp: new Date().toISOString()
 				});
 				saveRewardHistory();
 				updateRewardStatistics();

 				// 显示奖励
 				showRewardResult(reward, 'normal');

 				// 播放开始音效
 				playStartSound();

 				// 添加转盘动画
 				const angle = index * (360 / appState.normalWheelRewards.length);
 				animateWheel('normalWheel', angle, reward);
 			}

 			// 转动超级奖励转盘
 			function spinSuperWheel() {
 				if (appState.rewardPoints < 60) {
 					showToast('积分不足！需要至少60积分', 'error');
 					return;
 				}

 				// 扣除积分
 				appState.rewardPoints -= 60;
 				saveRewardPoints();
 				updateRewardPointsDisplay();

 				// 根据概率选择奖励
 				const {
 					reward,
 					index
 				} = selectRewardByProbability(appState.superWheelRewards);

 				// 添加到奖励历史
 				appState.rewardHistory.unshift({
 					rewardId: reward.id,
 					wheelType: 'super',
 					timestamp: new Date().toISOString()
 				});
 				saveRewardHistory();
 				updateRewardStatistics();

 				// 显示奖励
 				showRewardResult(reward, 'super');

 				// 播放开始音效
 				playStartSound();

 				// 添加转盘动画
 				const angle = index * (360 / appState.superWheelRewards.length);
 				animateWheel('superWheel', angle, reward);
 			}

 			// 转动最终转盘
 			function spinUltimateWheel() {
 				if (appState.rewardPoints < 300) {
 					showToast('积分不足！需要至少300积分', 'error');
 					return;
 				}

 				// 扣除积分
 				appState.rewardPoints -= 300;
 				saveRewardPoints();
 				updateRewardPointsDisplay();

 				// 根据概率选择奖励
 				const {
 					reward,
 					index
 				} = selectRewardByProbability(appState.ultimateWheelRewards);

 				// 添加到奖励历史
 				appState.rewardHistory.unshift({
 					rewardId: reward.id,
 					wheelType: 'ultimate',
 					timestamp: new Date().toISOString()
 				});
 				saveRewardHistory();
 				updateRewardStatistics();

 				// 显示奖励
 				showRewardResult(reward, 'ultimate');

 				// 播放开始音效
 				playStartSound();

 				// 添加转盘动画
 				const angle = index * (360 / appState.ultimateWheelRewards.length);
 				animateWheel('ultimateWheel', angle, reward);
 			}

 			// 显示奖励结果
 			function showRewardResult(reward, wheelType) {
 				let rewardElementId;
 				if (wheelType === 'normal') {
 					rewardElementId = 'normalWheelReward';
 				} else if (wheelType === 'super') {
 					rewardElementId = 'superWheelReward';
 				} else if (wheelType === 'ultimate') {
 					rewardElementId = 'ultimateWheelReward';
 				}

 				const rewardElement = document.getElementById(rewardElementId);

 				if (rewardElement) {
 					rewardElement.innerHTML = `
            <div class="flex flex-col items-center justify-center p-4 animate-fade-in">
                <div class="w-16 h-16 rounded-full bg-${reward.color}/20 flex items-center justify-center mb-4">
                    <i class="fa ${reward.icon} text-4xl text-${reward.color}"></i>
                </div>
                <h4 class="text-2xl font-bold text-${reward.color} mb-2">恭喜获得：${reward.name}！</h4>
                <p class="text-gray-400 text-sm">已添加到你的背包</p>
            </div>
            `;

 					// 添加奖励到背包
 					if (window.backpackModule) {
 						window.backpackModule.addReward(reward);
 					}

 					// 3秒后隐藏奖励显示
 					setTimeout(() => {
 						rewardElement.innerHTML = `
                <p class="text-gray-400 text-center">点击转动获取奖励</p>
                `;
 					}, 3000);
 				}
 			}

 			// 转盘动画
 			function animateWheel(wheelId, targetRotation, reward) {
 				const wheel = document.getElementById(wheelId);

 				if (!wheel) return;

 				// 禁用按钮防止重复点击
 				const spinBtn = document.getElementById(wheelId === 'normalWheel' ? 'spinNormalWheelBtn' :
 					wheelId === 'superWheel' ? 'spinSuperWheelBtn' : 'spinUltimateWheelBtn');
 				if (spinBtn) {
 					spinBtn.disabled = true;
 					spinBtn.classList.add('opacity-50', 'cursor-not-allowed');
 				}

 				// 计算旋转角度
 				const currentRotation = parseInt(wheel.style.transform.replace(/[^0-9-]/g, '')) || 0;
 				const rotationDifference = targetRotation - currentRotation;
 				const finalRotation = currentRotation + rotationDifference + 360 * 8; // 多转8圈增加效果

 				// 创建粒子特效
 				createWheelParticles(wheelId);

 				// 添加闪光效果
 				const flashOverlay = document.createElement('div');
 				flashOverlay.className = 'absolute inset-0 bg-white/30 rounded-full pointer-events-none';
 				flashOverlay.style.opacity = '0';
 				flashOverlay.style.transition = 'opacity 0.1s';
 				wheel.appendChild(flashOverlay);

 				// 阶段1：加速旋转（0-1秒）
 				wheel.style.transition = 'transform 1s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
 				wheel.style.transform = `rotate(${currentRotation + 360 * 2}deg)`;

 				// 阶段2：高速旋转（1-2秒）
 				setTimeout(() => {
 					wheel.style.transition = 'transform 1s linear';
 					wheel.style.transform = `rotate(${currentRotation + 360 * 5}deg)`;

 					// 闪光效果
 					flashOverlay.style.opacity = '0.5';
 					setTimeout(() => {
 						flashOverlay.style.opacity = '0';
 					}, 100);
 				}, 1000);

 				// 阶段3：减速旋转（2-3秒）
 				setTimeout(() => {
 					wheel.style.transition = 'transform 1s cubic-bezier(0.55, 0.085, 0.68, 0.53)';
 					wheel.style.transform = `rotate(${currentRotation + 360 * 7}deg)`;
 				}, 2000);

 				// 阶段4：最终停止（3-4秒）
 				setTimeout(() => {
 					wheel.style.transition = 'transform 1s cubic-bezier(0.17, 0.67, 0.12, 0.99)';
 					wheel.style.transform = `rotate(${finalRotation}deg)`;
 				}, 3000);

 				// 动画结束
 				setTimeout(() => {
 					// 移除闪光效果
 					flashOverlay.remove();

 					// 添加弹跳效果
 					wheel.style.transition = 'transform 0.2s cubic-bezier(0.68, -0.55, 0.265, 1.55)';
 					wheel.style.transform = `rotate(${finalRotation + 5}deg)`;

 					setTimeout(() => {
 						wheel.style.transform = `rotate(${finalRotation - 3}deg)`;
 					}, 200);

 					setTimeout(() => {
 						wheel.style.transform = `rotate(${finalRotation}deg)`;
 					}, 400);

 					// 恢复按钮
 					if (spinBtn) {
 						spinBtn.disabled = false;
 						spinBtn.classList.remove('opacity-50', 'cursor-not-allowed');
 					}

 					// 清除粒子
 					removeWheelParticles(wheelId);

 					// 播放结束音效
 					if (reward && !reward.name.includes('谢谢参与')) {
 						playWinSound();
 					} else {
 						playLoseSound();
 					}
 				}, 4000);
 			}

 			// 创建转盘粒子特效
 			let wheelParticles = {};

 			function createWheelParticles(wheelId) {
 				const wheel = document.getElementById(wheelId);
 				if (!wheel) return;

 				const particleContainer = document.createElement('div');
 				particleContainer.id = `${wheelId}Particles`;
 				particleContainer.className = 'absolute inset-0 pointer-events-none overflow-hidden';
 				wheel.appendChild(particleContainer);

 				wheelParticles[wheelId] = [];

 				for (let i = 0; i < 20; i++) {
 					const particle = document.createElement('div');
 					particle.className = 'absolute rounded-full';
 					particle.style.width = Math.random() * 10 + 5 + 'px';
 					particle.style.height = particle.style.width;
 					particle.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 70%)`;
 					particle.style.left = '50%';
 					particle.style.top = '50%';
 					particle.style.transform = 'translate(-50%, -50%)';
 					particle.style.opacity = '1';
 					particle.style.transition = 'all 1s ease-out';

 					particleContainer.appendChild(particle);
 					wheelParticles[wheelId].push(particle);

 					// 粒子动画
 					setTimeout(() => {
 						const angle = Math.random() * 360;
 						const distance = Math.random() * 100 + 50;
 						particle.style.left = `calc(50% + ${Math.cos(angle * Math.PI / 180) * distance}px)`;
 						particle.style.top = `calc(50% + ${Math.sin(angle * Math.PI / 180) * distance}px)`;
 						particle.style.opacity = '0';
 						particle.style.transform = 'translate(-50%, -50%) scale(0)';
 					}, Math.random() * 500);
 				}
 			}

 			function removeWheelParticles(wheelId) {
 				const particleContainer = document.getElementById(`${wheelId}Particles`);
 				if (particleContainer) {
 					particleContainer.remove();
 				}
 				delete wheelParticles[wheelId];
 			}

 			// ===== 奖励管理功能 =====

 			// 保存奖励配置到本地存储
 			function saveWheelRewards() {
 				localStorage.setItem('dopamineNormalWheelRewards', JSON.stringify(appState.normalWheelRewards));
 				localStorage.setItem('dopamineSuperWheelRewards', JSON.stringify(appState.superWheelRewards));
 				localStorage.setItem('dopamineUltimateWheelRewards', JSON.stringify(appState.ultimateWheelRewards));
 			}

 			// 从本地存储加载奖励配置
 			function loadWheelRewards() {
 				const normalRewards = localStorage.getItem('dopamineNormalWheelRewards');
 				const superRewards = localStorage.getItem('dopamineSuperWheelRewards');
 				const ultimateRewards = localStorage.getItem('dopamineUltimateWheelRewards');

 				if (normalRewards) {
 					appState.normalWheelRewards = JSON.parse(normalRewards);
 				}

 				if (superRewards) {
 					appState.superWheelRewards = JSON.parse(superRewards);
 				}

 				if (ultimateRewards) {
 					appState.ultimateWheelRewards = JSON.parse(ultimateRewards);
 				}
 			}

 			// 渲染普通奖励列表
 			function renderNormalRewardsList() {
 				const container = document.getElementById('normalRewardsList');
 				if (!container) return;

 				if (appState.normalWheelRewards.length === 0) {
 					container.innerHTML = '<p class="col-span-full text-gray-400 text-center py-4">暂无普通奖励，点击添加按钮添加</p>';
 					return;
 				}

 				let html = '';
 				appState.normalWheelRewards.forEach(reward => {
 					html += `
            <div class="reward-item bg-darkBg/60 border border-neonGreen/30 rounded-lg p-3 hover:border-neonGreen transition-colors cursor-pointer" data-reward-id="${reward.id}" data-wheel-type="normal">
                <div class="flex items-center justify-between mb-2">
                    <h5 class="text-white font-medium flex items-center">
                        <i class="fa ${reward.icon} text-neonGreen mr-2"></i>${reward.name}
                    </h5>
                    <div class="flex gap-1">
                        <button class="edit-reward-btn text-neonYellow hover:text-neonGreen" title="编辑奖励">
                            <i class="fa fa-edit"></i>
                        </button>
                        <button class="delete-reward-btn text-neonPink hover:text-red-500" title="删除奖励">
                            <i class="fa fa-trash"></i>
                        </button>
                    </div>
                </div>
                <div class="flex items-center gap-2 text-xs">
                    <span class="text-neonGreen">概率: ${reward.probability || 1}</span>
                    <span class="text-gray-400">颜色: ${reward.color}</span>
                </div>
            </div>
            `;
 				});

 				container.innerHTML = html;

 				// 绑定事件
 				bindRewardItemEvents();
 			}

 			// 渲染超级奖励列表
 			function renderSuperRewardsList() {
 				const container = document.getElementById('superRewardsList');
 				if (!container) return;

 				if (appState.superWheelRewards.length === 0) {
 					container.innerHTML = '<p class="col-span-full text-gray-400 text-center py-4">暂无超级奖励，点击添加按钮添加</p>';
 					return;
 				}

 				let html = '';
 				appState.superWheelRewards.forEach(reward => {
 					html += `
            <div class="reward-item bg-darkBg/60 border border-neonPink/30 rounded-lg p-3 hover:border-neonPink transition-colors cursor-pointer" data-reward-id="${reward.id}" data-wheel-type="super">
                <div class="flex items-center justify-between mb-2">
                    <h5 class="text-white font-medium flex items-center">
                        <i class="fa ${reward.icon} text-neonPink mr-2"></i>${reward.name}
                    </h5>
                    <div class="flex gap-1">
                        <button class="edit-reward-btn text-neonYellow hover:text-neonPink" title="编辑奖励">
                            <i class="fa fa-edit"></i>
                        </button>
                        <button class="delete-reward-btn text-neonPink hover:text-red-500" title="删除奖励">
                            <i class="fa fa-trash"></i>
                        </button>
                    </div>
                </div>
                <div class="flex items-center gap-2 text-xs">
                    <span class="text-neonPink">概率: ${reward.probability || 1}</span>
                    <span class="text-gray-400">颜色: ${reward.color}</span>
                </div>
            </div>
            `;
 				});

 				container.innerHTML = html;

 				// 绑定事件
 				bindRewardItemEvents();
 			}

 			// 渲染最终奖励列表
 			function renderUltimateRewardsList() {
 				const container = document.getElementById('ultimateRewardsList');
 				if (!container) return;

 				if (appState.ultimateWheelRewards.length === 0) {
 					container.innerHTML = '<p class="col-span-full text-gray-400 text-center py-4">暂无最终奖励，点击添加按钮添加</p>';
 					return;
 				}

 				let html = '';
 				appState.ultimateWheelRewards.forEach(reward => {
 					html += `
            <div class="reward-item bg-darkBg/60 border border-neonYellow/30 rounded-lg p-3 hover:border-neonYellow transition-colors cursor-pointer" data-reward-id="${reward.id}" data-wheel-type="ultimate">
                <div class="flex items-center justify-between mb-2">
                    <h5 class="text-white font-medium flex items-center">
                        <i class="fa ${reward.icon} text-neonYellow mr-2"></i>${reward.name}
                    </h5>
                    <div class="flex gap-1">
                        <button class="edit-reward-btn text-neonGreen hover:text-neonYellow" title="编辑奖励">
                            <i class="fa fa-edit"></i>
                        </button>
                        <button class="delete-reward-btn text-neonPink hover:text-red-500" title="删除奖励">
                            <i class="fa fa-trash"></i>
                        </button>
                    </div>
                </div>
                <div class="flex items-center gap-2 text-xs">
                    <span class="text-neonYellow">概率: ${reward.probability || 1}</span>
                    <span class="text-gray-400">颜色: ${reward.color}</span>
                </div>
            </div>
            `;
 				});

 				container.innerHTML = html;

 				// 绑定事件
 				bindRewardItemEvents();
 			}

 			// 绑定奖励项事件
 			function bindRewardItemEvents() {
 				// 编辑奖励按钮
 				document.querySelectorAll('.edit-reward-btn').forEach(btn => {
 					btn.addEventListener('click', function(e) {
 						e.stopPropagation();
 						const rewardItem = this.closest('.reward-item');
 						const rewardId = parseInt(rewardItem.getAttribute('data-reward-id'));
 						const wheelType = rewardItem.getAttribute('data-wheel-type');
 						editWheelReward(rewardId, wheelType);
 					});
 				});

 				// 删除奖励按钮
 				document.querySelectorAll('.delete-reward-btn').forEach(btn => {
 					btn.addEventListener('click', function(e) {
 						e.stopPropagation();
 						const rewardItem = this.closest('.reward-item');
 						const rewardId = parseInt(rewardItem.getAttribute('data-reward-id'));
 						const wheelType = rewardItem.getAttribute('data-wheel-type');
 						deleteWheelReward(rewardId, wheelType);
 					});
 				});
 			}

 			// 渲染转盘扇形区域
 			function renderWheelSectors() {
 				// 渲染普通转盘
 				const normalSectorsContainer = document.getElementById('normalWheelSectors');
 				if (normalSectorsContainer) {
 					let normalHtml = '';
 					const normalRewardCount = appState.normalWheelRewards.length;
 					const normalAngle = 360 / normalRewardCount;

 					appState.normalWheelRewards.forEach((reward, index) => {
 						const rotation = index * normalAngle;
 						const color = reward.color || 'neonPink';
 						normalHtml += `
                <div class="absolute top-0 left-1/2 w-1/2 h-1/2 origin-bottom transform -translate-x-1/2" style="transform: rotate(${rotation}deg); transform-origin: bottom center;">
                    <div class="w-full h-0 border-l-[24px] border-r-transparent border-b-[96px] border-l-${color}/80 border-b-transparent" style="border-left-width: 96px; border-left-color: rgba(var(--tw-color-${color}), 0.8);"></div>
                </div>
                `;
 					});
 					normalSectorsContainer.innerHTML = normalHtml;
 				}

 				// 渲染超级转盘
 				const superSectorsContainer = document.getElementById('superWheelSectors');
 				if (superSectorsContainer) {
 					let superHtml = '';
 					const superRewardCount = appState.superWheelRewards.length;
 					const superAngle = 360 / superRewardCount;

 					appState.superWheelRewards.forEach((reward, index) => {
 						const rotation = index * superAngle;
 						const color = reward.color || 'neonGreen';
 						superHtml += `
                <div class="absolute top-0 left-1/2 w-1/2 h-1/2 origin-bottom transform -translate-x-1/2" style="transform: rotate(${rotation}deg); transform-origin: bottom center;">
                    <div class="w-full h-0 border-l-[24px] border-r-transparent border-b-[96px] border-l-${color}/80 border-b-transparent" style="border-left-width: 96px; border-left-color: rgba(var(--tw-color-${color}), 0.8);"></div>
                </div>
                `;
 					});
 					superSectorsContainer.innerHTML = superHtml;
 				}

 				// 渲染最终转盘
 				const ultimateSectorsContainer = document.getElementById('ultimateWheelSectors');
 				if (ultimateSectorsContainer) {
 					let ultimateHtml = '';
 					const ultimateRewardCount = appState.ultimateWheelRewards.length;
 					const ultimateAngle = 360 / ultimateRewardCount;

 					appState.ultimateWheelRewards.forEach((reward, index) => {
 						const rotation = index * ultimateAngle;
 						const color = reward.color || 'neonYellow';
 						ultimateHtml += `
                <div class="absolute top-0 left-1/2 w-1/2 h-1/2 origin-bottom transform -translate-x-1/2" style="transform: rotate(${rotation}deg); transform-origin: bottom center;">
                    <div class="w-full h-0 border-l-[24px] border-r-transparent border-b-[96px] border-l-${color}/80 border-b-transparent" style="border-left-width: 96px; border-left-color: rgba(var(--tw-color-${color}), 0.8);"></div>
                </div>
                `;
 					});
 					ultimateSectorsContainer.innerHTML = ultimateHtml;
 				}
 			}

 			// 更新转盘上的文字显示
 			function updateWheelTexts() {
 				// 更新普通转盘文字
 				const normalTextsContainer = document.getElementById('normalWheelTexts');
 				if (normalTextsContainer && appState.normalWheelRewards.length > 0) {
 					let normalHtml = '';
 					appState.normalWheelRewards.forEach((reward, index) => {
 						const color = index % 2 === 0 ? 'white' : '#d50000';
 						const top = [12, 22, 50, 78, 88, 78, 50, 22][index];
 						const left = [50, 78, 85, 78, 50, 15, 22][index];
 						normalHtml +=
 							`<span style="position: absolute; top: ${top}%; left: ${left}%; transform: translateX(-50%); font-size: 13px; font-weight: 900; text-shadow: 3px 3px 6px rgba(0,0,0,0.9), 0 0 15px rgba(255,255,255,0.6); color: ${color};">${reward.name}</span>`;
 					});
 					normalTextsContainer.innerHTML = normalHtml;
 				}

 				// 更新超级转盘文字
 				const superTextsContainer = document.getElementById('superWheelTexts');
 				if (superTextsContainer && appState.superWheelRewards.length > 0) {
 					let superHtml = '';
 					appState.superWheelRewards.forEach((reward, index) => {
 						const color = index % 2 === 0 ? 'white' : '#d50000';
 						const top = [12, 22, 50, 78, 88, 78, 50, 22][index];
 						const left = [50, 78, 85, 78, 50, 15, 22][index];
 						superHtml +=
 							`<span style="position: absolute; top: ${top}%; left: ${left}%; transform: translateX(-50%); font-size: 13px; font-weight: 900; text-shadow: 3px 3px 6px rgba(0,0,0,0.9), 0 0 15px rgba(255,255,255,0.6); color: ${color};">${reward.name}</span>`;
 					});
 					superTextsContainer.innerHTML = superHtml;
 				}

 				// 更新终极转盘文字
 				const ultimateTextsContainer = document.getElementById('ultimateWheelTexts');
 				if (ultimateTextsContainer && appState.ultimateWheelRewards.length > 0) {
 					let ultimateHtml = '';
 					appState.ultimateWheelRewards.forEach((reward, index) => {
 						const color = index % 2 === 0 ? 'white' : '#d50000';
 						const top = [12, 22, 50, 78, 88, 78, 50, 22][index];
 						const left = [50, 78, 85, 78, 50, 15, 22][index];
 						ultimateHtml +=
 							`<span style="position: absolute; top: ${top}%; left: ${left}%; transform: translateX(-50%); font-size: 13px; font-weight: 900; text-shadow: 3px 3px 6px rgba(0,0,0,0.9), 0 0 15px rgba(255,255,255,0.6); color: ${color};">${reward.name}</span>`;
 					});
 					ultimateTextsContainer.innerHTML = ultimateHtml;
 				}
 			}

 			// 添加奖励
 			function addWheelReward(reward, wheelType) {
 				const newReward = {
 					id: Date.now(),
 					name: reward.name,
 					icon: reward.icon || 'fa-gift',
 					color: reward.color || 'neonPink',
 					probability: reward.probability || 1
 				};

 				if (wheelType === 'normal') {
 					appState.normalWheelRewards.push(newReward);
 				} else if (wheelType === 'super') {
 					appState.superWheelRewards.push(newReward);
 				} else if (wheelType === 'ultimate') {
 					appState.ultimateWheelRewards.push(newReward);
 				}

 				saveWheelRewards();
 				renderNormalRewardsList();
 				renderSuperRewardsList();
 				renderUltimateRewardsList();
 				renderWheelSectors();
 				updateWheelTexts();
 				showToast('奖励添加成功！');
 			}

 			// 编辑奖励
 			function editWheelReward(rewardId, wheelType) {
 				// 获取奖励数据
 				let rewards;
 				if (wheelType === 'normal') {
 					rewards = appState.normalWheelRewards;
 				} else if (wheelType === 'super') {
 					rewards = appState.superWheelRewards;
 				} else if (wheelType === 'ultimate') {
 					rewards = appState.ultimateWheelRewards;
 				}

 				const reward = rewards.find(r => r.id === rewardId);

 				if (!reward) return;

 				// 填充表单数据
 				document.getElementById('editRewardId').value = reward.id;
 				document.getElementById('editRewardWheelType').value = wheelType;
 				document.getElementById('editRewardName').value = reward.name;
 				document.getElementById('editRewardIcon').value = reward.icon;
 				document.getElementById('editRewardColor').value = reward.color || 'neonPink';
 				document.getElementById('editRewardProbability').value = reward.probability || 1;

 				// 显示弹窗
 				const modal = document.getElementById('editRewardModal');
 				modal.classList.remove('hidden', 'scale-out');
 				modal.classList.add('scale-in');
 			}

 			// 保存编辑奖励
 			function saveWheelRewardChanges() {
 				const rewardId = parseInt(document.getElementById('editRewardId').value);
 				const wheelType = document.getElementById('editRewardWheelType').value;

 				// 获取表单数据
 				const rewardData = {
 					name: document.getElementById('editRewardName').value,
 					icon: document.getElementById('editRewardIcon').value,
 					color: document.getElementById('editRewardColor').value,
 					probability: parseInt(document.getElementById('editRewardProbability').value)
 				};

 				// 更新奖励数据
 				if (wheelType === 'normal') {
 					const rewardIndex = appState.normalWheelRewards.findIndex(r => r.id === rewardId);
 					if (rewardIndex !== -1) {
 						appState.normalWheelRewards[rewardIndex] = {
 							...appState.normalWheelRewards[rewardIndex],
 							...rewardData
 						};
 					}
 				} else if (wheelType === 'super') {
 					const rewardIndex = appState.superWheelRewards.findIndex(r => r.id === rewardId);
 					if (rewardIndex !== -1) {
 						appState.superWheelRewards[rewardIndex] = {
 							...appState.superWheelRewards[rewardIndex],
 							...rewardData
 						};
 					}
 				} else if (wheelType === 'ultimate') {
 					const rewardIndex = appState.ultimateWheelRewards.findIndex(r => r.id === rewardId);
 					if (rewardIndex !== -1) {
 						appState.ultimateWheelRewards[rewardIndex] = {
 							...appState.ultimateWheelRewards[rewardIndex],
 							...rewardData
 						};
 					}
 				}

 				// 保存到本地存储
 				saveWheelRewards();

 				// 重新渲染
 				renderNormalRewardsList();
 				renderSuperRewardsList();
 				renderUltimateRewardsList();
 				renderWheelSectors();
 				updateWheelTexts();

 				// 关闭弹窗
 				const modal = document.getElementById('editRewardModal');
 				modal.classList.remove('scale-in');
 				modal.classList.add('scale-out');
 				setTimeout(() => {
 					modal.classList.add('hidden');
 				}, 300);

 				showToast('奖励更新成功！');
 			}

 			// 删除奖励
 			function deleteWheelReward(rewardId, wheelType) {
 				if (confirm('确定要删除这个奖励吗？')) {
 					if (wheelType === 'normal') {
 						appState.normalWheelRewards = appState.normalWheelRewards.filter(r => r.id !== rewardId);
 					} else if (wheelType === 'super') {
 						appState.superWheelRewards = appState.superWheelRewards.filter(r => r.id !== rewardId);
 					} else if (wheelType === 'ultimate') {
 						appState.ultimateWheelRewards = appState.ultimateWheelRewards.filter(r => r.id !== rewardId);
 					}

 					saveWheelRewards();
 					renderNormalRewardsList();
 					renderSuperRewardsList();
 					renderUltimateRewardsList();
 					renderWheelSectors();
 					updateWheelTexts();
 					showToast('奖励删除成功！');
 				}
 			}

 			// 渲染卡片选择选项
 			function renderCardSelectOptions() {
 				const container = document.getElementById('taskCardSelectContainer');
 				if (!container) return;

 				if (appState.taskCards.length === 0) {
 					container.innerHTML = `
                <div class="col-span-full text-center py-4 text-gray-400">
                    <i class="fa fa-info-circle mr-2"></i>暂无任务卡片，<a href="javascript:;" id="goToCardSettingFromSelect" class="text-neonBlue hover:underline">去设置</a>
                </div>
                `;

 					// 绑定跳转事件
 					document.getElementById('goToCardSettingFromSelect')?.addEventListener('click', () => {
 						document.getElementById('taskSwitchModal').classList.add('scale-out');
 						setTimeout(() => {
 							document.getElementById('taskSwitchModal').classList.add('hidden');
 							showScreen('cardSettingScreen');
 						}, 300);
 					});

 					return;
 				}

 				let html = '';
 				appState.taskCards.forEach(card => {
 					let typeClass = 'type-tag';
 					if (card.type === 'study') typeClass = 'type-tag-study';
 					if (card.type === 'rest') typeClass = 'type-tag-rest';
 					if (card.type === 'work') typeClass = 'type-tag-work';
 					if (card.type === 'life') typeClass = 'type-tag-life';

 					let iconClass = 'fa-code';
 					if (card.type === 'rest') iconClass = 'fa-heart';
 					if (card.type === 'work') iconClass = 'fa-briefcase';
 					if (card.type === 'life') iconClass = 'fa-home';

 					let colorClass = 'neonBlue';
 					if (card.type === 'rest') colorClass = 'neonGreen';
 					if (card.type === 'work') colorClass = 'neonPink';
 					if (card.type === 'life') colorClass = 'neonYellow';

 					html += `
                <div class="card-select-item bg-darkBg/80 border-2 border-${colorClass} rounded-lg p-3 cursor-pointer transition-all duration-300 hover:border-neonPink hover:scale-105" data-card-id="${card.id}">
                    <div class="text-center">
                        <div class="w-10 h-10 rounded-full bg-${colorClass}/20 flex items-center justify-center text-${colorClass} text-base mx-auto mb-2">
                            <i class="fa ${iconClass}"></i>
                        </div>
                        <p class="text-white text-sm font-medium truncate">${card.name}</p>
                        <p class="text-neonYellow text-xs mt-1">${card.time}分钟</p>
                    </div>
                </div>
                `;
 				});

 				container.innerHTML = html;

 				// 绑定卡片选择事件
 				document.querySelectorAll('.card-select-item').forEach(item => {
 					item.addEventListener('click', function() {
 						// 移除其他选中状态
 						document.querySelectorAll('.card-select-item').forEach(i => {
 							i.classList.remove('border-neonPink');
 							i.classList.add('opacity-70');
 						});

 						// 添加选中状态
 						this.classList.add('border-neonPink');
 						this.classList.remove('opacity-70');

 						const cardId = this.getAttribute('data-card-id');
 						const card = appState.taskCards.find(c => c.id === cardId);

 						if (card) {
 							document.getElementById('nextTaskName').value = card.name;
 							document.getElementById('nextTaskTime').value = card.time;
 							document.getElementById('nextTaskType').value = card.type;

 							if (card.linkedSmartTaskId) {
 								document.getElementById('linkSmartTask').checked = true;
 								document.getElementById('smartTaskLinkSelect').value = card.linkedSmartTaskId;
 								document.getElementById('smartTaskLinkSelect').classList.remove('hidden');
 							}
 						}
 					});
 				});
 			}

 			// 添加/编辑任务卡片
 			function saveTaskCard(cardData) {
 				if (cardData.id) {
 					// 编辑现有卡片
 					const index = appState.taskCards.findIndex(c => c.id === cardData.id);
 					if (index !== -1) {
 						appState.taskCards[index] = {
 							...appState.taskCards[index],
 							...cardData
 						};
 					}
 				} else {
 					// 添加新卡片
 					cardData.id = Date.now().toString();
 					appState.taskCards.push(cardData);
 				}

 				// 保存到本地存储
 				localStorage.setItem('dopamineTaskCards', JSON.stringify(appState.taskCards));

 				// 重新渲染
 				renderTaskCards();
 				renderCardSelectOptions();

 				// 关闭弹窗
 				closeEditCardModal();
 			}

 			// 删除任务卡片
 			function deleteTaskCard(cardId) {
 				if (!confirm('确定要删除这个任务卡片吗？')) return;

 				appState.taskCards = appState.taskCards.filter(card => card.id !== cardId);
 				localStorage.setItem('dopamineTaskCards', JSON.stringify(appState.taskCards));

 				renderTaskCards();
 				renderCardSelectOptions();
 			}

 			// 打开编辑卡片弹窗
 			function openEditCardModal(cardId = '') {
 				renderTaskTypeSuggestions();
 				renderSavedTaskTypeTags();
 				const modal = document.getElementById('editCardModal');
 				const title = document.getElementById('editCardModalTitle');
 				const form = document.getElementById('editCardForm');

 				// 清空表单
 				form.reset();
 				document.getElementById('editCardId').value = '';

 				if (cardId) {
 					// 编辑模式
 					title.innerHTML = '<i class="fa fa-pencil mr-2"></i>编辑任务卡片';
 					document.getElementById('confirmEditCardBtn').textContent = '确认修改';

 					const card = appState.taskCards.find(c => c.id === cardId);
 					if (card) {
 						document.getElementById('editCardId').value = card.id;
 						document.getElementById('editCardName').value = card.name;
 						document.getElementById('editCardTime').value = card.time;
 						document.getElementById('editCardType').value = card.type;
 						document.getElementById('editCardSmartLink').value = card.linkedSmartTaskId || '';
 					}
 				} else {
 					// 添加模式
 					title.innerHTML = '<i class="fa fa-plus-circle mr-2"></i>添加新任务卡片';
 					document.getElementById('confirmEditCardBtn').textContent = '确认添加';
 				}

 				// 加载SMART任务关联选项
 				loadSmartTaskLinkOptions('editCardSmartLink');

 				// 显示弹窗
 				modal.classList.remove('scale-out');
 				modal.classList.add('scale-in');
 				modal.classList.remove('hidden');
 			}

 			// 关闭编辑卡片弹窗
 			function closeEditCardModal() {
 				const modal = document.getElementById('editCardModal');
 				modal.classList.remove('scale-in');
 				modal.classList.add('scale-out');

 				setTimeout(() => {
 					modal.classList.add('hidden');
 				}, 300);
 			}

 			// 加载SMART任务关联选项
 			function loadSmartTaskLinkOptions(selectId) {
 				const select = document.getElementById(selectId);
 				if (!select) return;

 				// 获取所有SMART任务记录
 				const smartTasks = appState.taskRecords.filter(record => record.isSmart);

 				// 保留第一个选项
 				const firstOption = select.options[0];
 				select.innerHTML = '';
 				select.appendChild(firstOption);

 				// 添加SMART任务选项
 				smartTasks.forEach(task => {
 					const option = document.createElement('option');
 					option.value = task.id;
 					option.textContent = task.name.length > 20 ? task.name.substring(0, 20) + '...' : task.name;
 					select.appendChild(option);
 				});
 			}

 			// 显示指定界面
 			function showScreen(screenId) {
 				// 隐藏所有界面
 				document.querySelectorAll('.screen').forEach(screen => {
 					screen.classList.add('hidden');
 				});

 				// 显示指定界面
 				const targetScreen = document.getElementById(screenId);
 				if (targetScreen) {
 					targetScreen.classList.remove('hidden');

 					// 如果是记录页面，重新渲染数据
 					if (screenId === 'recordScreen') {
 						renderTaskRecords();
 					}

 					// 如果是卡片设置页面，重新渲染卡片
 					if (screenId === 'cardSettingScreen') {
 						renderTaskCards();
 					}

 					// 如果是周期任务管理页面，重新渲染周期任务
 					if (screenId === 'periodicTaskScreen') {
 						renderPeriodicTasks();
 					}

 					// 如果是奖励模块页面，重新渲染奖励值和记录
 					if (screenId === 'rewardModuleScreen') {
 						updateRewardPointsDisplay();
 						renderRewardHistory();
 					}
 				}
 			}

 			// 格式化时间显示
 			function formatTime(seconds) {
 				const mins = Math.floor(seconds / 60);
 				const secs = seconds % 60;
 				return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
 			}

 			// 开始计时器
 			function startTimer() {
 				if (appState.timerInterval) {
 					clearInterval(appState.timerInterval);
 				}

 				// 记录开始时间
 				if (!appState.currentTaskStartTime) {
 					appState.currentTaskStartTime = new Date().getTime();
 					appState.currentTask.startTimeStamp = appState.currentTaskStartTime;
 					appState.currentTask.startTime = new Date().toLocaleTimeString();
 				}

 				document.getElementById('startTimerBtn').classList.add('opacity-50', 'cursor-not-allowed');
 				document.getElementById('pauseTimerBtn').classList.remove('opacity-50', 'cursor-not-allowed');
 				document.getElementById('completeTaskBtn').classList.remove('opacity-50', 'cursor-not-allowed');

 				appState.timerInterval = setInterval(() => {
 					appState.elapsedTime++;

 					document.getElementById('timer').textContent = formatTime(appState.elapsedTime);

 					// 更新进度条
 					const totalTime = appState.currentTask.time * 60;
 					const progress = Math.min(100, (appState.elapsedTime / totalTime) * 100);
 					document.getElementById('progressBar').style.width = `${progress}%`;
 				}, 1000);
 			}

 			// 保存定时器状态
 			function saveTimerState() {
 				if (appState.currentTask && appState.currentTaskStartTime) {
 					const timerState = {
 						currentTask: appState.currentTask,
 						currentTaskStartTime: appState.currentTaskStartTime,
 						elapsedTime: appState.elapsedTime,
 						isSmartTask: appState.isSmartTask
 					};
 					try {
 						localStorage.setItem('dopamineTimerState', JSON.stringify(timerState));
 					} catch (error) {
 						console.warn('保存计时器状态失败（可能是浏览器跟踪防护导致）:', error);
 					}
 				}
 			}

 			// 恢复定时器状态
 			function restoreTimerState() {
 				const timerState = localStorage.getItem('dopamineTimerState');
 				if (timerState) {
 					try {
 						const {
 							currentTask,
 							currentTaskStartTime,
 							elapsedTime,
 							isSmartTask
 						} = JSON.parse(timerState);

 						// 计算页面关闭期间经过的时间（毫秒）
 						const now = Date.now();
 						const elapsedSinceStart = now - currentTaskStartTime;

 						// 将关闭时长加到任务记录时长中（转换为秒）
 						const closedDuration = Math.floor(elapsedSinceStart / 1000);

 						// 计算新的经过时间（加上关闭时长）
 						const newElapsedTime = elapsedTime + closedDuration;

 						// 恢复状态
 						appState.currentTask = currentTask;
 						appState.currentTaskStartTime = currentTaskStartTime;
 						appState.elapsedTime = newElapsedTime;
 						appState.isSmartTask = isSmartTask;

 						// 将关闭时长加到任务记录时长中
 						if (currentTask.id) {
 							const taskRecords = JSON.parse(localStorage.getItem('dopamineTaskRecords')) || [];
 							const taskRecord = taskRecords.find(record => record.id === currentTask.id);
 							if (taskRecord) {
 								taskRecord.duration += closedDuration;
 								localStorage.setItem('dopamineTaskRecords', JSON.stringify(taskRecords));
 							}
 						}

 						// 更新UI
 						document.getElementById('gameTaskTitle').textContent = currentTask.name;
 						document.getElementById('gameTaskDesc').textContent = currentTask.desc || '';
 						document.getElementById('gameTaskTime').textContent = currentTask.time;
 						document.getElementById('timer').textContent = formatTime(appState.elapsedTime);

 						const totalTime = currentTask.time * 60;
 						const progress = Math.min(100, (appState.elapsedTime / totalTime) * 100);
 						document.getElementById('progressBar').style.width = `${progress}%`;

 						// 恢复按钮状态（添加元素存在性检查）
 						const startTimerBtn = document.getElementById('startTimerBtn');
 						const pauseTimerBtn = document.getElementById('pauseTimerBtn');
 						const completeTaskBtn = document.getElementById('completeTaskBtn');

 						if (startTimerBtn) startTimerBtn.classList.add('opacity-50', 'cursor-not-allowed');
 						if (pauseTimerBtn) pauseTimerBtn.classList.remove('opacity-50', 'cursor-not-allowed');
 						if (completeTaskBtn) completeTaskBtn.classList.remove('opacity-50', 'cursor-not-allowed');

 						// 重新启动定时器
 						appState.timerInterval = setInterval(() => {
 							appState.elapsedTime++;

 							document.getElementById('timer').textContent = formatTime(appState.elapsedTime);

 							// 更新进度条
 							const totalTime = appState.currentTask.time * 60;
 							const progress = Math.min(100, (appState.elapsedTime / totalTime) * 100);
 							document.getElementById('progressBar').style.width = `${progress}%`;
 						}, 1000);

 						// 清除保存的状态
 						localStorage.removeItem('dopamineTimerState');

 						return true;
 					} catch (error) {
 						console.error('恢复定时器状态失败:', error);
 						localStorage.removeItem('dopamineTimerState');
 						return false;
 					}
 				}
 				return false;
 			}

 			// 暂停计时器
 			function pauseTimer() {
 				if (appState.timerInterval) {
 					clearInterval(appState.timerInterval);
 					appState.timerInterval = null;
 				}

 				if (appState.reminderInterval) {
 					clearInterval(appState.reminderInterval);
 					appState.reminderInterval = null;
 				}

 				document.getElementById('startTimerBtn').classList.remove('opacity-50', 'cursor-not-allowed');
 				document.getElementById('pauseTimerBtn').classList.add('opacity-50', 'cursor-not-allowed');
 				document.getElementById('timer').classList.remove('text-neonPink', 'animate-pulse-fast');
 			}

 			// 完成任务
 			function completeTask() {
 				pauseTimer();
 				createFireworks();
 				checkAchievements();

 				// 更新统计数据
 				appState.totalComplete++;

 				// 根据任务难度给予奖励值
 				let rewardPoints = 1; // 默认普通任务奖励值
 				if (appState.currentTask.isExchange) {
 					// 兑换任务特殊处理，奖励值为0.1
 					rewardPoints = 0.1;
 				} else if (appState.currentTask.isSmart && appState.currentTask.difficulty) {
 					if (appState.currentTask.difficulty === 'easy') {
 						rewardPoints = 1;
 					} else if (appState.currentTask.difficulty === 'medium') {
 						rewardPoints = 2;
 					} else if (appState.currentTask.difficulty === 'hard') {
 						rewardPoints = 3;
 					}
 				}

 				// 更新奖励值
 				appState.rewardPoints += rewardPoints;
 				saveRewardPoints();
 				updateRewardPointsDisplay();

 				// 调用背包模块添加奖励值
 				if (window.backpackModule) {
 					window.backpackModule.addPoints(rewardPoints);
 				}

 				calculateStreak();

				// 更新荣誉系统
				if (window.honorSystem) {
					window.honorSystem.updateDisplay();
				}

 				// 保存到本地存储（添加try-catch处理跟踪防护）
 				try {
 					localStorage.setItem('dopamineTotalComplete', appState.totalComplete);
 					localStorage.setItem('dopamineRewardPoints', appState.rewardPoints);

 					// 保存任务记录
 					saveTaskRecord(appState.currentTask);

 					// 清除定时器状态
 					localStorage.removeItem('dopamineTimerState');
 				} catch (error) {
 					console.warn('保存数据失败（可能是浏览器跟踪防护导致）:', error);
 				}

 				// 更新UI
				document.getElementById('totalComplete').textContent = appState.totalComplete;
				document.getElementById('streakDays').textContent = appState.streakDays;

 				// 更新奖励弹窗内容
 				document.getElementById('rewardMsg').textContent = `你成功完成了${appState.currentTask.name.replace(/第.+关：/, '')}`;
 				document.getElementById('rewardPoints').textContent = rewardPoints.toFixed(1);
 				document.getElementById('rewardStreak').textContent = appState.streakDays;
 				document.getElementById('rewardTotal').textContent = appState.totalComplete;

 				// SMART任务奖励标识
 				if (appState.currentTask.isSmart) {
 					document.getElementById('smartRewardBadge').classList.remove('hidden');
 					document.getElementById('smartRewardTip').classList.remove('hidden');
 				} else {
 					document.getElementById('smartRewardBadge').classList.add('hidden');
 					document.getElementById('smartRewardTip').classList.add('hidden');
 				}

 				// 显示奖励弹窗
 				document.getElementById('rewardModal').classList.remove('hidden');

 				// 保存任务记录和更新统计信息将在用户关闭奖励弹窗时进行
 			}

 			// 设置当前任务
 			function setCurrentTask(task) {
 				appState.currentTask = {
 					...task,
 					createTime: new Date().toLocaleString(),
 					startTime: '未开始',
 					startTimeStamp: null
 				};
 				appState.isSmartTask = task.isSmart || false;
 				appState.elapsedTime = 0;

 				// 更新游戏界面
 				document.getElementById('gameTaskTitle').textContent = task.name;
 				document.getElementById('gameTaskDesc').textContent = task.desc || '';
 				document.getElementById('gameTaskTime').textContent = task.time;
 				document.getElementById('timer').textContent = formatTime(appState.elapsedTime);
 				document.getElementById('progressBar').style.width = '0%';

 				// 重置计时器按钮状态
 				document.getElementById('startTimerBtn').classList.remove('opacity-50', 'cursor-not-allowed');
 				document.getElementById('pauseTimerBtn').classList.add('opacity-50', 'cursor-not-allowed');
 				document.getElementById('completeTaskBtn').classList.add('opacity-50', 'cursor-not-allowed');

 				// 清除计时器
 				if (appState.timerInterval) {
 					clearInterval(appState.timerInterval);
 					appState.timerInterval = null;
 				}

 				if (appState.reminderInterval) {
 					clearInterval(appState.reminderInterval);
 					appState.reminderInterval = null;
 				}

 				// 重置开始时间
 				appState.currentTaskStartTime = null;

 				// SMART任务详情展示
 				if (task.isSmart) {
 					document.getElementById('smartTaskTag').classList.remove('hidden');
 					document.getElementById('smartTaskDetails').classList.remove('hidden');
 					document.getElementById('detailSpecific').textContent = task.specific || '-';
 					document.getElementById('detailRelevant').textContent = task.relevant || '-';
 					document.getElementById('detailDeadline').textContent = task.deadline || '-';

 					// 显示子任务列表（地图形状，层层递进）
 					function renderSubtaskList(task) {
 						const subtaskContainer = document.getElementById('subtaskContainerGame');
 						subtaskContainer.innerHTML = '';

 						if (task.subtasks && task.subtasks.length > 0) {
 							document.getElementById('subtaskList').classList.remove('hidden');

 							// 获取搜索关键词
 							const searchKeyword = document.getElementById('subtaskSearchInput').value.toLowerCase();

 							// 根据筛选条件过滤子任务
 							let filteredSubtasks = task.subtasks;
 							if (currentSubtaskFilter === 'incomplete') {
 								filteredSubtasks = task.subtasks.filter(s => !s.completed);
 							} else if (currentSubtaskFilter === 'completed') {
 								filteredSubtasks = task.subtasks.filter(s => s.completed);
 							}

 							// 根据搜索关键词过滤
 							if (searchKeyword) {
 								filteredSubtasks = filteredSubtasks.filter(s => s.text.toLowerCase().includes(searchKeyword));
 							}

 							filteredSubtasks.forEach((subtask, index) => {
 								const subtaskDiv = document.createElement('div');
 								subtaskDiv.className = 'relative mb-4';

 								const isLast = index === task.subtasks.length - 1;
 								const completedClass = subtask.completed ? 'bg-neonGreen/20 border-neonGreen' :
 									'bg-darkBg/50 border-neonPink/50';
 								const iconClass = subtask.completed ? 'fa-check-circle text-neonGreen' :
 									'fa-circle-o text-neonPink';

 								subtaskDiv.innerHTML = `
                        <div class="flex items-center gap-4">
                            <div class="flex flex-col items-center">
                                <div class="w-12 h-12 rounded-full ${completedClass} border-2 flex items-center justify-center text-2xl transition-all duration-300 hover:scale-110 cursor-pointer" onclick="toggleSubtaskCompletion(${index})">
                                    <i class="fa ${iconClass}"></i>
                                </div>
                                ${!isLast ? `
                                <div class="w-1 h-8 ${subtask.completed ? 'bg-neonGreen' : 'bg-neonPink/30'} transition-all duration-300"></div>
                                ` : ''}
                            </div>
                            <div class="flex-1 ${subtask.completed ? 'opacity-50 line-through' : ''}">
                                <div class="bg-darkBg/80 border-2 border-neonBlue/30 rounded-lg p-4">
                                    <div class="flex items-center gap-2 mb-2">
                                        <span class="text-neonYellow font-bold">关卡 ${index + 1}</span>
                                        ${subtask.completed ? '<span class="bg-neonGreen text-white px-2 py-1 rounded text-xs">已完成</span>' : '<span class="bg-neonPink text-white px-2 py-1 rounded text-xs">进行中</span>'}
                                    </div>
                                    <p class="text-white">${subtask.text}</p>
                                </div>
                            </div>
                        </div>
                    `;
 								subtaskContainer.appendChild(subtaskDiv);
 							});
 						} else {
 							document.getElementById('subtaskList').classList.add('hidden');
 						}
 					}

 					// 子任务搜索和筛选功能
 					let currentSubtaskFilter = 'all';

 					function filterSubtasks(filter) {
 						currentSubtaskFilter = filter;
 						renderSubtaskList(appState.currentTask);
 					}

 					function completeAllSubtasks() {
 						if (!appState.currentTask || !appState.currentTask.subtasks) return;

 						appState.currentTask.subtasks.forEach(subtask => {
 							subtask.completed = true;
 						});

 						saveCurrentTask();
 						renderSubtaskList(appState.currentTask);
 						showToast('所有子任务已完成！');
 					}

 					function resetAllSubtasks() {
 						if (!appState.currentTask || !appState.currentTask.subtasks) return;

 						appState.currentTask.subtasks.forEach(subtask => {
 							subtask.completed = false;
 						});

 						saveCurrentTask();
 						renderSubtaskList(appState.currentTask);
 						showToast('所有子任务已重置！');
 					}

 					// 显示子任务列表（地图形状，层层递进）
 					renderSubtaskList(task);
 				} else {
 					document.getElementById('smartTaskTag').classList.add('hidden');
 					document.getElementById('smartTaskDetails').classList.add('hidden');
 				}

 				// 显示游戏界面
 				showScreen('gameScreen');

 				// ========== 新增：自动开始计时 ==========
 				setTimeout(() => {
 					startTimer();
 				}, 500);
 				// =======================================
 			}

 			// 初始化事件监听
 			// 初始化事件监听
 			function initEventListeners() {
 				console.log('初始化事件监听器...');
 				console.log('startDefaultBtn元素:', document.getElementById('startDefaultBtn'));
 				console.log('customTaskBtn元素:', document.getElementById('customTaskBtn'));
 				console.log('smartTaskBtn元素:', document.getElementById('smartTaskBtn'));
 				// 初始化自定义任务类型
 				renderTaskTypeSuggestions();
 				renderSavedTaskTypeTags();
 				initTaskTypeInputEvents();

 				document.getElementById('filterToggleBtn')?.addEventListener('click', function() {
 					const container = document.getElementById('filterContainer');
 					container.classList.toggle('hidden');
 				});

 				// 初始化粒子特效
 				createParticles();

 				// 监听窗口大小变化
 				window.addEventListener('resize', () => {
 					// 使用防抖避免频繁渲染
 					clearTimeout(window.resizeTimer);
 					window.resizeTimer = setTimeout(() => {
 						if (!document.getElementById('recordScreen').classList.contains('hidden')) {
 							renderTaskRecords(
 								document.getElementById('filterSelect')?.value || 'all',
 								document.getElementById('relevantFilterSelect')?.value || '',
 								document.getElementById('startDateFilter')?.value || '',
 								document.getElementById('endDateFilter')?.value || ''
 							);
 						}
 					}, 200);
 				});

 				// 子任务搜索和筛选事件监听
 				document.getElementById('subtaskSearchInput')?.addEventListener('input', () => {
 					renderSubtaskList(appState.currentTask);
 				});

 				document.getElementById('filterAllSubtasks')?.addEventListener('click', () => {
 					filterSubtasks('all');
 					document.getElementById('filterAllSubtasks').classList.add('bg-neonBlue/80');
 					document.getElementById('filterIncompleteSubtasks').classList.remove('bg-neonGreen/80');
 					document.getElementById('filterCompletedSubtasks').classList.remove('bg-neonPink/80');
 				});

 				document.getElementById('filterIncompleteSubtasks')?.addEventListener('click', () => {
 					filterSubtasks('incomplete');
 					document.getElementById('filterAllSubtasks').classList.remove('bg-neonBlue/80');
 					document.getElementById('filterIncompleteSubtasks').classList.add('bg-neonGreen/80');
 					document.getElementById('filterCompletedSubtasks').classList.remove('bg-neonPink/80');
 				});

 				document.getElementById('filterCompletedSubtasks')?.addEventListener('click', () => {
 					filterSubtasks('completed');
 					document.getElementById('filterAllSubtasks').classList.remove('bg-neonBlue/80');
 					document.getElementById('filterIncompleteSubtasks').classList.remove('bg-neonGreen/80');
 					document.getElementById('filterCompletedSubtasks').classList.add('bg-neonPink/80');
 				});

 				document.getElementById('completeAllSubtasks')?.addEventListener('click', completeAllSubtasks);
 				document.getElementById('resetAllSubtasks')?.addEventListener('click', resetAllSubtasks);

 				// 初始化成就墙
 				checkAchievements();

 				// ===== 首页按钮事件 =====
 				// 默认闯关按钮
 				document.getElementById('startDefaultBtn')?.addEventListener('click', () => {
 					// 检查是否有正在进行的任务
 					if (appState.currentTask && appState.timerInterval) {
 						// 有正在计时的任务 → 直接回到游戏界面继续计时
 						showScreen('gameScreen');
 						// 同步更新游戏界面的计时显示
 						document.getElementById('timer').textContent = formatTime(appState.elapsedTime);
 						const totalTime = appState.currentTask.time * 60;
 						const progress = Math.min(100, (appState.elapsedTime / totalTime) * 100);
 						document.getElementById('progressBar').style.width = `${progress}%`;
 						// 更新按钮状态
 						document.getElementById('startTimerBtn').classList.add('opacity-50', 'cursor-not-allowed');
 						document.getElementById('pauseTimerBtn').classList.remove('opacity-50', 'cursor-not-allowed');
 						document.getElementById('completeTaskBtn').classList.remove('opacity-50', 'cursor-not-allowed');
 						// 补充：恢复startTimeStamp（关键！）
 						if (!appState.currentTask.startTimeStamp && appState.currentTaskStartTime) {
 							appState.currentTask.startTimeStamp = appState.currentTaskStartTime;
 						}
 					} else {
 						// 没有正在进行的任务 → 初始化默认任务
 						const defaultTaskClone = JSON.parse(JSON.stringify(defaultTasks[0]));
 						setCurrentTask(defaultTaskClone);
 					}
 				});
 				// 检查是否有正在进行的任务

 			};;

 			// 自定义任务按钮
 			document.getElementById('customTaskBtn')?.addEventListener('click', () => {
 				document.getElementById('customTaskModal').classList.remove('hidden');
 				updateCustomTaskHistoryRelevantOptions();
 			});

 			// SMART任务按钮
 			document.getElementById('smartTaskBtn')?.addEventListener('click', () => {
 				document.getElementById('smartTaskModal').classList.remove('hidden');
 			});

 			// 周期任务管理按钮
 			document.getElementById('periodicTaskBtn')?.addEventListener('click', () => {
 				showScreen('periodicTaskScreen');
 				renderPeriodicTasks();
 			});

 			// 奖励模块按钮
 			document.getElementById('rewardModuleBtn')?.addEventListener('click', () => {
 				showScreen('rewardModuleScreen');
 				updateRewardPointsDisplay();
 				renderRewardHistory();
 			});

 			// 任务记录按钮
 			document.getElementById('taskRecordBtn')?.addEventListener('click', () => {
 				showScreen('recordScreen');
 			});

 			// 任务卡片设置按钮（首页）
 			document.getElementById('goToCardSettingBtnHome')?.addEventListener('click', () => {
 				showScreen('cardSettingScreen');
 			});

 			// 版本介绍按钮
 			document.getElementById('versionInfoBtn')?.addEventListener('click', () => {
 				document.getElementById('versionInfoModal').classList.remove('hidden');
 			});

 			// 关闭版本介绍弹窗
 			document.getElementById('closeVersionInfoBtn')?.addEventListener('click', () => {
 				document.getElementById('versionInfoModal').classList.add('hidden');
 			});

 			// 关闭自定义任务弹窗
 			document.getElementById('closeModalBtn')?.addEventListener('click', () => {
 				document.getElementById('customTaskModal').classList.add('hidden');
 			});

 			// 关闭SMART任务弹窗
 			document.getElementById('closeSmartModalBtn')?.addEventListener('click', () => {
 				document.getElementById('smartTaskModal').classList.add('hidden');
 			});

 			// 关闭奖励弹窗
 			document.getElementById('closeRewardBtn')?.addEventListener('click', () => {
 				// 保存任务感受
 				const taskFeeling = document.getElementById('taskFeeling').value.trim();
 				if (taskFeeling && appState.taskRecords.length > 0) {
 					// 更新最近一条任务记录的感受
 					const lastRecordIndex = appState.taskRecords.length - 1;
 					appState.taskRecords[lastRecordIndex].feeling = taskFeeling;
 					localStorage.setItem('dopamineTaskRecords', JSON.stringify(appState.taskRecords));
 					renderTaskRecords();
 				}

 				// 清空感受输入框
 				document.getElementById('taskFeeling').value = '';

 				document.getElementById('rewardModal').classList.add('hidden');
 				showScreen('startScreen');
 			});

 			// 奖励弹窗-查看记录
 			document.getElementById('gotoRecordBtn')?.addEventListener('click', () => {
 				// 保存任务感受
 				const taskFeeling = document.getElementById('taskFeeling').value.trim();
 				if (taskFeeling && appState.taskRecords.length > 0) {
 					// 更新最近一条任务记录的感受
 					const lastRecordIndex = appState.taskRecords.length - 1;
 					appState.taskRecords[lastRecordIndex].feeling = taskFeeling;
 					localStorage.setItem('dopamineTaskRecords', JSON.stringify(appState.taskRecords));
 					renderTaskRecords();
 				}

 				document.getElementById('rewardModal').classList.add('hidden');
 				showScreen('recordScreen');
 			});

 			// 返回首页按钮
 			document.getElementById('backToStartBtn')?.addEventListener('click', () => {
 				// 移除 pauseTimer()，保持计时状态
 				showScreen('startScreen');
 			});

 			// 记录页面返回按钮
 			document.getElementById('backFromRecordBtn')?.addEventListener('click', () => {
 				showScreen('startScreen');
 			});

 			// 卡片设置页面返回按钮
 			document.getElementById('backFromCardSettingBtn')?.addEventListener('click', () => {
 				showScreen('startScreen');
 			});

 			// 周期任务管理页面返回按钮
 			document.getElementById('backFromPeriodicTaskBtn')?.addEventListener('click', () => {
 				showScreen('startScreen');
 			});

 			// 查看今天任务按钮
 			document.getElementById('viewTodayTasksBtn')?.addEventListener('click', () => {
 				showTodayTaskConfirmation();
 			});

 			// 关闭今天任务弹窗按钮
 			document.getElementById('closeTodayTasksBtn')?.addEventListener('click', () => {
 				const modal = document.getElementById('todayTasksModal');
 				modal.classList.add('hidden');
 			});

 			// 显示今天的任务
 			function showTodayTasks() {
 				const today = new Date();
 				const todayStr = today.toISOString().split('T')[0];
 				const dayOfWeek = today.getDay();
 				const weekDays = ['周日', '周一', '周二', '周三', '周四', '周五', '周六'];

 				// 更新日期显示
 				document.getElementById('todayDate').textContent =
 					`${today.getFullYear()}年${today.getMonth() + 1}月${today.getDate()}日 ${weekDays[dayOfWeek]}`;

 				// 筛选今天的任务
 				const todayTasks = appState.periodicTasks.filter(task => {
 					if (task.type === 'daily') {
 						return true;
 					} else if (task.type === 'weekly' && Array.isArray(task.specificDates)) {
 						return task.specificDates.includes(dayOfWeek);
 					} else if (task.type === 'specific' && task.specificDates && task.specificDates.date) {
 						return task.specificDates.date === todayStr;
 					}
 					return false;
 				});

 				const taskList = document.getElementById('todayTasksList');
 				const emptyTip = document.getElementById('emptyTodayTasksTip');

 				if (todayTasks.length === 0) {
 					taskList.innerHTML = '';
 					emptyTip.classList.remove('hidden');
 				} else {
 					emptyTip.classList.add('hidden');

 					const typeLabels = {
 						daily: '每日',
 						weekly: '每周',
 						specific: '具体日期'
 					};

 					const typeColors = {
 						daily: 'neonBlue',
 						weekly: 'neonGreen',
 						specific: 'neonPink'
 					};

 					let html = '';
 					todayTasks.forEach((task, index) => {
 						const colorClass = typeColors[task.type] || 'neonBlue';
 						const typeLabel = typeLabels[task.type] || task.type;

 						const todayStr = new Date().toLocaleDateString();
 						const isCompleted = task.completedDates && task.completedDates.includes(todayStr);
 						const completedClass = isCompleted ? 'opacity-50 line-through' : '';
 						const checkIcon = isCompleted ? 'fa-check-circle text-neonGreen' : 'fa-circle-o text-gray-400';

 						let timeText = '';
 						if (task.type === 'specific' && task.specificDates && task.specificDates.time) {
 							timeText =
 								`<p class="text-gray-400 text-sm mt-1"><i class="fa fa-clock-o mr-1"></i>时间：${task.specificDates.time}</p>`;
 						}

 						const hasSubtasks = task.subtasks && task.subtasks.length > 0;
 						const subtasksCompletedCount = hasSubtasks ? task.subtasks.filter(s => s.completed).length : 0;
 						const subtasksTotalCount = hasSubtasks ? task.subtasks.length : 0;

 						html += `
                <div class="bg-darkBg/50 border border-${colorClass}/30 rounded-lg p-4 cursor-pointer hover:bg-darkBg/70 transition-all duration-300" onclick="toggleTodayTaskCompletion('${task.id}')">
                    <div class="flex items-start gap-3">
                        <div class="w-10 h-10 rounded-full bg-${colorClass}/20 flex items-center justify-center text-${colorClass} text-lg flex-shrink-0">
                            <i class="fa ${checkIcon}"></i>
                        </div>
                        <div class="flex-1 ${completedClass}">
                            <h4 class="text-white font-bold">${task.name}</h4>
                            <div class="flex items-center gap-2 mt-1">
                                <span class="bg-${colorClass}/20 text-${colorClass} px-2 py-1 rounded text-xs">${typeLabel}</span>
                                <span class="text-gray-400 text-xs">预计时长：${task.duration}分钟</span>
                                ${hasSubtasks ? `<span class="text-neonYellow text-xs"><i class="fa fa-tasks mr-1"></i>子任务：${subtasksCompletedCount}/${subtasksTotalCount}</span>` : ''}
                            </div>
                            ${timeText}
                            ${hasSubtasks ? `
                            <div class="mt-2 flex items-center gap-2">
                                <button class="bg-neonBlue/20 text-neonBlue px-3 py-1 rounded text-xs hover:bg-neonBlue/30 transition-all duration-300" onclick="event.stopPropagation(); showSubtaskModal('${task.id}')">
                                    <i class="fa fa-eye mr-1"></i>查看子任务
                                </button>
                            </div>
                            ` : ''}
                        </div>
                    </div>
                </div>
                `;
 					});

 					taskList.innerHTML = html;
 				}

 				// 显示弹窗
 				const modal = document.getElementById('todayTasksModal');
 				modal.classList.remove('hidden');
 			}

 			// 显示今日任务确认弹窗
 			function showTodayTaskConfirmation() {
 				const modal = document.getElementById('todayTaskConfirmationModal');
 				modal.classList.remove('hidden');
 			}

 			// 显示子任务查看弹窗
 			window.showSubtaskModal = function(taskId) {
 				const task = appState.periodicTasks.find(t => t.id === taskId);
 				if (!task) return;

 				const modal = document.getElementById('subtaskViewModal');
 				const subtaskList = document.getElementById('subtaskViewList');
 				subtaskList.innerHTML = '';

 				if (task.subtasks && task.subtasks.length > 0) {
 					task.subtasks.forEach((subtask, index) => {
 						const isLast = index === task.subtasks.length - 1;
 						const completedClass = subtask.completed ? 'bg-neonGreen/20 border-neonGreen' :
 							'bg-darkBg/50 border-neonPink/50';
 						const iconClass = subtask.completed ? 'fa-check-circle text-neonGreen' :
 							'fa-circle-o text-neonPink';
 						const lineColor = subtask.completed ? 'bg-neonGreen' : 'bg-neonPink/30';
 						const textColor = subtask.completed ? 'text-neonGreen' : 'text-neonPink';

 						const subtaskDiv = document.createElement('div');
 						subtaskDiv.className = 'relative mb-6';
 						subtaskDiv.innerHTML = `
                    <div class="flex items-center gap-4">
                        <div class="flex flex-col items-center">
                            <div class="w-16 h-16 rounded-full ${completedClass} border-2 flex items-center justify-center text-3xl transition-all duration-300 hover:scale-110 cursor-pointer" onclick="toggleSubtaskInView('${taskId}', ${index})">
                                <i class="fa ${iconClass}"></i>
                            </div>
                            ${!isLast ? `
                            <div class="w-2 h-12 ${lineColor} transition-all duration-300 relative" style="border-radius: 0 0 50% 50% / 50%;">
                                <div class="absolute inset-0 flex items-center justify-center">
                                    <div class="w-3 h-3 bg-darkBg rounded-full flex items-center justify-center">
                                        <i class="fa fa-check text-white text-xs"></i>
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                        <div class="flex-1 ${subtask.completed ? 'opacity-50 line-through' : ''}">
                            <div class="bg-darkBg/80 border-2 border-neonBlue/30 rounded-lg p-4">
                                <div class="flex items-center gap-2 mb-2">
                                    <span class="text-neonYellow font-bold">关卡 ${index + 1}</span>
                                    ${subtask.completed ? '<span class="bg-neonGreen text-white px-2 py-1 rounded text-xs">已完成</span>' : '<span class="bg-neonPink text-white px-2 py-1 rounded text-xs">进行中</span>'}
                                </div>
                                <p class="text-white">${subtask.text}</p>
                            </div>
                        </div>
                    </div>
                `;
 						subtaskList.appendChild(subtaskDiv);
 					});
 				} else {
 					subtaskList.innerHTML = `
                <div class="text-center py-10">
                    <p class="text-gray-400">该任务没有子任务</p>
                </div>
            `;
 				}

 				// 创建粒子特效
 				createSubtaskParticles();

 				// 重置按钮状态
 				document.getElementById('claimSubtaskRewardBtn').classList.remove('hidden');
 				document.getElementById('closeRewardSectionBtn').classList.add('hidden');

 				modal.classList.remove('hidden');
 			};

 			// 创建子任务粒子特效
 			function createSubtaskParticles() {
 				const container = document.getElementById('subtaskParticles');
 				if (!container) return;

 				container.innerHTML = '';

 				// 创建多个彩色粒子
 				const colors = ['#05D9E8', '#4EEC7B', '#FF2A6D', '#F7F99C'];
 				for (let i = 0; i < 20; i++) {
 					const particle = document.createElement('div');
 					const size = Math.random() * 10 + 5;
 					const color = colors[Math.floor(Math.random() * colors.length)];
 					const left = Math.random() * 100;
 					const top = Math.random() * 100;
 					const duration = Math.random() * 3 + 2;
 					const delay = Math.random() * 2;

 					particle.style.cssText = `
                position: absolute;
                left: ${left}%;
                top: ${top}%;
                width: ${size}px;
                height: ${size}px;
                background: ${color};
                border-radius: 50%;
                opacity: 0.6;
                animation: particle-float ${duration}s ease-in-out infinite;
                animation-delay: ${delay}s;
                box-shadow: 0 0 10px ${color};
            `;

 					container.appendChild(particle);
 				}
 			}

 			// 切换子任务查看弹窗中的完成状态
 			window.toggleSubtaskInView = function(taskId, subtaskIndex) {
 				const task = appState.periodicTasks.find(t => t.id === taskId);
 				if (!task || !task.subtasks) return;

 				const subtask = task.subtasks[subtaskIndex];
 				if (!subtask) return;

 				subtask.completed = !subtask.completed;

 				savePeriodicTasks();

 				// 更新进度条和奖励区域
 				updateSubtaskProgress(task);

 				showSubtaskModal(taskId);
 			};

 			// 更新子任务进度和奖励
 			function updateSubtaskProgress(task) {
 				if (!task.subtasks || task.subtasks.length === 0) return;

 				const completedCount = task.subtasks.filter(s => s.completed).length;
 				const totalCount = task.subtasks.length;
 				const progress = (completedCount / totalCount) * 100;

 				// 更新进度文本
 				const progressText = document.getElementById('subtaskProgressText');
 				if (progressText) {
 					progressText.textContent = `完成进度：${completedCount}/${totalCount}`;
 				}

 				// 更新进度条
 				const progressBar = document.getElementById('subtaskProgressBar');
 				if (progressBar) {
 					progressBar.style.width = `${progress}%`;
 				}

 				// 显示或隐藏奖励区域
 				const rewardSection = document.getElementById('subtaskRewardSection');
 				if (rewardSection) {
 					if (completedCount === totalCount && totalCount > 0) {
 						rewardSection.classList.remove('hidden');

 						// 计算奖励
					const baseReward = 10;
					const bonusReward = Math.floor(Math.random() * 10) + 1;
					const totalReward = baseReward + bonusReward;

					document.getElementById('bonusReward').textContent = `+${totalReward}`;
 					} else {
 						rewardSection.classList.add('hidden');
 					}
 				}
 			};

 			// 领取子任务奖励
 			document.getElementById('claimSubtaskRewardBtn')?.addEventListener('click', () => {
 				const task = appState.periodicTasks.find(t => t.subtasks && t.subtasks.length > 0);
 				if (!task) return;

 				const completedCount = task.subtasks.filter(s => s.completed).length;
 				const totalCount = task.subtasks.length;

 				if (completedCount === totalCount && totalCount > 0) {
 					const baseReward = 10;
 					const bonusReward = Math.floor(Math.random() * 10) + 1;
 					const totalReward = baseReward + bonusReward;

 					appState.rewardPoints += totalReward;
 					saveRewardPoints();
 					updateRewardPointsDisplay();

 					showToast(`恭喜！获得${totalReward}积分奖励！`);

 					// 隐藏奖励按钮，显示关闭按钮
 					document.getElementById('claimSubtaskRewardBtn').classList.add('hidden');
 					document.getElementById('closeRewardSectionBtn').classList.remove('hidden');
 				}
 			});

 			// 关闭奖励区域按钮
 			document.getElementById('closeRewardSectionBtn')?.addEventListener('click', () => {
 				const modal = document.getElementById('subtaskViewModal');
 				modal.classList.add('hidden');
 			});

 			// 关闭子任务查看弹窗
 			document.getElementById('closeSubtaskViewBtn')?.addEventListener('click', () => {
 				const modal = document.getElementById('subtaskViewModal');
 				modal.classList.add('hidden');
 			});

 			// 今日任务确认弹窗事件处理
 			document.getElementById('todayTaskYesBtn')?.addEventListener('click', () => {
 				const modal = document.getElementById('todayTaskConfirmationModal');
 				modal.classList.add('hidden');

 				appState.rewardPoints += 1;
 				saveRewardPoints();
 				updateRewardPointsDisplay();

 				showToast('恭喜！获得1积分奖励！');

 				showTodayTasks();
 			});

 			document.getElementById('todayTaskNoBtn')?.addEventListener('click', () => {
 				const confirmModal = document.getElementById('todayTaskConfirmationModal');
 				confirmModal.classList.add('hidden');

 				const giveUpModal = document.getElementById('giveUpConfirmationModal');
 				giveUpModal.classList.remove('hidden');
 			});

 			// 放弃确认弹窗事件处理
 			document.getElementById('giveUpConfirmBtn')?.addEventListener('click', () => {
 				const modal = document.getElementById('giveUpConfirmationModal');
 				modal.classList.add('hidden');

 				showScreen('startScreen');
 			});

 			document.getElementById('giveUpContinueBtn')?.addEventListener('click', () => {
 				const modal = document.getElementById('giveUpConfirmationModal');
 				modal.classList.add('hidden');

 				const confirmModal = document.getElementById('todayTaskConfirmationModal');
 				confirmModal.classList.remove('hidden');
 			});

 			// 切换今日任务完成状态
 			window.toggleTodayTaskCompletion = function(taskId) {
 				const task = appState.periodicTasks.find(t => t.id === taskId);
 				if (!task) return;

 				const todayStr = new Date().toLocaleDateString();

 				if (!task.completedDates) {
 					task.completedDates = [];
 				}

 				const index = task.completedDates.indexOf(todayStr);
 				if (index > -1) {
 					task.completedDates.splice(index, 1);
 					showToast('任务已标记为未完成');
 				} else {
 					task.completedDates.push(todayStr);
 					showToast('任务已完成！');
 				}

 				savePeriodicTasks();
 				showTodayTasks();
 			};

 			// 奖励模块页面返回按钮
 			document.getElementById('backFromRewardModuleBtn')?.addEventListener('click', () => {
 				showScreen('startScreen');
 			});

 			// 音效开关按钮
 			document.getElementById('toggleSoundBtn')?.addEventListener('click', toggleSound);

 			// 添加周期任务按钮
 			document.getElementById('addPeriodicTaskBtn')?.addEventListener('click', () => {
 				document.getElementById('editPeriodicTaskId').value = '';
 				document.getElementById('editPeriodicTaskName').value = '';
 				document.getElementById('editPeriodicTaskType').value = 'daily';
 				document.getElementById('editPeriodicTaskDuration').value = '30';
 				document.getElementById('editPeriodicTaskDifficulty').value = 'medium';
 				document.getElementById('editPeriodicTaskRelevant').value = '';
 				document.getElementById('editPeriodicTaskReward').value = '';
 				document.getElementById('editPeriodicTaskModalTitle').innerHTML =
 					'<i class="fa fa-plus-circle mr-2"></i>添加周期任务';
 				document.getElementById('confirmEditPeriodicTaskBtn').textContent = '确认添加';
 				const modal = document.getElementById('editPeriodicTaskModal');
 				modal.classList.remove('hidden', 'scale-out');
 				modal.classList.add('scale-in');

 				// 清空子任务
 				renderPeriodicSubtasks([]);

 				// 初始化日期选择器
 				initializeDateSelectors();

 				// 显示默认日期设置
 				updateDateSetting('daily');
 			});

 			// 周期类型切换
 			document.getElementById('editPeriodicTaskType')?.addEventListener('change', function() {
 				const taskType = this.value;
 				updateDateSetting(taskType);
 			});

 			// 初始化日期选择器
 			function initializeDateSelectors() {
 				// 设置具体日期输入框的最小值为今天
 				const today = new Date().toISOString().split('T')[0];
 				const specificDateInput = document.getElementById('specificDateInput');
 				if (specificDateInput) {
 					specificDateInput.min = today;
 				}
 			}

 			// 更新日期设置显示
 			function updateDateSetting(taskType) {
 				// 隐藏所有日期设置
 				document.querySelectorAll('.date-setting').forEach(el => el.classList.add('hidden'));

 				// 根据周期类型显示对应的日期设置
 				if (taskType === 'daily') {
 					document.getElementById('dailyDateSetting').classList.remove('hidden');
 				} else if (taskType === 'weekly') {
 					document.getElementById('weeklyDateSetting').classList.remove('hidden');
 				} else if (taskType === 'specific') {
 					document.getElementById('specificDateSetting').classList.remove('hidden');
 				}
 			}

 			// 添加周期任务子任务按钮
 			document.getElementById('addPeriodicSubtaskBtn')?.addEventListener('click', () => {
 				const input = document.getElementById('newPeriodicSubtaskInput');
 				const text = input.value.trim();
 				if (!text) return;

 				// 获取当前子任务
 				const container = document.getElementById('periodicSubtaskContainer');
 				const existingSubtasks = [];
 				const subtaskElements = container.querySelectorAll('.periodic-subtask-item');

 				subtaskElements.forEach(el => {
 					const textEl = el.querySelector('.periodic-subtask-text');
 					const checkboxEl = el.querySelector('.periodic-subtask-checkbox');
 					if (textEl && checkboxEl) {
 						existingSubtasks.push({
 							text: textEl.textContent,
 							completed: checkboxEl.checked
 						});
 					}
 				});

 				// 添加新子任务
 				existingSubtasks.push({
 					text: text,
 					completed: false
 				});

 				// 重新渲染子任务
 				renderPeriodicSubtasks(existingSubtasks);

 				// 清空输入框
 				input.value = '';
 			});

 			// 提交周期任务表单
 			document.getElementById('editPeriodicTaskForm')?.addEventListener('submit', function(e) {
 				e.preventDefault();

 				const taskId = document.getElementById('editPeriodicTaskId').value;

 				// 获取子任务
 				const container = document.getElementById('periodicSubtaskContainer');
 				const subtasks = [];
 				const subtaskElements = container.querySelectorAll('.periodic-subtask-item');

 				subtaskElements.forEach(el => {
 					const textEl = el.querySelector('.periodic-subtask-text');
 					const checkboxEl = el.querySelector('.periodic-subtask-checkbox');
 					if (textEl && checkboxEl) {
 						subtasks.push({
 							text: textEl.textContent,
 							completed: checkboxEl.checked
 						});
 					}
 				});

 				// 获取具体日期设置
 				const taskType = document.getElementById('editPeriodicTaskType').value;
 				let specificDates = null;

 				if (taskType === 'weekly') {
 					const checkboxes = document.querySelectorAll('.weekly-date-checkbox:checked');
 					specificDates = Array.from(checkboxes).map(cb => parseInt(cb.value));
 				} else if (taskType === 'specific') {
 					const dateInput = document.getElementById('specificDateInput').value;
 					const timeInput = document.getElementById('specificTimeInput').value;
 					if (dateInput) {
 						specificDates = {
 							date: dateInput,
 							time: timeInput || null
 						};
 					}
 				}

 				const taskData = {
 					name: document.getElementById('editPeriodicTaskName').value,
 					type: document.getElementById('editPeriodicTaskType').value,
 					duration: parseInt(document.getElementById('editPeriodicTaskDuration').value),
 					difficulty: document.getElementById('editPeriodicTaskDifficulty').value,
 					relevant: document.getElementById('editPeriodicTaskRelevant').value,
 					reward: document.getElementById('editPeriodicTaskReward').value,
 					subtasks: subtasks,
 					specificDates: specificDates
 				};

 				if (taskId) {
 					// 更新现有任务
 					updatePeriodicTask(taskId, taskData);
 				} else {
 					// 添加新任务
 					addPeriodicTask(taskData);
 				}

 				const modal = document.getElementById('editPeriodicTaskModal');
 				modal.classList.remove('scale-in');
 				modal.classList.add('scale-out');
 				setTimeout(() => {
 					modal.classList.add('hidden');
 				}, 300);
 			});

 			// 周期类型切换按钮
 			document.querySelectorAll('.periodic-tab-btn').forEach(btn => {
 				btn.addEventListener('click', function() {
 					// 更新按钮样式
 					document.querySelectorAll('.periodic-tab-btn').forEach(b => {
 						b.classList.remove('active', 'bg-neonBlue', 'text-darkBg');
 						b.classList.add('bg-gray-700', 'text-white');
 					});
 					this.classList.remove('bg-gray-700', 'text-white');
 					this.classList.add('active', 'bg-neonBlue', 'text-darkBg');

 					// 更新筛选类型
 					appState.currentPeriodFilter = this.getAttribute('data-period');
 					renderPeriodicTasks();
 				});
 			});

 			// SMART任务-从周期任务快速填充按钮
 			document.getElementById('quickFillFromPeriodicBtn')?.addEventListener('click', () => {
 				showPeriodicTaskSelectModal();
 			});

 			// 关闭周期任务选择弹窗
 			document.getElementById('closePeriodicSelectModalBtn')?.addEventListener('click', () => {
 				document.getElementById('periodicTaskSelectModal').classList.add('hidden');
 			});

 			// 取消编辑周期任务
 			document.getElementById('cancelEditPeriodicTaskBtn')?.addEventListener('click', () => {
 				const modal = document.getElementById('editPeriodicTaskModal');
 				modal.classList.remove('scale-in');
 				modal.classList.add('scale-out');
 				setTimeout(() => {
 					modal.classList.add('hidden');
 				}, 300);
 			});

 			// 周期任务选择弹窗-类型筛选
 			document.querySelectorAll('.periodic-select-tab-btn').forEach(btn => {
 				btn.addEventListener('click', function() {
 					// 更新按钮样式
 					document.querySelectorAll('.periodic-select-tab-btn').forEach(b => {
 						b.classList.remove('active', 'bg-neonBlue', 'text-darkBg');
 						b.classList.add('bg-gray-700', 'text-white');
 					});
 					this.classList.remove('bg-gray-700', 'text-white');
 					this.classList.add('active', 'bg-neonBlue', 'text-darkBg');

 					// 更新筛选类型
 					const filterType = this.getAttribute('data-period');
 					renderPeriodicTaskSelectList(filterType);
 				});
 			});

 			// 奖励模块-普通转盘按钮
 			document.getElementById('spinNormalWheelBtn')?.addEventListener('click', () => {
 				spinNormalWheel();
 			});

 			// 奖励模块-超级转盘按钮
 			document.getElementById('spinSuperWheelBtn')?.addEventListener('click', () => {
 				spinSuperWheel();
 			});

 			// 奖励模块-最终转盘按钮
 			document.getElementById('spinUltimateWheelBtn')?.addEventListener('click', () => {
 				spinUltimateWheel();
 			});

 			// 奖励管理-添加普通奖励按钮
 			document.getElementById('addNormalRewardBtn')?.addEventListener('click', () => {
 				// 简单实现：直接添加一个默认奖励
 				const defaultReward = {
 					name: '新奖励',
 					icon: 'fa-gift',
 					color: 'neonPink',
 					probability: 1
 				};
 				addWheelReward(defaultReward, 'normal');
 			});

 			// 奖励管理-添加超级奖励按钮
 			document.getElementById('addSuperRewardBtn')?.addEventListener('click', () => {
 				// 简单实现：直接添加一个默认奖励
 				const defaultReward = {
 					name: '新超级奖励',
 					icon: 'fa-star',
 					color: 'neonYellow',
 					probability: 1
 				};
 				addWheelReward(defaultReward, 'super');
 			});

 			// 奖励管理-添加最终奖励按钮
 			document.getElementById('addUltimateRewardBtn')?.addEventListener('click', () => {
 				// 简单实现：直接添加一个默认奖励
 				const defaultReward = {
 					name: '新最终奖励',
 					icon: 'fa-gem',
 					color: 'neonBlue',
 					probability: 1
 				};
 				addWheelReward(defaultReward, 'ultimate');
 			});

 			// 编辑奖励表单提交
 			document.getElementById('editRewardForm')?.addEventListener('submit', function(e) {
 				e.preventDefault();
 				saveWheelRewardChanges();
 			});

 			// 取消编辑奖励
 			document.getElementById('cancelEditRewardBtn')?.addEventListener('click', () => {
 				const modal = document.getElementById('editRewardModal');
 				modal.classList.remove('scale-in');
 				modal.classList.add('scale-out');
 				setTimeout(() => {
 					modal.classList.add('hidden');
 				}, 300);
 			});

 			// 空记录-开始任务
 			document.getElementById('emptyRecordStartBtn')?.addEventListener('click', () => {
 				showScreen('startScreen');
 				document.getElementById('customTaskModal').classList.remove('hidden');
 				updateCustomTaskHistoryRelevantOptions();
 			});

 			// 空卡片-添加按钮
 			document.getElementById('emptyCardAddBtn')?.addEventListener('click', () => {
 				openEditCardModal();
 			});

 			// 添加新卡片按钮
 			document.getElementById('addNewCardBtn')?.addEventListener('click', () => {
 				openEditCardModal();
 			});

 			// 取消编辑卡片
 			document.getElementById('cancelEditCardBtn')?.addEventListener('click', closeEditCardModal);

 			// 计时器控制
			document.getElementById('startTimerBtn')?.addEventListener('click', startTimer);
			document.getElementById('pauseTimerBtn')?.addEventListener('click', () => {
				if (appState.timerInterval) {
					document.getElementById('pauseConfirmationModal').classList.remove('hidden');
				}
			});
			document.getElementById('completeTaskBtn')?.addEventListener('click', () => {
				if (appState.timerInterval) {
					document.getElementById('completeConfirmationModal').classList.remove('hidden');
				}
			});

			// 暂停确认弹窗事件
			document.getElementById('pauseConfirmBtn')?.addEventListener('click', () => {
				document.getElementById('pauseConfirmationModal').classList.add('hidden');
				pauseTimer();
			});

			document.getElementById('pauseCancelBtn')?.addEventListener('click', () => {
				document.getElementById('pauseConfirmationModal').classList.add('hidden');
			});

			// 完成确认弹窗事件
			document.getElementById('completeConfirmBtn')?.addEventListener('click', () => {
				document.getElementById('completeConfirmationModal').classList.add('hidden');
				completeTask();
			});

			document.getElementById('completeCancelBtn')?.addEventListener('click', () => {
				document.getElementById('completeConfirmationModal').classList.add('hidden');
			});

 			// 换任务按钮
 			document.getElementById('switchTaskBtn')?.addEventListener('click', () => {
 				pauseTimer();

 				// 填充上一个任务信息
 				if (appState.currentTask) {
 					document.getElementById('lastTaskName').textContent = appState.currentTask.name;

 					let duration = '未开始';
 					if (appState.currentTaskStartTime) {
 						const timeDiff = (new Date().getTime() - appState.currentTaskStartTime) / 1000;
 						duration = `${Math.round((timeDiff / 60) * 10) / 10}分钟`;
 					}
 					document.getElementById('lastTaskDuration').textContent = `本次耗时：${duration}`;
 				}

 				// 加载SMART任务关联选项
 				loadSmartTaskLinkOptions('smartTaskLinkSelect');

 				// 显示切换弹窗
 				document.getElementById('taskSwitchModal').classList.remove('hidden');
 				setTimeout(() => {
 					document.getElementById('taskSwitchModal').classList.remove('scale-out');
 					document.getElementById('taskSwitchModal').classList.add('scale-in');
 				}, 10);
 			});

 			// 取消切换任务
 			document.getElementById('cancelSwitchBtn')?.addEventListener('click', () => {
 				document.getElementById('taskSwitchModal').classList.remove('scale-in');
 				document.getElementById('taskSwitchModal').classList.add('scale-out');

 				setTimeout(() => {
 					document.getElementById('taskSwitchModal').classList.add('hidden');
 				}, 300);
 			});

 			// 确认切换任务
 			document.getElementById('confirmSwitchBtn')?.addEventListener('click', () => {
 				const taskName = document.getElementById('nextTaskName').value.trim();
 				const taskTime = parseInt(document.getElementById('nextTaskTime').value);
 				const taskType = document.getElementById('nextTaskType').value;
 				const taskFeeling = document.getElementById('taskFeeling').value.trim();
 				const linkSmartTask = document.getElementById('linkSmartTask').checked;
 				const linkedSmartTaskId = document.getElementById('smartTaskLinkSelect').value;

 				if (!taskName || isNaN(taskTime) || taskTime < 1) {
 					showToast('请填写有效的任务名称和时长！');
 					return;
 				}
 				saveTaskType(taskType);

 				// ===== 新增：保存当前任务记录 =====
 				if (appState.currentTask && appState.currentTaskStartTime) {
 					// 将感受赋值给当前任务
 					appState.currentTask.feeling = taskFeeling;

 					// 更新统计数据
 					appState.totalComplete++;
 					appState.rewardPoints += appState.currentTask.points || 50;
 					calculateStreak();

 					// 保存到本地存储
 					localStorage.setItem('dopamineTotalComplete', appState.totalComplete);
 					localStorage.setItem('dopamineRewardPoints', appState.rewardPoints);

 					// 保存任务记录
 					saveTaskRecord(appState.currentTask);

 					// 更新UI
					document.getElementById('totalComplete').textContent = appState.totalComplete;
					document.getElementById('streakDays').textContent = appState.streakDays;

 					// 检查成就
 					checkAchievements();

 					showToast(`已完成：${appState.currentTask.name}，积分+${appState.currentTask.points || 50}`, 'success');
 				}

 				// 构建新任务
 				const newTask = {
 					name: taskName,
 					desc: `自定义任务：${taskName}`,
 					time: taskTime,
 					difficulty: 'medium',
 					points: Math.min(50 + (taskTime - 5) * 2, 200),
 					isSmart: false,
 					type: taskType,
 					linkedSmartTaskId: linkSmartTask ? linkedSmartTaskId : null
 				};

 				// 关闭切换弹窗
 				document.getElementById('taskSwitchModal').classList.remove('scale-in');
 				document.getElementById('taskSwitchModal').classList.add('scale-out');

 				setTimeout(() => {
 					document.getElementById('taskSwitchModal').classList.add('hidden');
 					// 设置并开始新任务
 					setCurrentTask(newTask);
 				}, 300);
 			});

 			// 关联SMART任务复选框
 			document.getElementById('linkSmartTask')?.addEventListener('change', function() {
 				if (this.checked) {
 					document.getElementById('smartTaskLinkSelect').classList.remove('hidden');
 				} else {
 					document.getElementById('smartTaskLinkSelect').classList.add('hidden');
 				}
 			});

 			// 历史关联快捷选择
 			document.getElementById('historyRelevantSelect')?.addEventListener('change', function() {
 				if (this.value) {
 					document.getElementById('smartRelevant').value = this.value;
 				} else {
 					document.getElementById('smartRelevant').value = '';
 				}

 				// 将历史选择器的值同步到图表筛选器，实现与图表的关联
 				const relevantFilter = document.getElementById('relevantFilterSelect');
 				if (relevantFilter) {
 					relevantFilter.value = this.value;

 					// 触发筛选事件，更新图表
 					if (typeof renderTaskRecords === 'function') {
 						renderTaskRecords(
 							document.getElementById('filterSelect')?.value || 'all',
 							this.value,
 							document.getElementById('startDateFilter')?.value || '',
 							document.getElementById('endDateFilter')?.value || ''
 						);
 					}
 				}
 			});

 			// 清空关联输入
 			document.getElementById('clearRelevantBtn')?.addEventListener('click', function() {
 				document.getElementById('historyRelevantSelect').value = '';
 				document.getElementById('smartRelevant').value = '';

 				// 将清空操作同步到图表筛选器，实现与图表的关联
 				const relevantFilter = document.getElementById('relevantFilterSelect');
 				if (relevantFilter) {
 					relevantFilter.value = '';

 					// 触发筛选事件，更新图表
 					if (typeof renderTaskRecords === 'function') {
 						renderTaskRecords(
 							document.getElementById('filterSelect')?.value || 'all',
 							'',
 							document.getElementById('startDateFilter')?.value || '',
 							document.getElementById('endDateFilter')?.value || ''
 						);
 					}
 				}
 			});

 			// 普通任务历史关联快捷选择
 			document.getElementById('customTaskHistoryRelevantSelect')?.addEventListener('change', function() {
 				if (this.value) {
 					document.getElementById('taskSmartAssociation').value = this.value;
 				} else {
 					document.getElementById('taskSmartAssociation').value = '';
 				}
 			});

 			// 清空普通任务关联输入
 			document.getElementById('clearCustomTaskRelevantBtn')?.addEventListener('click', function() {
 				document.getElementById('customTaskHistoryRelevantSelect').value = '';
 				document.getElementById('taskSmartAssociation').value = '';
 			});

 			// 子任务管理功能
 			let subtaskCounter = 0;

 			// 添加子任务
 			function addSubtask(text = '', completed = false) {
 				const container = document.getElementById('subtaskContainer');
 				const subtaskDiv = document.createElement('div');
 				subtaskDiv.className =
 					'subtask-item flex items-center gap-2 bg-darkBg/60 border border-neonPink/30 rounded-lg p-2';

 				const checkbox = document.createElement('input');
 				checkbox.type = 'checkbox';
 				checkbox.className =
 					'subtask-checkbox w-5 h-5 bg-darkBg border-2 border-neonPink rounded focus:ring-neonYellow cursor-pointer';
 				checkbox.checked = completed;

 				const textSpan = document.createElement('span');
 				textSpan.className = 'subtask-text flex-1 text-white text-sm';
 				textSpan.textContent = text || `子任务 ${subtaskCounter + 1}`;

 				const deleteBtn = document.createElement('button');
 				deleteBtn.type = 'button';
 				deleteBtn.className = 'text-neonPink hover:text-red-500 transition-colors px-2';
 				deleteBtn.innerHTML = '<i class="fa fa-times"></i>';

 				subtaskDiv.appendChild(checkbox);
 				subtaskDiv.appendChild(textSpan);
 				subtaskDiv.appendChild(deleteBtn);
 				container.appendChild(subtaskDiv);

 				subtaskCounter++;

 				// 删除子任务事件
 				deleteBtn.addEventListener('click', function() {
 					subtaskDiv.remove();
 				});

 				// 复选框变化事件
 				checkbox.addEventListener('change', function() {
 					textSpan.style.textDecoration = this.checked ? 'line-through' : 'none';
 					textSpan.style.opacity = this.checked ? '0.5' : '1';
 				});
 			}

 			// 渲染SMART任务子任务
 			function renderSubtasks(subtasks) {
 				const container = document.getElementById('subtaskContainer');
 				if (!container) return;

 				// 清空现有子任务
 				container.innerHTML = '';
 				// 重置子任务计数器
 				subtaskCounter = 0;

 				// 添加子任务
 				subtasks.forEach(subtask => {
 					addSubtask(subtask.text, subtask.completed);
 				});
 			}

 			// 添加子任务按钮事件
 			document.getElementById('addSubtaskBtn')?.addEventListener('click', function() {
 				const input = document.getElementById('newSubtaskInput');
 				const text = input.value.trim();
 				if (text) {
 					addSubtask(text);
 					input.value = '';
 				} else {
 					showToast('请输入子任务内容！', 'error');
 				}
 			});

 			// 回车键添加子任务
 			document.getElementById('newSubtaskInput')?.addEventListener('keypress', function(e) {
 				if (e.key === 'Enter') {
 					e.preventDefault();
 					document.getElementById('addSubtaskBtn').click();
 				}
 			});

 			// 自定义任务表单提交
 			document.getElementById('customTaskForm')?.addEventListener('submit', (e) => {
 				e.preventDefault();

 				const taskName = document.getElementById('taskName').value.trim();
 				const taskDesc = document.getElementById('taskDesc').value.trim();
 				const taskTime = parseInt(document.getElementById('taskTime').value);
 				const taskDifficulty = document.getElementById('taskDifficulty').value;
 				const taskSmartAssociation = document.getElementById('taskSmartAssociation').value.trim();

 				if (!taskName || !taskDesc || isNaN(taskTime) || taskTime < 1) {
 					showToast('请填写完整的任务信息！');
 					return;
 				}

 				// 计算积分（基础50分 + 时长奖励，最高200分）
 				let points = 50;
 				if (taskDifficulty === 'medium') points = 50 + (taskTime - 5) * 2;
 				if (taskDifficulty === 'hard') points = 50 + (taskTime - 5) * 3;
 				points = Math.min(points, 200);

 				// 构建任务对象
 				const newTask = {
 					name: taskName,
 					desc: taskDesc,
 					time: taskTime,
 					difficulty: taskDifficulty,
 					points: points,
 					isSmart: false,
 					smartAssociation: taskSmartAssociation
 				};

 				// 关闭弹窗并开始任务
 				document.getElementById('customTaskModal').classList.add('hidden');
 				setCurrentTask(newTask);
 			});

 			// SMART任务表单提交
 			// 渲染周期任务选项
 			function renderPeriodicTaskOptions() {
 				const select = document.getElementById('linkedPeriodicTask');
 				if (!select) return;

 				// 清空现有选项（保留第一个"不关联周期任务"选项）
 				const firstOption = select.querySelector('option[value=""]');
 				select.innerHTML = '';
 				if (firstOption) {
 					select.appendChild(firstOption);
 				}

 				// 添加周期任务选项
 				appState.periodicTasks.forEach(task => {
 					const option = document.createElement('option');
 					option.value = task.id;
 					const typeLabel = task.type === 'daily' ? '每日' : task.type === 'weekly' ? '每周' : task.type ===
 						'monthly' ? '每月' : '每年';
 					option.textContent = `${task.name}（${typeLabel}）`;
 					select.appendChild(option);
 				});
 			}

 			// 当SMART任务弹窗显示时，渲染周期任务选项
 			document.getElementById('smartTaskBtn')?.addEventListener('click', () => {
 				renderPeriodicTaskOptions();
 			});

 			document.getElementById('smartTaskForm')?.addEventListener('submit', (e) => {
 				e.preventDefault();

 				const specific = document.getElementById('smartSpecific').value.trim();
 				const achievable = document.getElementById('smartAchievable').value;
 				const relevant = document.getElementById('smartRelevant').value.trim();
 				const deadline = document.getElementById('smartDate').value;
 				const smartTime = parseInt(document.getElementById('smartTime').value);
 				const reward = document.getElementById('smartReward').value.trim();
 				const linkedPeriodicTaskId = document.getElementById('linkedPeriodicTask')?.value || '';

 				// 获取子任务列表
 				const subtasks = [];
 				const subtaskElements = document.querySelectorAll('.subtask-item');
 				subtaskElements.forEach((el, index) => {
 					const text = el.querySelector('.subtask-text').textContent;
 					const completed = el.querySelector('.subtask-checkbox').checked;
 					subtasks.push({
 						id: Date.now() + index,
 						text: text,
 						completed: completed
 					});
 				});

 				if (!specific || !relevant || !deadline || isNaN(smartTime) || smartTime < 5) {
 					showToast('请填写完整的SMART任务信息！');
 					return;
 				}

 				// 如果关联了周期任务，获取周期任务信息
 				let taskName = `SMART任务：${specific.substring(0, 10)}${specific.length > 10 ? '...' : ''}`;
 				let taskDesc = `SMART原则：${specific}`;
 				let taskTime = smartTime;

 				if (linkedPeriodicTaskId) {
 					const linkedTask = appState.periodicTasks.find(t => t.id === linkedPeriodicTaskId);
 					if (linkedTask) {
 						taskName = linkedTask.name;
 						taskDesc = `关联周期任务：${linkedTask.name}`;
 						taskTime = linkedTask.duration;
 					}
 				}

 				// 构建SMART任务
 				const smartTask = {
 					name: taskName,
 					desc: taskDesc,
 					time: taskTime,
 					difficulty: achievable,
 					points: Math.min(80 + (taskTime - 10) * 3, 300),
 					isSmart: true,
 					specific: specific,
 					subtasks: subtasks,
 					achievable: achievable,
 					relevant: relevant,
 					deadline: deadline,
 					reward: reward,
 					linkedPeriodicTaskId: linkedPeriodicTaskId || null
 				};

 				// 关闭弹窗并开始任务
 				document.getElementById('smartTaskModal').classList.add('hidden');
 				setCurrentTask(smartTask);
 			});

 			// 编辑卡片表单提交
 			document.getElementById('editCardForm')?.addEventListener('submit', (e) => {
 				e.preventDefault();

 				const cardId = document.getElementById('editCardId').value;
 				const cardName = document.getElementById('editCardName').value.trim();
 				const cardTime = parseInt(document.getElementById('editCardTime').value);
 				const cardType = document.getElementById('editCardType').value.trim();
 				const smartLink = document.getElementById('editCardSmartLink').value;

 				if (!cardName || isNaN(cardTime) || cardTime < 1) {
 					showToast('请填写有效的卡片名称和时长！');
 					return;
 				}

 				// 构建卡片数据
 				const cardData = {
 					name: cardName,
 					time: cardTime,
 					type: cardType,
 					linkedSmartTaskId: smartLink || null
 				};

 				if (cardId) {
 					cardData.id = cardId;
 				}

 				// 保存卡片
 				saveTaskCard(cardData);
 				saveTaskType(cardType);
 			});

 			// 记录页面-视图切换
 			document.getElementById('chartViewBtn')?.addEventListener('click', function() {
 				document.getElementById('chartViewBtn').classList.add('filter-active');
 				document.getElementById('timelineViewBtn').classList.remove('filter-active');
 				document.getElementById('chartView').classList.remove('hidden');
 				document.getElementById('timelineView').classList.add('hidden');

 				// 重新渲染图表，确保使用当前筛选条件
 				renderTaskRecords(
 					document.getElementById('filterSelect').value,
 					document.getElementById('relevantFilterSelect').value,
 					document.getElementById('startDateFilter').value,
 					document.getElementById('endDateFilter').value
 				);
 			});

 			document.getElementById('timelineViewBtn')?.addEventListener('click', function() {
 				document.getElementById('timelineViewBtn').classList.add('filter-active');
 				document.getElementById('chartViewBtn').classList.remove('filter-active');
 				document.getElementById('timelineView').classList.remove('hidden');
 				document.getElementById('chartView').classList.add('hidden');

 				// 重新渲染时间轴，确保使用当前筛选条件
 				renderTaskRecords(
 					document.getElementById('filterSelect').value,
 					document.getElementById('relevantFilterSelect').value,
 					document.getElementById('startDateFilter').value,
 					document.getElementById('endDateFilter').value
 				);
 			});

 			// 记录页面-筛选
 			document.getElementById('filterSelect')?.addEventListener('change', function() {
 				renderTaskRecords(
 					this.value,
 					document.getElementById('relevantFilterSelect').value,
 					document.getElementById('startDateFilter').value,
 					document.getElementById('endDateFilter').value
 				);
 			});

 			// 记录页面-排序
 			document.getElementById('sortSelect')?.addEventListener('change', function() {
 				renderTaskRecords(
 					document.getElementById('filterSelect').value,
 					document.getElementById('relevantFilterSelect').value,
 					document.getElementById('startDateFilter').value,
 					document.getElementById('endDateFilter').value
 				);
 			});

 			document.getElementById('relevantFilterSelect')?.addEventListener('change', function() {
 				renderTaskRecords(
 					document.getElementById('filterSelect').value,
 					this.value,
 					document.getElementById('startDateFilter').value,
 					document.getElementById('endDateFilter').value
 				);
 			});

 			// 为开始和结束日期选择器添加change事件监听
 			document.getElementById('startDateFilter')?.addEventListener('change', function() {
 				renderTaskRecords(
 					document.getElementById('filterSelect').value,
 					document.getElementById('relevantFilterSelect').value,
 					this.value,
 					document.getElementById('endDateFilter').value
 				);
 			});

 			document.getElementById('endDateFilter')?.addEventListener('change', function() {
 				renderTaskRecords(
 					document.getElementById('filterSelect').value,
 					document.getElementById('relevantFilterSelect').value,
 					document.getElementById('startDateFilter').value,
 					this.value
 				);
 			});

 			document.getElementById('dateFilterBtn')?.addEventListener('click', function() {
 				renderTaskRecords(
 					document.getElementById('filterSelect').value,
 					document.getElementById('relevantFilterSelect').value,
 					document.getElementById('startDateFilter').value,
 					document.getElementById('endDateFilter').value
 				);
 			});

 			// 在5+ App环境下保存文件的函数
 			function saveFileIn5PlusApp(content, fileName) {
 				try {
 					// 检查5+ API是否可用
 					if (!window.plus || !plus.io) {
 						throw new Error('5+ App文件系统API不可用');
 					}

 					// 确保文件名安全
 					const safeFileName = fileName.replace(/[^a-zA-Z0-9\u4e00-\u9fa5._-]/g, '_');

 					// 尝试多个目录，确保兼容性
 					const directories = [
 						plus.io.PUBLIC_DOWNLOADS,
 						plus.io.PUBLIC_DOCUMENTS,
 						plus.io.PRIVATE_DOC
 					];

 					let currentDirIndex = 0;

 					function tryNextDirectory() {
 						if (currentDirIndex >= directories.length) {
 							plus.nativeUI.toast('所有目录都无法保存文件');
 							console.error('所有目录都无法保存文件');
 							return;
 						}

 						const dirType = directories[currentDirIndex];
 						currentDirIndex++;

 						console.log('尝试保存到目录:', dirType, '文件名:', safeFileName);

 						try {
 							// 使用plus.io的resolveLocalFileSystemURL方法替代requestFileSystem
 							// 构建目录URL
 							let dirURL = '';
 							switch (dirType) {
 								case plus.io.PUBLIC_DOWNLOADS:
 									dirURL = '_downloads/';
 									break;
 								case plus.io.PUBLIC_DOCUMENTS:
 									dirURL = '_documents/';
 									break;
 								case plus.io.PRIVATE_DOC:
 									dirURL = '_doc/';
 									break;
 								default:
 									dirURL = '_doc/';
 							}

 							console.log('使用目录URL:', dirURL);

 							// 解析目录URL
 							plus.io.resolveLocalFileSystemURL(dirURL, function(dirEntry) {
 								console.log('目录解析成功:', dirEntry.fullPath);

 								// 在目录中创建或获取文件
 								dirEntry.getFile(safeFileName, {
 									create: true,
 									exclusive: false
 								}, function(fileEntry) {
 									// 获取文件路径
 									const filePath = fileEntry.fullPath;
 									const localURL = fileEntry.toURL();
 									console.log('文件路径:', filePath);
 									console.log('文件URL:', localURL);

 									// 创建文件写入器
 									fileEntry.createWriter(function(writer) {
 										let writeStep = 0; // 0: 初始状态, 1: truncate完成, 2: write完成

 										// 设置写入完成回调
 										writer.onwriteend = function() {
 											writeStep++;

 											if (writeStep === 1) {
 												// truncate完成，开始写入内容
 												try {
 													writer.write(content);
 												} catch (writeError) {
 													console.error('写入文件内容时发生错误:', JSON.stringify(
 														writeError));
 													tryNextDirectory();
 												}
 											} else if (writeStep === 2) {
 												// 所有写入操作完成
 												plus.nativeUI.toast('文件导出成功！保存在: ' + (dirType ===
 													plus.io.PUBLIC_DOWNLOADS ? 'Downloads' :
 													dirType === plus.io.PUBLIC_DOCUMENTS ?
 													'Documents' : '应用私有目录'));
 												console.log('文件导出成功:', safeFileName, '路径:',
 													filePath);

 												// 尝试打开文件
 												try {
 													plus.runtime.openFile(localURL, {}, function() {
 														console.log('文件打开成功');
 													}, function(error) {
 														console.log('文件打开失败:', JSON
 															.stringify(error));
 													});
 												} catch (e) {
 													console.log('尝试打开文件失败:', e);
 												}
 											}
 										};

 										// 设置写入错误回调
 										writer.onerror = function(error) {
 											console.error('文件写入失败:', JSON.stringify(error));
 											// 不显示toast，避免频繁提示
 											// 尝试下一个目录
 											tryNextDirectory();
 										};

 										// 确保writer处于文件开头
 										writer.seek(0);

 										// 清空文件并开始写入流程
 										try {
 											writer.truncate(0);
 										} catch (truncateError) {
 											console.error('清空文件时发生错误:', JSON.stringify(truncateError));
 											tryNextDirectory();
 										}
 									}, function(error) {
 										plus.nativeUI.toast('创建文件写入器失败');
 										console.error('创建文件写入器失败:', JSON.stringify(error));
 										// 尝试下一个目录
 										tryNextDirectory();
 									});
 								}, function(error) {
 									plus.nativeUI.toast('创建/获取文件失败');
 									console.error('创建/获取文件失败:', JSON.stringify(error));
 									// 尝试下一个目录
 									tryNextDirectory();
 								});
 							}, function(error) {
 								plus.nativeUI.toast('目录解析失败');
 								console.error('目录解析失败:', JSON.stringify(error));
 								// 尝试下一个目录
 								tryNextDirectory();
 							});
 						} catch (e) {
 							console.error('目录处理异常:', JSON.stringify(e));
 							tryNextDirectory();
 						}
 					}

 					// 开始尝试保存文件
 					tryNextDirectory();

 				} catch (error) {
 					plus.nativeUI.toast('导出失败: ' + (error.message || '未知错误'));
 					console.error('导出操作异常:', error);

 					// 最后尝试使用最基础的方式
 					try {
 						if (window.plus && plus.io) {
 							const path = '_downloads/' + fileName;
 							plus.io.resolveLocalFileSystemURL(path, function(entry) {
 								entry.remove(function() {
 									console.log('删除旧文件成功');
 									// 重新尝试保存
 									saveFileIn5PlusApp(content, fileName);
 								}, function() {
 									console.log('删除旧文件失败或不存在');
 								});
 							}, function() {
 								console.log('文件不存在');
 							});
 						}
 					} catch (e) {
 						console.error('最后尝试也失败了:', e);
 					}
 				}
 			}

 			// 导出记录
 			document.getElementById('exportRecordBtn')?.addEventListener('click', function() {
 				if (appState.taskRecords.length === 0) {
 					showToast('暂无记录可导出！');
 					return;
 				}

 				// 构建CSV内容
 				let csvContent = "任务名称,完成时间,计划时长,实际时长,积分,类型,是否SMART,感受\n";

 				appState.taskRecords.forEach(record => {
 					const row = [
 						`"${record.name}"`,
 						`"${record.completeTime}"`,
 						record.presetTime,
 						record.actualTime,
 						record.points,
 						`"${record.type === 'study' ? '学习' : record.type === 'rest' ? '休息' : record.type === 'work' ? '工作' : '生活杂事'}"`,
 						record.isSmart ? '是' : '否',
 						`"${record.feeling || ''}"`
 					].join(',');

 					csvContent += row + "\n";
 				});

 				// 生成文件名
 				const fileName = `多巴胺闯关记录_${new Date().toLocaleDateString().replace(/\//g, '-')}.csv`;

 				// 检查是否在5+ App环境
 				if (window.plus) {
 					// 使用5+ App文件系统保存
 					saveFileIn5PlusApp(csvContent, fileName);
 				} else {
 					// 网页环境下的下载方式
 					try {
 						const blob = new Blob([csvContent], {
 							type: 'text/csv;charset=utf-8;'
 						});
 						const url = URL.createObjectURL(blob);
 						const link = document.createElement('a');
 						link.setAttribute('href', url);
 						link.setAttribute('download', fileName);
 						link.style.display = 'none';
 						document.body.appendChild(link);
 						link.click();
 						document.body.removeChild(link);
 						showToast('文件导出成功！');
 					} catch (error) {
 						showToast('文件导出失败，请重试！');
 						console.error('网页下载失败:', error);
 					}
 				}
 			});

 			// 点击任务卡片设置按钮（切换弹窗）
 			document.getElementById('goToCardSettingBtn')?.addEventListener('click', function() {
 				document.getElementById('taskSwitchModal').classList.add('scale-out');
 				setTimeout(() => {
 					document.getElementById('taskSwitchModal').classList.add('hidden');
 					showScreen('cardSettingScreen');
 				}, 300);
 			});



 		


 			

 		








 			

 			// ===== IndexedDB和本地音乐管理 =====
 			let db = null;
 			let localMusic = null;
 			let localMusicList = [];
 			let bgMusic = null;
 			let bgMusic1 = null;
 			let bgMusic2 = null;
 			let bgMusic3 = null;
 			let bgMusic4 = null;
 			let bgMusic5 = null;
 			let bgMusicIcon = null;
 			let isMusicPlaying = false;
 			let currentBgMusic = 'bgMusic';

 			// 初始化IndexedDB
 			function initDB() {
 				return new Promise((resolve, reject) => {
 					const request = indexedDB.open('TimeManagementDB', 1);

 					request.onerror = () => {
 						console.error('IndexedDB打开失败:', request.error);
 						reject(request.error);
 					};

 					request.onsuccess = () => {
 						db = request.result;
 						console.log('IndexedDB打开成功');
 						resolve(db);
 					};

 					request.onupgradeneeded = (event) => {
 						const db = event.target.result;
 						if (!db.objectStoreNames.contains('music')) {
 							const objectStore = db.createObjectStore('music', {
 								keyPath: 'id',
 								autoIncrement: true
 							});
 							console.log('创建music objectStore');
 						}
 					};
 				});
 			}

 			// 加载本地音乐列表
 			async function loadLocalMusicList() {
 				console.log('开始加载本地音乐列表, db状态:', !!db);
 				if (!db) {
 					console.warn('IndexedDB未初始化，无法加载音乐列表');
 					return;
 				}

 				try {
 					const transaction = db.transaction(['music'], 'readonly');
 					const store = transaction.objectStore('music');
 					const request = store.getAll();

 					request.onsuccess = () => {
 						localMusicList = request.result || [];
 						console.log('加载到', localMusicList.length, '首本地音乐');
 						updateLocalMusicListUI();
 					};

 					request.onerror = () => {
 						console.error('加载本地音乐列表失败:', request.error);
 					};
 				} catch (error) {
 					console.error('加载本地音乐列表异常:', error);
 				}
 			}

 			// 更新本地音乐列表UI
 			function updateLocalMusicListUI() {
 				const container = document.getElementById('localMusicListContainer');
 				if (!container) return;

 				if (localMusicList.length === 0) {
 					container.innerHTML = '<p class="text-gray-400 text-center py-4">还没有导入本地音乐</p>';
 					return;
 				}

 				let html = '';
 				localMusicList.forEach((music, index) => {
 					const isPlaying = currentBgMusic === 'local' && localMusic && localMusic.id === music.id;
 					html += `
        <div class="bg-darkBg/50 border-2 border-neonPink/30 rounded-lg p-4 mb-3 transition-all duration-300 hover:border-neonPink/60" data-music-id="${music.id}">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3 flex-1" onclick="playLocalMusic(${music.id})">
                    <i class="fa ${isPlaying ? 'fa-pause' : 'fa-play'} text-neonPink text-xl"></i>
                    <div class="flex-1">
                        <h3 class="text-white font-bold text-lg truncate">${music.name}</h3>
                        <p class="text-gray-400 text-sm">${music.size}</p>
                    </div>
                </div>
                <button onclick="deleteLocalMusic(${music.id})" class="text-red-500 hover:text-red-400 transition-colors">
                    <i class="fa fa-trash text-xl"></i>
                </button>
            </div>
        </div>
        `;
 				});

 				container.innerHTML = html;
 			}

 			// 格式化文件大小
 			function formatFileSize(bytes) {
 				if (bytes === 0) return '0 Bytes';
 				const k = 1024;
 				const sizes = ['Bytes', 'KB', 'MB', 'GB'];
 				const i = Math.floor(Math.log(bytes) / Math.log(k));
 				return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
 			}

 			// 播放本地音乐
 			window.playLocalMusic = function(musicId) {
 				if (!db) return;

 				const transaction = db.transaction(['music'], 'readonly');
 				const store = transaction.objectStore('music');
 				const request = store.get(musicId);

 				request.onsuccess = () => {
 					const musicData = request.result;
 					if (!musicData) return;

 					// 停止所有音乐
 					[bgMusic, bgMusic1, bgMusic2, bgMusic3, bgMusic4, bgMusic5].forEach(music => {
 						music.pause();
 						music.currentTime = 0;
 					});

 					if (localMusic) {
 						localMusic.pause();
 						localMusic.currentTime = 0;
 					}

 					// 播放本地音乐
 					localMusic = new Audio(musicData.data);
 					localMusic.id = musicId;
 					localMusic.loop = true;
 					localMusic.play().catch(err => console.log('播放失败:', err));

 					currentBgMusic = 'local';
 					isMusicPlaying = true;
 					bgMusicIcon.className = 'fa fa-pause';

 					// 保存选择
 					localStorage.setItem('selectedBgMusic', 'local');
 					localStorage.setItem('selectedLocalMusicId', musicId);

 					// 更新UI
 					updateLocalMusicListUI();
 				};
 			};

 			// 删除本地音乐
 			window.deleteLocalMusic = function(musicId) {
 				if (!confirm('确定要删除这首音乐吗？')) return;
 				if (!db) return;

 				const transaction = db.transaction(['music'], 'readwrite');
 				const store = transaction.objectStore('music');
 				const request = store.delete(musicId);

 				request.onsuccess = () => {
 					loadLocalMusicList();
 					alert('音乐删除成功！');
 				};

 				request.onerror = () => {
 					alert('音乐删除失败！');
 				};
 			};

 			// 恢复本地音乐
 			function restoreLocalMusic() {
 				const savedMusicId = localStorage.getItem('selectedLocalMusicId');
 				if (savedMusicId && db) {
 					const transaction = db.transaction(['music'], 'readonly');
 					const store = transaction.objectStore('music');
 					const request = store.get(parseInt(savedMusicId));

 					request.onsuccess = () => {
 						const musicData = request.result;
 						if (musicData) {
 							localMusic = new Audio(musicData.data);
 							localMusic.id = musicData.id;
 							localMusic.loop = true;

 							// 停止所有音乐
 							[bgMusic, bgMusic1, bgMusic2, bgMusic3, bgMusic4, bgMusic5].forEach(music => {
 								music.pause();
 								music.currentTime = 0;
 							});

 							// 播放本地音乐
 							localMusic.play().catch(err => console.log('播放失败:', err));
 							currentBgMusic = 'local';
 							isMusicPlaying = true;
 							bgMusicIcon.className = 'fa fa-pause';
 						}
 					};
 				}
 			}

 			// 页面加载完成后初始化
 			// 5+ App环境初始化（必须等plus ready）
 			// 5+ App环境初始化（必须等plus ready）
 			function initApp() {
 				initStats();
 				initTaskCards();
 				initEventListeners(); // 确保事件监听器被正确调用

 				// 初始化粒子特效
 				createParticles();

 				// 初始化奖励值显示
 				updateRewardPointsDisplay();

 				// 初始化奖励管理功能
 				loadWheelRewards();
 				renderNormalRewardsList();
 				renderSuperRewardsList();
 				renderWheelSectors();
 				updateWheelTexts();

 				// 初始化音效设置
 				loadSoundSettings();

 				// 初始化IndexedDB和本地音乐
 				initDB().then(() => {
 					loadLocalMusicList();
 				}).catch(err => {
 					console.error('IndexedDB初始化失败:', err);
 				});

 				// ===== 新增：首次用户显示功能介绍 =====
 				const hasShownIntro = localStorage.getItem('dopamineHasShownIntro');
 				if (!hasShownIntro) {
 					setTimeout(() => {
 						document.getElementById('versionInfoModal').classList.remove('hidden');
 						localStorage.setItem('dopamineHasShownIntro', 'true');
 					}, 500);
 				}

 			
 			}



 			// 页面加载完成后初始化
 			document.addEventListener('DOMContentLoaded', () => {
 				// 确保DOM完全加载后再初始化
 				setTimeout(() => {
 					// 背景音乐和音效控制
 					bgMusic = document.getElementById('bgMusic');
 					bgMusic1 = document.getElementById('bgMusic1');
 					bgMusic2 = document.getElementById('bgMusic2');
 					bgMusic3 = document.getElementById('bgMusic3');
 					bgMusic4 = document.getElementById('bgMusic4');
 					bgMusic5 = document.getElementById('bgMusic5');
 					const clickSound = document.getElementById('clickSound');
 					const bgMusicToggle = document.getElementById('bgMusicToggle');
 					bgMusicIcon = document.getElementById('bgMusicIcon');
 					const bgMusicSelectModal = document.getElementById('bgMusicSelectModal');
 					const closeBgMusicSelectModal = document.getElementById('closeBgMusicSelectModal');
 					const localMusicInput = document.getElementById('localMusicInput');
 					isMusicPlaying = false;
 					currentBgMusic = 'bgMusic';

 					// 导入本地音乐
 					localMusicInput.addEventListener('change', async (e) => {
 						const file = e.target.files[0];
 						if (!file || !db) return;

 						// 读取文件
 						const reader = new FileReader();
 						reader.onload = async (event) => {
 							const musicData = {
 								name: file.name,
 								type: file.type,
 								data: event.target.result,
 								size: formatFileSize(file.size),
 								createdAt: new Date().toISOString()
 							};

 							// 保存到IndexedDB
 							const transaction = db.transaction(['music'], 'readwrite');
 							const store = transaction.objectStore('music');
 							const request = store.add(musicData);

 							request.onsuccess = () => {
 								loadLocalMusicList();
 								bgMusicSelectModal.classList.add('hidden');
 								alert('音乐导入成功！');
 							};

 							request.onerror = () => {
 								alert('音乐导入失败！');
 							};
 						};

 						reader.readAsDataURL(file);
 					});

 					// 背景音乐控制（播放/暂停）
 					bgMusicToggle.addEventListener('click', () => {
 						if (isMusicPlaying) {
 							[bgMusic, bgMusic1, bgMusic2, bgMusic3, bgMusic4, bgMusic5].forEach(
 								music => {
 									music.pause();
 								});
 							if (localMusic) {
 								localMusic.pause();
 							}
 							bgMusicIcon.className = 'fa fa-music';
 							isMusicPlaying = false;
 						} else {
 							let selectedMusic;
 							switch (currentBgMusic) {
 								case 'wy':
 									selectedMusic = bgMusic;
 									break;
 								case 'pure1':
 									selectedMusic = bgMusic1;
 									break;
 								case 'pure2':
 									selectedMusic = bgMusic2;
 									break;
 								case 'pure3':
 									selectedMusic = bgMusic3;
 									break;
 								case 'pure4':
 									selectedMusic = bgMusic4;
 									break;
 								case 'pure5':
 									selectedMusic = bgMusic5;
 									break;
 								case 'local':
 									selectedMusic = localMusic;
 									break;
 							}
 							if (selectedMusic) {
 								selectedMusic.play().catch(e => console.log('播放失败，可能需要用户交互'));
 								isMusicPlaying = true;
 								bgMusicIcon.className = 'fa fa-pause';
 							}
 						}
 					});

 					// 双击打开音乐选择弹窗
 					bgMusicToggle.addEventListener('dblclick', () => {
 						loadLocalMusicList();
 						bgMusicSelectModal.classList.remove('hidden');
 					});

 					// 关闭背景音乐选择弹窗
 					closeBgMusicSelectModal.addEventListener('click', () => {
 						bgMusicSelectModal.classList.add('hidden');
 					});

 					// 背景音乐选择
 					document.querySelectorAll('.bg-music-option').forEach(option => {
 						option.addEventListener('click', () => {
 							const musicType = option.getAttribute('data-music');
 							if (musicType === 'import') {
 								// 导入本地音乐
 								const input = document.getElementById('localMusicInput');
 								input.click();
 							} else {
 								selectBgMusic(musicType);
 								bgMusicSelectModal.classList.add('hidden');
 							}
 						});
 					});

 					// 选择背景音乐
 					function selectBgMusic(musicType) {
 						// 停止所有音乐
 						[bgMusic, bgMusic1, bgMusic2, bgMusic3, bgMusic4, bgMusic5].forEach(music => {
 							music.pause();
 							music.currentTime = 0;
 						});

 						// 停止本地音乐
 						if (localMusic) {
 							localMusic.pause();
 							localMusic.currentTime = 0;
 						}

 						// 播放选中的音乐
 						let selectedMusic;
 						switch (musicType) {
 							case 'wy':
 								selectedMusic = bgMusic;
 								break;
 							case 'pure1':
 								selectedMusic = bgMusic1;
 								break;
 							case 'pure2':
 								selectedMusic = bgMusic2;
 								break;
 							case 'pure3':
 								selectedMusic = bgMusic3;
 								break;
 							case 'pure4':
 								selectedMusic = bgMusic4;
 								break;
 							case 'pure5':
 								selectedMusic = bgMusic5;
 								break;
 						}

 						if (selectedMusic) {
 							selectedMusic.play().catch(e => console.log('播放失败，可能需要用户交互'));
 							currentBgMusic = musicType;
 							isMusicPlaying = true;
 							bgMusicIcon.className = 'fa fa-pause';

 							// 保存选择
 							localStorage.setItem('selectedBgMusic', musicType);
 						}
 					}

 					// 恢复上次选择的背景音乐
 					function restoreBgMusicSelection() {
 						const savedMusic = localStorage.getItem('selectedBgMusic');
 						if (savedMusic) {
 							selectBgMusic(savedMusic);
 						}
 					}

 					// 单击音效函数
 					function playClickSound() {
 						clickSound.currentTime = 0;
 						clickSound.play().catch(e => console.log('音效播放失败'));
 					}

 					// 为所有按钮添加单击音效
 					document.addEventListener('click', (e) => {
 						if (e.target.tagName === 'BUTTON' || e.target.closest('button')) {
 							playClickSound();
 						}
 					});

 					// 恢复定时器状态
 					restoreTimerState();

 					// 恢复本地音乐
 					restoreLocalMusic();

 					// 恢复上次选择的背景音乐
 					restoreBgMusicSelection();

 					// 5+ App环境需要等待plus ready
 					if (window.plus) {
 						initApp();
 					} else {
 						// 监听plus ready事件（5+ App启动时）
 						document.addEventListener("plusready", initApp, false);
 						// 网页端直接初始化
 						initApp();
					}
					
					// 初始化感受编辑弹窗
					initFeelingEditModal();
					
					// 监听页面可见性变化
 					document.addEventListener('visibilitychange', () => {
 						if (document.hidden) {
 							// 页面隐藏时保存定时器状态
 							saveTimerState();
 						} else {
 							// 页面显示时恢复定时器状态
 							restoreTimerState();
 						}
 					});

 					// 页面关闭前保存定时器状态
 					window.addEventListener('beforeunload', () => {
 						saveTimerState();
 					});
 				}, 100);
 			});
 		</script>
 		<script>
			// 感受编辑功能
			let currentEditingRecordId = null;

			// 打开感受编辑弹窗
			window.openFeelingEditModal = function(recordId) {
				const record = appState.taskRecords.find(r => r.id === recordId);
				if (!record) return;

				currentEditingRecordId = recordId;

				// 填充弹窗信息
				document.getElementById('feelingEditTaskName').textContent = record.name;
				document.getElementById('feelingEditTaskDate').textContent = record.completeDate + ' ' + (record.completeTime || '');
				document.getElementById('feelingEditText').value = record.feeling || '';

				// 显示弹窗
				document.getElementById('feelingEditModal').classList.remove('hidden');
			};

			// 关闭感受编辑弹窗
			function closeFeelingEditModal() {
				document.getElementById('feelingEditModal').classList.add('hidden');
				currentEditingRecordId = null;
			}

			// 保存感受
			function saveFeelingEdit() {
				if (!currentEditingRecordId) return;

				const feelingText = document.getElementById('feelingEditText').value.trim();
				
				// 查找并更新记录
				const recordIndex = appState.taskRecords.findIndex(r => r.id === currentEditingRecordId);
				if (recordIndex !== -1) {
					appState.taskRecords[recordIndex].feeling = feelingText;
					
					// 保存到本地存储
					localStorage.setItem('dopamineTaskRecords', JSON.stringify(appState.taskRecords));
					
					// 重新渲染列表
					renderTaskRecords(
						document.getElementById('filterSelect')?.value || 'all',
						document.getElementById('relevantFilterSelect')?.value || '',
						document.getElementById('startDate')?.value || '',
						document.getElementById('endDate')?.value || ''
					);

					// 显示成功提示
					showWechatNotification('修改完毕', '任务感受已成功修改！');

					// 关闭弹窗
					closeFeelingEditModal();
				}
			}

			// 绑定感受编辑弹窗事件
			function initFeelingEditModal() {
				// 取消按钮
				document.getElementById('cancelFeelingEditBtn')?.addEventListener('click', closeFeelingEditModal);

				// 保存按钮
				document.getElementById('saveFeelingEditBtn')?.addEventListener('click', saveFeelingEdit);
			}

			// 微信样式通知
			function showWechatNotification(title, content) {
				const notification = document.createElement('div');
				notification.className = 'wechat-notification';
				notification.innerHTML = `
					<div class="wechat-notification-header">
						<span>${title}</span>
						<div class="wechat-notification-close" onclick="this.parentElement.parentElement.parentElement.remove()">×</div>
					</div>
					<div class="wechat-notification-body">
						<p class="wechat-notification-title">${title}</p>
						<p class="wechat-notification-content">${content}</p>
						<div class="wechat-notification-btn">
							<button class="btn-confirm" onclick="this.parentElement.parentElement.parentElement.remove()">知道了</button>
						</div>
					</div>
				`;
				document.body.appendChild(notification);

				// 3秒后自动关闭
				setTimeout(() => {
					if (notification.parentElement) {
						notification.remove();
					}
				}, 3000);
			}


 			// 背包模块
 			class BackpackModule {
 				constructor() {
 					this.backpackItems = JSON.parse(localStorage.getItem('backpackItems')) || [];
 					// 读取appState中的奖励值，确保同步
 					this.totalPoints = parseInt(localStorage.getItem('dopamineRewardPoints')) || 0;
 					this.init();
 				}

 				init() {
 					this.bindEvents();
 					this.updateBackpackCount();
 					this.updateTotalPoints();
 				}

 				bindEvents() {
 					// 背包按钮点击事件
 					document.getElementById('backpackBtn')?.addEventListener('click', () => {
 						this.showBackpack();
 					});

 					// 关闭背包弹窗
 					document.getElementById('closeBackpackModal')?.addEventListener('click', () => {
 						this.hideBackpack();
 					});

 					// 关闭奖励弹窗
 					document.getElementById('closeRewardModal')?.addEventListener('click', () => {
 						this.hideRewardModal();
 					});

 					// 关闭奖励值弹窗
 					document.getElementById('closePointsModal')?.addEventListener('click', () => {
 						this.hidePointsModal();
 					});
 				}

 				// 显示背包
 				showBackpack() {
 					const modal = document.getElementById('backpackModal');
 					const itemsContainer = document.getElementById('backpackItems');

 					if (modal && itemsContainer) {
 						// 清空现有物品
 						itemsContainer.innerHTML = '';

 						// 生成物品列表
 						if (this.backpackItems.length === 0) {
 							itemsContainer.innerHTML =
 								'<div class="col-span-full text-center text-gray-400 py-8">背包是空的</div>';
 						} else {
 							this.backpackItems.forEach((item, index) => {
 								const itemEl = document.createElement('div');
 								itemEl.className =
 									'bg-darkBg/50 border border-neonGreen rounded-lg p-4 text-center hover:scale-105 transition-transform';
 								itemEl.innerHTML = `
                                <div class="text-4xl mb-2">${item.icon}</div>
                                <p class="text-white font-medium">${item.name}</p>
                                <p class="text-neonGreen text-sm mt-1">x${item.quantity}</p>
                                <button class="exchange-btn mt-2 bg-neonGreen text-darkBg px-4 py-2 rounded-full text-sm font-bold hover:scale-105 transition-transform" data-item-index="${index}">
                                    <i class="fa fa-exchange mr-1"></i>兑换
                                </button>
                            `;
 								itemsContainer.appendChild(itemEl);
 							});

 							// 绑定兑换按钮事件
 							itemsContainer.querySelectorAll('.exchange-btn').forEach(btn => {
 								btn.addEventListener('click', (e) => {
 									e.preventDefault();
 									const itemIndex = parseInt(btn.getAttribute('data-item-index'));
 									this.exchangeReward(itemIndex);
 								});
 							});
 						}

 						modal.classList.remove('hidden');
 					}
 				}

 				// 隐藏背包
 				hideBackpack() {
 					const modal = document.getElementById('backpackModal');
 					if (modal) {
 						modal.classList.add('hidden');
 					}
 				}

 				// 添加奖励到背包
 				addReward(reward) {
 					// 检查是否已存在该奖励
 					const existingItemIndex = this.backpackItems.findIndex(item => item.name === reward.name);

 					if (existingItemIndex >= 0) {
 						// 增加数量
 						this.backpackItems[existingItemIndex].quantity += 1;
 					} else {
 						// 添加新物品
 						this.backpackItems.push({
 							...reward,
 							quantity: 1,
 							id: Date.now()
 						});
 					}

 					// 保存到本地存储
 					this.saveBackpack();
 					// 更新UI
 					this.updateBackpackCount();
 					// 显示奖励弹窗
 					this.showRewardModal(reward);
 				}

 				// 添加奖励值
 				addPoints(points) {
 					this.totalPoints += points;
 					// 保存到本地存储
 					localStorage.setItem('dopamineRewardPoints', this.totalPoints.toString());
 					// 同步到appState
 					if (window.appState) {
 						window.appState.rewardPoints = this.totalPoints;
 					}
 					// 更新UI
 					this.updateTotalPoints();
 					// 更新奖励模块的奖励值显示
 					const currentPointsElement = document.getElementById('currentRewardPoints');
 					if (currentPointsElement) {
 						currentPointsElement.textContent = this.totalPoints;
 					}
 					// 显示奖励值弹窗
 					this.showPointsModal(points);
 				}

 				// 兑换奖励
 				exchangeReward(itemIndex) {
 					const item = this.backpackItems[itemIndex];
 					if (!item || item.quantity <= 0) {
 						showToast('该奖励数量不足！');
 						return;
 					}

 					// 减少物品数量
 					item.quantity -= 1;
 					if (item.quantity <= 0) {
 						this.backpackItems.splice(itemIndex, 1);
 					}

 					// 保存到本地存储
 					this.saveBackpack();
 					// 更新UI
 					this.updateBackpackCount();
 					// 重新显示背包
 					this.showBackpack();

 					// 构建兑换任务
 					const exchangeTask = {
 						name: `兑换任务：${item.name}`,
 						desc: `使用背包中的${item.name}`,
 						time: 5, // 默认5分钟
 						difficulty: 'easy',
 						points: 0,
 						isSmart: false,
 						isExchange: true
 					};

 					// 关闭背包弹窗
 					this.hideBackpack();

 					// 开始任务
 					setCurrentTask(exchangeTask);
 					showToast(`开始兑换任务：${item.name}`);
 				}

 				// 显示奖励弹窗
 				showRewardModal(reward) {
 					const modal = document.getElementById('backpackRewardModal');
 					const title = document.getElementById('rewardTitle');
 					const content = document.getElementById('rewardContent');

 					if (modal && title && content) {
 						title.textContent = '恭喜你！';
 						content.innerHTML = `获得了<span class="text-neonPink font-bold">${reward.name}</span>！`;
 						modal.classList.remove('hidden');

 						// 3秒后自动关闭
 						setTimeout(() => {
 							this.hideRewardModal();
 						}, 3000);
 					}
 				}

 				// 隐藏奖励弹窗
 				hideRewardModal() {
 					const modal = document.getElementById('backpackRewardModal');
 					if (modal) {
 						modal.classList.add('hidden');
 					}
 				}

 				// 显示奖励值弹窗
 				showPointsModal(points) {
 					const modal = document.getElementById('pointsModal');
 					const title = document.getElementById('pointsTitle');
 					const content = document.getElementById('pointsContent');

 					if (modal && title && content) {
 						title.textContent = '恭喜你！';
 						content.innerHTML = `获得了<span class="text-neonBlue font-bold">${points}</span>奖励值！\n你可以用这个抽取奖励`;
 						modal.classList.remove('hidden');

 						// 3秒后自动关闭
 						setTimeout(() => {
 							this.hidePointsModal();
 						}, 3000);
 					}
 				}

 				// 隐藏奖励值弹窗
 				hidePointsModal() {
 					const modal = document.getElementById('pointsModal');
 					if (modal) {
 						modal.classList.add('hidden');
 					}
 				}

 				// 更新背包数量
 				updateBackpackCount() {
 					const totalItems = this.backpackItems.reduce((sum, item) => sum + item.quantity, 0);
 					const countEl = document.getElementById('backpackCount');
 					if (countEl) {
 						countEl.textContent = totalItems;
 					}
 				}

 				// 更新奖励值
				updateTotalPoints() {
					const pointsEl = document.getElementById('rewardPoints');
					if (pointsEl) {
						pointsEl.textContent = this.totalPoints;
					}
				}

 				// 保存背包到本地存储
 				saveBackpack() {
 					localStorage.setItem('backpackItems', JSON.stringify(this.backpackItems));
 				}

 				// 获取背包物品
 				getBackpackItems() {
 					return this.backpackItems;
 				}

 				// 获取奖励值
 				getTotalPoints() {
 					return this.totalPoints;
 				}
 			}

 			// 初始化背包模块
 			const backpackModule = new BackpackModule();

 			// 暴露背包模块到全局
 			window.backpackModule = backpackModule;
 		</script>

		<!-- 荣誉系统 -->
		<script>
			// 荣誉系统
			class HonorSystem {
				constructor() {
					this.honorData = {
						title: localStorage.getItem('honorTitle') || '新手冒险者',
						description: localStorage.getItem('honorDescription') || '刚踏入学习之路的新手',
						pointsRequirement: parseInt(localStorage.getItem('honorPointsRequirement')) || 100,
						completed: parseInt(localStorage.getItem('honorCompleted')) || 0,
						showAnimation: localStorage.getItem('honorShowAnimation') !== 'false'
					};
					
					// 荣誉历史记录
					this.honorHistory = JSON.parse(localStorage.getItem('honorHistory')) || [];
					
					this.init();
				}

				init() {
					this.bindEvents();
					this.updateDisplay();
				}

				bindEvents() {
					// 荣誉图标按钮（单击查看，双击设置）
					const viewHonorBtn = document.getElementById('viewHonorBtn');
					if (viewHonorBtn) {
						let clickTimer = null;
						let clickCount = 0;
						
						viewHonorBtn.addEventListener('click', (e) => {
							clickCount++;
							
							if (clickCount === 1) {
								clickTimer = setTimeout(() => {
									// 单击：显示荣誉信息
									if (typeof this !== 'undefined' && this.showHonorInfo) {
										this.showHonorInfo();
									} else if (window.honorSystem) {
										window.honorSystem.showHonorInfo();
									}
									clickCount = 0;
								}, 250);
							} else if (clickCount === 2) {
								// 双击：打开设置
								clearTimeout(clickTimer);
								if (typeof this !== 'undefined' && this.showSettings) {
									this.showSettings();
								} else if (window.honorSystem) {
									window.honorSystem.showSettings();
								}
								clickCount = 0;
							}
						});
					}

					// 荣誉设置按钮
					const honorSettingsBtn = document.getElementById('honorSettingsBtn');
					if (honorSettingsBtn) {
						honorSettingsBtn.addEventListener('click', (e) => {
							e.stopPropagation();
							this.showSettings();
						});
					}

					// 任务设置图标按钮（显示设置菜单）
					const taskSettingsBtn = document.getElementById('taskSettingsBtn');
					if (taskSettingsBtn) {
						taskSettingsBtn.addEventListener('click', (e) => {
							e.stopPropagation();
							// 显示任务设置菜单（这里可以添加一个下拉菜单或子界面）
							// 暂时直接跳转到设置页面
							if (typeof showScreen === 'function') {
								// 显示任务设置子菜单（这里可以添加新的界面）
								// 或者直接显示一个包含两个选项的弹窗
								this.showTaskSettingsMenu();
							}
						});
					}

					// 关闭荣誉设置弹窗
					const closeHonorSettingsBtn = document.getElementById('closeHonorSettingsBtn');
					if (closeHonorSettingsBtn) {
						closeHonorSettingsBtn.addEventListener('click', () => {
							document.getElementById('honorSettingsModal').classList.add('hidden');
						});
					}

					// 保存荣誉设置
					const saveHonorBtn = document.getElementById('saveHonorBtn');
					if (saveHonorBtn) {
						saveHonorBtn.addEventListener('click', () => this.saveSettings());
					}

					// 重置荣誉设置
				const resetHonorBtn = document.getElementById('resetHonorBtn');
				if (resetHonorBtn) {
					resetHonorBtn.addEventListener('click', () => this.resetSettings());
				}

				// 确认荣誉按钮（荣誉设置弹窗）
				const confirmHonorBtnSettings = document.getElementById('confirmHonorBtn');
				if (confirmHonorBtnSettings) {
					confirmHonorBtnSettings.addEventListener('click', () => {
						document.getElementById('honorSettingsModal').classList.add('hidden');
					});
				}

					// 关闭荣誉弹窗
				const closeHonorModalBtn = document.getElementById('closeHonorModalBtn');
				if (closeHonorModalBtn) {
					closeHonorModalBtn.addEventListener('click', () => {
						document.getElementById('honorModal').classList.add('hidden');
					});
				}
				
				// 确认荣誉按钮（荣誉弹窗）
				const confirmHonorBtnModal = document.getElementById('confirmHonorBtn');
				if (confirmHonorBtnModal) {
					confirmHonorBtnModal.addEventListener('click', () => {
						document.getElementById('honorModal').classList.add('hidden');
					});
				}
				
				// 荣誉标签页切换
				const currentHonorTab = document.getElementById('currentHonorTab');
				const honorHistoryTab = document.getElementById('honorHistoryTab');
				const currentHonorContent = document.getElementById('currentHonorContent');
				const honorHistoryContent = document.getElementById('honorHistoryContent');
				
				if (currentHonorTab && honorHistoryTab) {
					currentHonorTab.addEventListener('click', () => {
						// 切换到当前荣誉
						currentHonorTab.className = 'bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg text-sm transition-colors';
						honorHistoryTab.className = 'bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg text-sm transition-colors';
						currentHonorContent.classList.remove('hidden');
						honorHistoryContent.classList.add('hidden');
						// 渲染当前荣誉列表
						renderCurrentHonorList();
					});

					honorHistoryTab.addEventListener('click', () => {
						// 切换到荣誉历史
						honorHistoryTab.className = 'bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg text-sm transition-colors';
						currentHonorTab.className = 'bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg text-sm transition-colors';
						currentHonorContent.classList.add('hidden');
						honorHistoryContent.classList.remove('hidden');
						this.renderHonorHistory();
					});
				}

					// 背包按钮
					const backpackBtn = document.getElementById('backpackBtn');
					if (backpackBtn) {
						backpackBtn.addEventListener('click', () => {
							document.getElementById('backpackModal').classList.remove('hidden');
						});
					}
				}

				updateDisplay() {
					// 更新荣誉模块显示
					const completedTasksCount = document.getElementById('completedTasksCount');
					const consecutiveDaysCount = document.getElementById('consecutiveDaysCount');
					const rewardPoints = document.getElementById('rewardPoints');

					if (completedTasksCount && appState.totalComplete !== undefined) {
						completedTasksCount.textContent = appState.totalComplete;
					}

					if (consecutiveDaysCount && appState.streak !== undefined) {
						consecutiveDaysCount.textContent = `${appState.streak}天`;
					}

					if (rewardPoints && appState.rewardPoints !== undefined) {
						rewardPoints.textContent = appState.rewardPoints;
					}

					// 检查是否应该显示荣誉动画
					this.checkHonorUnlocked();
				}

				checkHonorUnlocked() {
					const currentPoints = appState.rewardPoints || 0;
					const pointsRequirement = this.honorData.pointsRequirement;

					// 如果达到荣誉要求且之前未显示过
					if (currentPoints >= pointsRequirement && this.honorData.showAnimation && this.honorData.completed === 0) {
						this.showHonorAnimation();
						this.addToHistory();
						this.honorData.completed = 1;
						localStorage.setItem('honorCompleted', '1');
					}
				}
				
				addToHistory() {
					const historyItem = {
						id: Date.now(),
						title: this.honorData.title,
						description: this.honorData.description,
						pointsRequirement: this.honorData.pointsRequirement,
						date: new Date().toISOString(),
						points: appState.rewardPoints || 0
					};
					
					this.honorHistory.unshift(historyItem);
					// 只保留最近10条记录
					if (this.honorHistory.length > 10) {
						this.honorHistory = this.honorHistory.slice(0, 10);
					}
					
					// 保存到本地存储
					localStorage.setItem('honorHistory', JSON.stringify(this.honorHistory));
				}
				
				renderHonorHistory() {
					const honorHistoryList = document.getElementById('honorHistoryList');
					const noHonorHistory = document.getElementById('noHonorHistory');
					
					if (!honorHistoryList) return;
					
					if (this.honorHistory.length === 0) {
						honorHistoryList.innerHTML = '';
						noHonorHistory.classList.remove('hidden');
						return;
					}
					
					noHonorHistory.classList.add('hidden');
					
					honorHistoryList.innerHTML = this.honorHistory.map(item => {
						const date = new Date(item.date);
						const dateStr = date.toLocaleDateString('zh-CN', {
							year: 'numeric',
							month: '2-digit',
							day: '2-digit',
							hour: '2-digit',
							minute: '2-digit'
						});
						
						return `
							<div class="bg-purple-900/30 border border-purple-400/30 rounded-lg p-4">
								<div class="flex items-start justify-between">
									<div class="flex-1">
										<h4 class="text-purple-300 font-bold text-lg mb-1">${item.title}</h4>
										<p class="text-gray-300 text-sm mb-2">${item.description}</p>
										<div class="flex items-center gap-4 text-xs text-gray-400">
											<span>要求：${item.pointsRequirement}分</span>
											<span>${dateStr}</span>
										</div>
									</div>
									<div class="text-2xl text-purple-400">
										<i class="fa fa-trophy"></i>
									</div>
								</div>
							</div>
						`;
					}).join('');
				}

				showHonorAnimation() {
					const honorModal = document.getElementById('honorModal');
					const honorTitle = document.getElementById('honorTitle');
					const honorDescription = document.getElementById('honorDescription');
					const honorPointsRequirement = document.getElementById('honorPointsRequirement');

					if (honorModal && honorTitle && honorDescription && honorPointsRequirement) {
						honorTitle.textContent = `恭喜获得荣誉：${this.honorData.title}！`;
						honorDescription.textContent = this.honorData.description;
						honorPointsRequirement.textContent = this.honorData.pointsRequirement;

						honorModal.classList.remove('hidden');

						// 播放荣誉音效（如果需要）
						this.playHonorSound();
					}
				}

				showHonorInfo() {
					// 显示荣誉信息
					const honorModal = document.getElementById('honorModal');

					if (honorModal) {
						// 初始化显示当前荣誉标签页
						const currentHonorTab = document.getElementById('currentHonorTab');
						const honorHistoryTab = document.getElementById('honorHistoryTab');
						const currentHonorContent = document.getElementById('currentHonorContent');
						const honorHistoryContent = document.getElementById('honorHistoryContent');

						if (currentHonorTab && honorHistoryTab && currentHonorContent && honorHistoryContent) {
							// 切换到当前荣誉
							currentHonorTab.className = 'bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg text-sm transition-colors';
							honorHistoryTab.className = 'bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg text-sm transition-colors';
							currentHonorContent.classList.remove('hidden');
							honorHistoryContent.classList.add('hidden');
						}

						// 渲染当前荣誉列表
						renderCurrentHonorList();

						honorModal.classList.remove('hidden');
					}
				}

				showSettings() {
					const honorSettingsModal = document.getElementById('honorSettingsModal');
					const honorTitleInput = document.getElementById('honorTitleInput');
					const honorPointsRequirementInput = document.getElementById('honorPointsRequirementInput');
					const honorDescriptionInput = document.getElementById('honorDescriptionInput');

					if (honorSettingsModal) {
						// 填充当前设置
						if (honorTitleInput) honorTitleInput.value = this.honorData.title;
						if (honorPointsRequirementInput) honorPointsRequirementInput.value = this.honorData.pointsRequirement;
						if (honorDescriptionInput) honorDescriptionInput.value = this.honorData.description;

						honorSettingsModal.classList.remove('hidden');
					}
				}

				showTaskSettingsMenu() {
					// 简单的任务设置菜单，直接跳转到相应的功能

	
					const choice = confirm('选择任务设置功能：\n\n确定 = 周期任务管理\n取消 = 任务卡片设置');
					
					if (choice) {
						// 确定 = 周期任务管理
						if (typeof showScreen === 'function') {
							showScreen('periodicTaskScreen');
						}
					} else {
						// 取消 = 任务卡片设置
						if (typeof showScreen === 'function') {
							showScreen('cardSettingScreen');
						}
					}
				}

				saveSettings() {
					const honorTitleInput = document.getElementById('honorTitleInput');
					const honorPointsRequirementInput = document.getElementById('honorPointsRequirementInput');
					const honorDescriptionInput = document.getElementById('honorDescriptionInput');

					// 保存新设置
					if (honorTitleInput) {
						this.honorData.title = honorTitleInput.value || '新手冒险者';
						localStorage.setItem('honorTitle', this.honorData.title);
					}

					if (honorPointsRequirementInput) {
						this.honorData.pointsRequirement = parseInt(honorPointsRequirementInput.value) || 100;
						localStorage.setItem('honorPointsRequirement', this.honorData.pointsRequirement.toString());
					}

					if (honorDescriptionInput) {
						this.honorData.description = honorDescriptionInput.value || '刚踏入学习之路的新手';
						localStorage.setItem('honorDescription', this.honorData.description);
					}

					// 重置完成状态，允许重新触发动画
					this.honorData.completed = 0;
					localStorage.setItem('honorCompleted', '0');

					// 关闭设置弹窗
					document.getElementById('honorSettingsModal').classList.add('hidden');

					// 更新显示
					this.updateDisplay();

					// 显示保存成功提示
					this.showSaveSuccess();
				}

				resetSettings() {
					this.honorData = {
						title: '新手冒险者',
						description: '刚踏入学习之路的新手',
						pointsRequirement: 100,
						completed: 0,
						showAnimation: true
					};

					// 清空本地存储
					localStorage.removeItem('honorTitle');
					localStorage.removeItem('honorDescription');
					localStorage.removeItem('honorPointsRequirement');
					localStorage.removeItem('honorCompleted');

					// 关闭设置弹窗
					document.getElementById('honorSettingsModal').classList.add('hidden');

					// 更新显示
					this.updateDisplay();
				}

				showSaveSuccess() {
					// 可以显示一个简单的成功提示
					const saveBtn = document.getElementById('saveHonorBtn');
					if (saveBtn) {
						const originalText = saveBtn.textContent;
						saveBtn.textContent = '保存成功！';
						saveBtn.classList.add('bg-green-600');
						saveBtn.classList.remove('bg-purple-600');

						setTimeout(() => {
							saveBtn.textContent = originalText;
							saveBtn.classList.remove('bg-green-600');
							saveBtn.classList.add('bg-purple-600');
						}, 1500);
					}
				}

				playHonorSound() {
					// 可以在这里添加荣誉获得的音效
					try {
						// 使用 Web Audio API 播放简单的音效
						const audioContext = new (window.AudioContext || window.webkitAudioContext)();
						const oscillator = audioContext.createOscillator();
						const gainNode = audioContext.createGain();

						oscillator.connect(gainNode);
						gainNode.connect(audioContext.destination);

						// 荣誉音效：上升的音调
						oscillator.type = 'triangle';
						oscillator.frequency.setValueAtTime(440, audioContext.currentTime);
						oscillator.frequency.exponentialRampToValueAtTime(880, audioContext.currentTime + 0.2);
						oscillator.frequency.exponentialRampToValueAtTime(1320, audioContext.currentTime + 0.4);

						gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
						gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);

						oscillator.start(audioContext.currentTime);
						oscillator.stop(audioContext.currentTime + 0.5);
					} catch (error) {
						console.log('荣誉音效播放失败:', error);
					}
				}
			}

			// 初始化荣誉系统
			let honorSystem;

			// 确保在 DOM 加载完成后初始化
			document.addEventListener('DOMContentLoaded', function() {
				honorSystem = new HonorSystem();
				window.honorSystem = honorSystem;
				
				// 初始化王者值管理器
				initHonorValueManager();
			});

			// 暴露荣誉系统到全局
			window.HonorSystem = HonorSystem;
		</script>

		<!-- 王者值管理器 -->
		<script>
			// 王者值管理器
			function initHonorValueManager() {
				// 绑定按钮事件
				const increaseBtn = document.getElementById('increaseHonorBtn');
				const decreaseBtn = document.getElementById('decreaseHonorBtn');
				
				if (increaseBtn) {
					increaseBtn.addEventListener('click', increaseHonorPoints);
				}
				
				if (decreaseBtn) {
					decreaseBtn.addEventListener('click', decreaseHonorPoints);
				}
				
				// 绑定荣誉设置相关事件
				const saveHonorBtn = document.getElementById('saveHonorBtn');
				const resetHonorBtn = document.getElementById('resetHonorBtn');
				const confirmHonorBtn = document.getElementById('confirmHonorBtn');
				
				if (saveHonorBtn) {
					saveHonorBtn.addEventListener('click', saveCustomHonor);
				}
				
				if (resetHonorBtn) {
					resetHonorBtn.addEventListener('click', resetHonorForm);
				}
				
				if (confirmHonorBtn) {
					confirmHonorBtn.addEventListener('click', closeHonorSettings);
				}
				
				// 初始化显示
				updateHonorValueDisplay();
				renderHonorHistory();
				renderCurrentHonorList();
			}
			
			// 保存自定义荣誉称号
			function saveCustomHonor() {
				const title = document.getElementById('honorTitleInput').value.trim();
				const description = document.getElementById('honorDescriptionInput').value.trim();
				const pointsRequirement = parseInt(document.getElementById('honorPointsRequirementInput').value);
				const level = document.getElementById('honorLevelInput').value;

				if (!title) {
					showMessage('请输入荣誉称号', 'warning');
					return;
				}

				if (!pointsRequirement || pointsRequirement <= 0) {
					showMessage('请输入有效的王者值要求', 'warning');
					return;
				}

				const currentHonorPoints = getHonorValue();
				const isCompleted = currentHonorPoints >= pointsRequirement;

				// 检查是否在编辑模式
				const editingId = sessionStorage.getItem('editingHonorId');
				let honorHistory = JSON.parse(localStorage.getItem('customHonorHistory')) || [];

				if (editingId) {
					// 编辑模式：更新现有记录
					const honorIndex = honorHistory.findIndex(h => h.id === parseInt(editingId));
					if (honorIndex !== -1) {
						honorHistory[honorIndex] = {
							...honorHistory[honorIndex],
							title: title,
							description: description,
							pointsRequirement: pointsRequirement,
							level: level
						};
						localStorage.setItem('customHonorHistory', JSON.stringify(honorHistory));
						showMessage('荣誉称号已更新！', 'success');
					}
				} else {
					// 创建模式：创建新记录
					const honorRecord = {
						id: Date.now(),
						title: title,
						description: description,
						pointsRequirement: pointsRequirement,
						currentPoints: 0, // 每个荣誉独立的当前王者值
						level: level, // 使用用户选择的等级
						completedDate: isCompleted ? new Date().toISOString() : null,
						completedTime: isCompleted ? new Date().toLocaleString('zh-CN') : null,
						isCompleted: isCompleted
					};

					honorHistory.unshift(honorRecord);
					localStorage.setItem('customHonorHistory', JSON.stringify(honorHistory));

					if (isCompleted) {
						showMessage('荣誉称号已保存！', 'success');
					} else {
						showMessage(`荣誉称号已保存！当前王者值不足，需要${pointsRequirement}分`, 'info');
					}
				}

				// 重置表单
				resetHonorForm();

				// 清除编辑状态
				sessionStorage.removeItem('editingHonorId');

				// 刷新历史记录显示
				renderHonorHistory();
				renderCurrentHonorList();
			}
			
			// 重置荣誉表单
			function resetHonorForm() {
				document.getElementById('honorTitleInput').value = '';
				document.getElementById('honorDescriptionInput').value = '';
				document.getElementById('honorPointsRequirementInput').value = '';
				document.getElementById('honorLevelInput').value = 'low';
			}
			
			// 关闭荣誉设置
			function closeHonorSettings() {
				document.getElementById('honorSettingsModal').classList.add('hidden');
			}
			
			// 编辑荣誉称号
			function editHonor(id) {
				const honorHistory = JSON.parse(localStorage.getItem('customHonorHistory')) || [];
				const honorIndex = honorHistory.findIndex(h => h.id === id);
				
				if (honorIndex === -1) {
					showMessage('未找到该荣誉称号', 'warning');
					return;
				}
				
				const honor = honorHistory[honorIndex];

				// 填充表单
				document.getElementById('honorTitleInput').value = honor.title;
				document.getElementById('honorDescriptionInput').value = honor.description;
				document.getElementById('honorPointsRequirementInput').value = honor.pointsRequirement;
				document.getElementById('honorLevelInput').value = honor.level || 'low';

				// 显示编辑状态
				showMessage('进入编辑模式', 'info');

				// 临时保存编辑状态
				sessionStorage.setItem('editingHonorId', id.toString());
			}
			
			// 删除荣誉称号
			function deleteHonor(id) {
				if (!confirm('确定要删除这个荣誉称号吗？')) {
					return;
				}
				
				let honorHistory = JSON.parse(localStorage.getItem('customHonorHistory')) || [];
				honorHistory = honorHistory.filter(h => h.id !== id);
				localStorage.setItem('customHonorHistory', JSON.stringify(honorHistory));
				
				// 刷新显示
				renderHonorHistory();
				renderCurrentHonorList();

				showMessage('荣誉称号已删除', 'success');
			}
			
			// 批量创建多个自定义荣誉称号
			function createMultipleHonors() {
				const title1 = document.getElementById('honorTitle1').value.trim();
				const points1 = parseInt(document.getElementById('honorPoints1').value) || 0;
				const title2 = document.getElementById('honorTitle2').value.trim();
				const points2 = parseInt(document.getElementById('honorPoints2').value) || 0;
				const title3 = document.getElementById('honorTitle3').value.trim();
				const points3 = parseInt(document.getElementById('honorPoints3').value) || 0;
				const title4 = document.getElementById('honorTitle4').value.trim();
				const points4 = parseInt(document.getElementById('honorPoints4').value) || 0;

				if (!title1 && !title2 && !title3 && !title4) {
					showMessage('请至少输入一个荣誉称号', 'warning');
					return;
				}

				const honorHistory = JSON.parse(localStorage.getItem('customHonorHistory')) || [];
				const currentPoints = getHonorValue();
				const completedTime = new Date().toISOString();
				const completedTimeStr = new Date().toLocaleString('zh-CN');

				if (title1) {
					const isCompleted1 = currentPoints >= points1;
					honorHistory.push({
						id: Date.now(),
						title: title1,
						description: '自定义荣誉称号',
						pointsRequirement: points1,
						currentPoints: 0, // 每个荣誉独立的当前王者值
						level: 'low', // 默认等级：低
						completedDate: isCompleted1 ? completedTime : null,
						completedTime: isCompleted1 ? completedTimeStr : null,
						isCompleted: isCompleted1
					});
				}

				if (title2) {
					const isCompleted2 = currentPoints >= points2;
					honorHistory.push({
						id: Date.now() + 1,
						title: title2,
						description: '自定义荣誉称号',
						pointsRequirement: points2,
						currentPoints: 0, // 每个荣誉独立的当前王者值
						level: 'low', // 默认等级：低
						completedDate: isCompleted2 ? completedTime : null,
						completedTime: isCompleted2 ? completedTimeStr : null,
						isCompleted: isCompleted2
					});
				}

				if (title3) {
					const isCompleted3 = currentPoints >= points3;
					honorHistory.push({
						id: Date.now() + 2,
						title: title3,
						description: '自定义荣誉称号',
						pointsRequirement: points3,
						currentPoints: 0, // 每个荣誉独立的当前王者值
						level: 'low', // 默认等级：低
						completedDate: isCompleted3 ? completedTime : null,
						completedTime: isCompleted3 ? completedTimeStr : null,
						isCompleted: isCompleted3
					});
				}

				if (title4) {
					const isCompleted4 = currentPoints >= points4;
					honorHistory.push({
						id: Date.now() + 3,
						title: title4,
						description: '自定义荣誉称号',
						pointsRequirement: points4,
						currentPoints: 0, // 每个荣誉独立的当前王者值
						level: 'low', // 默认等级：低
						completedDate: isCompleted4 ? completedTime : null,
						completedTime: isCompleted4 ? completedTimeStr : null,
						isCompleted: isCompleted4
					});
				}

				localStorage.setItem('customHonorHistory', JSON.stringify(honorHistory));

				// 清空表单
				document.getElementById('honorTitle1').value = '';
				document.getElementById('honorPoints1').value = '';
				document.getElementById('honorTitle2').value = '';
				document.getElementById('honorPoints2').value = '';
				document.getElementById('honorTitle3').value = '';
				document.getElementById('honorPoints3').value = '';
				document.getElementById('honorTitle4').value = '';
				document.getElementById('honorPoints4').value = '';

				// 刷新显示
				renderHonorHistory();
				renderCurrentHonorList();

				showMessage('已成功创建4个荣誉称号！', 'success');
			}
			
			// 渲染荣誉历史记录
			function renderHonorHistory() {
				const honorHistoryList = document.getElementById('honorHistoryList');
				if (!honorHistoryList) return;

				// 获取并迁移荣誉历史数据，确保所有荣誉都有 currentPoints 字段
				let honorHistory = JSON.parse(localStorage.getItem('customHonorHistory')) || [];
				let hasChanges = false;

				honorHistory = honorHistory.map(honor => {
					if (honor.currentPoints === undefined) {
						honor.currentPoints = 0;
						hasChanges = true;
					}
					if (honor.level === undefined) {
						honor.level = 'low';
						hasChanges = true;
					}
					return honor;
				});

				if (hasChanges) {
					localStorage.setItem('customHonorHistory', JSON.stringify(honorHistory));
				}
				
				if (honorHistory.length === 0) {
					honorHistoryList.innerHTML = '<p class="text-gray-400 text-center py-4">暂无已获得的荣誉称号</p>';
					return;
				}
				
				honorHistoryList.innerHTML = honorHistory.map((honor, index) => {
					const honorCurrentPoints = honor.currentPoints || 0;
					const isCompleted = honor.isCompleted || honorCurrentPoints >= honor.pointsRequirement;
					const levelInfo = getHonorLevel(honor.level);
					const date = honor.completedTime ? new Date(honor.completedTime) : null;
					const dateStr = date ? date.toLocaleDateString('zh-CN', {
						year: 'numeric',
						month: '2-digit',
						day: '2-digit',
						hour: '2-digit',
						minute: '2-digit'
					}) : '未完成';

					return `
						<div class="bg-purple-900/30 border border-purple-400/30 rounded-lg p-4 hover:border-purple-300 transition-all duration-300 ${isCompleted ? 'opacity-100' : 'opacity-50'}">
							<div class="flex items-start justify-between">
								<div class="flex-1">
									<h4 class="${isCompleted ? 'text-purple-300' : 'text-gray-500'} font-bold text-lg mb-1">${honor.title}
										<span class="ml-2 px-2 py-1 rounded-full text-xs font-bold ${levelInfo.color} ${levelInfo.bg} border ${levelInfo.border}">${levelInfo.name}</span>
									</h4>
									<p class="${isCompleted ? 'text-gray-300' : 'text-gray-500'} text-sm mb-2">${honor.description || '自定义荣誉称号'}</p>
									<div class="flex items-center gap-4 text-xs ${isCompleted ? 'text-gray-400' : 'text-gray-500'}">
										<span>要求：${honor.pointsRequirement}王者值</span>
										<span>${isCompleted ? '获得时间：' : '状态：'}${dateStr}</span>
									</div>
								</div>
								<div class="flex flex-col items-end gap-2">
									<div class="flex items-center gap-2">
										<button onclick="decreaseHonorPoints(${honor.id})"
											class="bg-red-500 hover:bg-red-600 text-white w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold transition-all duration-300 hover:scale-110">
											<i class="fa fa-minus"></i>
										</button>
										<div class="bg-purple-900/50 rounded px-2 py-1 text-purple-300 font-bold min-w-[40px] text-center">
											${honorCurrentPoints}
										</div>
										<button onclick="increaseHonorPoints(${honor.id})"
											class="bg-green-500 hover:bg-green-600 text-white w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold transition-all duration-300 hover:scale-110">
											<i class="fa fa-plus"></i>
										</button>
									</div>
									<div class="text-xs text-gray-500">
										今日：<span id="todayCount_${honor.id}">${getTodayIncreaseCount(honor.id)}</span>/3
									</div>
								</div>
							</div>
							<div class="flex gap-2 mt-3">
								<button onclick="editHonor(${honor.id})"
									class="flex-1 bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm transition-colors">
									<i class="fa fa-edit mr-1"></i>编辑
								</button>
								<button onclick="deleteHonor(${honor.id})"
									class="flex-1 bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm transition-colors">
									<i class="fa fa-trash mr-1"></i>删除
								</button>
							</div>
						</div>
					`;
				}).join('');
			}

			function renderCurrentHonorList() {
				const currentHonorList = document.getElementById('currentHonorList');
				const noCurrentHonor = document.getElementById('noCurrentHonor');

				if (!currentHonorList) return;

				// 获取并迁移荣誉历史数据，确保所有荣誉都有 currentPoints 字段
				let honorHistory = JSON.parse(localStorage.getItem('customHonorHistory')) || [];
				let hasChanges = false;

				honorHistory = honorHistory.map(honor => {
					if (honor.currentPoints === undefined) {
						honor.currentPoints = 0;
						hasChanges = true;
					}
					if (honor.level === undefined) {
						honor.level = 'low';
						hasChanges = true;
					}
					return honor;
				});

				if (hasChanges) {
					localStorage.setItem('customHonorHistory', JSON.stringify(honorHistory));
				}

				if (honorHistory.length === 0) {
					currentHonorList.innerHTML = '';
					if (noCurrentHonor) {
						noCurrentHonor.classList.remove('hidden');
					}
					return;
				}

				if (noCurrentHonor) {
					noCurrentHonor.classList.add('hidden');
				}

				currentHonorList.innerHTML = honorHistory.map((honor, index) => {
					const honorCurrentPoints = honor.currentPoints || 0;
					const isCompleted = honor.isCompleted || honorCurrentPoints >= honor.pointsRequirement;
					const levelInfo = getHonorLevel(honor.level);
					const date = honor.completedTime ? new Date(honor.completedTime) : null;
					const dateStr = date ? date.toLocaleDateString('zh-CN', {
						year: 'numeric',
						month: '2-digit',
						day: '2-digit',
						hour: '2-digit',
						minute: '2-digit'
					}) : '未完成';

					return `
						<div class="bg-purple-900/30 border border-purple-400/30 rounded-lg p-4 hover:border-purple-300 transition-all duration-300 ${isCompleted ? 'opacity-100' : 'opacity-50'}">
							<div class="flex items-start justify-between">
								<div class="flex-1">
									<div class="flex items-center gap-2 mb-2">
										<i class="fa fa-trophy ${isCompleted ? 'text-purple-400' : 'text-gray-500'} text-xl"></i>
										<h4 class="${isCompleted ? 'text-purple-300' : 'text-gray-500'} font-bold text-lg">${honor.title}</h4>
										<span class="px-2 py-1 rounded-full text-xs font-bold ${levelInfo.color} ${levelInfo.bg} border ${levelInfo.border}">${levelInfo.name}</span>
									</div>
									<p class="${isCompleted ? 'text-gray-300' : 'text-gray-500'} text-sm mb-2">${honor.description || '自定义荣誉称号'}</p>
									<div class="flex items-center gap-4 text-xs ${isCompleted ? 'text-gray-400' : 'text-gray-500'}">
										<span>要求：${honor.pointsRequirement}王者值</span>
										<span>${isCompleted ? '获得时间：' : '需要：'}${dateStr}</span>
									</div>
								</div>
								<div class="flex flex-col items-end gap-2">
									<div class="flex items-center gap-2">
										<button onclick="decreaseHonorPoints(${honor.id})"
											class="bg-red-500 hover:bg-red-600 text-white w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold transition-all duration-300 hover:scale-110">
											<i class="fa fa-minus"></i>
										</button>
										<div class="bg-purple-900/50 rounded px-2 py-1 text-purple-300 font-bold min-w-[40px] text-center">
											${honorCurrentPoints}
										</div>
										<button onclick="increaseHonorPoints(${honor.id})"
											class="bg-green-500 hover:bg-green-600 text-white w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold transition-all duration-300 hover:scale-110">
											<i class="fa fa-plus"></i>
										</button>
									</div>
									<div class="text-xs text-gray-500">
										今日：<span id="todayCount_${honor.id}">${getTodayIncreaseCount(honor.id)}</span>/3
									</div>
								</div>
							</div>
							<div class="flex gap-2 mt-3">
								<button onclick="editHonor(${honor.id})"
									class="flex-1 bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm transition-colors">
									<i class="fa fa-edit mr-1"></i>编辑
								</button>
								<button onclick="deleteHonor(${honor.id})"
									class="flex-1 bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm transition-colors">
									<i class="fa fa-trash mr-1"></i>删除
								</button>
							</div>
						</div>
					`;
				}).join('');
			}

			function getTodayString() {
				return new Date().toLocaleDateString();
			}
			
			function getHonorValue() {
				return Number(localStorage.getItem('honorPoints')) || 0;
			}

			function getHonorLevel(level) {
				const levelMap = {
					'low': { name: '初级', color: 'text-green-400', bg: 'bg-green-400/20', border: 'border-green-400/30' },
					'medium': { name: '中级', color: 'text-yellow-400', bg: 'bg-yellow-400/20', border: 'border-yellow-400/30' },
					'high': { name: '高级', color: 'text-red-400', bg: 'bg-red-400/20', border: 'border-red-400/30' }
				};
				return levelMap[level] || levelMap['low'];
			}
			
			function setHonorValue(points) {
				localStorage.setItem('honorPoints', points.toString());
			}
			
			function getTodayIncreaseCount(honorId) {
				const today = getTodayString();
				const lastDate = localStorage.getItem(`honor_${honorId}_lastIncreaseDate`);
				
				if (lastDate !== today) {
					// 新的一天，重置计数器
					localStorage.setItem(`honor_${honorId}_todayIncreaseCount`, '0');
					localStorage.setItem(`honor_${honorId}_lastIncreaseDate`, today);
					return 0;
				}
				
				return Number(localStorage.getItem(`honor_${honorId}_todayIncreaseCount`)) || 0;
			}

			function getHonorTodayIncreaseCount() {
				const today = getTodayString();
				const lastDate = localStorage.getItem('lastIncreaseDate');
				
				if (lastDate !== today) {
					// 新的一天，重置计数器
					localStorage.setItem('todayIncreaseCount', '0');
					localStorage.setItem('lastIncreaseDate', today);
					return 0;
				}
				
				return Number(localStorage.getItem('todayIncreaseCount')) || 0;
			}

			// 为指定荣誉增加王者值
			function increaseHonorPoints(honorId) {
				const honorHistory = JSON.parse(localStorage.getItem('customHonorHistory')) || [];
				const honorIndex = honorHistory.findIndex(h => h.id === honorId);
				
				if (honorIndex === -1) {
					showMessage('未找到该荣誉', 'warning');
					return;
				}

				const currentCount = getTodayIncreaseCount(honorId);
				
				if (currentCount >= 3) {
					showMessage('今日已增加3次，无法继续增加', 'warning');
					return;
				}
				
				honorHistory[honorIndex].currentPoints = (honorHistory[honorIndex].currentPoints || 0) + 1;
				const newCount = currentCount + 1;
				
				localStorage.setItem('customHonorHistory', JSON.stringify(honorHistory));
				localStorage.setItem(`honor_${honorId}_todayIncreaseCount`, newCount.toString());
				localStorage.setItem(`honor_${honorId}_lastIncreaseDate`, getTodayString());
				
				// 更新显示
				renderCurrentHonorList();
				renderHonorHistory();
				
				showMessage(`${honorHistory[honorIndex].title} 王者值 +1`, 'success');
				
				// 检查是否完成荣誉
				const honor = honorHistory[honorIndex];
				if (!honor.isCompleted && honor.currentPoints >= honor.pointsRequirement) {
					honor.isCompleted = true;
					honor.completedDate = new Date().toISOString();
					honor.completedTime = new Date().toLocaleString('zh-CN');
					localStorage.setItem('customHonorHistory', JSON.stringify(honorHistory));
					renderCurrentHonorList();
					renderHonorHistory();
					showMessage(`恭喜获得荣誉：${honor.title}！`, 'success');
				}
			}

			// 为指定荣誉减少王者值
			function decreaseHonorPoints(honorId) {
				const honorHistory = JSON.parse(localStorage.getItem('customHonorHistory')) || [];
				const honorIndex = honorHistory.findIndex(h => h.id === honorId);
				
				if (honorIndex === -1) {
					showMessage('未找到该荣誉', 'warning');
					return;
				}

				const currentPoints = honorHistory[honorIndex].currentPoints || 0;
				
				if (currentPoints <= 0) {
					showMessage('该荣誉王者值已为0，无法继续减少', 'warning');
					return;
				}
				
				honorHistory[honorIndex].currentPoints = currentPoints - 1;
				localStorage.setItem('customHonorHistory', JSON.stringify(honorHistory));
				
				// 更新显示
				renderCurrentHonorList();
				renderHonorHistory();
				
				showMessage(`${honorHistory[honorIndex].title} 王者值 -1`, 'info');
			}
			
			function updateHonorValueDisplay() {
				const points = getHonorValue();
				const count = getTodayIncreaseCount();
				
				// 更新显示
				const honorPointsElement = document.getElementById('currentHonorPoints');
				if (honorPointsElement) {
					honorPointsElement.textContent = points;
				}
				
				const todayCountElement = document.getElementById('todayIncreaseCount');
				if (todayCountElement) {
					todayCountElement.textContent = count;
				}
				
				// 更新按钮状态
				const increaseBtn = document.getElementById('increaseHonorBtn');
				const decreaseBtn = document.getElementById('decreaseHonorBtn');
				
				if (increaseBtn) {
					if (count >= 3) {
						increaseBtn.disabled = true;
						increaseBtn.classList.add('opacity-50', 'cursor-not-allowed');
					} else {
						increaseBtn.disabled = false;
						increaseBtn.classList.remove('opacity-50', 'cursor-not-allowed');
					}
				}
				
				if (decreaseBtn) {
					if (points <= 0) {
						decreaseBtn.disabled = true;
						decreaseBtn.classList.add('opacity-50', 'cursor-not-allowed');
					} else {
						decreaseBtn.disabled = false;
						decreaseBtn.classList.remove('opacity-50', 'cursor-not-allowed');
					}
				}
			}
			
			function checkHonorTitle(points) {
				const titles = [
					{ points: 0, title: '新手冒险者', description: '刚踏入学习之路的新手' },
					{ points: 50, title: '学习新星', description: '已经开始在学习路上闪闪发光' },
					{ points: 100, title: '知识探索者', description: '勇敢探索知识的未知领域' },
					{ points: 200, title: '智慧学者', description: '智慧的光芒照亮前路' },
					{ points: 300, title: '学霸之路', description: '学霸之路任重道远' },
					{ points: 500, title: '知识大师', description: '知识领域的真正大师' },
					{ points: 1000, title: '学习之王', description: '王者归来！学习的最高境界' }
				];
				
				let currentTitle = null;
				for (let i = titles.length - 1; i >= 0; i--) {
					if (points >= titles[i].points) {
						currentTitle = titles[i];
						break;
					}
				}
				
				if (currentTitle) {
					const savedTitle = localStorage.getItem('currentHonorTitle');
					if (savedTitle !== currentTitle.title) {
						localStorage.setItem('currentHonorTitle', currentTitle.title);
						
						// 延迟显示荣誉弹窗
						setTimeout(() => {
							showHonorAnimation(currentTitle);
						}, 1000);
					}
				}
			}
			
			function showHonorAnimation(titleData) {
				const modal = document.getElementById('honorModal');
				const title = document.getElementById('honorTitle');
				const description = document.getElementById('honorDescription');
				
				if (modal && title && description) {
					title.textContent = `恭喜获得新荣誉：${titleData.title}！`;
					description.textContent = titleData.description;
					modal.classList.remove('hidden');
					
					// 播放荣誉音效
					playHonorSound();
				}
			}
			
			function playHonorSound() {
				try {
					const audioContext = new (window.AudioContext || window.webkitAudioContext)();
					const oscillator = audioContext.createOscillator();
					const gainNode = audioContext.createGain();

					oscillator.connect(gainNode);
					gainNode.connect(audioContext.destination);

					oscillator.type = 'triangle';
					oscillator.frequency.setValueAtTime(440, audioContext.currentTime);
					oscillator.frequency.exponentialRampToValueAtTime(880, audioContext.currentTime + 0.2);
					oscillator.frequency.exponentialRampToValueAtTime(1320, audioContext.currentTime + 0.4);

					gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
					gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);

					oscillator.start(audioContext.currentTime);
					oscillator.stop(audioContext.currentTime + 0.5);
				} catch (error) {
					console.log('荣誉音效播放失败:', error);
				}
			}
			
			function showMessage(text, type = 'info') {
				// 创建临时消息元素
				const message = document.createElement('div');
				message.className = `fixed top-4 right-4 z-50 px-4 py-2 rounded-lg text-white font-bold transform transition-all duration-300 translate-x-full`;
				
				switch (type) {
					case 'success':
						message.classList.add('bg-green-500');
						break;
					case 'warning':
						message.classList.add('bg-yellow-500');
						break;
					case 'info':
						message.classList.add('bg-blue-500');
						break;
					default:
						message.classList.add('bg-gray-500');
				}
				
				message.textContent = text;
				document.body.appendChild(message);
				
				// 显示动画
				setTimeout(() => {
					message.classList.remove('translate-x-full');
				}, 100);
				
				// 3秒后移除
				setTimeout(() => {
					message.classList.add('translate-x-full');
					setTimeout(() => {
						if (document.body.contains(message)) {
							document.body.removeChild(message);
						}
					}, 300);
				}, 3000);
			}
		</script>

		<!-- 背包弹窗 -->
 		<div id="backpackModal"
 			class="fixed inset-0 bg-darkBg/95 backdrop-blur-md z-50 flex items-center justify-center hidden">
 			<div
 				class="bg-darkBg border-2 border-neonGreen rounded-2xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto animate-explode">
 				<div class="flex justify-between items-center mb-6">
 					<h2 class="text-2xl font-bold text-neonGreen text-shadow-neon">
 						<i class="fa fa-briefcase mr-2"></i>我的背包
 					</h2>
 					<button id="closeBackpackModal" class="text-gray-400 hover:text-white text-2xl">
 						<i class="fa fa-times"></i>
 					</button>
 				</div>
 				<div id="backpackItems" class="grid grid-cols-2 md:grid-cols-3 gap-4">
 					<!-- 背包物品动态生成 -->
 				</div>
 			</div>
 		</div>

 		<!-- 奖励弹窗 -->
 		<!-- 背包奖励弹窗 -->
 		<div id="backpackRewardModal"
 			class="fixed inset-0 bg-darkBg/95 backdrop-blur-md z-50 flex items-center justify-center hidden">
 			<div class="bg-darkBg border-4 border-neonPink rounded-3xl p-8 w-full max-w-md animate-explode">
 				<div class="text-center">
 					<div class="text-6xl mb-6 animate-bounce">
 						<i class="fa fa-gift text-neonPink"></i>
 					</div>
 					<h2 id="rewardTitle" class="text-2xl font-bold text-neonPink text-shadow-neon mb-4">恭喜你！</h2>
 					<p id="rewardContent" class="text-xl text-white mb-6"></p>
 					<button id="closeRewardModal"
 						class="bg-neonPink text-white px-8 py-3 rounded-lg text-lg font-bold transition-all duration-300 hover:scale-105 hover:bg-neonPink/80">
 						<i class="fa fa-check mr-2"></i>确定
 					</button>
 				</div>
 			</div>
 		</div>

 		<!-- 奖励值弹窗 -->
 		<div id="pointsModal"
 			class="fixed inset-0 bg-darkBg/95 backdrop-blur-md z-50 flex items-center justify-center hidden">
 			<div class="bg-darkBg border-4 border-neonBlue rounded-3xl p-8 w-full max-w-md animate-explode">
 				<div class="text-center">
 					<i class="fa fa-star text-neonBlue"></i>
 				</div>
 				<h2 id="pointsTitle" class="text-2xl font-bold text-neonBlue text-shadow-neon mb-4">恭喜你！</h2>
 				<p id="pointsContent" class="text-xl text-white mb-6"></p>
 				<button id="closePointsModal"
 					class="bg-neonBlue text-darkBg px-8 py-3 rounded-lg text-lg font-bold transition-all duration-300 hover:scale-105 hover:bg-neonBlue/80">
 					<i class="fa fa-check mr-2"></i>确定
 				</button>
 			</div>
 		</div>
 		</div>
 	</body>

 </html>